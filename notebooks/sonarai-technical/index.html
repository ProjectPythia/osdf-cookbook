<!DOCTYPE html><html lang="en" class="" style="scroll-padding:60px"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Contextual Integration of NCAR/NOAA Environmental Data with the NOAA Water Column Sonar Archive - OSDF Cookbook</title><meta property="og:title" content="Contextual Integration of NCAR/NOAA Environmental Data with the NOAA Water Column Sonar Archive - OSDF Cookbook"/><meta name="generator" content="mystmd"/><meta name="keywords" content=""/><meta name="image" content="/osdf-cookbook/build/cookbook_logo-35042cacdefd342d103254243b6520b3.png"/><meta property="og:image" content="/osdf-cookbook/build/cookbook_logo-35042cacdefd342d103254243b6520b3.png"/><link rel="stylesheet" href="/osdf-cookbook/build/_assets/app-5WKS5EPQ.css"/><link rel="stylesheet" href="/osdf-cookbook/build/_assets/thebe-core-VKVHG5VY.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jupyter-matplotlib@0.11.3/css/mpl_widget.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-T52X8HNYE8"></script><script>window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-T52X8HNYE8');</script><link rel="icon" href="/osdf-cookbook/favicon.ico"/><link rel="stylesheet" href="/osdf-cookbook/myst-theme.css"/><script>
  const savedTheme = localStorage.getItem("myst:theme");
  const theme = window.matchMedia("(prefers-color-scheme: light)").matches ? 'light' : 'dark';
  const classes = document.documentElement.classList;
  const hasAnyTheme = classes.contains('light') || classes.contains('dark');
  if (!hasAnyTheme) classes.add(savedTheme ?? theme);
</script></head><body class="m-0 transition-colors duration-500 bg-white dark:bg-stone-900"><div class="fixed top-1 left-1 h-[0px] w-[0px] focus-within:z-40 focus-within:h-auto focus-within:w-auto bg-white overflow-hidden focus-within:p-2 focus-within:ring-1" aria-label="skip to content options"><a href="#skip-to-frontmatter" class="block px-2 py-1 text-black underline">Skip to article frontmatter</a><a href="#skip-to-article" class="block px-2 py-1 text-black underline">Skip to article content</a></div><div class="bg-white/80 backdrop-blur dark:bg-stone-900/80 shadow dark:shadow-stone-700 p-3 md:px-8 sticky w-screen top-0 z-30 h-[60px]"><nav class="flex items-center justify-between flex-nowrap max-w-[1440px] mx-auto"><div class="flex flex-row xl:min-w-[19.5rem] mr-2 sm:mr-7 justify-start items-center shrink-0"><div class="block xl:hidden"><button class="flex items-center border-stone-400 text-stone-800 hover:text-stone-900 dark:text-stone-200 hover:dark:text-stone-100"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="m-1"><path fill-rule="evenodd" d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd"></path></svg><span class="sr-only">Open Menu</span></button></div><a class="flex items-center ml-3 dark:text-white w-fit md:ml-5 xl:ml-7" href="https://projectpythia.org"><div class="p-1 mr-3"><img src="/osdf-cookbook/build/config-item-24692dda-912711fa60f34a06b6e586a0ce2a7b3c.svg" class="h-9 dark:hidden" height="2.25rem"/><img src="/osdf-cookbook/build/config-item-84d6d338-7b0c18702c96d7dbd8b73b394237733c.svg" class="hidden h-9 dark:block" height="2.25rem"/></div><span class="text-md sm:text-xl tracking-tight sm:mr-5 sr-only">Made with MyST</span></a></div><div class="flex items-center flex-grow w-auto"><div class="flex-grow hidden text-md lg:block"><div class="relative inline-block mx-2 grow-0"><a class="inline-flex items-center justify-center w-full mx-2 py-1 text-md font-medium dark:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-opacity-75" href="/osdf-cookbookhttps://projectpythia.org">Home</a></div><div class="relative inline-block mx-2 grow-0"><a class="inline-flex items-center justify-center w-full mx-2 py-1 text-md font-medium dark:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-opacity-75" href="/osdf-cookbookhttps://foundations.projectpythia.org">Foundations</a></div><div class="relative inline-block mx-2 grow-0"><a class="inline-flex items-center justify-center w-full mx-2 py-1 text-md font-medium dark:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-opacity-75" href="/osdf-cookbookhttps://cookbooks.projectpythia.org/">Cookbooks</a></div><div class="relative inline-block mx-2 grow-0"><a class="inline-flex items-center justify-center w-full mx-2 py-1 text-md font-medium dark:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-opacity-75" href="/osdf-cookbookhttps://projectpythia.org/resource-gallery/">Resources</a></div><div class="relative inline-block mx-2 grow-0"><a class="inline-flex items-center justify-center w-full mx-2 py-1 text-md font-medium dark:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-opacity-75" href="/osdf-cookbookhttps://projectpythia.org/#join-us">Community</a></div></div><div class="flex-grow block"></div><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R74op:" data-state="closed" class="flex items-center h-10 aspect-square sm:w-64 text-left text-gray-400 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 hover:ring-blue-500 dark:hover:ring-blue-500 hover:border-blue-500 dark:hover:border-blue-500"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="p-2.5 h-10 w-10 aspect-square"><path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd"></path></svg><span class="hidden sm:block grow">Search</span><div aria-hidden="true" class="items-center hidden mx-1 font-mono text-sm text-gray-400 sm:flex gap-x-1"><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none hide-mac">CTRL</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none show-mac">⌘</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none ">K</kbd><script>
;(() => {
const script = document.currentScript;
const root = script.parentElement;

const isMac = /mac/i.test(
      window.navigator.userAgentData?.platform ?? window.navigator.userAgent,
    );
root.querySelectorAll(".hide-mac").forEach(node => {node.classList.add(isMac ? "hidden" : "block")});
root.querySelectorAll(".show-mac").forEach(node => {node.classList.add(!isMac ? "hidden" : "block")});
})()</script></div></button><button class="theme rounded-full aspect-square border border-stone-700 dark:border-white hover:bg-neutral-100 border-solid overflow-hidden text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 w-8 h-8 mx-3" title="Toggle theme between light and dark mode" aria-label="Toggle theme between light and dark mode"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="h-full w-full p-0.5 hidden dark:block"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd"></path></svg><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="h-full w-full p-0.5 dark:hidden"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"></path></svg></button><div class="block sm:hidden"><div class="relative" data-headlessui-state=""><div><button class="flex text-sm bg-transparent rounded-full focus:outline-none" id="headlessui-menu-button-:Rr4op:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Open Menu</span><div class="flex items-center text-stone-200 hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="p-1"><path fill-rule="evenodd" d="M10.5 6a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Zm0 6a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Zm0 6a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z" clip-rule="evenodd"></path></svg></div></button></div></div></div><div class="hidden sm:block"><a href="https://projectpythia.org" target="_blank" rel="noopener noreferrer" class="inline-block px-4 py-2 mx-1 mt-0 leading-none border rounded text-md border-stone-700 dark:border-white text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 hover:bg-neutral-100">Project Pythia</a></div></div></nav></div><div class="fixed xl:article-grid grid-gap xl:w-screen xl:pointer-events-none overflow-auto max-xl:min-w-[300px] hidden z-10" style="top:60px"><div class="pointer-events-auto xl:col-margin-left flex-col overflow-hidden hidden xl:flex"><div class="flex-grow py-6 overflow-y-auto primary-scrollbar"><nav aria-label="Navigation" class="overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px] lg:hidden"><div class="w-full px-1 dark:text-white font-medium"><a href="https://projectpythia.org" target="_blank" rel="noopener noreferrer" class="p-2 my-1 rounded-lg hover:bg-slate-300/30 block break-words focus:outline outline-blue-200 outline-2 rounded">Home</a><a href="https://foundations.projectpythia.org" target="_blank" rel="noopener noreferrer" class="p-2 my-1 rounded-lg hover:bg-slate-300/30 block break-words focus:outline outline-blue-200 outline-2 rounded">Foundations</a><a href="https://cookbooks.projectpythia.org/" target="_blank" rel="noopener noreferrer" class="p-2 my-1 rounded-lg hover:bg-slate-300/30 block break-words focus:outline outline-blue-200 outline-2 rounded">Cookbooks</a><a href="https://projectpythia.org/resource-gallery/" target="_blank" rel="noopener noreferrer" class="p-2 my-1 rounded-lg hover:bg-slate-300/30 block break-words focus:outline outline-blue-200 outline-2 rounded">Resources</a><a href="https://projectpythia.org/#join-us" target="_blank" rel="noopener noreferrer" class="p-2 my-1 rounded-lg hover:bg-slate-300/30 block break-words focus:outline outline-blue-200 outline-2 rounded">Community</a></div></nav><div class="my-3 border-b-2 lg:hidden"></div><nav aria-label="Table of Contents" class="flex-grow overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px]"><div class="w-full px-1 dark:text-white"><a title="OSDF Cookbook" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30 font-bold" href="/osdf-cookbook/">OSDF Cookbook</a><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Preamble" class="block break-words rounded py-2 grow cursor-pointer">Preamble</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rmp8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rmp8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Introduction to OSDF" class="block break-words rounded py-2 grow cursor-pointer">Introduction to OSDF</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rup8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rup8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="NCAR examples" class="block break-words rounded py-2 grow cursor-pointer">NCAR examples</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R16p8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R16p8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Envistor examples" class="block break-words rounded py-2 grow cursor-pointer">Envistor examples</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1ep8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1ep8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="NOAA SONAR data examples" class="block break-words rounded py-2 grow cursor-pointer">NOAA SONAR data examples</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1mp8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1mp8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="PYCOGSS examples" class="block break-words rounded py-2 grow cursor-pointer">PYCOGSS examples</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1up8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1up8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="OpenVISUS examples" class="block break-words rounded py-2 grow cursor-pointer">OpenVISUS examples</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R26p8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R26p8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div></div></nav></div><div class="flex-none py-6 transition-all duration-700 translate-y-6 opacity-0"><a class="flex mx-auto text-gray-700 w-fit hover:text-blue-700 dark:text-gray-200 dark:hover:text-blue-400" href="https://mystmd.org/made-with-myst" target="_blank" rel="noreferrer"><svg style="width:24px;height:24px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" stroke="none"><g id="icon"><path fill="currentColor" d="M23.8,54.8v-3.6l4.7-0.8V17.5l-4.7-0.8V13H36l13.4,31.7h0.2l13-31.7h12.6v3.6l-4.7,0.8v32.9l4.7,0.8v3.6h-15
          v-3.6l4.9-0.8V20.8H65L51.4,53.3h-3.8l-14-32.5h-0.1l0.2,17.4v12.1l5,0.8v3.6H23.8z"></path><path fill="#F37726" d="M47,86.9c0-5.9-3.4-8.8-10.1-8.8h-8.4c-5.2,0-9.4-1.3-12.5-3.8c-3.1-2.5-5.4-6.2-6.8-11l4.8-1.6
          c1.8,5.6,6.4,8.6,13.8,8.8h9.2c6.4,0,10.8,2.5,13.1,7.5c2.3-5,6.7-7.5,13.1-7.5h8.4c7.8,0,12.7-2.9,14.6-8.7l4.8,1.6
          c-1.4,4.9-3.6,8.6-6.8,11.1c-3.1,2.5-7.3,3.7-12.4,3.8H63c-6.7,0-10,2.9-10,8.8"></path></g></svg><span class="self-center ml-2 text-sm">Made with MyST</span></a></div></div></div><main class="article-grid grid-gap"><article class="article-grid subgrid-gap col-screen article content"><div class="hidden"></div><div id="skip-to-frontmatter" aria-label="article frontmatter" class="mb-8 pt-9"><div class="flex items-center h-6 mb-5 text-sm font-light"><div class="flex-grow"></div><a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="noopener noreferrer" class="opacity-50 hover:opacity-100 text-inherit hover:text-inherit" aria-label="Content License: Creative Commons Attribution 4.0 International (CC-BY-4.0)"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="inline-block mx-1"><title>Content License: Creative Commons Attribution 4.0 International (CC-BY-4.0)</title><path d="M12 2.2c2.7 0 5 1 7 2.9.9.9 1.6 2 2.1 3.1.5 1.2.7 2.4.7 3.8 0 1.3-.2 2.6-.7 3.8-.5 1.2-1.2 2.2-2.1 3.1-1 .9-2 1.7-3.2 2.2-1.2.5-2.5.7-3.7.7s-2.6-.3-3.8-.8c-1.2-.5-2.2-1.2-3.2-2.1s-1.6-2-2.1-3.2-.8-2.4-.8-3.7c0-1.3.2-2.5.7-3.7S4.2 6 5.1 5.1C7 3.2 9.3 2.2 12 2.2zM12 4c-2.2 0-4.1.8-5.6 2.3C5.6 7.1 5 8 4.6 9c-.4 1-.6 2-.6 3s.2 2.1.6 3c.4 1 1 1.8 1.8 2.6S8 19 9 19.4c1 .4 2 .6 3 .6s2.1-.2 3-.6c1-.4 1.9-1 2.7-1.8 1.5-1.5 2.3-3.3 2.3-5.6 0-1.1-.2-2.1-.6-3.1-.4-1-1-1.8-1.7-2.6C16.1 4.8 14.2 4 12 4zm-.1 6.4l-1.3.7c-.1-.3-.3-.5-.5-.6-.2-.1-.4-.2-.6-.2-.9 0-1.3.6-1.3 1.7 0 .5.1.9.3 1.3.2.3.5.5 1 .5.6 0 1-.3 1.2-.8l1.2.6c-.3.5-.6.9-1.1 1.1-.5.3-1 .4-1.5.4-.9 0-1.6-.3-2.1-.8-.5-.6-.8-1.3-.8-2.3 0-.9.3-1.7.8-2.2.6-.6 1.3-.8 2.1-.8 1.2 0 2.1.4 2.6 1.4zm5.6 0l-1.3.7c-.1-.3-.3-.5-.5-.6-.2-.1-.4-.2-.6-.2-.9 0-1.3.6-1.3 1.7 0 .5.1.9.3 1.3.2.3.5.5 1 .5.6 0 1-.3 1.2-.8l1.2.6c-.3.5-.6.9-1.1 1.1-.4.2-.9.3-1.4.3-.9 0-1.6-.3-2.1-.8s-.8-1.3-.8-2.2c0-.9.3-1.7.8-2.2.5-.5 1.2-.8 2-.8 1.2 0 2.1.4 2.6 1.4z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="inline-block mr-1"><title>Credit must be given to the creator</title><path d="M12 2.2c2.7 0 5 .9 6.9 2.8 1.9 1.9 2.8 4.2 2.8 6.9s-.9 5-2.8 6.8c-2 1.9-4.3 2.9-7 2.9-2.6 0-4.9-1-6.9-2.9-1.8-1.7-2.8-4-2.8-6.7s1-5 2.9-6.9C7 3.2 9.3 2.2 12 2.2zM12 4c-2.2 0-4.1.8-5.6 2.3C4.8 8 4 9.9 4 12c0 2.2.8 4 2.4 5.6C8 19.2 9.8 20 12 20c2.2 0 4.1-.8 5.7-2.4 1.5-1.5 2.3-3.3 2.3-5.6 0-2.2-.8-4.1-2.3-5.7C16.1 4.8 14.2 4 12 4zm2.6 5.6v4h-1.1v4.7h-3v-4.7H9.4v-4c0-.2.1-.3.2-.4.1-.2.2-.2.4-.2h4c.2 0 .3.1.4.2.2.1.2.2.2.4zm-4-2.5c0-.9.5-1.4 1.4-1.4s1.4.5 1.4 1.4c0 .9-.5 1.4-1.4 1.4s-1.4-.5-1.4-1.4z"></path></svg></a><a href="https://opensource.org/licenses/Apache-2.0" target="_blank" rel="noopener noreferrer" title="Code License: Apache License 2.0 (Apache-2.0)" class="text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="mx-1 inline-block opacity-60 hover:opacity-100 hover:text-[#599F46]"><path d="M13.2 15.6c1.4-.5 2.1-1.6 2.1-3.3S13.8 8.9 12 8.9c-1.9 0-3.3 1.6-3.3 3.3 0 1.8.8 3 2.2 3.4l-2.3 5.9c-3.1-.8-6.3-4.6-6.3-9.3 0-5.5 4.3-10 9.7-10s9.8 4.5 9.8 10c0 4.7-3.1 8.5-6.3 9.3l-2.3-5.9z"></path></svg></a><a href="https://en.wikipedia.org/wiki/Open_access" target="_blank" rel="noopener noreferrer" title="Open Access" class="text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="mr-1 inline-block opacity-60 hover:opacity-100 hover:text-[#E18435]"><path d="M17.1 12.6h-2V7.5c0-1.7-1.4-3.1-3-3.1-.8 0-1.6.3-2.2.9-.6.5-.9 1.3-.9 2.2v.7H7v-.7c0-1.4.5-2.7 1.5-3.7s2.2-1.5 3.6-1.5 2.6.5 3.6 1.5 1.5 2.3 1.5 3.7v5.1z"></path><path d="M12 21.8c-.8 0-1.6-.2-2.3-.5-.7-.3-1.4-.8-1.9-1.3-.6-.6-1-1.2-1.3-2-.3-.8-.5-1.6-.5-2.4s.2-1.6.5-2.4c.3-.7.7-1.4 1.3-2s1.2-1 1.9-1.3c.7-.3 1.5-.5 2.3-.5.8 0 1.6.2 2.3.5.7.3 1.4.8 1.9 1.3.6.6 1 1.2 1.3 2 .3.8.5 1.6.5 2.4s-.2 1.6-.5 2.4c-.3.7-.7 1.4-1.3 2-.6.6-1.2 1-1.9 1.3-.7.3-1.5.5-2.3.5zm0-10.3c-2.2 0-4 1.8-4 4.1s1.8 4.1 4 4.1 4-1.8 4-4.1-1.8-4.1-4-4.1z"></path><circle cx="12" cy="15.6" r="1.7"></circle></svg></a><a href="https://github.com/projectpythia/osdf-cookbook" title="GitHub Repository: projectpythia/osdf-cookbook" target="_blank" rel="noopener noreferrer" class="text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="inline-block mr-1 opacity-60 hover:opacity-100"><path d="M12 2.5c-5.4 0-9.8 4.4-9.8 9.7 0 4.3 2.8 8 6.7 9.2.5.1.7-.2.7-.5v-1.8c-2.4.5-3.1-.6-3.3-1.1-.1-.3-.6-1.1-1-1.4-.3-.2-.8-.6 0-.6s1.3.7 1.5 1c.9 1.5 2.3 1.1 2.8.8.1-.6.3-1.1.6-1.3-2.2-.2-4.4-1.1-4.4-4.8 0-1.1.4-1.9 1-2.6-.1-.2-.4-1.2.1-2.6 0 0 .8-.3 2.7 1 .8-.2 1.6-.3 2.4-.3.8 0 1.7.1 2.4.3 1.9-1.3 2.7-1 2.7-1 .5 1.3.2 2.3.1 2.6.6.7 1 1.5 1 2.6 0 3.7-2.3 4.6-4.4 4.8.4.3.7.9.7 1.8V21c0 .3.2.6.7.5 3.9-1.3 6.6-4.9 6.6-9.2 0-5.4-4.4-9.8-9.8-9.8z"></path></svg></a><div class="inline-block mr-1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="inline-block"><title>Jupyter Notebook</title><path d="M20.2 1.7c0 .8-.5 1.4-1.3 1.5-.8 0-1.4-.5-1.5-1.3 0-.8.5-1.4 1.3-1.5.8-.1 1.5.5 1.5 1.3zM12 17.9c-3.7 0-7-1.3-8.7-3.3 1.8 4.8 7.1 7.3 11.9 5.5 2.5-.9 4.5-2.9 5.5-5.5-1.7 2-4.9 3.3-8.7 3.3zM12 5.1c3.7 0 7 1.3 8.7 3.3-1.8-4.8-7.1-7.3-11.9-5.5-2.5.9-4.5 2.9-5.5 5.5 1.7-2 5-3.3 8.7-3.3zM6.9 21.8c.1 1-.7 1.8-1.7 1.9-1 .1-1.8-.7-1.9-1.7 0-1 .7-1.8 1.7-1.9 1-.1 1.8.7 1.9 1.7zM3.7 4.6c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1c0 .5-.4 1-1 1z"></path></svg></div><a href="https://github.com/projectpythia/osdf-cookbook/edit/main/notebooks/04_SonarAI_Technical.ipynb" title="Edit This Page" target="_blank" rel="noopener noreferrer" class="text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="inline-block mr-1 opacity-60 hover:opacity-100"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg></a><div class="relative flex inline-block mx-1 grow-0" data-headlessui-state=""><button class="relative ml-2 -mr-1" id="headlessui-menu-button-:Rs8top:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Downloads</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem"><title>Download</title><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg></button></div><button class="inline-flex size-[24px] hover:text-[#E18435] items-center justify-center" aria-label="Launch in external computing interface" title="Launch in external computing interface" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:Re8top:" data-state="closed"><svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.85357 3.85355L7.65355 3.05353C8.2981 2.40901 9.42858 1.96172 10.552 1.80125C11.1056 1.72217 11.6291 1.71725 12.0564 1.78124C12.4987 1.84748 12.7698 1.97696 12.8965 2.10357C13.0231 2.23018 13.1526 2.50125 13.2188 2.94357C13.2828 3.37086 13.2779 3.89439 13.1988 4.44801C13.0383 5.57139 12.591 6.70188 11.9464 7.34645L7.49999 11.7929L6.35354 10.6465C6.15827 10.4512 5.84169 10.4512 5.64643 10.6465C5.45117 10.8417 5.45117 11.1583 5.64643 11.3536L7.14644 12.8536C7.34171 13.0488 7.65829 13.0488 7.85355 12.8536L8.40073 12.3064L9.57124 14.2572C9.65046 14.3893 9.78608 14.4774 9.9389 14.4963C10.0917 14.5151 10.2447 14.4624 10.3535 14.3536L12.3535 12.3536C12.4648 12.2423 12.5172 12.0851 12.495 11.9293L12.0303 8.67679L12.6536 8.05355C13.509 7.19808 14.0117 5.82855 14.1887 4.58943C14.2784 3.9618 14.2891 3.33847 14.2078 2.79546C14.1287 2.26748 13.9519 1.74482 13.6035 1.39645C13.2552 1.04809 12.7325 0.871332 12.2045 0.792264C11.6615 0.710945 11.0382 0.721644 10.4105 0.8113C9.17143 0.988306 7.80189 1.491 6.94644 2.34642L6.32322 2.96968L3.07071 2.50504C2.91492 2.48278 2.75773 2.53517 2.64645 2.64646L0.646451 4.64645C0.537579 4.75533 0.484938 4.90829 0.50375 5.0611C0.522563 5.21391 0.61073 5.34954 0.742757 5.42876L2.69364 6.59928L2.14646 7.14645C2.0527 7.24022 2.00002 7.3674 2.00002 7.50001C2.00002 7.63261 2.0527 7.75979 2.14646 7.85356L3.64647 9.35356C3.84173 9.54883 4.15831 9.54883 4.35357 9.35356C4.54884 9.1583 4.54884 8.84172 4.35357 8.64646L3.20712 7.50001L3.85357 6.85356L6.85357 3.85355ZM10.0993 13.1936L9.12959 11.5775L11.1464 9.56067L11.4697 11.8232L10.0993 13.1936ZM3.42251 5.87041L5.43935 3.85356L3.17678 3.53034L1.80638 4.90074L3.42251 5.87041ZM2.35356 10.3535C2.54882 10.1583 2.54882 9.8417 2.35356 9.64644C2.1583 9.45118 1.84171 9.45118 1.64645 9.64644L0.646451 10.6464C0.451188 10.8417 0.451188 11.1583 0.646451 11.3535C0.841713 11.5488 1.1583 11.5488 1.35356 11.3535L2.35356 10.3535ZM3.85358 11.8536C4.04884 11.6583 4.04885 11.3417 3.85359 11.1465C3.65833 10.9512 3.34175 10.9512 3.14648 11.1465L1.14645 13.1464C0.95119 13.3417 0.951187 13.6583 1.14645 13.8535C1.34171 14.0488 1.65829 14.0488 1.85355 13.8536L3.85358 11.8536ZM5.35356 13.3535C5.54882 13.1583 5.54882 12.8417 5.35356 12.6464C5.1583 12.4512 4.84171 12.4512 4.64645 12.6464L3.64645 13.6464C3.45119 13.8417 3.45119 14.1583 3.64645 14.3535C3.84171 14.5488 4.1583 14.5488 4.35356 14.3535L5.35356 13.3535ZM9.49997 6.74881C10.1897 6.74881 10.7488 6.1897 10.7488 5.5C10.7488 4.8103 10.1897 4.25118 9.49997 4.25118C8.81026 4.25118 8.25115 4.8103 8.25115 5.5C8.25115 6.1897 8.81026 6.74881 9.49997 6.74881Z" fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"></path></svg></button></div><h1 class="mb-0">Contextual Integration of NCAR/NOAA Environmental Data with the NOAA Water Column Sonar Archive</h1><header class="mt-4 not-prose"><div><span class="font-semibold text-sm inline-block text-comma"><button class="focus:shadow-[0_0_0_2px] focus:shadow-black outline-none hover:underline" aria-label="Author Details" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R138top:" data-state="closed">Harsha R. Hampapura</button></span><span class="font-semibold text-sm inline-block text-comma"><button class="focus:shadow-[0_0_0_2px] focus:shadow-black outline-none hover:underline" aria-label="Author Details" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R158top:" data-state="closed">Brian Bockelman</button></span><span class="font-semibold text-sm inline-block text-comma"><button class="focus:shadow-[0_0_0_2px] focus:shadow-black outline-none hover:underline" aria-label="Author Details" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R178top:" data-state="closed">Alexander Hoelzeman</button></span><span class="font-semibold text-sm inline-block text-comma"><button class="focus:shadow-[0_0_0_2px] focus:shadow-black outline-none hover:underline" aria-label="Author Details" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R198top:" data-state="closed">Carrie Wall</button></span><span class="font-semibold text-sm inline-block text-comma"><button class="focus:shadow-[0_0_0_2px] focus:shadow-black outline-none hover:underline" aria-label="Author Details" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R1b8top:" data-state="closed">Emma Turetsky</button></span><span class="font-semibold text-sm inline-block text-comma"><button class="focus:shadow-[0_0_0_2px] focus:shadow-black outline-none hover:underline" aria-label="Author Details" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R1d8top:" data-state="closed">Amandha Wingert Barok</button></span><span class="font-semibold text-sm inline-block text-comma"><button class="focus:shadow-[0_0_0_2px] focus:shadow-black outline-none hover:underline" aria-label="Author Details" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R1f8top:" data-state="closed">Aashish Panta</button></span><span class="font-semibold text-sm inline-block text-comma"><button class="focus:shadow-[0_0_0_2px] focus:shadow-black outline-none hover:underline" aria-label="Author Details" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R1h8top:" data-state="closed">Riley Conroy</button></span><span class="font-semibold text-sm inline-block text-comma"><button class="focus:shadow-[0_0_0_2px] focus:shadow-black outline-none hover:underline" aria-label="Author Details" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R1j8top:" data-state="closed">Douglas Schuster</button></span><span class="font-semibold text-sm inline-block text-comma"><button class="focus:shadow-[0_0_0_2px] focus:shadow-black outline-none hover:underline" aria-label="Author Details" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R1l8top:" data-state="closed">Justin Hiemstra</button></span><span class="font-semibold text-sm inline-block text-comma"><button class="focus:shadow-[0_0_0_2px] focus:shadow-black outline-none hover:underline" aria-label="Author Details" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R1n8top:" data-state="closed">Joanmarie Del Vecchio</button></span><span class="font-semibold text-sm inline-block"><button class="focus:shadow-[0_0_0_2px] focus:shadow-black outline-none hover:underline" aria-label="Author Details" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R1p8top:" data-state="closed">Kibiwott Koech</button></span></div></header></div><div class="block my-10 lg:sticky lg:z-10 lg:h-0 lg:pt-0 lg:my-0 lg:ml-10 lg:col-margin-right" style="top:60px"><nav></nav></div><div class="sticky top-[60px] pb-[14px] flex justify-end w-full z-20 pointer-events-none"><div class="flex p-1 m-1 space-x-1 border rounded-full shadow pointer-events-auto border-stone-300 bg-white/80 dark:bg-stone-900/80 backdrop-blur"><div class="rounded"><button class="flex text-center rounded-full cursor-pointer text-stone-800 dark:text-white hover:opacity-100 opacity-60" aria-label="start compute environment"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="inline-block w-6 h-6 align-top"><title>Launch kernel</title><path stroke-linecap="round" stroke-linejoin="round" d="M5.636 5.636a9 9 0 1 0 12.728 0M12 3v9"></path></svg></button></div></div></div><div id="skip-to-article"></div><div id="Ykuve0pCQX" class="relative group/block"><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-text" style="white-space:pre"></code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div></div><div id="EyZlArtwVr" class="relative group/block"><h1 id="contextual-integration-of-ncar-noaa-environmental-data-with-the-noaa-water-column-sonar-archive" class="relative group"><span class="heading-text">Contextual Integration of NCAR/NOAA Environmental Data with the NOAA Water Column Sonar Archive</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#contextual-integration-of-ncar-noaa-environmental-data-with-the-noaa-water-column-sonar-archive" title="Link to this Section" aria-label="Link to this Section">¶</a></h1><p>This notebook walks through an end-to-end workflow to relate shipboard sonar backscatter (Sv) to local environmental conditions. We (1) open EK60 data from a public NOAA S3 Zarr, (2) gather co-located environmental variables from OISST and IOOS ERDDAP, (3) compute hourly mean Sv, (4) assemble a depth×time error map for reference, and (5) synchronize timestamps to produce an interactive line-plus-heatmap visualization. All selections (time/depth/frequency) and conversions are kept explicit for reproducibility.</p><ol start="1"><li><p><strong>Imports</strong>
Load core libraries for data access (xarray, s3fs), analysis (numpy, pandas), plotting (plotly), and I/O.</p></li><li><p><strong>Initializing the datasets</strong>
Access HB1906 EK60 Zarr data from public S3; subset by time/depth, select 38 kHz, and mask bins below bottom.</p></li><li><p><strong>Access buoy data</strong>
Define Georges Bank buoy coordinates, sample daily OISST SST at the nearest grid cell (±1 day), and download the model error map (<code>.npy</code>).</p></li><li><p><strong>Calculate the temperature anomaly, sun elevation in degree and azimuth</strong></p></li><li><p><strong>Downloading external error map for the specific location</strong>
Downloading the error map comes from a fixed file</p></li><li><p><strong>Helper Function: Mean Sv (dB)</strong>
Convert Sv from dB→linear, compute mean, convert back to dB.</p></li><li><p><strong>Group Cruise Data into Hourly Chunks</strong>
Add an hourly label and split the EK60 dataset into per-hour <code>xarray.Dataset</code> chunks.</p></li><li><p><strong>Compute Hourly Mean Sv &amp; Attach to <code>env_df</code></strong>
Aggregate Sv per hour and append results as a new column in the environmental dataframe.</p></li><li><p><strong>Build Depth×Time Error-Map DataFrame &amp; Align Timestamps</strong>
Construct a depth-by-time matrix from the error map, guard for size mismatches, and align <code>env_df</code> endpoints to the heatmap timestamps.</p></li><li><p><strong>Data Visualization: Synchronized Lines + Heatmap</strong>
Plot environmental time series above a depth×time heatmap with shared x-axis; save interactive HTML output.</p></li></ol></div><div id="xEg2lVzSzY" class="relative group/block"><hr class="py-2 my-5 translate-y-2"/></div><div id="nSun1yY1Ng" class="relative group/block"><h1 id="prerequisites" class="relative group"><span class="heading-text">Prerequisites</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#prerequisites" title="Link to this Section" aria-label="Link to this Section">¶</a></h1><p>This section was inspired by <a href="https://github.com/alan-turing-institute/the-turing-way/blob/master/book/templates/chapter-template/chapter-landing-page.md" class="italic" target="_blank" rel="noreferrer" data-state="closed">this template</a> of the wonderful <a target="_blank" rel="noreferrer" href="https://the-turing-way.netlify.app" class="">The Turing Way</a> Jupyter Book.</p><p>This notebook opens public NOAA EK60 Zarr data from S3, subsets by time/depth, reads daily OISST SST near a buoy, fetches ERDDAP environmental variables, computes hourly mean <strong>Sv</strong> (dB), aligns with a depth×time error map, and renders synchronized line/heatmap plots.</p><p>Label the importance of each concept explicitly as <strong>helpful/necessary</strong>.</p><table class=""><tbody><tr class=""><th class="">Concepts</th><th class="">Importance</th><th class="">Notes</th></tr><tr class=""><td class="">Xarray + Zarr basics</td><td class=""><strong>Necessary</strong></td><td class="">Opening Zarr stores, selecting by coords/dims, <code>.compute()</code> semantics</td></tr><tr class=""><td class="">s3fs &amp; public S3 access</td><td class=""><strong>Necessary</strong></td><td class="">Anonymous reads from AWS S3 (<code>anon=True</code>)</td></tr><tr class=""><td class="">Pandas time series</td><td class=""><strong>Necessary</strong></td><td class=""><code>DatetimeIndex</code>, sorting, filtering, timezone-naive vs. aware</td></tr><tr class=""><td class="">NumPy fundamentals</td><td class=""><strong>Necessary</strong></td><td class="">Array slicing, stats, type conversion</td></tr><tr class=""><td class="">Acoustic backscatter (Sv) &amp; dB averaging</td><td class=""><strong>Necessary</strong></td><td class="">Convert dB→linear, mean, then linear→dB, Understanding results</td></tr><tr class=""><td class="">ERDDAP tabledap &amp; info endpoints</td><td class=""><strong>Helpful</strong></td><td class="">Reading CSV responses; unit metadata lookup</td></tr><tr class=""><td class="">Plotly fundamentals</td><td class=""><strong>Helpful</strong></td><td class="">Subplots, heatmaps, interactive HTML export</td></tr><tr class=""><td class="">Understanding of NetCDF/CF</td><td class=""><strong>Helpful</strong></td><td class="">Variable metadata and geospatial conventions</td></tr><tr class=""><td class="">Dask awareness</td><td class=""><strong>Helpful</strong></td><td class="">Lazy arrays; when/why to call <code>.compute()</code></td></tr><tr class=""><td class="">Geographic coordinates</td><td class=""><strong>Helpful</strong></td><td class="">0–360 vs. −180–180 longitude handling</td></tr><tr class=""><td class="">HTTP/IO with <code>requests</code></td><td class=""><strong>Helpful</strong></td><td class="">Downloading <code>.npy</code> assets for local use</td></tr></tbody></table><ul><li><p><strong>Time to learn</strong>: ~75 minutes</p></li><li><p><strong>System requirements</strong>:</p><ul><li><p>Python 3.9+ with Jupyter Notebook/Lab</p></li><li><p>Required packages: <code>xarray</code>, <code>s3fs</code>, <code>numpy</code>, <code>pandas</code>, <code>plotly</code>, <code>requests</code>, <code>netCDF4</code> <em>(optional but helpful: <code>dask</code>)</em></p></li></ul></li></ul><p><strong>Note:</strong> Run the cell below <strong>only</strong> in a local environment to install the required packages. If you’re using Binder, skip this step.</p></div><div id="npi1gU69Nr" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import os
import sys
import yaml
import shutil
import subprocess

ENV_PATH = &quot;../environment.yml&quot;

with open(ENV_PATH, &quot;r&quot;, encoding=&quot;utf-8&quot;) as f:
    env = yaml.safe_load(f)

channels = env.get(&quot;channels&quot;, [])
deps = env.get(&quot;dependencies&quot;, [])

conda_pkgs = []
pip_pkgs = []

for dep in deps:
    if isinstance(dep, str):
        # Skip python pin and the literal &#x27;pip&#x27; meta-package entry
        name = dep.split(&quot;=&quot;)[0].strip().lower()
        if name in {&quot;python&quot;, &quot;pip&quot;}:
            continue
        conda_pkgs.append(dep)
    elif isinstance(dep, dict) and &quot;pip&quot; in dep:
        pip_pkgs.extend(dep[&quot;pip&quot;])

# Prefer mamba if present; fallback to conda
conda_exe = shutil.which(&quot;mamba&quot;) or shutil.which(&quot;conda&quot;)

# Install Conda packages
if conda_pkgs:
    if not conda_exe:
        raise RuntimeError(&quot;Conda/mamba not found in PATH. Run this inside a Conda environment.&quot;)
    # Install into the current environment prefix
    env_prefix = os.environ.get(&quot;CONDA_PREFIX&quot;, sys.prefix)
    cmd = [conda_exe, &quot;install&quot;, &quot;-y&quot;, &quot;-p&quot;, env_prefix]
    for ch in channels:
        cmd += [&quot;-c&quot;, ch]
    cmd += conda_pkgs
    print(&quot;Running:&quot;, &quot; &quot;.join(cmd))
    subprocess.check_call(cmd)
else:
    print(&quot;No Conda packages to install.&quot;)

# Install pip packages into the current kernel&#x27;s Python
if pip_pkgs:
    cmd = [sys.executable, &quot;-m&quot;, &quot;pip&quot;, &quot;install&quot;, *pip_pkgs]
    print(&quot;Running:&quot;, &quot; &quot;.join(cmd))
    subprocess.check_call(cmd)
else:
    print(&quot;No pip packages to install.&quot;)
</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="_r_2xclWBTNak9SrUmKWH" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>Running: /usr/bin/conda install -y -p /home/runner/micromamba/envs/osdf-cookbook -c conda-forge jupyterlab mystmd jupyterlab-myst aiohttp bash_kernel intake=0.7.0 intake-esm=2024.2.6 pelicanplatform panel bokeh xmltodict cartopy colorcet cf-units boto3 basemap pelicanfs=1.2.1 matplotlib metpy pandas xarray geopandas pystac-client rasterio dask dask-jobqueue openpyxl hvplot plotly zarr=2.18.1 s3fs seaborn tqdm h5netcdf igwn-auth-utils=1.4.0
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span style="color:rgb(187, 187, 0);font-weight:bold">CI detected</span><span style="color:rgb(187, 187, 0);font-weight:bold">...</span><span>
</span><span style="color:rgb(187, 187, 0);font-weight:bold">By accessing </span><span style="color:rgb(85, 85, 255);text-decoration:underline">https://repo.anaconda.com/pkgs/main</span><span style="color:rgb(187, 187, 0);font-weight:bold"> via CI for this repository you </span><span>
</span><span style="color:rgb(187, 187, 0);font-weight:bold">acknowledge and agree to the Terms of Service:</span><span>
</span><span style="color:rgb(187, 187, 0);font-weight:bold">ANACONDA TERMS OF SERVICE</span><span>
</span><span style="color:rgb(187, 187, 0);font-weight:bold">Effective Date: July </span><span style="color:rgb(0, 187, 187);font-weight:bold">15</span><span style="color:rgb(187, 187, 0);font-weight:bold">, </span><span style="color:rgb(0, 187, 187);font-weight:bold">2025</span><span>

</span><span style="color:rgb(187, 187, 0);font-weight:bold">See </span><span style="color:rgb(85, 85, 255);text-decoration:underline">https://anaconda.com/legal/terms/terms-of-service</span><span>
</span><span style="color:rgb(187, 187, 0);font-weight:bold">By accessing </span><span style="color:rgb(85, 85, 255);text-decoration:underline">https://repo.anaconda.com/pkgs/r</span><span style="color:rgb(187, 187, 0);font-weight:bold"> via CI for this repository you </span><span>
</span><span style="color:rgb(187, 187, 0);font-weight:bold">acknowledge and agree to the Terms of Service:</span><span>
</span><span style="color:rgb(187, 187, 0);font-weight:bold">ANACONDA TERMS OF SERVICE</span><span>
</span><span style="color:rgb(187, 187, 0);font-weight:bold">Effective Date: July </span><span style="color:rgb(0, 187, 187);font-weight:bold">15</span><span style="color:rgb(187, 187, 0);font-weight:bold">, </span><span style="color:rgb(0, 187, 187);font-weight:bold">2025</span><span>

</span><span style="color:rgb(187, 187, 0);font-weight:bold">See </span><span style="color:rgb(85, 85, 255);text-decoration:underline">https://anaconda.com/legal/terms/terms-of-service</span><span>
</span><span style="color:rgb(0, 187, 0);font-weight:bold">2</span><span style="color:rgb(0, 187, 0);font-weight:bold"> channel Terms of Service accepted</span><span>
Retrieving notices: \ </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>done
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>Channels:
 - conda-forge
 - defaults
Platform: linux-64
Collecting package metadata (repodata.json): - </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>/ </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>\ </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>- </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>| </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>\ </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>- </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>/ </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>\ </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>/ </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>\ </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>- </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>| </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>- </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>/ </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>| </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>- </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>| </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>\ </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>- </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>| </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>/ </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>- </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>\ </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>| </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>/ </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>- </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>\ </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>/ </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>done
Solving environment: | </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>- </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>| </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>- </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>| </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>- </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>| </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>- </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>| </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>- </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>| </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>- </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>| </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>- </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>| </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>- </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>| </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>- </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>| </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>- </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>| </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>- </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>| </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>- </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>| </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>- </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>| </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>- </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>| </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>- </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>| </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>- </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>| </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>- </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>| </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>- </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>| </span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>done
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>

==&gt; WARNING: A newer version of conda exists. &lt;==
    current version: 25.7.0
    latest version: 25.9.0

Please update conda by running

    $ conda update -n base -c defaults conda


</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>
# All requested packages already installed.

</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>Running: /home/runner/micromamba/envs/osdf-cookbook/bin/python -m pip install import-ipynb OpenVisus openvisuspy pvlib rioxarray stackstac
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>Requirement already satisfied: import-ipynb in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (0.2)
Requirement already satisfied: OpenVisus in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (2.2.142)
Requirement already satisfied: openvisuspy in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (1.0.71)
Requirement already satisfied: pvlib in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (0.13.1)
Requirement already satisfied: rioxarray in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (0.19.0)
Requirement already satisfied: stackstac in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (0.5.1)
Requirement already satisfied: IPython in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from import-ipynb) (9.6.0)
Requirement already satisfied: nbformat in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from import-ipynb) (5.10.4)
Requirement already satisfied: numpy&gt;=1.21.2 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from pvlib) (2.3.3)
Requirement already satisfied: pandas&gt;=1.3.3 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from pvlib) (2.2.3)
Requirement already satisfied: pytz in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from pvlib) (2024.1)
Requirement already satisfied: requests in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from pvlib) (2.32.5)
Requirement already satisfied: scipy&gt;=1.7.2 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from pvlib) (1.16.2)
Requirement already satisfied: h5py in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from pvlib) (3.14.0)
Requirement already satisfied: packaging in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from rioxarray) (25.0)
Requirement already satisfied: rasterio&gt;=1.4.3 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from rioxarray) (1.4.3)
Requirement already satisfied: xarray&gt;=2024.7.0 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from rioxarray) (2025.9.1)
Requirement already satisfied: pyproj&gt;=3.3 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from rioxarray) (3.7.2)
Requirement already satisfied: dask&gt;=2022.1.1 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from dask[array]&gt;=2022.1.1-&gt;stackstac) (2025.9.1)
Requirement already satisfied: python-dateutil&gt;=2.8.2 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from pandas&gt;=1.3.3-&gt;pvlib) (2.9.0.post0)
Requirement already satisfied: tzdata&gt;=2022.7 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from pandas&gt;=1.3.3-&gt;pvlib) (2025.2)
Requirement already satisfied: certifi in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from pyproj&gt;=3.3-&gt;rioxarray) (2025.8.3)
Requirement already satisfied: affine in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from rasterio&gt;=1.4.3-&gt;rioxarray) (2.4.0)
Requirement already satisfied: attrs in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from rasterio&gt;=1.4.3-&gt;rioxarray) (25.3.0)
Requirement already satisfied: click&gt;=4.0 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from rasterio&gt;=1.4.3-&gt;rioxarray) (8.3.0)
Requirement already satisfied: cligj&gt;=0.5 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from rasterio&gt;=1.4.3-&gt;rioxarray) (0.7.2)
Requirement already satisfied: click-plugins in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from rasterio&gt;=1.4.3-&gt;rioxarray) (1.1.1.2)
Requirement already satisfied: pyparsing in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from rasterio&gt;=1.4.3-&gt;rioxarray) (3.2.5)
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>Requirement already satisfied: cloudpickle&gt;=3.0.0 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from dask&gt;=2022.1.1-&gt;dask[array]&gt;=2022.1.1-&gt;stackstac) (3.1.1)
Requirement already satisfied: fsspec&gt;=2021.09.0 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from dask&gt;=2022.1.1-&gt;dask[array]&gt;=2022.1.1-&gt;stackstac) (2025.9.0)
Requirement already satisfied: partd&gt;=1.4.0 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from dask&gt;=2022.1.1-&gt;dask[array]&gt;=2022.1.1-&gt;stackstac) (1.4.2)
Requirement already satisfied: pyyaml&gt;=5.3.1 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from dask&gt;=2022.1.1-&gt;dask[array]&gt;=2022.1.1-&gt;stackstac) (6.0.3)
Requirement already satisfied: toolz&gt;=0.10.0 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from dask&gt;=2022.1.1-&gt;dask[array]&gt;=2022.1.1-&gt;stackstac) (1.0.0)
Requirement already satisfied: locket in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from partd&gt;=1.4.0-&gt;dask&gt;=2022.1.1-&gt;dask[array]&gt;=2022.1.1-&gt;stackstac) (1.0.0)
Requirement already satisfied: six&gt;=1.5 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from python-dateutil&gt;=2.8.2-&gt;pandas&gt;=1.3.3-&gt;pvlib) (1.17.0)
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>Requirement already satisfied: decorator in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from IPython-&gt;import-ipynb) (5.2.1)
Requirement already satisfied: ipython-pygments-lexers in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from IPython-&gt;import-ipynb) (1.1.1)
Requirement already satisfied: jedi&gt;=0.16 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from IPython-&gt;import-ipynb) (0.19.2)
Requirement already satisfied: matplotlib-inline in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from IPython-&gt;import-ipynb) (0.1.7)
Requirement already satisfied: pexpect&gt;4.3 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from IPython-&gt;import-ipynb) (4.9.0)
Requirement already satisfied: prompt_toolkit&lt;3.1.0,&gt;=3.0.41 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from IPython-&gt;import-ipynb) (3.0.52)
Requirement already satisfied: pygments&gt;=2.4.0 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from IPython-&gt;import-ipynb) (2.19.2)
Requirement already satisfied: stack_data in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from IPython-&gt;import-ipynb) (0.6.3)
Requirement already satisfied: traitlets&gt;=5.13.0 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from IPython-&gt;import-ipynb) (5.14.3)
Requirement already satisfied: wcwidth in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from prompt_toolkit&lt;3.1.0,&gt;=3.0.41-&gt;IPython-&gt;import-ipynb) (0.2.14)
Requirement already satisfied: parso&lt;0.9.0,&gt;=0.8.4 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from jedi&gt;=0.16-&gt;IPython-&gt;import-ipynb) (0.8.5)
Requirement already satisfied: ptyprocess&gt;=0.5 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from pexpect&gt;4.3-&gt;IPython-&gt;import-ipynb) (0.7.0)
Requirement already satisfied: fastjsonschema&gt;=2.15 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from nbformat-&gt;import-ipynb) (2.21.2)
Requirement already satisfied: jsonschema&gt;=2.6 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from nbformat-&gt;import-ipynb) (4.25.1)
Requirement already satisfied: jupyter-core!=5.0.*,&gt;=4.12 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from nbformat-&gt;import-ipynb) (5.8.1)
Requirement already satisfied: jsonschema-specifications&gt;=2023.03.6 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from jsonschema&gt;=2.6-&gt;nbformat-&gt;import-ipynb) (2025.9.1)
Requirement already satisfied: referencing&gt;=0.28.4 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from jsonschema&gt;=2.6-&gt;nbformat-&gt;import-ipynb) (0.36.2)
Requirement already satisfied: rpds-py&gt;=0.7.1 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from jsonschema&gt;=2.6-&gt;nbformat-&gt;import-ipynb) (0.27.1)
Requirement already satisfied: platformdirs&gt;=2.5 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from jupyter-core!=5.0.*,&gt;=4.12-&gt;nbformat-&gt;import-ipynb) (4.4.0)
Requirement already satisfied: typing-extensions&gt;=4.4.0 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from referencing&gt;=0.28.4-&gt;jsonschema&gt;=2.6-&gt;nbformat-&gt;import-ipynb) (4.15.0)
Requirement already satisfied: charset_normalizer&lt;4,&gt;=2 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from requests-&gt;pvlib) (3.4.3)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from requests-&gt;pvlib) (3.10)
Requirement already satisfied: urllib3&lt;3,&gt;=1.21.1 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from requests-&gt;pvlib) (2.5.0)
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>Requirement already satisfied: executing&gt;=1.2.0 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from stack_data-&gt;IPython-&gt;import-ipynb) (2.2.1)
Requirement already satisfied: asttokens&gt;=2.1.0 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from stack_data-&gt;IPython-&gt;import-ipynb) (3.0.0)
Requirement already satisfied: pure_eval in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from stack_data-&gt;IPython-&gt;import-ipynb) (0.2.3)
</span></code></pre></div></div></div><div id="DHt6bgfrne" class="relative group/block"><hr class="py-2 my-5 translate-y-2"/></div><div id="tAx5vmUjk5" class="relative group/block"><h1 id="id-1-imports" class="relative group"><span class="heading-text">1) Imports</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-1-imports" title="Link to this Section" aria-label="Link to this Section">¶</a></h1><p>Core libraries used throughout the notebook.</p><p>Key roles:</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-text" style="white-space:pre">xarray/s3fs for reading NOAA Zarr data from S3
numpy/pandas for arrays &amp; tables
plotly for interactive plotting
requests/io/os for file I/O and downloads
datetime for time calculations</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div></div><div id="vgeFHQupJs" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import xarray as xr
import s3fs
import numpy as np
import plotly.graph_objects as go
from plotly.subplots import make_subplots
import pandas as pd
import requests
import io
import os
import rioxarray
from datetime import datetime, timedelta
import pvlib</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="OtVksJ9oPyV-iYNwqw9Mn" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="slUEOImf8z" class="relative group/block"><h1 id="id-2-initializing-the-datasets" class="relative group"><span class="heading-text">2) Initializing the datasets</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-2-initializing-the-datasets" title="Link to this Section" aria-label="Link to this Section">¶</a></h1></div><div id="oPEXItzioK" class="relative group/block"><p>Builds the S3 path to the HB1906 EK60 Zarr dataset and opens it anonymously.
Subsets by time window and depth range, selects the 38 kHz channel, and masks samples below the estimated bottom.
.compute() materializes the selection; hm_timestamps will be reused for time alignment later. All datasets are accessed
using the OSDF infrastructure</p></div><div id="m5LTzWoVng" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">bucket_name = &#x27;noaa-wcsd-zarr-pds&#x27;
ship_name = &quot;Henry_B._Bigelow&quot;
cruise_name = &quot;HB1906&quot;
sensor_name = &quot;EK60&quot;

# Accessing the NOAA HB1906 dataset using OSDF (anonymous S3)
s3_file_system = s3fs.S3FileSystem(anon=True)
zarr_store = f&#x27;{cruise_name}.zarr&#x27;
s3_zarr_store_path = f&quot;{bucket_name}/level_2/{ship_name}/{cruise_name}/{sensor_name}/{zarr_store}&quot;

# Map S3 path to a zarr store and open (consolidated=None to let xarray infer metadata)
store = s3fs.S3Map(root=s3_zarr_store_path, s3=s3_file_system, check=False)
cruise = xr.open_zarr(store=store, consolidated=None)

# Time/depth subset and single-frequency selection
start_time = &quot;2019-10-16T15:00:00&quot;
end_time = &quot;2019-10-16T23:11:09&quot;
timeslice = slice(start_time, end_time)
depths = slice(10, 250)
cruise = cruise.sel(time=timeslice, depth=depths, drop=False)
cruise = cruise.sel(frequency=38000, method=&#x27;nearest&#x27;).compute()  # materialize after selection
cruise = cruise.where(cruise.depth &lt; cruise.bottom + 2, drop=True)  # remove bins below bottom

# Timestamps for later alignment
hm_timestamps = cruise.time.values.tolist()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="HFu0wP6xskax3xB78za0j" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="JQ4CIQC3Aq" class="relative group/block"><h1 id="id-3-accessing-buoy-data" class="relative group"><span class="heading-text">3) Accessing buoy data</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-3-accessing-buoy-data" title="Link to this Section" aria-label="Link to this Section">¶</a></h1><p>Defines a buoy location on Georges Bank (longitude converted to 0–360).</p><ol start="1"><li><p>Optional: Loads three daily OISST files and samples SST at the nearest grid point (day before, day of, day after).</p></li><li><p>ERDDAP buoy environmental data.</p></li></ol><p>Sets ERDDAP dataset parameters and enforces a max_days cap by adjusting end_date_time if needed.
Reads station metadata to extract lon/lat and wind-speed units; prepares a conversion to knots.
Pulls a table of time, wind_speed, SST, significant wave height, converts wind speed to knots, indexes by time.
Filters to the requested window and keeps the first nine rows (intentional truncation for later alignment).</p></div><div id="Jy2o14a3yw" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Location of one specific buoy located on Georges Bank
target_lon = 360 - 66.546  # convert from -180..180 to 0..360
target_lat = 41.088

# ______________OPTIONAL BUOY DATA FROM NCAR/UCAR______________
# print(f&quot;Target coordinates: Longitude: {target_lon}, Latitude: {target_lat}&quot;)
#
# # Accessing stationary buoy data (daily OISST files); select nearest grid cell
# buoy_data_day_before = xr.open_dataset(
#     &#x27;https://data.rda.ucar.edu/d277007/avhrr_v2.1/2019/oisst-avhrr-v02r01.20191015.nc#mode=bytes&#x27;, engine=&#x27;netcdf4&#x27;)
# buoy_data_actual_day = xr.open_dataset(
#     &#x27;https://data.rda.ucar.edu/d277007/avhrr_v2.1/2019/oisst-avhrr-v02r01.20191016.nc#mode=bytes&#x27;,
#     engine=&#x27;netcdf4&#x27;)
# buoy_data_day_after = xr.open_dataset(
#     &#x27;https://data.rda.ucar.edu/d277007/avhrr_v2.1/2019/oisst-avhrr-v02r01.20191017.nc#mode=bytes&#x27;,
#     engine=&#x27;netcdf4&#x27;)
#
# sst_day_before = buoy_data_day_before[&#x27;sst&#x27;].sel(lon=target_lon, lat=target_lat, method=&#x27;nearest&#x27;).values[0][0]
# sst_actual_day = buoy_data_actual_day[&#x27;sst&#x27;].sel(lon=target_lon, lat=target_lat, method=&#x27;nearest&#x27;).values[0][0]
# sst_day_after = buoy_data_day_after[&#x27;sst&#x27;].sel(lon=target_lon, lat=target_lat, method=&#x27;nearest&#x27;).values[0][0]
# ______________________________________________________________

# The following code has been copied from https://github.com/ioos/soundcoop/blob/main/3_HMD_environmental_data/plot_sound_environmental_and_climatology_data.ipynb in order to access buoy environmental data.

erddap_dataset = &#x27;gov-ndbc-44005&#x27;
sound_dataset = &#x27;Monh&#x27;
max_days = 25
start_date_time = &#x27;2019-10-16T14:00:00.000&#x27;
end_date_time = &#x27;2021-10-16T23:30:00.000&#x27;
min_frequency = 21
max_frequency = 24000

erddap_base_url = &#x27;https://erddap.sensors.ioos.us/erddap&#x27;

# Cap the end date if requested range exceeds max_days
time_delta = datetime.fromisoformat(end_date_time) - datetime.fromisoformat(start_date_time)
if time_delta.days &gt; max_days:
    end_date_time = str(datetime.fromisoformat(start_date_time) + timedelta(days=max_days))
    print(f&#x27;end_date_time updated to {end_date_time}&#x27;)

# Get station lon/lat and units from ERDDAP metadata (CSV)
erddap_metadata_url = f&#x27;{erddap_base_url}/info/{erddap_dataset}/index.csv&#x27;
env_metadata_df = pd.read_csv(erddap_metadata_url)

env_station_x = env_metadata_df.loc[env_metadata_df[&#x27;Attribute Name&#x27;] == &#x27;geospatial_lon_min&#x27;][&#x27;Value&#x27;].item()
env_station_y = env_metadata_df.loc[env_metadata_df[&#x27;Attribute Name&#x27;] == &#x27;geospatial_lat_min&#x27;][&#x27;Value&#x27;].item()
swt_var = &#x27;sea_surface_temperature&#x27;

# __________OPTIONAL: Add Wind__________
# Determine wind_speed units to convert to knots
# wind_speed_units_row = env_metadata_df[
#     (env_metadata_df[&#x27;Row Type&#x27;] == &#x27;attribute&#x27;) &amp;
#     (env_metadata_df[&#x27;Attribute Name&#x27;] == &#x27;units&#x27;) &amp;
#     # (env_metadata_df[&#x27;Variable Name&#x27;] == &#x27;wind_speed&#x27;)
#     ]
# wind_speed_units = wind_speed_units_row.iloc[0][&#x27;Value&#x27;]
# print(wind_speed_units)

# wind_speed_to_kts_factors = {
#     &quot;m.s-1&quot;: 1.94384,
#     &quot;mph&quot;: 0.86897423357831,
#     &quot;kmh&quot;: 0.53995555554212126825,
#     &quot;ft.s-1&quot;: 0.59248243198521155506
# }

# if wind_speed_units in wind_speed_to_kts_factors:
#     print(&quot;Success! Units can be converted from&quot;, wind_speed_units, &#x27;to&#x27;, &#x27;kts&#x27;)
# else:
#     print(&quot;Error! Wind speed cannot be converted from&quot;, wind_speed_units, &#x27;to&#x27;, &#x27;kts&#x27;)

# wind_var = &#x27;wind_speed&#x27;
# wave_var = &#x27;sea_surface_wave_significant_height&#x27;
# anomaly_var = &#x27;swt_anomaly&#x27;
# wind_var_kts = &#x27;wind_speed_kts&#x27;
# ________________________________________

# Build ERDDAP tabledap query URL
erddap_dataset_url = (
    f&#x27;{erddap_base_url}/tabledap/{erddap_dataset}.csv&#x27;
    f&#x27;?time,{swt_var}&#x27;
)

# Read dataset (skip the second row of units)
env_df = pd.read_csv(
    erddap_dataset_url,
    skiprows=[1]  # The second row (index 1) are the column units, which we don&#x27;t need
)

# Format time, convert wind speed to knots, index by time
env_df[&#x27;time&#x27;] = pd.to_datetime(env_df[&#x27;time&#x27;])
# env_df[&#x27;wind_speed_kts&#x27;] = env_df[&#x27;wind_speed&#x27;].apply(lambda x: x * wind_speed_to_kts_factors[wind_speed_units])
# del env_df[&#x27;wind_speed&#x27;]
env_df = env_df.set_index(&#x27;time&#x27;).sort_index()

# Filter by requested time window and keep first 9 rows (drops the rest)
env_df = env_df[(env_df.index &gt; start_date_time) &amp; (env_df.index &lt; end_date_time)]
env_df.drop(env_df.tail(-9).index, inplace=True)
# env_df</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="mrcKOCb3fcy0_XQXILgVO" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>end_date_time updated to 2019-11-10 14:00:00
</span></code></pre></div></div></div><div id="bi50i4kUMg" class="relative group/block"><h2 id="id-4-calculate-the-temperature-anomaly-sun-elevation-in-degree-and-azimuth" class="relative group"><span class="heading-text">4) Calculate the temperature anomaly, sun elevation in degree and azimuth</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-4-calculate-the-temperature-anomaly-sun-elevation-in-degree-and-azimuth" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Extracts World Ocean Atlas 2023 temperature data for a specific location and month and calculates temperature anomaly (optional), sun elevation in degree and azimuth (optional).</p></div><div id="qAkZVp82dN" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">def get_woa23_temp_at_xy(x, y, month, var=&#x27;t_mn&#x27;, depth=0):
    &quot;&quot;&quot;
    Get 1-degree WOA 2023 temperature values for a given point and month.

    Args:
        x: A longitude value given in decimal degrees
        y: A latitude value given in decimal degrees
        month: The month asn integer from which to extract the value
        var (optional): The temperature variable to use. Defaults to the statistical mean.
        depth (optional): The depth at which to extract the value. Defaults to the surface.
    &quot;&quot;&quot;
    url = (
        &#x27;https://www.ncei.noaa.gov/thredds-ocean/dodsC/woa23/DATA/&#x27;
        f&#x27;temperature/netcdf/decav/1.00/woa23_decav_t{month:02}_01.nc&#x27;
    )
    ds = xr.open_dataset(
        url,
        decode_times=False  # xarray can&#x27;t handle times defined as &quot;months since ...&quot;
    )

    da = ds.isel(depth=depth)[var]  # Pull out just the variable we&#x27;re interested in

    # Because nearshore locations are often NaN due to the grid&#x27;s low resolution
    # we need to interpolate the NaNs to the nearest non-NaN before extracting our value.
    # We use rioxarray to do the interpolations in two dimensions because plain vanilla xarray
    # can only interpolate in one dimension.
    da = da.rio.write_crs(4326)
    da = da.rio.interpolate_na(method=&#x27;nearest&#x27;)

    # Then we extract the value, also using the nearest neighbor method because the given
    # x and y values are unlikely to fall exactly on one of the grid&#x27;s lat/lon coordinate pairs
    val = da.sel(lon=x, lat=y, method=&#x27;nearest&#x27;).item()

    return val


# Define the location of our selected ERDDAP dataset
# Override here if needed
x = env_station_x
y = env_station_y

url = (
    &#x27;https://www.ncei.noaa.gov/thredds-ocean/dodsC/woa23/DATA/&#x27;
    f&#x27;temperature/netcdf/decav/1.00/woa23_decav_t07_01.nc&#x27;
)
da = xr.open_dataset(
    url,
    decode_times=False  # xarray can&#x27;t handle times defined as &quot;months since ...&quot;
).isel(depth=0)[&#x27;t_mn&#x27;]  # Pull out just the variable we&#x27;re interested in

# Because nearshore locations are often NaN due to the grid&#x27;s low resolution
# we need to interpolate the NaNs to the nearest non-NaN before extracting our value.
# We use rioxarray to do the interpolations in two dimensions because plain vanilla xarray
# can only interpolate in one dimension.
da = da.rio.write_crs(4326)
da = da.rio.interpolate_na(method=&#x27;nearest&#x27;)

# Then we extract the value, also using the nearest neighbor method because the given
# x and y values are unlikely to fall exactly on one of the grid&#x27;s lat/lon coordinate pairs
val = da.sel(lon=x, lat=y, method=&#x27;nearest&#x27;).item()

# Assemble a mapping between months and WOA 2023 temperature values
months = list(range(1, 13))
temps = [get_woa23_temp_at_xy(x, y, m) for m in months]
clim_dict = {m: t for m, t in zip(months, temps)}

# Calculate the sea water temperature anomaly by subtracting the monthly WOA 2023 temperature value
# from each measured sea water temperature value and store it as a new variable
anomaly_var = env_df[swt_var] - [clim_dict[10]]
# We are not adding the temperature_anomaly variable to our dataset, because we were able to see that it follows the sea surface temperature.
# env_df[&quot;temperature_anomaly&quot;] = anomaly_var

# ---- Time range in UTC ----
times_utc = pd.date_range(
    start=start_date_time,
    end=end_date_time,
    freq=&quot;1h&quot;,
    tz=&quot;UTC&quot;  # &lt;-- key: set timezone to UTC
)

# ---- Calculate solar position ----
solpos = pvlib.solarposition.get_solarposition(times_utc, target_lat, target_lon)

# ---- Extract elevation ----
df = pd.DataFrame({
    &quot;time_utc&quot;: times_utc,
    &quot;elevation_deg&quot;: solpos[&quot;elevation&quot;],
    &quot;azimuth_deg&quot;: solpos[&quot;azimuth&quot;]
})

env_df[&quot;elevation_deg&quot;] = solpos[&quot;elevation&quot;].tolist()[1:10]
# env_df[&quot;azimuth_deg&quot;] = solpos[&quot;azimuth&quot;].tolist()[:9]
env_df</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="-Idu9s_HFlnungTPBD9kz" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system jupyter-error"><code><span style="color:rgb(187, 0, 0)">---------------------------------------------------------------------------</span><span>
</span><span style="color:rgb(187, 0, 0)">ClientResponseError</span><span>                       Traceback (most recent call last)
</span><span style="color:rgb(0, 187, 187)">File </span><span style="color:rgb(0, 187, 0)">~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/implementations/http.py:437</span><span>, in </span><span style="color:rgb(0, 187, 187)">HTTPFileSystem._info</span><span style="color:rgb(0, 0, 187)">(self, url, **kwargs)</span><span>
</span><span style="color:rgb(0, 187, 0)">    435</span><span> </span><span style="color:rgb(0, 135, 0);font-weight:bold">try</span><span>:
</span><span style="color:rgb(0, 187, 0)">    436</span><span>     info.update(
</span><span style="color:rgb(0, 187, 0)">--&gt; </span><span style="color:rgb(0, 187, 0)">437</span><span>         </span><span style="color:rgb(0, 135, 0);font-weight:bold">await</span><span> _file_info(
</span><span style="color:rgb(0, 187, 0)">    438</span><span>             </span><span style="color:rgb(0, 135, 0)">self</span><span>.encode_url(url),
</span><span style="color:rgb(0, 187, 0)">    439</span><span>             size_policy=policy,
</span><span style="color:rgb(0, 187, 0)">    440</span><span>             session=session,
</span><span style="color:rgb(0, 187, 0)">    441</span><span>             **</span><span style="color:rgb(0, 135, 0)">self</span><span>.kwargs,
</span><span style="color:rgb(0, 187, 0)">    442</span><span>             **kwargs,
</span><span style="color:rgb(0, 187, 0)">    443</span><span>         )
</span><span style="color:rgb(0, 187, 0)">    444</span><span>     )
</span><span style="color:rgb(0, 187, 0)">    445</span><span>     </span><span style="color:rgb(0, 135, 0);font-weight:bold">if</span><span> info.get(</span><span style="color:rgb(187, 187, 0)">&quot;</span><span style="color:rgb(187, 187, 0)">size</span><span style="color:rgb(187, 187, 0)">&quot;</span><span>) </span><span style="color:rgb(175, 0, 255);font-weight:bold">is</span><span> </span><span style="color:rgb(175, 0, 255);font-weight:bold">not</span><span> </span><span style="color:rgb(0, 135, 0);font-weight:bold">None</span><span>:

</span><span style="color:rgb(0, 187, 187)">File </span><span style="color:rgb(0, 187, 0)">~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/implementations/http.py:853</span><span>, in </span><span style="color:rgb(0, 187, 187)">_file_info</span><span style="color:rgb(0, 0, 187)">(url, session, size_policy, **kwargs)</span><span>
</span><span style="color:rgb(0, 187, 0)">    852</span><span> </span><span style="color:rgb(0, 135, 0);font-weight:bold">async</span><span> </span><span style="color:rgb(0, 135, 0);font-weight:bold">with</span><span> r:
</span><span style="color:rgb(0, 187, 0)">--&gt; </span><span style="color:rgb(0, 187, 0)">853</span><span>     </span><span style="background-color:rgb(187, 187, 0)">r</span><span style="background-color:rgb(187, 187, 0)">.</span><span style="background-color:rgb(187, 187, 0)">raise_for_status</span><span style="background-color:rgb(187, 187, 0)">(</span><span style="background-color:rgb(187, 187, 0)">)</span><span>
</span><span style="color:rgb(0, 187, 0)">    855</span><span>     </span><span style="color:rgb(0, 135, 0);font-weight:bold">if</span><span> </span><span style="color:rgb(187, 187, 0)">&quot;</span><span style="color:rgb(187, 187, 0)">Content-Length</span><span style="color:rgb(187, 187, 0)">&quot;</span><span> </span><span style="color:rgb(175, 0, 255);font-weight:bold">in</span><span> r.headers:
</span><span style="color:rgb(0, 187, 0)">    856</span><span>         </span><span style="color:rgb(95, 135, 135);font-style:italic"># Some servers may choose to ignore Accept-Encoding and return</span><span>
</span><span style="color:rgb(0, 187, 0)">    857</span><span>         </span><span style="color:rgb(95, 135, 135);font-style:italic"># compressed content, in which case the returned size is unreliable.</span><span>

</span><span style="color:rgb(0, 187, 187)">File </span><span style="color:rgb(0, 187, 0)">~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/aiohttp/client_reqrep.py:629</span><span>, in </span><span style="color:rgb(0, 187, 187)">ClientResponse.raise_for_status</span><span style="color:rgb(0, 0, 187)">(self)</span><span>
</span><span style="color:rgb(0, 187, 0)">    627</span><span>     </span><span style="color:rgb(0, 135, 0)">self</span><span>.release()
</span><span style="color:rgb(0, 187, 0)">--&gt; </span><span style="color:rgb(0, 187, 0)">629</span><span> </span><span style="color:rgb(0, 135, 0);font-weight:bold">raise</span><span> ClientResponseError(
</span><span style="color:rgb(0, 187, 0)">    630</span><span>     </span><span style="color:rgb(0, 135, 0)">self</span><span>.request_info,
</span><span style="color:rgb(0, 187, 0)">    631</span><span>     </span><span style="color:rgb(0, 135, 0)">self</span><span>.history,
</span><span style="color:rgb(0, 187, 0)">    632</span><span>     status=</span><span style="color:rgb(0, 135, 0)">self</span><span>.status,
</span><span style="color:rgb(0, 187, 0)">    633</span><span>     message=</span><span style="color:rgb(0, 135, 0)">self</span><span>.reason,
</span><span style="color:rgb(0, 187, 0)">    634</span><span>     headers=</span><span style="color:rgb(0, 135, 0)">self</span><span>.headers,
</span><span style="color:rgb(0, 187, 0)">    635</span><span> )

</span><span style="color:rgb(187, 0, 0)">ClientResponseError</span><span>: 400, message=&#x27;&#x27;, url=&#x27;https://www.ncei.noaa.gov/thredds-ocean/dodsC/woa23/DATA/temperature/netcdf/decav/1.00/woa23_decav_t07_01.nc&#x27;

The above exception was the direct cause of the following exception:

</span><span style="color:rgb(187, 0, 0)">FileNotFoundError</span><span>                         Traceback (most recent call last)
</span><span style="color:rgb(0, 187, 187)">Cell</span><span style="color:rgb(0, 187, 187)"> </span><span style="color:rgb(0, 187, 0)">In[5]</span><span style="color:rgb(0, 187, 0)">, line 46</span><span>
</span><span style="color:rgb(0, 187, 0)">     40</span><span> y = env_station_y
</span><span style="color:rgb(0, 187, 0)">     42</span><span> url = (
</span><span style="color:rgb(0, 187, 0)">     43</span><span>     </span><span style="color:rgb(187, 187, 0)">&#x27;</span><span style="color:rgb(187, 187, 0)">https://www.ncei.noaa.gov/thredds-ocean/dodsC/woa23/DATA/</span><span style="color:rgb(187, 187, 0)">&#x27;</span><span>
</span><span style="color:rgb(0, 187, 0)">     44</span><span>     </span><span style="color:rgb(187, 187, 0)">f</span><span style="color:rgb(187, 187, 0)">&#x27;</span><span style="color:rgb(187, 187, 0)">temperature/netcdf/decav/1.00/woa23_decav_t07_01.nc</span><span style="color:rgb(187, 187, 0)">&#x27;</span><span>
</span><span style="color:rgb(0, 187, 0)">     45</span><span> )
</span><span style="color:rgb(0, 187, 0)">---&gt; </span><span style="color:rgb(0, 187, 0)">46</span><span> da = </span><span style="background-color:rgb(187, 187, 0)">xr</span><span style="background-color:rgb(187, 187, 0)">.</span><span style="background-color:rgb(187, 187, 0)">open_dataset</span><span style="background-color:rgb(187, 187, 0)">(</span><span>
</span><span style="color:rgb(0, 187, 0)">     47</span><span> </span><span style="background-color:rgb(187, 187, 0)">    </span><span style="background-color:rgb(187, 187, 0)">url</span><span style="background-color:rgb(187, 187, 0)">,</span><span>
</span><span style="color:rgb(0, 187, 0)">     48</span><span> </span><span style="background-color:rgb(187, 187, 0)">    </span><span style="background-color:rgb(187, 187, 0)">decode_times</span><span style="background-color:rgb(187, 187, 0)">=</span><span style="background-color:rgb(187, 187, 0);color:rgb(0, 135, 0);font-weight:bold">False</span><span style="background-color:rgb(187, 187, 0)">  </span><span style="background-color:rgb(187, 187, 0);color:rgb(95, 135, 135);font-style:italic"># xarray can&#x27;t handle times defined as &quot;months since ...&quot;</span><span>
</span><span style="color:rgb(0, 187, 0)">     49</span><span> </span><span style="background-color:rgb(187, 187, 0)">)</span><span>.isel(depth=</span><span style="color:rgb(0, 187, 0)">0</span><span>)[</span><span style="color:rgb(187, 187, 0)">&#x27;</span><span style="color:rgb(187, 187, 0)">t_mn</span><span style="color:rgb(187, 187, 0)">&#x27;</span><span>]  </span><span style="color:rgb(95, 135, 135);font-style:italic"># Pull out just the variable we&#x27;re interested in</span><span>
</span><span style="color:rgb(0, 187, 0)">     51</span><span> </span><span style="color:rgb(95, 135, 135);font-style:italic"># Because nearshore locations are often NaN due to the grid&#x27;s low resolution</span><span>
</span><span style="color:rgb(0, 187, 0)">     52</span><span> </span><span style="color:rgb(95, 135, 135);font-style:italic"># we need to interpolate the NaNs to the nearest non-NaN before extracting our value.</span><span>
</span><span style="color:rgb(0, 187, 0)">     53</span><span> </span><span style="color:rgb(95, 135, 135);font-style:italic"># We use rioxarray to do the interpolations in two dimensions because plain vanilla xarray</span><span>
</span><span style="color:rgb(0, 187, 0)">     54</span><span> </span><span style="color:rgb(95, 135, 135);font-style:italic"># can only interpolate in one dimension.</span><span>
</span><span style="color:rgb(0, 187, 0)">     55</span><span> da = da.rio.write_crs(</span><span style="color:rgb(0, 187, 0)">4326</span><span>)

</span><span style="color:rgb(0, 187, 187)">File </span><span style="color:rgb(0, 187, 0)">~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/api.py:596</span><span>, in </span><span style="color:rgb(0, 187, 187)">open_dataset</span><span style="color:rgb(0, 0, 187)">(filename_or_obj, engine, chunks, cache, decode_cf, mask_and_scale, decode_times, decode_timedelta, use_cftime, concat_characters, decode_coords, drop_variables, create_default_indexes, inline_array, chunked_array_type, from_array_kwargs, backend_kwargs, **kwargs)</span><span>
</span><span style="color:rgb(0, 187, 0)">    584</span><span> decoders = _resolve_decoders_kwargs(
</span><span style="color:rgb(0, 187, 0)">    585</span><span>     decode_cf,
</span><span style="color:rgb(0, 187, 0)">    586</span><span>     open_backend_dataset_parameters=backend.open_dataset_parameters,
</span><span style="color:rgb(0, 187, 0)">   (...)</span><span style="color:rgb(0, 187, 0)">    592</span><span>     decode_coords=decode_coords,
</span><span style="color:rgb(0, 187, 0)">    593</span><span> )
</span><span style="color:rgb(0, 187, 0)">    595</span><span> overwrite_encoded_chunks = kwargs.pop(</span><span style="color:rgb(187, 187, 0)">&quot;</span><span style="color:rgb(187, 187, 0)">overwrite_encoded_chunks</span><span style="color:rgb(187, 187, 0)">&quot;</span><span>, </span><span style="color:rgb(0, 135, 0);font-weight:bold">None</span><span>)
</span><span style="color:rgb(0, 187, 0)">--&gt; </span><span style="color:rgb(0, 187, 0)">596</span><span> backend_ds = </span><span style="background-color:rgb(187, 187, 0)">backend</span><span style="background-color:rgb(187, 187, 0)">.</span><span style="background-color:rgb(187, 187, 0)">open_dataset</span><span style="background-color:rgb(187, 187, 0)">(</span><span>
</span><span style="color:rgb(0, 187, 0)">    597</span><span> </span><span style="background-color:rgb(187, 187, 0)">    </span><span style="background-color:rgb(187, 187, 0)">filename_or_obj</span><span style="background-color:rgb(187, 187, 0)">,</span><span>
</span><span style="color:rgb(0, 187, 0)">    598</span><span> </span><span style="background-color:rgb(187, 187, 0)">    </span><span style="background-color:rgb(187, 187, 0)">drop_variables</span><span style="background-color:rgb(187, 187, 0)">=</span><span style="background-color:rgb(187, 187, 0)">drop_variables</span><span style="background-color:rgb(187, 187, 0)">,</span><span>
</span><span style="color:rgb(0, 187, 0)">    599</span><span> </span><span style="background-color:rgb(187, 187, 0)">    </span><span style="background-color:rgb(187, 187, 0)">*</span><span style="background-color:rgb(187, 187, 0)">*</span><span style="background-color:rgb(187, 187, 0)">decoders</span><span style="background-color:rgb(187, 187, 0)">,</span><span>
</span><span style="color:rgb(0, 187, 0)">    600</span><span> </span><span style="background-color:rgb(187, 187, 0)">    </span><span style="background-color:rgb(187, 187, 0)">*</span><span style="background-color:rgb(187, 187, 0)">*</span><span style="background-color:rgb(187, 187, 0)">kwargs</span><span style="background-color:rgb(187, 187, 0)">,</span><span>
</span><span style="color:rgb(0, 187, 0)">    601</span><span> </span><span style="background-color:rgb(187, 187, 0)">)</span><span>
</span><span style="color:rgb(0, 187, 0)">    602</span><span> ds = _dataset_from_backend_dataset(
</span><span style="color:rgb(0, 187, 0)">    603</span><span>     backend_ds,
</span><span style="color:rgb(0, 187, 0)">    604</span><span>     filename_or_obj,
</span><span style="color:rgb(0, 187, 0)">   (...)</span><span style="color:rgb(0, 187, 0)">    615</span><span>     **kwargs,
</span><span style="color:rgb(0, 187, 0)">    616</span><span> )
</span><span style="color:rgb(0, 187, 0)">    617</span><span> </span><span style="color:rgb(0, 135, 0);font-weight:bold">return</span><span> ds

</span><span style="color:rgb(0, 187, 187)">File </span><span style="color:rgb(0, 187, 0)">~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/h5netcdf_.py:502</span><span>, in </span><span style="color:rgb(0, 187, 187)">H5netcdfBackendEntrypoint.open_dataset</span><span style="color:rgb(0, 0, 187)">(self, filename_or_obj, mask_and_scale, decode_times, concat_characters, decode_coords, drop_variables, use_cftime, decode_timedelta, format, group, lock, invalid_netcdf, phony_dims, decode_vlen_strings, driver, driver_kwds, storage_options)</span><span>
</span><span style="color:rgb(0, 187, 0)">    499</span><span> emit_phony_dims_warning, phony_dims = _check_phony_dims(phony_dims)
</span><span style="color:rgb(0, 187, 0)">    501</span><span> filename_or_obj = _normalize_filename_or_obj(filename_or_obj)
</span><span style="color:rgb(0, 187, 0)">--&gt; </span><span style="color:rgb(0, 187, 0)">502</span><span> store = </span><span style="background-color:rgb(187, 187, 0)">H5NetCDFStore</span><span style="background-color:rgb(187, 187, 0)">.</span><span style="background-color:rgb(187, 187, 0)">open</span><span style="background-color:rgb(187, 187, 0)">(</span><span>
</span><span style="color:rgb(0, 187, 0)">    503</span><span> </span><span style="background-color:rgb(187, 187, 0)">    </span><span style="background-color:rgb(187, 187, 0)">filename_or_obj</span><span style="background-color:rgb(187, 187, 0)">,</span><span>
</span><span style="color:rgb(0, 187, 0)">    504</span><span> </span><span style="background-color:rgb(187, 187, 0)">    </span><span style="background-color:rgb(187, 187, 0);color:rgb(0, 135, 0)">format</span><span style="background-color:rgb(187, 187, 0)">=</span><span style="background-color:rgb(187, 187, 0);color:rgb(0, 135, 0)">format</span><span style="background-color:rgb(187, 187, 0)">,</span><span>
</span><span style="color:rgb(0, 187, 0)">    505</span><span> </span><span style="background-color:rgb(187, 187, 0)">    </span><span style="background-color:rgb(187, 187, 0)">group</span><span style="background-color:rgb(187, 187, 0)">=</span><span style="background-color:rgb(187, 187, 0)">group</span><span style="background-color:rgb(187, 187, 0)">,</span><span>
</span><span style="color:rgb(0, 187, 0)">    506</span><span> </span><span style="background-color:rgb(187, 187, 0)">    </span><span style="background-color:rgb(187, 187, 0)">lock</span><span style="background-color:rgb(187, 187, 0)">=</span><span style="background-color:rgb(187, 187, 0)">lock</span><span style="background-color:rgb(187, 187, 0)">,</span><span>
</span><span style="color:rgb(0, 187, 0)">    507</span><span> </span><span style="background-color:rgb(187, 187, 0)">    </span><span style="background-color:rgb(187, 187, 0)">invalid_netcdf</span><span style="background-color:rgb(187, 187, 0)">=</span><span style="background-color:rgb(187, 187, 0)">invalid_netcdf</span><span style="background-color:rgb(187, 187, 0)">,</span><span>
</span><span style="color:rgb(0, 187, 0)">    508</span><span> </span><span style="background-color:rgb(187, 187, 0)">    </span><span style="background-color:rgb(187, 187, 0)">phony_dims</span><span style="background-color:rgb(187, 187, 0)">=</span><span style="background-color:rgb(187, 187, 0)">phony_dims</span><span style="background-color:rgb(187, 187, 0)">,</span><span>
</span><span style="color:rgb(0, 187, 0)">    509</span><span> </span><span style="background-color:rgb(187, 187, 0)">    </span><span style="background-color:rgb(187, 187, 0)">decode_vlen_strings</span><span style="background-color:rgb(187, 187, 0)">=</span><span style="background-color:rgb(187, 187, 0)">decode_vlen_strings</span><span style="background-color:rgb(187, 187, 0)">,</span><span>
</span><span style="color:rgb(0, 187, 0)">    510</span><span> </span><span style="background-color:rgb(187, 187, 0)">    </span><span style="background-color:rgb(187, 187, 0)">driver</span><span style="background-color:rgb(187, 187, 0)">=</span><span style="background-color:rgb(187, 187, 0)">driver</span><span style="background-color:rgb(187, 187, 0)">,</span><span>
</span><span style="color:rgb(0, 187, 0)">    511</span><span> </span><span style="background-color:rgb(187, 187, 0)">    </span><span style="background-color:rgb(187, 187, 0)">driver_kwds</span><span style="background-color:rgb(187, 187, 0)">=</span><span style="background-color:rgb(187, 187, 0)">driver_kwds</span><span style="background-color:rgb(187, 187, 0)">,</span><span>
</span><span style="color:rgb(0, 187, 0)">    512</span><span> </span><span style="background-color:rgb(187, 187, 0)">    </span><span style="background-color:rgb(187, 187, 0)">storage_options</span><span style="background-color:rgb(187, 187, 0)">=</span><span style="background-color:rgb(187, 187, 0)">storage_options</span><span style="background-color:rgb(187, 187, 0)">,</span><span>
</span><span style="color:rgb(0, 187, 0)">    513</span><span> </span><span style="background-color:rgb(187, 187, 0)">)</span><span>
</span><span style="color:rgb(0, 187, 0)">    515</span><span> store_entrypoint = StoreBackendEntrypoint()
</span><span style="color:rgb(0, 187, 0)">    517</span><span> ds = store_entrypoint.open_dataset(
</span><span style="color:rgb(0, 187, 0)">    518</span><span>     store,
</span><span style="color:rgb(0, 187, 0)">    519</span><span>     mask_and_scale=mask_and_scale,
</span><span style="color:rgb(0, 187, 0)">   (...)</span><span style="color:rgb(0, 187, 0)">    525</span><span>     decode_timedelta=decode_timedelta,
</span><span style="color:rgb(0, 187, 0)">    526</span><span> )

</span><span style="color:rgb(0, 187, 187)">File </span><span style="color:rgb(0, 187, 0)">~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/h5netcdf_.py:185</span><span>, in </span><span style="color:rgb(0, 187, 187)">H5NetCDFStore.open</span><span style="color:rgb(0, 0, 187)">(cls, filename, mode, format, group, lock, autoclose, invalid_netcdf, phony_dims, decode_vlen_strings, driver, driver_kwds, storage_options)</span><span>
</span><span style="color:rgb(0, 187, 0)">    183</span><span> </span><span style="color:rgb(0, 135, 0);font-weight:bold">if</span><span> </span><span style="color:rgb(0, 135, 0)">isinstance</span><span>(filename, </span><span style="color:rgb(0, 135, 0)">str</span><span>) </span><span style="color:rgb(175, 0, 255);font-weight:bold">and</span><span> is_remote_uri(filename) </span><span style="color:rgb(175, 0, 255);font-weight:bold">and</span><span> driver </span><span style="color:rgb(175, 0, 255);font-weight:bold">is</span><span> </span><span style="color:rgb(0, 135, 0);font-weight:bold">None</span><span>:
</span><span style="color:rgb(0, 187, 0)">    184</span><span>     mode_ = </span><span style="color:rgb(187, 187, 0)">&quot;</span><span style="color:rgb(187, 187, 0)">rb</span><span style="color:rgb(187, 187, 0)">&quot;</span><span> </span><span style="color:rgb(0, 135, 0);font-weight:bold">if</span><span> mode == </span><span style="color:rgb(187, 187, 0)">&quot;</span><span style="color:rgb(187, 187, 0)">r</span><span style="color:rgb(187, 187, 0)">&quot;</span><span> </span><span style="color:rgb(0, 135, 0);font-weight:bold">else</span><span> mode
</span><span style="color:rgb(0, 187, 0)">--&gt; </span><span style="color:rgb(0, 187, 0)">185</span><span>     filename = </span><span style="background-color:rgb(187, 187, 0)">_open_remote_file</span><span style="background-color:rgb(187, 187, 0)">(</span><span>
</span><span style="color:rgb(0, 187, 0)">    186</span><span> </span><span style="background-color:rgb(187, 187, 0)">        </span><span style="background-color:rgb(187, 187, 0)">filename</span><span style="background-color:rgb(187, 187, 0)">,</span><span style="background-color:rgb(187, 187, 0)"> </span><span style="background-color:rgb(187, 187, 0)">mode</span><span style="background-color:rgb(187, 187, 0)">=</span><span style="background-color:rgb(187, 187, 0)">mode_</span><span style="background-color:rgb(187, 187, 0)">,</span><span style="background-color:rgb(187, 187, 0)"> </span><span style="background-color:rgb(187, 187, 0)">storage_options</span><span style="background-color:rgb(187, 187, 0)">=</span><span style="background-color:rgb(187, 187, 0)">storage_options</span><span>
</span><span style="color:rgb(0, 187, 0)">    187</span><span> </span><span style="background-color:rgb(187, 187, 0)">    </span><span style="background-color:rgb(187, 187, 0)">)</span><span>
</span><span style="color:rgb(0, 187, 0)">    189</span><span> </span><span style="color:rgb(0, 135, 0);font-weight:bold">if</span><span> </span><span style="color:rgb(0, 135, 0)">isinstance</span><span>(filename, BytesIOProxy):
</span><span style="color:rgb(0, 187, 0)">    190</span><span>     source = filename

</span><span style="color:rgb(0, 187, 187)">File </span><span style="color:rgb(0, 187, 0)">~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/common.py:223</span><span>, in </span><span style="color:rgb(0, 187, 187)">_open_remote_file</span><span style="color:rgb(0, 0, 187)">(file, mode, storage_options)</span><span>
</span><span style="color:rgb(0, 187, 0)">    218</span><span> </span><span style="color:rgb(0, 135, 0);font-weight:bold">import</span><span style="color:rgb(undefined, undefined, undefined)"> </span><span style="color:rgb(0, 0, 187);font-weight:bold">fsspec</span><span>
</span><span style="color:rgb(0, 187, 0)">    220</span><span> fs, _, paths = fsspec.get_fs_token_paths(
</span><span style="color:rgb(0, 187, 0)">    221</span><span>     file, mode=mode, storage_options=storage_options
</span><span style="color:rgb(0, 187, 0)">    222</span><span> )
</span><span style="color:rgb(0, 187, 0)">--&gt; </span><span style="color:rgb(0, 187, 0)">223</span><span> </span><span style="color:rgb(0, 135, 0);font-weight:bold">return</span><span> </span><span style="background-color:rgb(187, 187, 0)">fs</span><span style="background-color:rgb(187, 187, 0)">.</span><span style="background-color:rgb(187, 187, 0)">open</span><span style="background-color:rgb(187, 187, 0)">(</span><span style="background-color:rgb(187, 187, 0)">paths</span><span style="background-color:rgb(187, 187, 0)">[</span><span style="background-color:rgb(187, 187, 0);color:rgb(0, 187, 0)">0</span><span style="background-color:rgb(187, 187, 0)">]</span><span style="background-color:rgb(187, 187, 0)">,</span><span style="background-color:rgb(187, 187, 0)"> </span><span style="background-color:rgb(187, 187, 0)">mode</span><span style="background-color:rgb(187, 187, 0)">=</span><span style="background-color:rgb(187, 187, 0)">mode</span><span style="background-color:rgb(187, 187, 0)">)</span><span>

</span><span style="color:rgb(0, 187, 187)">File </span><span style="color:rgb(0, 187, 0)">~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/spec.py:1338</span><span>, in </span><span style="color:rgb(0, 187, 187)">AbstractFileSystem.open</span><span style="color:rgb(0, 0, 187)">(self, path, mode, block_size, cache_options, compression, **kwargs)</span><span>
</span><span style="color:rgb(0, 187, 0)">   1336</span><span> </span><span style="color:rgb(0, 135, 0);font-weight:bold">else</span><span>:
</span><span style="color:rgb(0, 187, 0)">   1337</span><span>     ac = kwargs.pop(</span><span style="color:rgb(187, 187, 0)">&quot;</span><span style="color:rgb(187, 187, 0)">autocommit</span><span style="color:rgb(187, 187, 0)">&quot;</span><span>, </span><span style="color:rgb(175, 0, 255);font-weight:bold">not</span><span> </span><span style="color:rgb(0, 135, 0)">self</span><span>._intrans)
</span><span style="color:rgb(0, 187, 0)">-&gt; </span><span style="color:rgb(0, 187, 0)">1338</span><span>     f = </span><span style="background-color:rgb(187, 187, 0);color:rgb(0, 135, 0)">self</span><span style="background-color:rgb(187, 187, 0)">.</span><span style="background-color:rgb(187, 187, 0)">_open</span><span style="background-color:rgb(187, 187, 0)">(</span><span>
</span><span style="color:rgb(0, 187, 0)">   1339</span><span> </span><span style="background-color:rgb(187, 187, 0)">        </span><span style="background-color:rgb(187, 187, 0)">path</span><span style="background-color:rgb(187, 187, 0)">,</span><span>
</span><span style="color:rgb(0, 187, 0)">   1340</span><span> </span><span style="background-color:rgb(187, 187, 0)">        </span><span style="background-color:rgb(187, 187, 0)">mode</span><span style="background-color:rgb(187, 187, 0)">=</span><span style="background-color:rgb(187, 187, 0)">mode</span><span style="background-color:rgb(187, 187, 0)">,</span><span>
</span><span style="color:rgb(0, 187, 0)">   1341</span><span> </span><span style="background-color:rgb(187, 187, 0)">        </span><span style="background-color:rgb(187, 187, 0)">block_size</span><span style="background-color:rgb(187, 187, 0)">=</span><span style="background-color:rgb(187, 187, 0)">block_size</span><span style="background-color:rgb(187, 187, 0)">,</span><span>
</span><span style="color:rgb(0, 187, 0)">   1342</span><span> </span><span style="background-color:rgb(187, 187, 0)">        </span><span style="background-color:rgb(187, 187, 0)">autocommit</span><span style="background-color:rgb(187, 187, 0)">=</span><span style="background-color:rgb(187, 187, 0)">ac</span><span style="background-color:rgb(187, 187, 0)">,</span><span>
</span><span style="color:rgb(0, 187, 0)">   1343</span><span> </span><span style="background-color:rgb(187, 187, 0)">        </span><span style="background-color:rgb(187, 187, 0)">cache_options</span><span style="background-color:rgb(187, 187, 0)">=</span><span style="background-color:rgb(187, 187, 0)">cache_options</span><span style="background-color:rgb(187, 187, 0)">,</span><span>
</span><span style="color:rgb(0, 187, 0)">   1344</span><span> </span><span style="background-color:rgb(187, 187, 0)">        </span><span style="background-color:rgb(187, 187, 0)">*</span><span style="background-color:rgb(187, 187, 0)">*</span><span style="background-color:rgb(187, 187, 0)">kwargs</span><span style="background-color:rgb(187, 187, 0)">,</span><span>
</span><span style="color:rgb(0, 187, 0)">   1345</span><span> </span><span style="background-color:rgb(187, 187, 0)">    </span><span style="background-color:rgb(187, 187, 0)">)</span><span>
</span><span style="color:rgb(0, 187, 0)">   1346</span><span>     </span><span style="color:rgb(0, 135, 0);font-weight:bold">if</span><span> compression </span><span style="color:rgb(175, 0, 255);font-weight:bold">is</span><span> </span><span style="color:rgb(175, 0, 255);font-weight:bold">not</span><span> </span><span style="color:rgb(0, 135, 0);font-weight:bold">None</span><span>:
</span><span style="color:rgb(0, 187, 0)">   1347</span><span>         </span><span style="color:rgb(0, 135, 0);font-weight:bold">from</span><span style="color:rgb(undefined, undefined, undefined)"> </span><span style="color:rgb(0, 0, 187);font-weight:bold">fsspec</span><span style="color:rgb(0, 0, 187);font-weight:bold">.</span><span style="color:rgb(0, 0, 187);font-weight:bold">compression</span><span style="color:rgb(undefined, undefined, undefined)"> </span><span style="color:rgb(0, 135, 0);font-weight:bold">import</span><span> compr

</span><span style="color:rgb(0, 187, 187)">File </span><span style="color:rgb(0, 187, 0)">~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/implementations/http.py:376</span><span>, in </span><span style="color:rgb(0, 187, 187)">HTTPFileSystem._open</span><span style="color:rgb(0, 0, 187)">(self, path, mode, block_size, autocommit, cache_type, cache_options, size, **kwargs)</span><span>
</span><span style="color:rgb(0, 187, 0)">    374</span><span> kw.update(kwargs)
</span><span style="color:rgb(0, 187, 0)">    375</span><span> info = {}
</span><span style="color:rgb(0, 187, 0)">--&gt; </span><span style="color:rgb(0, 187, 0)">376</span><span> size = size </span><span style="color:rgb(175, 0, 255);font-weight:bold">or</span><span> info.update(</span><span style="background-color:rgb(187, 187, 0);color:rgb(0, 135, 0)">self</span><span style="background-color:rgb(187, 187, 0)">.</span><span style="background-color:rgb(187, 187, 0)">info</span><span style="background-color:rgb(187, 187, 0)">(</span><span style="background-color:rgb(187, 187, 0)">path</span><span style="background-color:rgb(187, 187, 0)">,</span><span style="background-color:rgb(187, 187, 0)"> </span><span style="background-color:rgb(187, 187, 0)">*</span><span style="background-color:rgb(187, 187, 0)">*</span><span style="background-color:rgb(187, 187, 0)">kwargs</span><span style="background-color:rgb(187, 187, 0)">)</span><span>) </span><span style="color:rgb(175, 0, 255);font-weight:bold">or</span><span> info[</span><span style="color:rgb(187, 187, 0)">&quot;</span><span style="color:rgb(187, 187, 0)">size</span><span style="color:rgb(187, 187, 0)">&quot;</span><span>]
</span><span style="color:rgb(0, 187, 0)">    377</span><span> session = sync(</span><span style="color:rgb(0, 135, 0)">self</span><span>.loop, </span><span style="color:rgb(0, 135, 0)">self</span><span>.set_session)
</span><span style="color:rgb(0, 187, 0)">    378</span><span> </span><span style="color:rgb(0, 135, 0);font-weight:bold">if</span><span> block_size </span><span style="color:rgb(175, 0, 255);font-weight:bold">and</span><span> size </span><span style="color:rgb(175, 0, 255);font-weight:bold">and</span><span> info.get(</span><span style="color:rgb(187, 187, 0)">&quot;</span><span style="color:rgb(187, 187, 0)">partial</span><span style="color:rgb(187, 187, 0)">&quot;</span><span>, </span><span style="color:rgb(0, 135, 0);font-weight:bold">True</span><span>):

</span><span style="color:rgb(0, 187, 187)">File </span><span style="color:rgb(0, 187, 0)">~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/asyn.py:118</span><span>, in </span><span style="color:rgb(0, 187, 187)">sync_wrapper.&lt;locals&gt;.wrapper</span><span style="color:rgb(0, 0, 187)">(*args, **kwargs)</span><span>
</span><span style="color:rgb(0, 187, 0)">    115</span><span> </span><span style="color:rgb(175, 0, 255)">@functools</span><span>.wraps(func)
</span><span style="color:rgb(0, 187, 0)">    116</span><span> </span><span style="color:rgb(0, 135, 0);font-weight:bold">def</span><span style="color:rgb(undefined, undefined, undefined)"> </span><span style="color:rgb(0, 0, 187)">wrapper</span><span>(*args, **kwargs):
</span><span style="color:rgb(0, 187, 0)">    117</span><span>     </span><span style="color:rgb(0, 135, 0)">self</span><span> = obj </span><span style="color:rgb(175, 0, 255);font-weight:bold">or</span><span> args[</span><span style="color:rgb(0, 187, 0)">0</span><span>]
</span><span style="color:rgb(0, 187, 0)">--&gt; </span><span style="color:rgb(0, 187, 0)">118</span><span>     </span><span style="color:rgb(0, 135, 0);font-weight:bold">return</span><span> </span><span style="background-color:rgb(187, 187, 0)">sync</span><span style="background-color:rgb(187, 187, 0)">(</span><span style="background-color:rgb(187, 187, 0);color:rgb(0, 135, 0)">self</span><span style="background-color:rgb(187, 187, 0)">.</span><span style="background-color:rgb(187, 187, 0)">loop</span><span style="background-color:rgb(187, 187, 0)">,</span><span style="background-color:rgb(187, 187, 0)"> </span><span style="background-color:rgb(187, 187, 0)">func</span><span style="background-color:rgb(187, 187, 0)">,</span><span style="background-color:rgb(187, 187, 0)"> </span><span style="background-color:rgb(187, 187, 0)">*</span><span style="background-color:rgb(187, 187, 0)">args</span><span style="background-color:rgb(187, 187, 0)">,</span><span style="background-color:rgb(187, 187, 0)"> </span><span style="background-color:rgb(187, 187, 0)">*</span><span style="background-color:rgb(187, 187, 0)">*</span><span style="background-color:rgb(187, 187, 0)">kwargs</span><span style="background-color:rgb(187, 187, 0)">)</span><span>

</span><span style="color:rgb(0, 187, 187)">File </span><span style="color:rgb(0, 187, 0)">~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/asyn.py:103</span><span>, in </span><span style="color:rgb(0, 187, 187)">sync</span><span style="color:rgb(0, 0, 187)">(loop, func, timeout, *args, **kwargs)</span><span>
</span><span style="color:rgb(0, 187, 0)">    101</span><span>     </span><span style="color:rgb(0, 135, 0);font-weight:bold">raise</span><span> FSTimeoutError </span><span style="color:rgb(0, 135, 0);font-weight:bold">from</span><span style="color:rgb(undefined, undefined, undefined)"> </span><span style="color:rgb(0, 0, 187);font-weight:bold">return_result</span><span>
</span><span style="color:rgb(0, 187, 0)">    102</span><span> </span><span style="color:rgb(0, 135, 0);font-weight:bold">elif</span><span> </span><span style="color:rgb(0, 135, 0)">isinstance</span><span>(return_result, </span><span style="color:rgb(215, 95, 95);font-weight:bold">BaseException</span><span>):
</span><span style="color:rgb(0, 187, 0)">--&gt; </span><span style="color:rgb(0, 187, 0)">103</span><span>     </span><span style="color:rgb(0, 135, 0);font-weight:bold">raise</span><span> return_result
</span><span style="color:rgb(0, 187, 0)">    104</span><span> </span><span style="color:rgb(0, 135, 0);font-weight:bold">else</span><span>:
</span><span style="color:rgb(0, 187, 0)">    105</span><span>     </span><span style="color:rgb(0, 135, 0);font-weight:bold">return</span><span> return_result

</span><span style="color:rgb(0, 187, 187)">File </span><span style="color:rgb(0, 187, 0)">~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/asyn.py:56</span><span>, in </span><span style="color:rgb(0, 187, 187)">_runner</span><span style="color:rgb(0, 0, 187)">(event, coro, result, timeout)</span><span>
</span><span style="color:rgb(0, 187, 0)">     54</span><span>     coro = asyncio.wait_for(coro, timeout=timeout)
</span><span style="color:rgb(0, 187, 0)">     55</span><span> </span><span style="color:rgb(0, 135, 0);font-weight:bold">try</span><span>:
</span><span style="color:rgb(0, 187, 0)">---&gt; </span><span style="color:rgb(0, 187, 0)">56</span><span>     result[</span><span style="color:rgb(0, 187, 0)">0</span><span>] = </span><span style="color:rgb(0, 135, 0);font-weight:bold">await</span><span> coro
</span><span style="color:rgb(0, 187, 0)">     57</span><span> </span><span style="color:rgb(0, 135, 0);font-weight:bold">except</span><span> </span><span style="color:rgb(215, 95, 95);font-weight:bold">Exception</span><span> </span><span style="color:rgb(0, 135, 0);font-weight:bold">as</span><span> ex:
</span><span style="color:rgb(0, 187, 0)">     58</span><span>     result[</span><span style="color:rgb(0, 187, 0)">0</span><span>] = ex

</span><span style="color:rgb(0, 187, 187)">File </span><span style="color:rgb(0, 187, 0)">~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/implementations/http.py:450</span><span>, in </span><span style="color:rgb(0, 187, 187)">HTTPFileSystem._info</span><span style="color:rgb(0, 0, 187)">(self, url, **kwargs)</span><span>
</span><span style="color:rgb(0, 187, 0)">    447</span><span>     </span><span style="color:rgb(0, 135, 0);font-weight:bold">except</span><span> </span><span style="color:rgb(215, 95, 95);font-weight:bold">Exception</span><span> </span><span style="color:rgb(0, 135, 0);font-weight:bold">as</span><span> exc:
</span><span style="color:rgb(0, 187, 0)">    448</span><span>         </span><span style="color:rgb(0, 135, 0);font-weight:bold">if</span><span> policy == </span><span style="color:rgb(187, 187, 0)">&quot;</span><span style="color:rgb(187, 187, 0)">get</span><span style="color:rgb(187, 187, 0)">&quot;</span><span>:
</span><span style="color:rgb(0, 187, 0)">    449</span><span>             </span><span style="color:rgb(95, 135, 135);font-style:italic"># If get failed, then raise a FileNotFoundError</span><span>
</span><span style="color:rgb(0, 187, 0)">--&gt; </span><span style="color:rgb(0, 187, 0)">450</span><span>             </span><span style="color:rgb(0, 135, 0);font-weight:bold">raise</span><span> </span><span style="color:rgb(215, 95, 95);font-weight:bold">FileNotFoundError</span><span>(url) </span><span style="color:rgb(0, 135, 0);font-weight:bold">from</span><span style="color:rgb(undefined, undefined, undefined)"> </span><span style="color:rgb(0, 0, 187);font-weight:bold">exc</span><span>
</span><span style="color:rgb(0, 187, 0)">    451</span><span>         logger.debug(</span><span style="color:rgb(187, 187, 0)">&quot;</span><span style="color:rgb(187, 187, 0)">&quot;</span><span>, exc_info=exc)
</span><span style="color:rgb(0, 187, 0)">    453</span><span> </span><span style="color:rgb(0, 135, 0);font-weight:bold">return</span><span> {</span><span style="color:rgb(187, 187, 0)">&quot;</span><span style="color:rgb(187, 187, 0)">name</span><span style="color:rgb(187, 187, 0)">&quot;</span><span>: url, </span><span style="color:rgb(187, 187, 0)">&quot;</span><span style="color:rgb(187, 187, 0)">size</span><span style="color:rgb(187, 187, 0)">&quot;</span><span>: </span><span style="color:rgb(0, 135, 0);font-weight:bold">None</span><span>, **info, </span><span style="color:rgb(187, 187, 0)">&quot;</span><span style="color:rgb(187, 187, 0)">type</span><span style="color:rgb(187, 187, 0)">&quot;</span><span>: </span><span style="color:rgb(187, 187, 0)">&quot;</span><span style="color:rgb(187, 187, 0)">file</span><span style="color:rgb(187, 187, 0)">&quot;</span><span>}

</span><span style="color:rgb(187, 0, 0)">FileNotFoundError</span><span>: https://www.ncei.noaa.gov/thredds-ocean/dodsC/woa23/DATA/temperature/netcdf/decav/1.00/woa23_decav_t07_01.nc</span></code></pre></div></div></div><div id="taJnVHgM1X" class="relative group/block"><h1 id="id-5-downloading-external-error-map-for-the-specific-location" class="relative group"><span class="heading-text">5) Downloading external error map for the specific location.</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-5-downloading-external-error-map-for-the-specific-location" title="Link to this Section" aria-label="Link to this Section">¶</a></h1><p>Currently the error map comes from a fixed file; our plan is to switch to a dynamic AWS download that accepts location parameters.</p></div><div id="BQxgODznzM" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Downloading anomaly detection model error map from NCAR via OSDF
response = requests.get(&#x27;https://data-osdf.rda.ucar.edu/ncar/rda/pythia_2025/osdf-cookbook/mae_error_map.npy&#x27;)
response.raise_for_status()
sonar_clusters = np.load(io.BytesIO(response.content))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="H4qP5jM03lHH99vNAB5JK" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="ZvSW0joYoE" class="relative group/block"><hr class="py-2 my-5 translate-y-2"/></div><div id="G1lD5P6fnf" class="relative group/block"><h1 id="id-6-helper-mean-sv-in-db" class="relative group"><span class="heading-text">6) Helper: mean Sv in dB</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-6-helper-mean-sv-in-db" title="Link to this Section" aria-label="Link to this Section">¶</a></h1><p>Computes the mean of Sv correctly by converting dB → linear, averaging, then linear → dB.
Accepts array-like input (NumPy/xarray/dask); returns a scalar in dB.</p></div><div id="jJTxddaCA1" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">def calculate_sv_mean(input_sv):
    # Convert dB to linear, mean in linear space, convert back to dB
    sv = 10. ** (input_sv / 10.)
    return 10 * np.log10(np.mean(sv))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="D0t3O50lLECO4tgrd5syu" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="MLWg8xZszA" class="relative group/block"><h1 id="id-7-group-cruise-data-into-hourly-chunks" class="relative group"><span class="heading-text">7) Group cruise data into hourly chunks</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-7-group-cruise-data-into-hourly-chunks" title="Link to this Section" aria-label="Link to this Section">¶</a></h1><p>Adds an hourly label and groups the cruise data by hour.
Produces a list of per-hour xarray.Dataset chunks for downstream aggregation.</p></div><div id="j6zv4n39BG" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">cruise[&#x27;time_hour&#x27;] = cruise[&#x27;time&#x27;].dt.floor(&#x27;1h&#x27;)  # hourly bin label

# Group by each hour
grouped = cruise.groupby(&#x27;time_hour&#x27;)

# Extract each 1-hour Dataset as a chunk (drop helper label)
chunks = [group.drop_vars(&#x27;time_hour&#x27;) for _, group in grouped]</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="jNAExaaThjDeFwDNqQJDm" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="qUk5tozkBd" class="relative group/block"><h1 id="id-8-compute-hourly-mean-sv-and-attach-to-env-df" class="relative group"><span class="heading-text">8) Compute hourly mean Sv and attach to env_df</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-8-compute-hourly-mean-sv-and-attach-to-env-df" title="Link to this Section" aria-label="Link to this Section">¶</a></h1><p>Iterates over hourly chunks, computes mean Sv per hour using calculate_sv_mean.
Converts dask→NumPy→Python float and appends to a list.
Assigns the resulting hourly series to env_df[“sv_hourly”].
Assumes the number/order of hours matches rows retained in env_df.</p></div><div id="wd1K51y45h" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">sv_hourly = []
timestamps = []

for i in range(0, len(chunks)):
    sv_data = chunks[i][&#x27;Sv&#x27;]
    result = calculate_sv_mean(sv_data)

    # Use first time in hour as representative timestamp
    ts = pd.to_datetime(chunks[i][&#x27;time&#x27;].values[0])
    result = result.compute()  # dask -&gt; numpy
    result = float(result.values)  # numpy -&gt; Python float

    sv_hourly.append(result)

env_df[&quot;sv_hourly&quot;] = sv_hourly</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="Gbbx7qCGl7Yq2VkV_9iGH" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="DxI0PliGt3" class="relative group/block"><h1 id="id-9-build-depth-time-error-map-dataframe-and-align-timestamps" class="relative group"><span class="heading-text">9) Build (depth × time) error-map DataFrame and align timestamps</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-9-build-depth-time-error-map-dataframe-and-align-timestamps" title="Link to this Section" aria-label="Link to this Section">¶</a></h1><p>Extracts one channel from sonar_clusters and pairs it with cruise depths and timestamps to form a DataFrame.
Uses min(...) to guard against size mismatches in depth/time dimensions.
Aligns only the first and last timestamps in env_df to the heatmap’s time range (keeps interior indices unchanged, sets UTC).</p></div><div id="FjVJQ46V7h" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Prepare axes
depths = np.asarray(cruise.depth.values)
times = pd.to_datetime(hm_timestamps)

# Select channel/slice from sonar_clusters
vals = sonar_clusters[:, :, 1]  # (1088, 28096)

# Guard against mismatched sizes
n_depth = min(len(depths), vals.shape[0])
n_time = min(len(times), vals.shape[1])

# DataFrame: rows=depths, cols=timestamps
df = pd.DataFrame(
    data=vals[:n_depth, :n_time],
    index=depths[:n_depth],
    columns=times[:n_time]
)

# Align env_df index endpoints to heatmap timestamps (keeps interior unchanged)
idx = env_df.index.tolist()
df_timestamps = pd.to_datetime(df.columns).tz_localize(None)
idx[0] = pd.Timestamp(df_timestamps.values[0], tz=&#x27;UTC&#x27;).floor(&quot;s&quot;)
idx[-1] = pd.Timestamp(df_timestamps.values[-1], tz=&#x27;UTC&#x27;).floor(&quot;s&quot;)
env_df.index = idx</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="U3B6waPqAuunQ_sAmoqSq" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="KfJHIWJga0" class="relative group/block"><h1 id="id-10-data-visualization-synchronized-lines-heatmap" class="relative group"><span class="heading-text">10) Data Visualization: Synchronized Lines + Heatmap</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-10-data-visualization-synchronized-lines-heatmap" title="Link to this Section" aria-label="Link to this Section">¶</a></h1></div><div id="QWFltp56jR" class="relative group/block"><p>Plots synchronized data: top = time series from line_df; bottom = depth×time heatmap from heatmap_df.
Expects line_df to have a DatetimeIndex (timezone-naive or converted).
Depth axis is reversed (surface at top).
Saves an interactive HTML file to the parent directory (correlations.html) and shows the figure if show=True.</p></div><div id="tsDGYDrL8b" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">def plot_synchronized_heatmaps_from_df(
        heatmap_df: pd.DataFrame,
        line_df: pd.DataFrame,
        colorscale: str = &quot;Reds&quot;,
        show_markers: bool = False,
        show: bool = False,
):
    if not isinstance(line_df.index, pd.DatetimeIndex):
        raise TypeError(&quot;line_df must have a DatetimeIndex&quot;)
    line_df = line_df.copy()
    if line_df.index.tz is not None:
        line_df.index = line_df.index.tz_convert(None)

    depths = np.asarray(heatmap_df.index)
    heatmap_timestamps = pd.to_datetime(heatmap_df.columns)
    z = heatmap_df.to_numpy()

    n = len(line_df.columns)
    fig = make_subplots(
        rows=n + 1,
        cols=1,
        shared_xaxes=True,
        vertical_spacing=0.02,
        row_heights=[0.1] * n + [0.7],  # n small rows + large heatmap row
    )

    mode = &quot;lines+markers&quot; if show_markers else &quot;lines&quot;

    # Define units for each variable
    units = {
        &#x27;sea_surface_temperature&#x27;: &#x27;°C&#x27;,
        &#x27;elevation_deg&#x27;: &#x27;degrees&#x27;,
        &#x27;sv_hourly&#x27;: &#x27;dB&#x27;
    }

    for i, col in enumerate(line_df.columns, start=1):
        fig.add_trace(
            go.Scatter(x=line_df.index, y=line_df[col], name=str(col), mode=mode, showlegend=True),
            row=i, col=1
        )

        # Add units as y-axis titles
        unit = units.get(col, &#x27;&#x27;)  # Default to empty string if variable not found
        fig.update_yaxes(
            title_text=unit,
            row=i, col=1
        )

        if i &lt; len(line_df.columns):
            fig.update_xaxes(showticklabels=False, row=i, col=1)

    fig.add_trace(
        go.Heatmap(
            z=z, x=heatmap_timestamps, y=depths, colorscale=colorscale,
            zmin=np.nanmin(z), zmax=np.nanmax(z),
            hovertemplate=&quot;t=%{x}&lt;br&gt;depth=%{y}&lt;br&gt;value=%{z}&lt;extra&gt;&lt;/extra&gt;&quot;,
        ),
        row=n + 1, col=1
    )
    fig.update_yaxes(autorange=&quot;reversed&quot;, row=n + 1, col=1, title_text=&quot;Depth&quot;)

    fig.update_layout(
        margin=dict(l=40, r=40, t=60, b=40),  # Reduced left margin, increased top for legend
        hovermode=&quot;x unified&quot;,
        template=&quot;plotly_white&quot;,
        # height=10 * n + 500,  # scale height with number of signals
    )

    # Enhanced horizontal legend positioning
    fig.update_layout(
        legend=dict(
            orientation=&#x27;h&#x27;,
            x=0,
            y=1.02,
            xanchor=&#x27;left&#x27;,
            yanchor=&#x27;bottom&#x27;,
            bgcolor=&#x27;rgba(255,255,255,0.8)&#x27;,
            bordercolor=&#x27;rgba(0,0,0,0.1)&#x27;,
            borderwidth=1
        )
    )

    save_path = os.path.join(os.path.dirname(os.getcwd()), &quot;correlations.html&quot;)
    fig.write_html(save_path)
    print(f&quot;Plot saved to: {save_path}&quot;)
    if show:
        fig.show()
    return fig
# Uncomment this line in order to create the plot.
# fig = plot_synchronized_heatmaps_from_df(heatmap_df=df, line_df=env_df)
# fig.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="re3OTYIeVVNhytAZNVEdh" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="VTqinU2tgi" class="relative group/block"><p>Because rendering the plot is computationally intensive and involves downloading approximately 1 GB of data, we present a static image of the result instead.</p></div><div id="VSAtMVHDaa" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">from IPython.display import Image, display
display(Image(filename=&#x27;../images/sonarai_example.png&#x27;))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="rpbSFbY649UtwyNx6xuSs" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div></div><div class="flex pt-10 mb-10 space-x-4"><a class="flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700" href="/osdf-cookbook/notebooks/sonarai-foundations"><div class="flex h-full align-middle"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="self-center transition-transform group-hover:-translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"></path></svg><div class="flex-grow text-right"><div class="text-xs text-gray-500 dark:text-gray-400">NOAA SONAR data examples</div>Integrating sonar and buoy-based temperature data</div></div></a><a class="flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700" href="/osdf-cookbook/notebooks/pycogss-foundations"><div class="flex h-full align-middle"><div class="flex-grow"><div class="text-xs text-gray-500 dark:text-gray-400">PYCOGSS examples</div>PyCoGSS: Spectral Change Analysis of Arctic Water Tracks</div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="self-center transition-transform group-hover:translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"></path></svg></div></a></div></article></main><script>((a,d)=>{if(!window.history.state||!window.history.state.key){let h=Math.random().toString(32).slice(2);window.history.replaceState({key:h},"")}try{let f=JSON.parse(sessionStorage.getItem(a)||"{}")[d||window.history.state.key];typeof f=="number"&&window.scrollTo(0,f)}catch(h){console.error(h),sessionStorage.removeItem(a)}})("positions", null)</script><link rel="modulepreload" href="/osdf-cookbook/build/entry.client-UNPC4GT3.js"/><link rel="modulepreload" href="/osdf-cookbook/build/_shared/chunk-OCTKKCIL.js"/><link rel="modulepreload" href="/osdf-cookbook/build/_shared/chunk-UAI5KRM7.js"/><link rel="modulepreload" href="/osdf-cookbook/build/_shared/chunk-2NH4LW52.js"/><link rel="modulepreload" href="/osdf-cookbook/build/_shared/chunk-XWET6RJ7.js"/><link rel="modulepreload" href="/osdf-cookbook/build/_shared/chunk-HBJK6BW3.js"/><link rel="modulepreload" href="/osdf-cookbook/build/_shared/chunk-HYMQ7M2K.js"/><link rel="modulepreload" href="/osdf-cookbook/build/_shared/chunk-OHOXABTA.js"/><link rel="modulepreload" href="/osdf-cookbook/build/_shared/chunk-OCWQY3HK.js"/><link rel="modulepreload" href="/osdf-cookbook/build/_shared/chunk-C7FW3E47.js"/><link rel="modulepreload" href="/osdf-cookbook/build/_shared/chunk-3CVK3PYF.js"/><link rel="modulepreload" href="/osdf-cookbook/build/_shared/chunk-J6FHCSRC.js"/><link rel="modulepreload" href="/osdf-cookbook/build/_shared/chunk-ND43KHSX.js"/><link rel="modulepreload" href="/osdf-cookbook/build/_shared/chunk-GUCIBHGO.js"/><link rel="modulepreload" href="/osdf-cookbook/build/root-ZJOPFBMV.js"/><link rel="modulepreload" href="/osdf-cookbook/build/_shared/chunk-NFM2H3KQ.js"/><link rel="modulepreload" href="/osdf-cookbook/build/routes/$-CQPS5IOR.js"/><script>window.__remixContext = {"url":"/notebooks/sonarai-technical","state":{"loaderData":{"root":{"config":{"version":2,"myst":"1.6.2","options":{"favicon":"/osdf-cookbook/build/config-item-9b3afca6-5bca396d929bf4f7df1be04ff9e2654d.ico","logo":"/osdf-cookbook/build/config-item-24692dda-912711fa60f34a06b6e586a0ce2a7b3c.svg","logo_dark":"/osdf-cookbook/build/config-item-84d6d338-7b0c18702c96d7dbd8b73b394237733c.svg","logo_url":"https://projectpythia.org","analytics_google":"G-T52X8HNYE8","folders":true},"parts":{},"nav":[{"title":"Home","url":"https://projectpythia.org"},{"title":"Foundations","url":"https://foundations.projectpythia.org"},{"title":"Cookbooks","url":"https://cookbooks.projectpythia.org/"},{"title":"Resources","url":"https://projectpythia.org/resource-gallery/"},{"title":"Community","url":"https://projectpythia.org/#join-us"}],"actions":[{"title":"Project Pythia","url":"https://projectpythia.org","internal":false,"static":false}],"projects":[{"open_access":true,"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true},"code":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true}},"title":"OSDF Cookbook","authors":[{"nameParsed":{"literal":"Harsha R. Hampapura","given":"Harsha R.","family":"Hampapura"},"name":"Harsha R. Hampapura","id":"contributors-myst-generated-uid-0"},{"nameParsed":{"literal":"Brian Bockelman","given":"Brian","family":"Bockelman"},"name":"Brian Bockelman","id":"contributors-myst-generated-uid-1"},{"nameParsed":{"literal":"Alexander Hoelzeman","given":"Alexander","family":"Hoelzeman"},"name":"Alexander Hoelzeman","id":"contributors-myst-generated-uid-2"},{"nameParsed":{"literal":"Carrie Wall","given":"Carrie","family":"Wall"},"name":"Carrie Wall","id":"contributors-myst-generated-uid-3"},{"nameParsed":{"literal":"Emma Turetsky","given":"Emma","family":"Turetsky"},"name":"Emma Turetsky","id":"contributors-myst-generated-uid-4"},{"nameParsed":{"literal":"Amandha Wingert Barok","given":"Amandha Wingert","family":"Barok"},"name":"Amandha Wingert Barok","id":"contributors-myst-generated-uid-5"},{"nameParsed":{"literal":"Aashish Panta","given":"Aashish","family":"Panta"},"name":"Aashish Panta","id":"contributors-myst-generated-uid-6"},{"nameParsed":{"literal":"Riley Conroy","given":"Riley","family":"Conroy"},"name":"Riley Conroy","id":"contributors-myst-generated-uid-7"},{"nameParsed":{"literal":"Douglas Schuster","given":"Douglas","family":"Schuster"},"name":"Douglas Schuster","id":"contributors-myst-generated-uid-8"},{"nameParsed":{"literal":"Justin Hiemstra","given":"Justin","family":"Hiemstra"},"name":"Justin Hiemstra","id":"contributors-myst-generated-uid-9"},{"nameParsed":{"literal":"Joanmarie Del Vecchio","given":"Joanmarie Del","family":"Vecchio"},"name":"Joanmarie Del Vecchio","id":"contributors-myst-generated-uid-10"},{"nameParsed":{"literal":"Kibiwott Koech","given":"Kibiwott","family":"Koech"},"name":"Kibiwott Koech","id":"contributors-myst-generated-uid-11"}],"contributors":[{"id":"brian-rose","nameParsed":{"literal":"Brian E. J. Rose","given":"Brian E. J.","family":"Rose"},"name":"Brian E. J. Rose","orcid":"0000-0002-9961-3821","email":"brose@albany.edu","affiliations":["UAlbany"],"url":"https://brian-rose.github.io","github":"brian-rose","bluesky":"@brianejrose.bsky.social","linkedin":"https://www.linkedin.com/in/brian-rose-37bb55106/"},{"id":"clyne","nameParsed":{"literal":"John Clyne","given":"John","family":"Clyne"},"name":"John Clyne","orcid":"0000-0003-2788-9017","affiliations":["CISL"],"github":"clyne"},{"id":"jukent","nameParsed":{"literal":"Julia Kent","given":"Julia","family":"Kent"},"name":"Julia Kent","orcid":"0000-0002-5611-8986","affiliations":["CISL"],"github":"jukent"},{"id":"ktyle","nameParsed":{"literal":"Kevin Tyle","given":"Kevin","family":"Tyle"},"name":"Kevin Tyle","orcid":"0000-0001-5249-9665","affiliations":["UAlbany"],"github":"ktyle"},{"id":"andersy005","nameParsed":{"literal":"Anderson Banihirwe","given":"Anderson","family":"Banihirwe"},"name":"Anderson Banihirwe","orcid":"0000-0001-6583-571X","affiliations":["CarbonPlan"],"github":"andersy005"},{"id":"dcamron","nameParsed":{"literal":"Drew Camron","given":"Drew","family":"Camron"},"name":"Drew Camron","orcid":"0000-0001-7246-6502","affiliations":["Unidata"],"github":"dcamron"},{"id":"dopplershift","nameParsed":{"literal":"Ryan May","given":"Ryan","family":"May"},"name":"Ryan May","orcid":"0000-0003-2907-038X","affiliations":["Unidata"],"github":"dopplershift"},{"id":"mgrover1","nameParsed":{"literal":"Maxwell Grover","given":"Maxwell","family":"Grover"},"name":"Maxwell Grover","orcid":"0000-0002-0370-8974","affiliations":["Argonne"],"github":"mgrover1"},{"id":"r-ford","nameParsed":{"literal":"Robert R. Ford","given":"Robert R.","family":"Ford"},"name":"Robert R. Ford","orcid":"0000-0001-5483-4965","affiliations":["UAlbany"],"github":"r-ford"},{"id":"kmpaul","nameParsed":{"literal":"Kevin Paul","given":"Kevin","family":"Paul"},"name":"Kevin Paul","orcid":"0000-0001-8155-8038","affiliations":["NVIDIA"],"github":"kmpaul"},{"id":"jnmorley","nameParsed":{"literal":"James Morley","given":"James","family":"Morley"},"name":"James Morley","orcid":"0009-0005-5193-7981","github":"jnmorley"},{"id":"erogluorhan","nameParsed":{"literal":"Orhan Eroglu","given":"Orhan","family":"Eroglu"},"name":"Orhan Eroglu","orcid":"0000-0003-3099-8775","affiliations":["CISL"],"github":"erogluorhan"},{"id":"lkailynncar","nameParsed":{"literal":"Lily Kailyn","given":"Lily","family":"Kailyn"},"name":"Lily Kailyn","orcid":"0009-0002-0125-5091","affiliations":["CISL"],"github":"lkailynncar"},{"id":"anissa111","nameParsed":{"literal":"Anissa Zacharias","given":"Anissa","family":"Zacharias"},"name":"Anissa Zacharias","orcid":"0000-0002-2666-8493","affiliations":["CISL"],"github":"anissa111"},{"id":"kafitzgerald","nameParsed":{"literal":"Katelyn FitzGerald","given":"Katelyn","family":"FitzGerald"},"name":"Katelyn FitzGerald","orcid":"0000-0003-4184-1917","affiliations":["CISL"],"github":"kafitzgerald"}],"github":"https://github.com/projectpythia/osdf-cookbook","affiliations":[{"id":"UAlbany","name":"University at Albany (SUNY)","department":"Atmospheric and Environmental Sciences","url":"https://www.albany.edu/daes"},{"id":"CISL","name":"NSF National Center for Atmospheric Research","department":"Computational and Information Systems Lab","url":"https://www.cisl.ucar.edu"},{"id":"Unidata","name":"NSF Unidata","url":"https://www.unidata.ucar.edu"},{"id":"Argonne","name":"Argonne National Laboratory","department":"Environmental Science Division","url":"https://www.anl.gov/evs"},{"id":"CarbonPlan","name":"CarbonPlan","url":"https://carbonplan.org"},{"id":"NVIDIA","name":"NVIDIA Corporation","url":"https://www.nvidia.com/"}],"copyright":"2024","references":{"foundations":{"url":"https://foundations.projectpythia.org"},"xarray":{"url":"https://docs.xarray.dev/en/stable"},"matplotlib":{"url":"https://matplotlib.org/stable"}},"thebe":{"binder":{"url":"https://mybinder.org/","provider":"github","repo":"projectpythia/osdf-cookbook","ref":"HEAD"}},"toc":[{"file":"README.md"},{"children":[{"file":"notebooks/how-to-cite.md"}],"title":"Preamble"},{"children":[{"file":"notebooks/01_osdf_intro.ipynb"},{"file":"notebooks/01_pelicanfs.ipynb"}],"title":"Introduction to OSDF"},{"children":[{"file":"notebooks/02_ncar_intro.ipynb"},{"file":"notebooks/02_cesm2_oceanheat.ipynb"},{"file":"notebooks/02_cmip6_gmst.ipynb"}],"title":"NCAR examples"},{"children":[{"file":"notebooks/03_EnviStor_Foundations.ipynb"},{"file":"notebooks/03_EnviStor_Technical.ipynb"}],"title":"Envistor examples"},{"children":[{"file":"notebooks/04_SonarAI_Foundations.ipynb"},{"file":"notebooks/04_SonarAI_Technical.ipynb"}],"title":"NOAA SONAR data examples"},{"children":[{"file":"notebooks/05_PyCoGSS_Foundations.ipynb"},{"file":"notebooks/05_PyCoGSS_SpectralChange_PFS.ipynb"}],"title":"PYCOGSS examples"},{"children":[{"file":"notebooks/06_introduction_to_NSDF_OpenVISUS.ipynb"},{"file":"notebooks/06_ocean_llc4320_visualization.ipynb"},{"file":"notebooks/06_ocean_llc2160_visualization.ipynb"},{"file":"notebooks/06_atmosphere_llc2160_visualization.ipynb"}],"title":"OpenVISUS examples"}],"thumbnail":"/osdf-cookbook/build/cookbook_logo-35042cacdefd342d103254243b6520b3.png","exports":[],"bibliography":[],"index":"index","pages":[{"level":1,"title":"Preamble"},{"slug":"notebooks.how-to-cite","title":"How to Cite This Cookbook","description":"","date":"","thumbnail":"/osdf-cookbook/build/752d668a01647c1c7b20b3d9a5936e83.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Introduction to OSDF"},{"slug":"notebooks.osdf-intro","title":"Streaming Data with the Open Science Data Federation (OSDF)","description":"","date":"","thumbnail":"/osdf-cookbook/build/OSDF_OSPool_Logos-99cf193aeb85d67d226662a090b8949c.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.pelicanfs","title":"Using PelicanFS via FSSpec to Access Data on the OSDF","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"NCAR examples"},{"slug":"notebooks.ncar-intro","title":"Introduction to NSF NCAR’s Geoscience Data Exhcange","description":"","date":"","thumbnail":"/osdf-cookbook/build/GDEX_Logo-14e63756244eaffa89ef375718dec784.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.cesm2-oceanheat","title":"Calculate Surface Ocean Heat using CESM2 LENS data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.cmip6-gmst","title":"Global Mean Surface Temperature Anomalies (GMSTA) from CMIP6 data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Envistor examples"},{"slug":"notebooks.envistor-foundations","title":"Exploring Salinity Patterns in South Florida Coastal Waters","description":"","date":"","thumbnail":"/osdf-cookbook/build/FIU_EnviStor_logo-14a90cd9a6adcbd2340f41e78b465b76.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.envistor-technical","title":"Analyzing Salinity Patterns in South Florida","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"NOAA SONAR data examples"},{"slug":"notebooks.sonarai-foundations","title":"Integrating sonar and buoy-based temperature data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.sonarai-technical","title":"Contextual Integration of NCAR/NOAA Environmental Data with the NOAA Water Column Sonar Archive","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"PYCOGSS examples"},{"slug":"notebooks.pycogss-foundations","title":"PyCoGSS: Spectral Change Analysis of Arctic Water Tracks","description":"","date":"","thumbnail":"/osdf-cookbook/build/pycogss-logo-89634f9a80a51495a2ba88fb9f62fac1.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.pycogss-spectralchange-pfs","title":"PyCoGSS: Spectral Change Analysis of Arctic Water Tracks","description":"","date":"","thumbnail":"/osdf-cookbook/build/pycogss-logo-89634f9a80a51495a2ba88fb9f62fac1.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"OpenVISUS examples"},{"slug":"notebooks.introduction-to-nsdf-openvisus","title":"Introduction to NSDF-OpenVISUS","description":"","date":"","thumbnail":"/osdf-cookbook/build/nsdf-9370e15d8357004fee486039903687a2.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.ocean-llc4320-visualization","title":"ECCO LLC4320 Ocean Dataset Notebook","description":"","date":"","thumbnail":"/osdf-cookbook/build/nsdf-9370e15d8357004fee486039903687a2.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.ocean-llc2160-visualization","title":"DYAMOND LLC2160 Ocean Dataset Notebook","description":"","date":"","thumbnail":"/osdf-cookbook/build/nsdf-9370e15d8357004fee486039903687a2.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.atmosphere-llc2160-visualization","title":"DYAMOND LLC2160 Atmospheric Dataset Notebook","description":"","date":"","thumbnail":"/osdf-cookbook/build/nsdf-9370e15d8357004fee486039903687a2.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"CONTENT_CDN_PORT":"3100","MODE":"static","BASE_URL":"/osdf-cookbook"},"routes/$":{"config":{"version":2,"myst":"1.6.2","options":{"favicon":"/osdf-cookbook/build/config-item-9b3afca6-5bca396d929bf4f7df1be04ff9e2654d.ico","logo":"/osdf-cookbook/build/config-item-24692dda-912711fa60f34a06b6e586a0ce2a7b3c.svg","logo_dark":"/osdf-cookbook/build/config-item-84d6d338-7b0c18702c96d7dbd8b73b394237733c.svg","logo_url":"https://projectpythia.org","analytics_google":"G-T52X8HNYE8","folders":true},"parts":{},"nav":[{"title":"Home","url":"https://projectpythia.org"},{"title":"Foundations","url":"https://foundations.projectpythia.org"},{"title":"Cookbooks","url":"https://cookbooks.projectpythia.org/"},{"title":"Resources","url":"https://projectpythia.org/resource-gallery/"},{"title":"Community","url":"https://projectpythia.org/#join-us"}],"actions":[{"title":"Project Pythia","url":"https://projectpythia.org","internal":false,"static":false}],"projects":[{"open_access":true,"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true},"code":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true}},"title":"OSDF Cookbook","authors":[{"nameParsed":{"literal":"Harsha R. Hampapura","given":"Harsha R.","family":"Hampapura"},"name":"Harsha R. Hampapura","id":"contributors-myst-generated-uid-0"},{"nameParsed":{"literal":"Brian Bockelman","given":"Brian","family":"Bockelman"},"name":"Brian Bockelman","id":"contributors-myst-generated-uid-1"},{"nameParsed":{"literal":"Alexander Hoelzeman","given":"Alexander","family":"Hoelzeman"},"name":"Alexander Hoelzeman","id":"contributors-myst-generated-uid-2"},{"nameParsed":{"literal":"Carrie Wall","given":"Carrie","family":"Wall"},"name":"Carrie Wall","id":"contributors-myst-generated-uid-3"},{"nameParsed":{"literal":"Emma Turetsky","given":"Emma","family":"Turetsky"},"name":"Emma Turetsky","id":"contributors-myst-generated-uid-4"},{"nameParsed":{"literal":"Amandha Wingert Barok","given":"Amandha Wingert","family":"Barok"},"name":"Amandha Wingert Barok","id":"contributors-myst-generated-uid-5"},{"nameParsed":{"literal":"Aashish Panta","given":"Aashish","family":"Panta"},"name":"Aashish Panta","id":"contributors-myst-generated-uid-6"},{"nameParsed":{"literal":"Riley Conroy","given":"Riley","family":"Conroy"},"name":"Riley Conroy","id":"contributors-myst-generated-uid-7"},{"nameParsed":{"literal":"Douglas Schuster","given":"Douglas","family":"Schuster"},"name":"Douglas Schuster","id":"contributors-myst-generated-uid-8"},{"nameParsed":{"literal":"Justin Hiemstra","given":"Justin","family":"Hiemstra"},"name":"Justin Hiemstra","id":"contributors-myst-generated-uid-9"},{"nameParsed":{"literal":"Joanmarie Del Vecchio","given":"Joanmarie Del","family":"Vecchio"},"name":"Joanmarie Del Vecchio","id":"contributors-myst-generated-uid-10"},{"nameParsed":{"literal":"Kibiwott Koech","given":"Kibiwott","family":"Koech"},"name":"Kibiwott Koech","id":"contributors-myst-generated-uid-11"}],"contributors":[{"id":"brian-rose","nameParsed":{"literal":"Brian E. J. Rose","given":"Brian E. J.","family":"Rose"},"name":"Brian E. J. Rose","orcid":"0000-0002-9961-3821","email":"brose@albany.edu","affiliations":["UAlbany"],"url":"https://brian-rose.github.io","github":"brian-rose","bluesky":"@brianejrose.bsky.social","linkedin":"https://www.linkedin.com/in/brian-rose-37bb55106/"},{"id":"clyne","nameParsed":{"literal":"John Clyne","given":"John","family":"Clyne"},"name":"John Clyne","orcid":"0000-0003-2788-9017","affiliations":["CISL"],"github":"clyne"},{"id":"jukent","nameParsed":{"literal":"Julia Kent","given":"Julia","family":"Kent"},"name":"Julia Kent","orcid":"0000-0002-5611-8986","affiliations":["CISL"],"github":"jukent"},{"id":"ktyle","nameParsed":{"literal":"Kevin Tyle","given":"Kevin","family":"Tyle"},"name":"Kevin Tyle","orcid":"0000-0001-5249-9665","affiliations":["UAlbany"],"github":"ktyle"},{"id":"andersy005","nameParsed":{"literal":"Anderson Banihirwe","given":"Anderson","family":"Banihirwe"},"name":"Anderson Banihirwe","orcid":"0000-0001-6583-571X","affiliations":["CarbonPlan"],"github":"andersy005"},{"id":"dcamron","nameParsed":{"literal":"Drew Camron","given":"Drew","family":"Camron"},"name":"Drew Camron","orcid":"0000-0001-7246-6502","affiliations":["Unidata"],"github":"dcamron"},{"id":"dopplershift","nameParsed":{"literal":"Ryan May","given":"Ryan","family":"May"},"name":"Ryan May","orcid":"0000-0003-2907-038X","affiliations":["Unidata"],"github":"dopplershift"},{"id":"mgrover1","nameParsed":{"literal":"Maxwell Grover","given":"Maxwell","family":"Grover"},"name":"Maxwell Grover","orcid":"0000-0002-0370-8974","affiliations":["Argonne"],"github":"mgrover1"},{"id":"r-ford","nameParsed":{"literal":"Robert R. Ford","given":"Robert R.","family":"Ford"},"name":"Robert R. Ford","orcid":"0000-0001-5483-4965","affiliations":["UAlbany"],"github":"r-ford"},{"id":"kmpaul","nameParsed":{"literal":"Kevin Paul","given":"Kevin","family":"Paul"},"name":"Kevin Paul","orcid":"0000-0001-8155-8038","affiliations":["NVIDIA"],"github":"kmpaul"},{"id":"jnmorley","nameParsed":{"literal":"James Morley","given":"James","family":"Morley"},"name":"James Morley","orcid":"0009-0005-5193-7981","github":"jnmorley"},{"id":"erogluorhan","nameParsed":{"literal":"Orhan Eroglu","given":"Orhan","family":"Eroglu"},"name":"Orhan Eroglu","orcid":"0000-0003-3099-8775","affiliations":["CISL"],"github":"erogluorhan"},{"id":"lkailynncar","nameParsed":{"literal":"Lily Kailyn","given":"Lily","family":"Kailyn"},"name":"Lily Kailyn","orcid":"0009-0002-0125-5091","affiliations":["CISL"],"github":"lkailynncar"},{"id":"anissa111","nameParsed":{"literal":"Anissa Zacharias","given":"Anissa","family":"Zacharias"},"name":"Anissa Zacharias","orcid":"0000-0002-2666-8493","affiliations":["CISL"],"github":"anissa111"},{"id":"kafitzgerald","nameParsed":{"literal":"Katelyn FitzGerald","given":"Katelyn","family":"FitzGerald"},"name":"Katelyn FitzGerald","orcid":"0000-0003-4184-1917","affiliations":["CISL"],"github":"kafitzgerald"}],"github":"https://github.com/projectpythia/osdf-cookbook","affiliations":[{"id":"UAlbany","name":"University at Albany (SUNY)","department":"Atmospheric and Environmental Sciences","url":"https://www.albany.edu/daes"},{"id":"CISL","name":"NSF National Center for Atmospheric Research","department":"Computational and Information Systems Lab","url":"https://www.cisl.ucar.edu"},{"id":"Unidata","name":"NSF Unidata","url":"https://www.unidata.ucar.edu"},{"id":"Argonne","name":"Argonne National Laboratory","department":"Environmental Science Division","url":"https://www.anl.gov/evs"},{"id":"CarbonPlan","name":"CarbonPlan","url":"https://carbonplan.org"},{"id":"NVIDIA","name":"NVIDIA Corporation","url":"https://www.nvidia.com/"}],"copyright":"2024","references":{"foundations":{"url":"https://foundations.projectpythia.org"},"xarray":{"url":"https://docs.xarray.dev/en/stable"},"matplotlib":{"url":"https://matplotlib.org/stable"}},"thebe":{"binder":{"url":"https://mybinder.org/","provider":"github","repo":"projectpythia/osdf-cookbook","ref":"HEAD"}},"toc":[{"file":"README.md"},{"children":[{"file":"notebooks/how-to-cite.md"}],"title":"Preamble"},{"children":[{"file":"notebooks/01_osdf_intro.ipynb"},{"file":"notebooks/01_pelicanfs.ipynb"}],"title":"Introduction to OSDF"},{"children":[{"file":"notebooks/02_ncar_intro.ipynb"},{"file":"notebooks/02_cesm2_oceanheat.ipynb"},{"file":"notebooks/02_cmip6_gmst.ipynb"}],"title":"NCAR examples"},{"children":[{"file":"notebooks/03_EnviStor_Foundations.ipynb"},{"file":"notebooks/03_EnviStor_Technical.ipynb"}],"title":"Envistor examples"},{"children":[{"file":"notebooks/04_SonarAI_Foundations.ipynb"},{"file":"notebooks/04_SonarAI_Technical.ipynb"}],"title":"NOAA SONAR data examples"},{"children":[{"file":"notebooks/05_PyCoGSS_Foundations.ipynb"},{"file":"notebooks/05_PyCoGSS_SpectralChange_PFS.ipynb"}],"title":"PYCOGSS examples"},{"children":[{"file":"notebooks/06_introduction_to_NSDF_OpenVISUS.ipynb"},{"file":"notebooks/06_ocean_llc4320_visualization.ipynb"},{"file":"notebooks/06_ocean_llc2160_visualization.ipynb"},{"file":"notebooks/06_atmosphere_llc2160_visualization.ipynb"}],"title":"OpenVISUS examples"}],"thumbnail":"/osdf-cookbook/build/cookbook_logo-35042cacdefd342d103254243b6520b3.png","exports":[],"bibliography":[],"index":"index","pages":[{"level":1,"title":"Preamble"},{"slug":"notebooks.how-to-cite","title":"How to Cite This Cookbook","description":"","date":"","thumbnail":"/osdf-cookbook/build/752d668a01647c1c7b20b3d9a5936e83.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Introduction to OSDF"},{"slug":"notebooks.osdf-intro","title":"Streaming Data with the Open Science Data Federation (OSDF)","description":"","date":"","thumbnail":"/osdf-cookbook/build/OSDF_OSPool_Logos-99cf193aeb85d67d226662a090b8949c.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.pelicanfs","title":"Using PelicanFS via FSSpec to Access Data on the OSDF","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"NCAR examples"},{"slug":"notebooks.ncar-intro","title":"Introduction to NSF NCAR’s Geoscience Data Exhcange","description":"","date":"","thumbnail":"/osdf-cookbook/build/GDEX_Logo-14e63756244eaffa89ef375718dec784.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.cesm2-oceanheat","title":"Calculate Surface Ocean Heat using CESM2 LENS data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.cmip6-gmst","title":"Global Mean Surface Temperature Anomalies (GMSTA) from CMIP6 data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Envistor examples"},{"slug":"notebooks.envistor-foundations","title":"Exploring Salinity Patterns in South Florida Coastal Waters","description":"","date":"","thumbnail":"/osdf-cookbook/build/FIU_EnviStor_logo-14a90cd9a6adcbd2340f41e78b465b76.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.envistor-technical","title":"Analyzing Salinity Patterns in South Florida","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"NOAA SONAR data examples"},{"slug":"notebooks.sonarai-foundations","title":"Integrating sonar and buoy-based temperature data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.sonarai-technical","title":"Contextual Integration of NCAR/NOAA Environmental Data with the NOAA Water Column Sonar Archive","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"PYCOGSS examples"},{"slug":"notebooks.pycogss-foundations","title":"PyCoGSS: Spectral Change Analysis of Arctic Water Tracks","description":"","date":"","thumbnail":"/osdf-cookbook/build/pycogss-logo-89634f9a80a51495a2ba88fb9f62fac1.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.pycogss-spectralchange-pfs","title":"PyCoGSS: Spectral Change Analysis of Arctic Water Tracks","description":"","date":"","thumbnail":"/osdf-cookbook/build/pycogss-logo-89634f9a80a51495a2ba88fb9f62fac1.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"OpenVISUS examples"},{"slug":"notebooks.introduction-to-nsdf-openvisus","title":"Introduction to NSDF-OpenVISUS","description":"","date":"","thumbnail":"/osdf-cookbook/build/nsdf-9370e15d8357004fee486039903687a2.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.ocean-llc4320-visualization","title":"ECCO LLC4320 Ocean Dataset Notebook","description":"","date":"","thumbnail":"/osdf-cookbook/build/nsdf-9370e15d8357004fee486039903687a2.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.ocean-llc2160-visualization","title":"DYAMOND LLC2160 Ocean Dataset Notebook","description":"","date":"","thumbnail":"/osdf-cookbook/build/nsdf-9370e15d8357004fee486039903687a2.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.atmosphere-llc2160-visualization","title":"DYAMOND LLC2160 Atmospheric Dataset Notebook","description":"","date":"","thumbnail":"/osdf-cookbook/build/nsdf-9370e15d8357004fee486039903687a2.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"page":{"version":2,"kind":"Notebook","sha256":"0ba524d9363a1973fb82642b3b8fc68a041e678852dec8b3bb51a7d88a3d22ec","slug":"notebooks.sonarai-technical","location":"/notebooks/04_SonarAI_Technical.ipynb","dependencies":[],"frontmatter":{"title":"Contextual Integration of NCAR/NOAA Environmental Data with the NOAA Water Column Sonar Archive","content_includes_title":true,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"authors":[{"nameParsed":{"literal":"Harsha R. Hampapura","given":"Harsha R.","family":"Hampapura"},"name":"Harsha R. Hampapura","id":"contributors-myst-generated-uid-0"},{"nameParsed":{"literal":"Brian Bockelman","given":"Brian","family":"Bockelman"},"name":"Brian Bockelman","id":"contributors-myst-generated-uid-1"},{"nameParsed":{"literal":"Alexander Hoelzeman","given":"Alexander","family":"Hoelzeman"},"name":"Alexander Hoelzeman","id":"contributors-myst-generated-uid-2"},{"nameParsed":{"literal":"Carrie Wall","given":"Carrie","family":"Wall"},"name":"Carrie Wall","id":"contributors-myst-generated-uid-3"},{"nameParsed":{"literal":"Emma Turetsky","given":"Emma","family":"Turetsky"},"name":"Emma Turetsky","id":"contributors-myst-generated-uid-4"},{"nameParsed":{"literal":"Amandha Wingert Barok","given":"Amandha Wingert","family":"Barok"},"name":"Amandha Wingert Barok","id":"contributors-myst-generated-uid-5"},{"nameParsed":{"literal":"Aashish Panta","given":"Aashish","family":"Panta"},"name":"Aashish Panta","id":"contributors-myst-generated-uid-6"},{"nameParsed":{"literal":"Riley Conroy","given":"Riley","family":"Conroy"},"name":"Riley Conroy","id":"contributors-myst-generated-uid-7"},{"nameParsed":{"literal":"Douglas Schuster","given":"Douglas","family":"Schuster"},"name":"Douglas Schuster","id":"contributors-myst-generated-uid-8"},{"nameParsed":{"literal":"Justin Hiemstra","given":"Justin","family":"Hiemstra"},"name":"Justin Hiemstra","id":"contributors-myst-generated-uid-9"},{"nameParsed":{"literal":"Joanmarie Del Vecchio","given":"Joanmarie Del","family":"Vecchio"},"name":"Joanmarie Del Vecchio","id":"contributors-myst-generated-uid-10"},{"nameParsed":{"literal":"Kibiwott Koech","given":"Kibiwott","family":"Koech"},"name":"Kibiwott Koech","id":"contributors-myst-generated-uid-11"}],"open_access":true,"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true},"code":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true}},"github":"https://github.com/projectpythia/osdf-cookbook","copyright":"2024","affiliations":[{"id":"UAlbany","name":"University at Albany (SUNY)","department":"Atmospheric and Environmental Sciences","url":"https://www.albany.edu/daes"},{"id":"CISL","name":"NSF National Center for Atmospheric Research","department":"Computational and Information Systems Lab","url":"https://www.cisl.ucar.edu"},{"id":"Unidata","name":"NSF Unidata","url":"https://www.unidata.ucar.edu"},{"id":"Argonne","name":"Argonne National Laboratory","department":"Environmental Science Division","url":"https://www.anl.gov/evs"},{"id":"CarbonPlan","name":"CarbonPlan","url":"https://carbonplan.org"},{"id":"NVIDIA","name":"NVIDIA Corporation","url":"https://www.nvidia.com/"}],"numbering":{"title":{"offset":1}},"source_url":"https://github.com/projectpythia/osdf-cookbook/blob/main/notebooks/04_SonarAI_Technical.ipynb","edit_url":"https://github.com/projectpythia/osdf-cookbook/edit/main/notebooks/04_SonarAI_Technical.ipynb","exports":[{"format":"ipynb","filename":"04_SonarAI_Technical.ipynb","url":"/osdf-cookbook/build/04_SonarAI_Technical-7f48d80aca4b6970ab3599bba0808039.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"code","lang":"","value":"","key":"pA4NHTFaeg"}],"key":"Ykuve0pCQX"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Contextual Integration of NCAR/NOAA Environmental Data with the NOAA Water Column Sonar Archive","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ktJE3imHeZ"}],"identifier":"contextual-integration-of-ncar-noaa-environmental-data-with-the-noaa-water-column-sonar-archive","label":"Contextual Integration of NCAR/NOAA Environmental Data with the NOAA Water Column Sonar Archive","html_id":"contextual-integration-of-ncar-noaa-environmental-data-with-the-noaa-water-column-sonar-archive","implicit":true,"key":"s42x5F9eVS"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This notebook walks through an end-to-end workflow to relate shipboard sonar backscatter (Sv) to local environmental conditions. We (1) open EK60 data from a public NOAA S3 Zarr, (2) gather co-located environmental variables from OISST and IOOS ERDDAP, (3) compute hourly mean Sv, (4) assemble a depth×time error map for reference, and (5) synchronize timestamps to produce an interactive line-plus-heatmap visualization. All selections (time/depth/frequency) and conversions are kept explicit for reproducibility.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"vTiYCJZNWH"}],"key":"uOnC8edAAO"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Imports","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"O99oa4ce0Q"}],"key":"cyR2jexiLr"},{"type":"text","value":"\nLoad core libraries for data access (xarray, s3fs), analysis (numpy, pandas), plotting (plotly), and I/O.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"nlTyVICwN4"}],"key":"JX2iOy2pM2"}],"key":"WBoRgKSoDH"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"strong","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Initializing the datasets","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"JGpyFmFplV"}],"key":"f2Hy3eq4ks"},{"type":"text","value":"\nAccess HB1906 EK60 Zarr data from public S3; subset by time/depth, select 38 kHz, and mask bins below bottom.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"xY7GEZ5ubs"}],"key":"Pk97ePuW3B"}],"key":"mPUnuUt3MH"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"strong","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Access buoy data","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"pg42AE3GdQ"}],"key":"uGRHDY8UDa"},{"type":"text","value":"\nDefine Georges Bank buoy coordinates, sample daily OISST SST at the nearest grid cell (±1 day), and download the model error map (","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"knfTtO8Cyy"},{"type":"inlineCode","value":".npy","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"qxjVneTrdL"},{"type":"text","value":").","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"Gte0WVRyxc"}],"key":"AQpwuJFO7f"}],"key":"zF6S5DMQPA"},{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"strong","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Calculate the temperature anomaly, sun elevation in degree and azimuth","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"RxOakoVRB4"}],"key":"wa1bZTTvgI"}],"key":"AXS7Z2Hvy7"}],"key":"ozBNb3jROl"},{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":16,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"strong","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Downloading external error map for the specific location","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"itibGAGv8p"}],"key":"L4o07PB1BJ"},{"type":"text","value":"\nDownloading the error map comes from a fixed file","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"NI4DCw8tFI"}],"key":"SulSHHzGoK"}],"key":"wGWzVCvxmP"},{"type":"listItem","spread":true,"position":{"start":{"line":19,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":19,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"strong","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Helper Function: Mean Sv (dB)","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"AKYBty1jIk"}],"key":"jId2fzF632"},{"type":"text","value":"\nConvert Sv from dB→linear, compute mean, convert back to dB.","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"Sr2O3WUj4n"}],"key":"TCqb6IE6pd"}],"key":"v4npwsRlbv"},{"type":"listItem","spread":true,"position":{"start":{"line":22,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":22,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"strong","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"Group Cruise Data into Hourly Chunks","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"HKf6ld0Nl6"}],"key":"XjaVikgVjg"},{"type":"text","value":"\nAdd an hourly label and split the EK60 dataset into per-hour ","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"tBYTR0mN3Q"},{"type":"inlineCode","value":"xarray.Dataset","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"ZTU2t0kq1B"},{"type":"text","value":" chunks.","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"uvXBE5QXt1"}],"key":"bt8r7Ir0kL"}],"key":"eqZDumWnuc"},{"type":"listItem","spread":true,"position":{"start":{"line":25,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":25,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"strong","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"Compute Hourly Mean Sv \u0026 Attach to ","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"fCMu46z6AY"},{"type":"inlineCode","value":"env_df","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"aTtTLBeWUk"}],"key":"KRoY4zivZK"},{"type":"text","value":"\nAggregate Sv per hour and append results as a new column in the environmental dataframe.","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"QiA0Lp38ZS"}],"key":"CAFu9wdvX2"}],"key":"e4O7LMq2Is"},{"type":"listItem","spread":true,"position":{"start":{"line":28,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":28,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"strong","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"Build Depth×Time Error-Map DataFrame \u0026 Align Timestamps","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"thYqGvJ8Ko"}],"key":"GAKvmd5StZ"},{"type":"text","value":"\nConstruct a depth-by-time matrix from the error map, guard for size mismatches, and align ","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"ZmByIvkvIn"},{"type":"inlineCode","value":"env_df","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"a3APDzEwvJ"},{"type":"text","value":" endpoints to the heatmap timestamps.","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"rQLo0t5YSm"}],"key":"fD0IEAJu2z"}],"key":"Y6Gpa7hz18"},{"type":"listItem","spread":true,"position":{"start":{"line":31,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":31,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"strong","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"Data Visualization: Synchronized Lines + Heatmap","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"RDmmoQGllr"}],"key":"MRIYvYoJ60"},{"type":"text","value":"\nPlot environmental time series above a depth×time heatmap with shared x-axis; save interactive HTML output.","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"m4P9B5MkgS"}],"key":"pm9SdO5o26"}],"key":"nAwbIRVYYi"}],"key":"rzOzFca94x"}],"key":"EyZlArtwVr"},{"type":"block","kind":"notebook-content","children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"piF6mAwwmf"}],"key":"xEg2lVzSzY"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Prerequisites","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Th2fhixKA1"}],"identifier":"prerequisites","label":"Prerequisites","html_id":"prerequisites","implicit":true,"key":"J5Yxbw2K02"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"This section was inspired by ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"VBN5PEiSjC"},{"type":"link","url":"https://github.com/alan-turing-institute/the-turing-way/blob/master/book/templates/chapter-template/chapter-landing-page.md","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"this template","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"pW09PgEfXJ"}],"urlSource":"https://github.com/alan-turing-institute/the-turing-way/blob/master/book/templates/chapter-template/chapter-landing-page.md","data":{"kind":"file","org":"alan-turing-institute","repo":"the-turing-way","reference":"master","file":"book/templates/chapter-template/chapter-landing-page.md","raw":"https://raw.githubusercontent.com/alan-turing-institute/the-turing-way/master/book/templates/chapter-template/chapter-landing-page.md"},"internal":false,"protocol":"github","key":"JjoQ8h5ce0"},{"type":"text","value":" of the wonderful ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"rGoVthO5sk"},{"type":"link","url":"https://the-turing-way.netlify.app","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"The Turing Way","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"cv98x5bEly"}],"urlSource":"https://the-turing-way.netlify.app","key":"tB7tKhLZDZ"},{"type":"text","value":" Jupyter Book.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Y1Xxiz2bVx"}],"key":"xJuDYhYvcn"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"This notebook opens public NOAA EK60 Zarr data from S3, subsets by time/depth, reads daily OISST SST near a buoy, fetches ERDDAP environmental variables, computes hourly mean ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"yP1VOXvbsY"},{"type":"strong","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Sv","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"yEO1Lipxnk"}],"key":"Ygw2UsAn5E"},{"type":"text","value":" (dB), aligns with a depth×time error map, and renders synchronized line/heatmap plots.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"gBKTPKoZ1j"}],"key":"kX7q5cUkD4"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Label the importance of each concept explicitly as ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"JGbBpPAFQd"},{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"helpful/necessary","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"w1F7Uq5c0e"}],"key":"mwY2m0jG6M"},{"type":"text","value":".","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"lR5eNo9yGK"}],"key":"Ilq3MmIdws"},{"type":"table","position":{"start":{"line":8,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"tableRow","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"tableCell","header":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Concepts","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"I5zrt0yWZ8"}],"key":"FN2B7SrBaO"},{"type":"tableCell","header":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Importance","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"yYljjJ5KZy"}],"key":"NWsmVah2iE"},{"type":"tableCell","header":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Notes","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"JCwuezWuwe"}],"key":"xepdeZGwAr"}],"key":"xu7FLO6RXy"},{"type":"tableRow","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Xarray + Zarr basics","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"YXtu74lrin"}],"key":"Gc0K8U2N7L"},{"type":"tableCell","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"strong","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Necessary","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"zrORYAQWOc"}],"key":"MwfjXaBwMv"}],"key":"bRo2EU0Tzy"},{"type":"tableCell","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Opening Zarr stores, selecting by coords/dims, ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"Og1WrhMsdE"},{"type":"inlineCode","value":".compute()","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"n69eHurhWu"},{"type":"text","value":" semantics","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"kCGJKFSSK8"}],"key":"LmCynZ5oNM"}],"key":"omvwyPZIb4"},{"type":"tableRow","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"s3fs \u0026 public S3 access","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"IhM8Tl6JOS"}],"key":"RlKbqUpjKV"},{"type":"tableCell","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"strong","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Necessary","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"c6qihPxW8x"}],"key":"mHctaWss8u"}],"key":"SPi8KH6kwY"},{"type":"tableCell","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Anonymous reads from AWS S3 (","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"x0fBHrBW7Y"},{"type":"inlineCode","value":"anon=True","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"l4iZUOThq4"},{"type":"text","value":")","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"Y6rx4SOuvd"}],"key":"jvoy18lQox"}],"key":"OL0e6RChx3"},{"type":"tableRow","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Pandas time series","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"KDZTVWFE5H"}],"key":"XUb6DMCuW8"},{"type":"tableCell","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"strong","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Necessary","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"TbbTMACQOk"}],"key":"FEPlAYQDYt"}],"key":"PmuKbAJ2kq"},{"type":"tableCell","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"inlineCode","value":"DatetimeIndex","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"SlsrRRNwE1"},{"type":"text","value":", sorting, filtering, timezone-naive vs. aware","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"uQiECLiLIk"}],"key":"VukPQLcJzH"}],"key":"L98nzCY5Uz"},{"type":"tableRow","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"NumPy fundamentals","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"PNAcw2enZF"}],"key":"qIT1nkyvY9"},{"type":"tableCell","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"strong","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Necessary","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"Ynp2YP2SLt"}],"key":"YaANwI6ZS5"}],"key":"lB3g1orCXA"},{"type":"tableCell","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Array slicing, stats, type conversion","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"jXG1lZS9tW"}],"key":"lMExD2WZPX"}],"key":"FaxTtXWu8y"},{"type":"tableRow","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Acoustic backscatter (Sv) \u0026 dB averaging","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"CIuazYmAS0"}],"key":"PokyfgFnJy"},{"type":"tableCell","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"strong","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Necessary","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"lKUmtrKlAQ"}],"key":"p8IPPcAlav"}],"key":"E9QnfhLOvi"},{"type":"tableCell","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Convert dB→linear, mean, then linear→dB, Understanding results","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"c5dtMss925"}],"key":"K6mehSugH5"}],"key":"zMuD9hRuGT"},{"type":"tableRow","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"ERDDAP tabledap \u0026 info endpoints","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"fQHIRUkTLZ"}],"key":"F0BSTHN2HN"},{"type":"tableCell","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"strong","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Helpful","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"kt4kByOpmT"}],"key":"m8CpbbDPit"}],"key":"gfySkt7JX9"},{"type":"tableCell","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Reading CSV responses; unit metadata lookup","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"tMGmYusf1C"}],"key":"jTymmaMHXx"}],"key":"if9T6mO9yI"},{"type":"tableRow","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Plotly fundamentals","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"URSq89ZuDG"}],"key":"wuLX3PmcYB"},{"type":"tableCell","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"strong","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Helpful","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"vGVabDurak"}],"key":"Y3oK7VDrJU"}],"key":"cU8bu0UWOy"},{"type":"tableCell","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Subplots, heatmaps, interactive HTML export","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"J9xJfzSrzX"}],"key":"hsBLcZFHX9"}],"key":"H6s0BpKDDw"},{"type":"tableRow","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Understanding of NetCDF/CF","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"JHwF3revej"}],"key":"mIwp5ZAmma"},{"type":"tableCell","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"strong","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Helpful","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"w96IojVrtz"}],"key":"OsTxAjIRT8"}],"key":"Nkt0o4tGlN"},{"type":"tableCell","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Variable metadata and geospatial conventions","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"DZoPOfDisi"}],"key":"pT0lLTzClF"}],"key":"uiQxIMCHfV"},{"type":"tableRow","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"Dask awareness","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"J0IwUH2LzD"}],"key":"Y7iB6jYxyg"},{"type":"tableCell","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"strong","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"Helpful","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"oIOJ4M4MeR"}],"key":"TOgutQasDH"}],"key":"ndc3xY0wOq"},{"type":"tableCell","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"Lazy arrays; when/why to call ","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"IwIrvQro6n"},{"type":"inlineCode","value":".compute()","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"i3o8OkA2pM"}],"key":"Ejq7zcxwCY"}],"key":"S0oiP9VNtK"},{"type":"tableRow","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Geographic coordinates","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"Ya0jQ7s1Rt"}],"key":"FMgI5W3vnd"},{"type":"tableCell","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"strong","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Helpful","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"FWdRzRdf7b"}],"key":"FJtWPZQozo"}],"key":"f6y2xPrUkZ"},{"type":"tableCell","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"0–360 vs. −180–180 longitude handling","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"aCXFNhjxVR"}],"key":"EWSBNAMLd4"}],"key":"MH0zgjd74v"},{"type":"tableRow","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"HTTP/IO with ","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"BTVanUnxJh"},{"type":"inlineCode","value":"requests","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"Z9okJertTC"}],"key":"hACfw6eBkQ"},{"type":"tableCell","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"strong","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"Helpful","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"yukXcJrr9s"}],"key":"bU4ydHyqTd"}],"key":"U8EJ6UoYM7"},{"type":"tableCell","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"Downloading ","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"C4CAHj6Z8A"},{"type":"inlineCode","value":".npy","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"fWmrn0POdm"},{"type":"text","value":" assets for local use","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"nHQK3r1MH7"}],"key":"fkbgiGxd3g"}],"key":"iruIxLq0Ye"}],"key":"D9BxFHGbRa"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":22,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":22,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"strong","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"Time to learn","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"t3AZNRl7Hv"}],"key":"skouhRXcuJ"},{"type":"text","value":": ~75 minutes","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"sZ1a3jMw07"}],"key":"v1aUkaevDM"}],"key":"lIzE185sr9"},{"type":"listItem","spread":true,"position":{"start":{"line":24,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"strong","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"System requirements","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"qiCoEZo2Pk"}],"key":"v43SFsEr4x"},{"type":"text","value":":","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"P0jOGz3eVw"}],"key":"RiciIkGpo3"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":25,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Python 3.9+ with Jupyter Notebook/Lab","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"yf0CJq7bE7"}],"key":"t3SDqmmRIs"}],"key":"pF1lKUvRhG"},{"type":"listItem","spread":true,"position":{"start":{"line":26,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Required packages: ","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"rLG2wCxnyd"},{"type":"inlineCode","value":"xarray","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"dDycYNKmt8"},{"type":"text","value":", ","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"YQvRqV2rqd"},{"type":"inlineCode","value":"s3fs","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"oPWD6Hfqxk"},{"type":"text","value":", ","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"UnDPJ0ff8V"},{"type":"inlineCode","value":"numpy","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"IFlDytmGi1"},{"type":"text","value":", ","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"tFycWW9tLn"},{"type":"inlineCode","value":"pandas","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"pYmiBv9Kso"},{"type":"text","value":", ","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"mX81Gusfa5"},{"type":"inlineCode","value":"plotly","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"wjiXcbLrrn"},{"type":"text","value":", ","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"Apf5wfIpOv"},{"type":"inlineCode","value":"requests","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"vguvFoYKNn"},{"type":"text","value":", ","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"Q2j2Lus4yB"},{"type":"inlineCode","value":"netCDF4","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"oJY6ZKSdWZ"},{"type":"text","value":" ","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"lPbJOyLrtq"},{"type":"emphasis","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"(optional but helpful: ","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"gsR6G606FJ"},{"type":"inlineCode","value":"dask","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"iTS2c4GK0j"},{"type":"text","value":")","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"zLZYizG4Ea"}],"key":"Oa5vQoAsos"}],"key":"vTxqJkys6Y"}],"key":"HOtmavULzX"}],"key":"iu7g5VTHKB"}],"key":"g6ByGgrtne"}],"key":"b2lRuj77RA"},{"type":"paragraph","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"strong","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"Note:","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"yNJPBIycfC"}],"key":"R9uohMMmyZ"},{"type":"text","value":" Run the cell below ","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"mYLSzFNLLI"},{"type":"strong","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"only","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"ui5ADgGKGt"}],"key":"l3y81D87A5"},{"type":"text","value":" in a local environment to install the required packages. If you’re using Binder, skip this step.","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"lhQ7VCoG3D"}],"key":"e9giRXOAxg"}],"key":"nSun1yY1Ng"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import os\nimport sys\nimport yaml\nimport shutil\nimport subprocess\n\nENV_PATH = \"../environment.yml\"\n\nwith open(ENV_PATH, \"r\", encoding=\"utf-8\") as f:\n    env = yaml.safe_load(f)\n\nchannels = env.get(\"channels\", [])\ndeps = env.get(\"dependencies\", [])\n\nconda_pkgs = []\npip_pkgs = []\n\nfor dep in deps:\n    if isinstance(dep, str):\n        # Skip python pin and the literal 'pip' meta-package entry\n        name = dep.split(\"=\")[0].strip().lower()\n        if name in {\"python\", \"pip\"}:\n            continue\n        conda_pkgs.append(dep)\n    elif isinstance(dep, dict) and \"pip\" in dep:\n        pip_pkgs.extend(dep[\"pip\"])\n\n# Prefer mamba if present; fallback to conda\nconda_exe = shutil.which(\"mamba\") or shutil.which(\"conda\")\n\n# Install Conda packages\nif conda_pkgs:\n    if not conda_exe:\n        raise RuntimeError(\"Conda/mamba not found in PATH. Run this inside a Conda environment.\")\n    # Install into the current environment prefix\n    env_prefix = os.environ.get(\"CONDA_PREFIX\", sys.prefix)\n    cmd = [conda_exe, \"install\", \"-y\", \"-p\", env_prefix]\n    for ch in channels:\n        cmd += [\"-c\", ch]\n    cmd += conda_pkgs\n    print(\"Running:\", \" \".join(cmd))\n    subprocess.check_call(cmd)\nelse:\n    print(\"No Conda packages to install.\")\n\n# Install pip packages into the current kernel's Python\nif pip_pkgs:\n    cmd = [sys.executable, \"-m\", \"pip\", \"install\", *pip_pkgs]\n    print(\"Running:\", \" \".join(cmd))\n    subprocess.check_call(cmd)\nelse:\n    print(\"No pip packages to install.\")\n","key":"M4iMwPzwWF"},{"type":"output","id":"_r_2xclWBTNak9SrUmKWH","data":[{"output_type":"stream","name":"stdout","text":"Running: /usr/bin/conda install -y -p /home/runner/micromamba/envs/osdf-cookbook -c conda-forge jupyterlab mystmd jupyterlab-myst aiohttp bash_kernel intake=0.7.0 intake-esm=2024.2.6 pelicanplatform panel bokeh xmltodict cartopy colorcet cf-units boto3 basemap pelicanfs=1.2.1 matplotlib metpy pandas xarray geopandas pystac-client rasterio dask dask-jobqueue openpyxl hvplot plotly zarr=2.18.1 s3fs seaborn tqdm h5netcdf igwn-auth-utils=1.4.0\n"},{"output_type":"stream","name":"stdout","text":"\u001b[1;33mCI detected\u001b[0m\u001b[1;33m...\u001b[0m\n\u001b[1;33mBy accessing \u001b[0m\u001b[4;94mhttps://repo.anaconda.com/pkgs/main\u001b[0m\u001b[1;33m via CI for this repository you \u001b[0m\n\u001b[1;33macknowledge and agree to the Terms of Service:\u001b[0m\n\u001b[1;33mANACONDA TERMS OF SERVICE\u001b[0m\n\u001b[1;33mEffective Date: July \u001b[0m\u001b[1;36m15\u001b[0m\u001b[1;33m, \u001b[0m\u001b[1;36m2025\u001b[0m\n\n\u001b[1;33mSee \u001b[0m\u001b[4;94mhttps://anaconda.com/legal/terms/terms-of-service\u001b[0m\n\u001b[1;33mBy accessing \u001b[0m\u001b[4;94mhttps://repo.anaconda.com/pkgs/r\u001b[0m\u001b[1;33m via CI for this repository you \u001b[0m\n\u001b[1;33macknowledge and agree to the Terms of Service:\u001b[0m\n\u001b[1;33mANACONDA TERMS OF SERVICE\u001b[0m\n\u001b[1;33mEffective Date: July \u001b[0m\u001b[1;36m15\u001b[0m\u001b[1;33m, \u001b[0m\u001b[1;36m2025\u001b[0m\n\n\u001b[1;33mSee \u001b[0m\u001b[4;94mhttps://anaconda.com/legal/terms/terms-of-service\u001b[0m\n\u001b[1;32m2\u001b[0m\u001b[1;32m channel Terms of Service accepted\u001b[0m\nRetrieving notices: - \b\b\\ "},{"output_type":"stream","name":"stdout","text":"\b\bdone\n"},{"output_type":"stream","name":"stdout","text":"Channels:\n - conda-forge\n - defaults\nPlatform: linux-64\nCollecting package metadata (repodata.json): / \b\b- "},{"output_type":"stream","name":"stdout","text":"\b\b\\ \b\b| \b\b/ "},{"output_type":"stream","name":"stdout","text":"\b\b- \b\b\\ "},{"output_type":"stream","name":"stdout","text":"\b\b| \b\b/ \b\b- "},{"output_type":"stream","name":"stdout","text":"\b\b\\ \b\b| "},{"output_type":"stream","name":"stdout","text":"\b\b/ \b\b- \b\b\\ "},{"output_type":"stream","name":"stdout","text":"\b\b| \b\b/ \b\b- "},{"output_type":"stream","name":"stdout","text":"\b\b\\ \b\b| \b\b/ "},{"output_type":"stream","name":"stdout","text":"\b\b- \b\b\\ "},{"output_type":"stream","name":"stdout","text":"\b\b| \b\b/ "},{"output_type":"stream","name":"stdout","text":"\b\b- \b\b\\ "},{"output_type":"stream","name":"stdout","text":"\b\b| \b\b/ \b\b- "},{"output_type":"stream","name":"stdout","text":"\b\b\\ \b\b| "},{"output_type":"stream","name":"stdout","text":"\b\b/ \b\b- "},{"output_type":"stream","name":"stdout","text":"\b\b\\ \b\b| \b\b/ "},{"output_type":"stream","name":"stdout","text":"\b\b- \b\b\\ \b\b| "},{"output_type":"stream","name":"stdout","text":"\b\b/ \b\b- "},{"output_type":"stream","name":"stdout","text":"\b\b\\ \b\b| "},{"output_type":"stream","name":"stdout","text":"\b\b/ \b\b- \b\b\\ "},{"output_type":"stream","name":"stdout","text":"\b\b| \b\b/ \b\b- "},{"output_type":"stream","name":"stdout","text":"\b\b\\ \b\b| "},{"output_type":"stream","name":"stdout","text":"\b\b/ "},{"output_type":"stream","name":"stdout","text":"\b\b- "},{"output_type":"stream","name":"stdout","text":"\b\b\\ "},{"output_type":"stream","name":"stdout","text":"\b\b| "},{"output_type":"stream","name":"stdout","text":"\b\b/ "},{"output_type":"stream","name":"stdout","text":"\b\b- "},{"output_type":"stream","name":"stdout","text":"\b\b\\ "},{"output_type":"stream","name":"stdout","text":"\b\b| \b\b/ "},{"output_type":"stream","name":"stdout","text":"\b\b- \b\bdone\nSolving environment: | "},{"output_type":"stream","name":"stdout","text":"\b\b/ \b\b- "},{"output_type":"stream","name":"stdout","text":"\b\b\\ \b\b| "},{"output_type":"stream","name":"stdout","text":"\b\b/ \b\b- "},{"output_type":"stream","name":"stdout","text":"\b\b\\ \b\b| "},{"output_type":"stream","name":"stdout","text":"\b\b/ \b\b- "},{"output_type":"stream","name":"stdout","text":"\b\b\\ \b\b| "},{"output_type":"stream","name":"stdout","text":"\b\b/ \b\b- "},{"output_type":"stream","name":"stdout","text":"\b\b\\ \b\b| "},{"output_type":"stream","name":"stdout","text":"\b\b/ \b\b- "},{"output_type":"stream","name":"stdout","text":"\b\b\\ \b\b| "},{"output_type":"stream","name":"stdout","text":"\b\b/ \b\b- "},{"output_type":"stream","name":"stdout","text":"\b\b\\ \b\b| "},{"output_type":"stream","name":"stdout","text":"\b\b/ \b\b- "},{"output_type":"stream","name":"stdout","text":"\b\b\\ \b\b| "},{"output_type":"stream","name":"stdout","text":"\b\b/ \b\b- "},{"output_type":"stream","name":"stdout","text":"\b\b\\ \b\b| "},{"output_type":"stream","name":"stdout","text":"\b\b/ \b\b- "},{"output_type":"stream","name":"stdout","text":"\b\b\\ \b\b| "},{"output_type":"stream","name":"stdout","text":"\b\b/ \b\b- "},{"output_type":"stream","name":"stdout","text":"\b\b\\ \b\b| "},{"output_type":"stream","name":"stdout","text":"\b\b/ \b\b- "},{"output_type":"stream","name":"stdout","text":"\b\b\\ \b\b| "},{"output_type":"stream","name":"stdout","text":"\b\b/ \b\b- "},{"output_type":"stream","name":"stdout","text":"\b\b\\ \b\b| "},{"output_type":"stream","name":"stdout","text":"\b\b/ \b\b- "},{"output_type":"stream","name":"stdout","text":"\b\b\\ \b\b| "},{"output_type":"stream","name":"stdout","text":"\b\b/ \b\b- "},{"output_type":"stream","name":"stdout","text":"\b\b\\ \b\b| "},{"output_type":"stream","name":"stdout","text":"\b\b/ \b\b- "},{"output_type":"stream","name":"stdout","text":"\b\b\\ \b\b| "},{"output_type":"stream","name":"stdout","text":"\b\b/ \b\b- "},{"output_type":"stream","name":"stdout","text":"\b\b\\ \b\b| "},{"output_type":"stream","name":"stdout","text":"\b\b/ \b\b- "},{"output_type":"stream","name":"stdout","text":"\b\b\\ \b\b| "},{"output_type":"stream","name":"stdout","text":"\b\b/ \b\b- "},{"output_type":"stream","name":"stdout","text":"\b\b\\ \b\b| "},{"output_type":"stream","name":"stdout","text":"\b\b/ \b\bdone\n"},{"output_type":"stream","name":"stderr","text":"\n\n==\u003e WARNING: A newer version of conda exists. \u003c==\n    current version: 25.7.0\n    latest version: 25.9.0\n\nPlease update conda by running\n\n    $ conda update -n base -c defaults conda\n\n\n"},{"output_type":"stream","name":"stdout","text":"\n# All requested packages already installed.\n\n"},{"output_type":"stream","name":"stdout","text":"Running: /home/runner/micromamba/envs/osdf-cookbook/bin/python -m pip install import-ipynb OpenVisus openvisuspy pvlib rioxarray stackstac\n"},{"output_type":"stream","name":"stdout","text":"Requirement already satisfied: import-ipynb in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (0.2)\nRequirement already satisfied: OpenVisus in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (2.2.142)\nRequirement already satisfied: openvisuspy in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (1.0.71)\nRequirement already satisfied: pvlib in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (0.13.1)\nRequirement already satisfied: rioxarray in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (0.19.0)\nRequirement already satisfied: stackstac in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (0.5.1)\nRequirement already satisfied: IPython in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from import-ipynb) (9.6.0)\nRequirement already satisfied: nbformat in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from import-ipynb) (5.10.4)\nRequirement already satisfied: numpy\u003e=1.21.2 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from pvlib) (2.3.3)\nRequirement already satisfied: pandas\u003e=1.3.3 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from pvlib) (2.2.3)\nRequirement already satisfied: pytz in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from pvlib) (2024.1)\nRequirement already satisfied: requests in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from pvlib) (2.32.5)\nRequirement already satisfied: scipy\u003e=1.7.2 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from pvlib) (1.16.2)\nRequirement already satisfied: h5py in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from pvlib) (3.14.0)\nRequirement already satisfied: packaging in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from rioxarray) (25.0)\nRequirement already satisfied: rasterio\u003e=1.4.3 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from rioxarray) (1.4.3)\nRequirement already satisfied: xarray\u003e=2024.7.0 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from rioxarray) (2025.9.1)\nRequirement already satisfied: pyproj\u003e=3.3 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from rioxarray) (3.7.2)\nRequirement already satisfied: dask\u003e=2022.1.1 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from dask[array]\u003e=2022.1.1-\u003estackstac) (2025.9.1)\nRequirement already satisfied: python-dateutil\u003e=2.8.2 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from pandas\u003e=1.3.3-\u003epvlib) (2.9.0.post0)\nRequirement already satisfied: tzdata\u003e=2022.7 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from pandas\u003e=1.3.3-\u003epvlib) (2025.2)\nRequirement already satisfied: certifi in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from pyproj\u003e=3.3-\u003erioxarray) (2025.8.3)\nRequirement already satisfied: affine in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from rasterio\u003e=1.4.3-\u003erioxarray) (2.4.0)\nRequirement already satisfied: attrs in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from rasterio\u003e=1.4.3-\u003erioxarray) (25.3.0)\nRequirement already satisfied: click\u003e=4.0 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from rasterio\u003e=1.4.3-\u003erioxarray) (8.3.0)\nRequirement already satisfied: cligj\u003e=0.5 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from rasterio\u003e=1.4.3-\u003erioxarray) (0.7.2)\nRequirement already satisfied: click-plugins in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from rasterio\u003e=1.4.3-\u003erioxarray) (1.1.1.2)\nRequirement already satisfied: pyparsing in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from rasterio\u003e=1.4.3-\u003erioxarray) (3.2.5)\n"},{"output_type":"stream","name":"stdout","text":"Requirement already satisfied: cloudpickle\u003e=3.0.0 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from dask\u003e=2022.1.1-\u003edask[array]\u003e=2022.1.1-\u003estackstac) (3.1.1)\nRequirement already satisfied: fsspec\u003e=2021.09.0 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from dask\u003e=2022.1.1-\u003edask[array]\u003e=2022.1.1-\u003estackstac) (2025.9.0)\nRequirement already satisfied: partd\u003e=1.4.0 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from dask\u003e=2022.1.1-\u003edask[array]\u003e=2022.1.1-\u003estackstac) (1.4.2)\nRequirement already satisfied: pyyaml\u003e=5.3.1 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from dask\u003e=2022.1.1-\u003edask[array]\u003e=2022.1.1-\u003estackstac) (6.0.3)\nRequirement already satisfied: toolz\u003e=0.10.0 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from dask\u003e=2022.1.1-\u003edask[array]\u003e=2022.1.1-\u003estackstac) (1.0.0)\nRequirement already satisfied: locket in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from partd\u003e=1.4.0-\u003edask\u003e=2022.1.1-\u003edask[array]\u003e=2022.1.1-\u003estackstac) (1.0.0)\nRequirement already satisfied: six\u003e=1.5 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from python-dateutil\u003e=2.8.2-\u003epandas\u003e=1.3.3-\u003epvlib) (1.17.0)\n"},{"output_type":"stream","name":"stdout","text":"Requirement already satisfied: decorator in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from IPython-\u003eimport-ipynb) (5.2.1)\nRequirement already satisfied: ipython-pygments-lexers in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from IPython-\u003eimport-ipynb) (1.1.1)\nRequirement already satisfied: jedi\u003e=0.16 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from IPython-\u003eimport-ipynb) (0.19.2)\nRequirement already satisfied: matplotlib-inline in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from IPython-\u003eimport-ipynb) (0.1.7)\nRequirement already satisfied: pexpect\u003e4.3 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from IPython-\u003eimport-ipynb) (4.9.0)\nRequirement already satisfied: prompt_toolkit\u003c3.1.0,\u003e=3.0.41 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from IPython-\u003eimport-ipynb) (3.0.52)\nRequirement already satisfied: pygments\u003e=2.4.0 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from IPython-\u003eimport-ipynb) (2.19.2)\nRequirement already satisfied: stack_data in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from IPython-\u003eimport-ipynb) (0.6.3)\nRequirement already satisfied: traitlets\u003e=5.13.0 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from IPython-\u003eimport-ipynb) (5.14.3)\nRequirement already satisfied: wcwidth in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from prompt_toolkit\u003c3.1.0,\u003e=3.0.41-\u003eIPython-\u003eimport-ipynb) (0.2.14)\nRequirement already satisfied: parso\u003c0.9.0,\u003e=0.8.4 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from jedi\u003e=0.16-\u003eIPython-\u003eimport-ipynb) (0.8.5)\nRequirement already satisfied: ptyprocess\u003e=0.5 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from pexpect\u003e4.3-\u003eIPython-\u003eimport-ipynb) (0.7.0)\nRequirement already satisfied: fastjsonschema\u003e=2.15 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from nbformat-\u003eimport-ipynb) (2.21.2)\nRequirement already satisfied: jsonschema\u003e=2.6 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from nbformat-\u003eimport-ipynb) (4.25.1)\nRequirement already satisfied: jupyter-core!=5.0.*,\u003e=4.12 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from nbformat-\u003eimport-ipynb) (5.8.1)\nRequirement already satisfied: jsonschema-specifications\u003e=2023.03.6 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from jsonschema\u003e=2.6-\u003enbformat-\u003eimport-ipynb) (2025.9.1)\nRequirement already satisfied: referencing\u003e=0.28.4 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from jsonschema\u003e=2.6-\u003enbformat-\u003eimport-ipynb) (0.36.2)\nRequirement already satisfied: rpds-py\u003e=0.7.1 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from jsonschema\u003e=2.6-\u003enbformat-\u003eimport-ipynb) (0.27.1)\nRequirement already satisfied: platformdirs\u003e=2.5 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from jupyter-core!=5.0.*,\u003e=4.12-\u003enbformat-\u003eimport-ipynb) (4.4.0)\nRequirement already satisfied: typing-extensions\u003e=4.4.0 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from referencing\u003e=0.28.4-\u003ejsonschema\u003e=2.6-\u003enbformat-\u003eimport-ipynb) (4.15.0)\nRequirement already satisfied: charset_normalizer\u003c4,\u003e=2 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from requests-\u003epvlib) (3.4.3)\nRequirement already satisfied: idna\u003c4,\u003e=2.5 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from requests-\u003epvlib) (3.10)\nRequirement already satisfied: urllib3\u003c3,\u003e=1.21.1 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from requests-\u003epvlib) (2.5.0)\n"},{"output_type":"stream","name":"stdout","text":"Requirement already satisfied: executing\u003e=1.2.0 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from stack_data-\u003eIPython-\u003eimport-ipynb) (2.2.1)\nRequirement already satisfied: asttokens\u003e=2.1.0 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from stack_data-\u003eIPython-\u003eimport-ipynb) (3.0.0)\nRequirement already satisfied: pure_eval in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from stack_data-\u003eIPython-\u003eimport-ipynb) (0.2.3)\n"}],"key":"aU13qNDirU"}],"key":"npi1gU69Nr"},{"type":"block","kind":"notebook-content","children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uOFMPOKCYP"}],"key":"DHt6bgfrne"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"1) Imports","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"P9v3ko9Wpl"}],"identifier":"id-1-imports","label":"1) Imports","html_id":"id-1-imports","implicit":true,"key":"ywQtDfbjMo"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Core libraries used throughout the notebook.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"oPOBgj6AVp"}],"key":"BpdLfNTEDV"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Key roles:","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"KwOMkWyoZM"}],"key":"gJgVfYHxBB"},{"type":"code","lang":"","value":"xarray/s3fs for reading NOAA Zarr data from S3\nnumpy/pandas for arrays \u0026 tables\nplotly for interactive plotting\nrequests/io/os for file I/O and downloads\ndatetime for time calculations","position":{"start":{"line":6,"column":1},"end":{"line":10,"column":1}},"key":"GUmkNNDwXC"}],"key":"tAx5vmUjk5"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import xarray as xr\nimport s3fs\nimport numpy as np\nimport plotly.graph_objects as go\nfrom plotly.subplots import make_subplots\nimport pandas as pd\nimport requests\nimport io\nimport os\nimport rioxarray\nfrom datetime import datetime, timedelta\nimport pvlib","key":"LvDvI503MN"},{"type":"output","id":"OtVksJ9oPyV-iYNwqw9Mn","data":[],"key":"oQSsFesnKo"}],"key":"vgeFHQupJs"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2) Initializing the datasets","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GYP4FV8kSt"}],"identifier":"id-2-initializing-the-datasets","label":"2) Initializing the datasets","html_id":"id-2-initializing-the-datasets","implicit":true,"key":"D9N1VEMLXD"}],"key":"slUEOImf8z"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Builds the S3 path to the HB1906 EK60 Zarr dataset and opens it anonymously.\nSubsets by time window and depth range, selects the 38 kHz channel, and masks samples below the estimated bottom.\n.compute() materializes the selection; hm_timestamps will be reused for time alignment later. All datasets are accessed\nusing the OSDF infrastructure","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"chUwV7qN2m"}],"key":"CXZzM1Avwt"}],"key":"oPEXItzioK"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"bucket_name = 'noaa-wcsd-zarr-pds'\nship_name = \"Henry_B._Bigelow\"\ncruise_name = \"HB1906\"\nsensor_name = \"EK60\"\n\n# Accessing the NOAA HB1906 dataset using OSDF (anonymous S3)\ns3_file_system = s3fs.S3FileSystem(anon=True)\nzarr_store = f'{cruise_name}.zarr'\ns3_zarr_store_path = f\"{bucket_name}/level_2/{ship_name}/{cruise_name}/{sensor_name}/{zarr_store}\"\n\n# Map S3 path to a zarr store and open (consolidated=None to let xarray infer metadata)\nstore = s3fs.S3Map(root=s3_zarr_store_path, s3=s3_file_system, check=False)\ncruise = xr.open_zarr(store=store, consolidated=None)\n\n# Time/depth subset and single-frequency selection\nstart_time = \"2019-10-16T15:00:00\"\nend_time = \"2019-10-16T23:11:09\"\ntimeslice = slice(start_time, end_time)\ndepths = slice(10, 250)\ncruise = cruise.sel(time=timeslice, depth=depths, drop=False)\ncruise = cruise.sel(frequency=38000, method='nearest').compute()  # materialize after selection\ncruise = cruise.where(cruise.depth \u003c cruise.bottom + 2, drop=True)  # remove bins below bottom\n\n# Timestamps for later alignment\nhm_timestamps = cruise.time.values.tolist()","key":"gvTf71CpFB"},{"type":"output","id":"HFu0wP6xskax3xB78za0j","data":[],"key":"Xk7PaZQLv3"}],"key":"m5LTzWoVng"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3) Accessing buoy data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"z9G4b2dZvh"}],"identifier":"id-3-accessing-buoy-data","label":"3) Accessing buoy data","html_id":"id-3-accessing-buoy-data","implicit":true,"key":"weyaTraVXs"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Defines a buoy location on Georges Bank (longitude converted to 0–360).","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"oZ3zkOaW4a"}],"key":"KjcmeW1Nhm"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Optional: Loads three daily OISST files and samples SST at the nearest grid point (day before, day of, day after).","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"H9AQpngQ0p"}],"key":"D8mKp8fZwQ"}],"key":"HHPdb0H44q"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"ERDDAP buoy environmental data.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"KFVOL2YOI0"}],"key":"Kylds02AOI"}],"key":"ClDHaodozz"}],"key":"cAYPteoQfR"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Sets ERDDAP dataset parameters and enforces a max_days cap by adjusting end_date_time if needed.\nReads station metadata to extract lon/lat and wind-speed units; prepares a conversion to knots.\nPulls a table of time, wind_speed, SST, significant wave height, converts wind speed to knots, indexes by time.\nFilters to the requested window and keeps the first nine rows (intentional truncation for later alignment).","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"nNib3WmVpI"}],"key":"XljxhIswtD"}],"key":"JQ4CIQC3Aq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Location of one specific buoy located on Georges Bank\ntarget_lon = 360 - 66.546  # convert from -180..180 to 0..360\ntarget_lat = 41.088\n\n# ______________OPTIONAL BUOY DATA FROM NCAR/UCAR______________\n# print(f\"Target coordinates: Longitude: {target_lon}, Latitude: {target_lat}\")\n#\n# # Accessing stationary buoy data (daily OISST files); select nearest grid cell\n# buoy_data_day_before = xr.open_dataset(\n#     'https://data.rda.ucar.edu/d277007/avhrr_v2.1/2019/oisst-avhrr-v02r01.20191015.nc#mode=bytes', engine='netcdf4')\n# buoy_data_actual_day = xr.open_dataset(\n#     'https://data.rda.ucar.edu/d277007/avhrr_v2.1/2019/oisst-avhrr-v02r01.20191016.nc#mode=bytes',\n#     engine='netcdf4')\n# buoy_data_day_after = xr.open_dataset(\n#     'https://data.rda.ucar.edu/d277007/avhrr_v2.1/2019/oisst-avhrr-v02r01.20191017.nc#mode=bytes',\n#     engine='netcdf4')\n#\n# sst_day_before = buoy_data_day_before['sst'].sel(lon=target_lon, lat=target_lat, method='nearest').values[0][0]\n# sst_actual_day = buoy_data_actual_day['sst'].sel(lon=target_lon, lat=target_lat, method='nearest').values[0][0]\n# sst_day_after = buoy_data_day_after['sst'].sel(lon=target_lon, lat=target_lat, method='nearest').values[0][0]\n# ______________________________________________________________\n\n# The following code has been copied from https://github.com/ioos/soundcoop/blob/main/3_HMD_environmental_data/plot_sound_environmental_and_climatology_data.ipynb in order to access buoy environmental data.\n\nerddap_dataset = 'gov-ndbc-44005'\nsound_dataset = 'Monh'\nmax_days = 25\nstart_date_time = '2019-10-16T14:00:00.000'\nend_date_time = '2021-10-16T23:30:00.000'\nmin_frequency = 21\nmax_frequency = 24000\n\nerddap_base_url = 'https://erddap.sensors.ioos.us/erddap'\n\n# Cap the end date if requested range exceeds max_days\ntime_delta = datetime.fromisoformat(end_date_time) - datetime.fromisoformat(start_date_time)\nif time_delta.days \u003e max_days:\n    end_date_time = str(datetime.fromisoformat(start_date_time) + timedelta(days=max_days))\n    print(f'end_date_time updated to {end_date_time}')\n\n# Get station lon/lat and units from ERDDAP metadata (CSV)\nerddap_metadata_url = f'{erddap_base_url}/info/{erddap_dataset}/index.csv'\nenv_metadata_df = pd.read_csv(erddap_metadata_url)\n\nenv_station_x = env_metadata_df.loc[env_metadata_df['Attribute Name'] == 'geospatial_lon_min']['Value'].item()\nenv_station_y = env_metadata_df.loc[env_metadata_df['Attribute Name'] == 'geospatial_lat_min']['Value'].item()\nswt_var = 'sea_surface_temperature'\n\n# __________OPTIONAL: Add Wind__________\n# Determine wind_speed units to convert to knots\n# wind_speed_units_row = env_metadata_df[\n#     (env_metadata_df['Row Type'] == 'attribute') \u0026\n#     (env_metadata_df['Attribute Name'] == 'units') \u0026\n#     # (env_metadata_df['Variable Name'] == 'wind_speed')\n#     ]\n# wind_speed_units = wind_speed_units_row.iloc[0]['Value']\n# print(wind_speed_units)\n\n# wind_speed_to_kts_factors = {\n#     \"m.s-1\": 1.94384,\n#     \"mph\": 0.86897423357831,\n#     \"kmh\": 0.53995555554212126825,\n#     \"ft.s-1\": 0.59248243198521155506\n# }\n\n# if wind_speed_units in wind_speed_to_kts_factors:\n#     print(\"Success! Units can be converted from\", wind_speed_units, 'to', 'kts')\n# else:\n#     print(\"Error! Wind speed cannot be converted from\", wind_speed_units, 'to', 'kts')\n\n# wind_var = 'wind_speed'\n# wave_var = 'sea_surface_wave_significant_height'\n# anomaly_var = 'swt_anomaly'\n# wind_var_kts = 'wind_speed_kts'\n# ________________________________________\n\n# Build ERDDAP tabledap query URL\nerddap_dataset_url = (\n    f'{erddap_base_url}/tabledap/{erddap_dataset}.csv'\n    f'?time,{swt_var}'\n)\n\n# Read dataset (skip the second row of units)\nenv_df = pd.read_csv(\n    erddap_dataset_url,\n    skiprows=[1]  # The second row (index 1) are the column units, which we don't need\n)\n\n# Format time, convert wind speed to knots, index by time\nenv_df['time'] = pd.to_datetime(env_df['time'])\n# env_df['wind_speed_kts'] = env_df['wind_speed'].apply(lambda x: x * wind_speed_to_kts_factors[wind_speed_units])\n# del env_df['wind_speed']\nenv_df = env_df.set_index('time').sort_index()\n\n# Filter by requested time window and keep first 9 rows (drops the rest)\nenv_df = env_df[(env_df.index \u003e start_date_time) \u0026 (env_df.index \u003c end_date_time)]\nenv_df.drop(env_df.tail(-9).index, inplace=True)\n# env_df","key":"uznPFEtYSY"},{"type":"output","id":"mrcKOCb3fcy0_XQXILgVO","data":[{"output_type":"stream","name":"stdout","text":"end_date_time updated to 2019-11-10 14:00:00\n"}],"key":"Lem79thsLI"}],"key":"Jy2o14a3yw"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"4) Calculate the temperature anomaly, sun elevation in degree and azimuth","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bCOUC44ctd"}],"identifier":"id-4-calculate-the-temperature-anomaly-sun-elevation-in-degree-and-azimuth","label":"4) Calculate the temperature anomaly, sun elevation in degree and azimuth","html_id":"id-4-calculate-the-temperature-anomaly-sun-elevation-in-degree-and-azimuth","implicit":true,"key":"Ltsddw32iV"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Extracts World Ocean Atlas 2023 temperature data for a specific location and month and calculates temperature anomaly (optional), sun elevation in degree and azimuth (optional).","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Ya0ss9VnJx"}],"key":"Hw7UMqBbHx"}],"key":"bi50i4kUMg"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def get_woa23_temp_at_xy(x, y, month, var='t_mn', depth=0):\n    \"\"\"\n    Get 1-degree WOA 2023 temperature values for a given point and month.\n\n    Args:\n        x: A longitude value given in decimal degrees\n        y: A latitude value given in decimal degrees\n        month: The month asn integer from which to extract the value\n        var (optional): The temperature variable to use. Defaults to the statistical mean.\n        depth (optional): The depth at which to extract the value. Defaults to the surface.\n    \"\"\"\n    url = (\n        'https://www.ncei.noaa.gov/thredds-ocean/dodsC/woa23/DATA/'\n        f'temperature/netcdf/decav/1.00/woa23_decav_t{month:02}_01.nc'\n    )\n    ds = xr.open_dataset(\n        url,\n        decode_times=False  # xarray can't handle times defined as \"months since ...\"\n    )\n\n    da = ds.isel(depth=depth)[var]  # Pull out just the variable we're interested in\n\n    # Because nearshore locations are often NaN due to the grid's low resolution\n    # we need to interpolate the NaNs to the nearest non-NaN before extracting our value.\n    # We use rioxarray to do the interpolations in two dimensions because plain vanilla xarray\n    # can only interpolate in one dimension.\n    da = da.rio.write_crs(4326)\n    da = da.rio.interpolate_na(method='nearest')\n\n    # Then we extract the value, also using the nearest neighbor method because the given\n    # x and y values are unlikely to fall exactly on one of the grid's lat/lon coordinate pairs\n    val = da.sel(lon=x, lat=y, method='nearest').item()\n\n    return val\n\n\n# Define the location of our selected ERDDAP dataset\n# Override here if needed\nx = env_station_x\ny = env_station_y\n\nurl = (\n    'https://www.ncei.noaa.gov/thredds-ocean/dodsC/woa23/DATA/'\n    f'temperature/netcdf/decav/1.00/woa23_decav_t07_01.nc'\n)\nda = xr.open_dataset(\n    url,\n    decode_times=False  # xarray can't handle times defined as \"months since ...\"\n).isel(depth=0)['t_mn']  # Pull out just the variable we're interested in\n\n# Because nearshore locations are often NaN due to the grid's low resolution\n# we need to interpolate the NaNs to the nearest non-NaN before extracting our value.\n# We use rioxarray to do the interpolations in two dimensions because plain vanilla xarray\n# can only interpolate in one dimension.\nda = da.rio.write_crs(4326)\nda = da.rio.interpolate_na(method='nearest')\n\n# Then we extract the value, also using the nearest neighbor method because the given\n# x and y values are unlikely to fall exactly on one of the grid's lat/lon coordinate pairs\nval = da.sel(lon=x, lat=y, method='nearest').item()\n\n# Assemble a mapping between months and WOA 2023 temperature values\nmonths = list(range(1, 13))\ntemps = [get_woa23_temp_at_xy(x, y, m) for m in months]\nclim_dict = {m: t for m, t in zip(months, temps)}\n\n# Calculate the sea water temperature anomaly by subtracting the monthly WOA 2023 temperature value\n# from each measured sea water temperature value and store it as a new variable\nanomaly_var = env_df[swt_var] - [clim_dict[10]]\n# We are not adding the temperature_anomaly variable to our dataset, because we were able to see that it follows the sea surface temperature.\n# env_df[\"temperature_anomaly\"] = anomaly_var\n\n# ---- Time range in UTC ----\ntimes_utc = pd.date_range(\n    start=start_date_time,\n    end=end_date_time,\n    freq=\"1h\",\n    tz=\"UTC\"  # \u003c-- key: set timezone to UTC\n)\n\n# ---- Calculate solar position ----\nsolpos = pvlib.solarposition.get_solarposition(times_utc, target_lat, target_lon)\n\n# ---- Extract elevation ----\ndf = pd.DataFrame({\n    \"time_utc\": times_utc,\n    \"elevation_deg\": solpos[\"elevation\"],\n    \"azimuth_deg\": solpos[\"azimuth\"]\n})\n\nenv_df[\"elevation_deg\"] = solpos[\"elevation\"].tolist()[1:10]\n# env_df[\"azimuth_deg\"] = solpos[\"azimuth\"].tolist()[:9]\nenv_df","key":"ITBWuCrrtU"},{"type":"output","id":"-Idu9s_HFlnungTPBD9kz","data":[{"output_type":"error","traceback":"\u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mClientResponseError\u001b[39m                       Traceback (most recent call last)\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/implementations/http.py:437\u001b[39m, in \u001b[36mHTTPFileSystem._info\u001b[39m\u001b[34m(self, url, **kwargs)\u001b[39m\n\u001b[32m    435\u001b[39m \u001b[38;5;28;01mtry\u001b[39;00m:\n\u001b[32m    436\u001b[39m     info.update(\n\u001b[32m--\u003e \u001b[39m\u001b[32m437\u001b[39m         \u001b[38;5;28;01mawait\u001b[39;00m _file_info(\n\u001b[32m    438\u001b[39m             \u001b[38;5;28mself\u001b[39m.encode_url(url),\n\u001b[32m    439\u001b[39m             size_policy=policy,\n\u001b[32m    440\u001b[39m             session=session,\n\u001b[32m    441\u001b[39m             **\u001b[38;5;28mself\u001b[39m.kwargs,\n\u001b[32m    442\u001b[39m             **kwargs,\n\u001b[32m    443\u001b[39m         )\n\u001b[32m    444\u001b[39m     )\n\u001b[32m    445\u001b[39m     \u001b[38;5;28;01mif\u001b[39;00m info.get(\u001b[33m\"\u001b[39m\u001b[33msize\u001b[39m\u001b[33m\"\u001b[39m) \u001b[38;5;129;01mis\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m \u001b[38;5;28;01mNone\u001b[39;00m:\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/implementations/http.py:853\u001b[39m, in \u001b[36m_file_info\u001b[39m\u001b[34m(url, session, size_policy, **kwargs)\u001b[39m\n\u001b[32m    852\u001b[39m \u001b[38;5;28;01masync\u001b[39;00m \u001b[38;5;28;01mwith\u001b[39;00m r:\n\u001b[32m--\u003e \u001b[39m\u001b[32m853\u001b[39m     \u001b[43mr\u001b[49m\u001b[43m.\u001b[49m\u001b[43mraise_for_status\u001b[49m\u001b[43m(\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    855\u001b[39m     \u001b[38;5;28;01mif\u001b[39;00m \u001b[33m\"\u001b[39m\u001b[33mContent-Length\u001b[39m\u001b[33m\"\u001b[39m \u001b[38;5;129;01min\u001b[39;00m r.headers:\n\u001b[32m    856\u001b[39m         \u001b[38;5;66;03m# Some servers may choose to ignore Accept-Encoding and return\u001b[39;00m\n\u001b[32m    857\u001b[39m         \u001b[38;5;66;03m# compressed content, in which case the returned size is unreliable.\u001b[39;00m\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/aiohttp/client_reqrep.py:629\u001b[39m, in \u001b[36mClientResponse.raise_for_status\u001b[39m\u001b[34m(self)\u001b[39m\n\u001b[32m    627\u001b[39m     \u001b[38;5;28mself\u001b[39m.release()\n\u001b[32m--\u003e \u001b[39m\u001b[32m629\u001b[39m \u001b[38;5;28;01mraise\u001b[39;00m ClientResponseError(\n\u001b[32m    630\u001b[39m     \u001b[38;5;28mself\u001b[39m.request_info,\n\u001b[32m    631\u001b[39m     \u001b[38;5;28mself\u001b[39m.history,\n\u001b[32m    632\u001b[39m     status=\u001b[38;5;28mself\u001b[39m.status,\n\u001b[32m    633\u001b[39m     message=\u001b[38;5;28mself\u001b[39m.reason,\n\u001b[32m    634\u001b[39m     headers=\u001b[38;5;28mself\u001b[39m.headers,\n\u001b[32m    635\u001b[39m )\n\n\u001b[31mClientResponseError\u001b[39m: 400, message='', url='https://www.ncei.noaa.gov/thredds-ocean/dodsC/woa23/DATA/temperature/netcdf/decav/1.00/woa23_decav_t07_01.nc'\n\nThe above exception was the direct cause of the following exception:\n\n\u001b[31mFileNotFoundError\u001b[39m                         Traceback (most recent call last)\n\u001b[36mCell\u001b[39m\u001b[36m \u001b[39m\u001b[32mIn[5]\u001b[39m\u001b[32m, line 46\u001b[39m\n\u001b[32m     40\u001b[39m y = env_station_y\n\u001b[32m     42\u001b[39m url = (\n\u001b[32m     43\u001b[39m     \u001b[33m'\u001b[39m\u001b[33mhttps://www.ncei.noaa.gov/thredds-ocean/dodsC/woa23/DATA/\u001b[39m\u001b[33m'\u001b[39m\n\u001b[32m     44\u001b[39m     \u001b[33mf\u001b[39m\u001b[33m'\u001b[39m\u001b[33mtemperature/netcdf/decav/1.00/woa23_decav_t07_01.nc\u001b[39m\u001b[33m'\u001b[39m\n\u001b[32m     45\u001b[39m )\n\u001b[32m---\u003e \u001b[39m\u001b[32m46\u001b[39m da = \u001b[43mxr\u001b[49m\u001b[43m.\u001b[49m\u001b[43mopen_dataset\u001b[49m\u001b[43m(\u001b[49m\n\u001b[32m     47\u001b[39m \u001b[43m    \u001b[49m\u001b[43murl\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m     48\u001b[39m \u001b[43m    \u001b[49m\u001b[43mdecode_times\u001b[49m\u001b[43m=\u001b[49m\u001b[38;5;28;43;01mFalse\u001b[39;49;00m\u001b[43m  \u001b[49m\u001b[38;5;66;43;03m# xarray can't handle times defined as \"months since ...\"\u001b[39;49;00m\n\u001b[32m     49\u001b[39m \u001b[43m)\u001b[49m.isel(depth=\u001b[32m0\u001b[39m)[\u001b[33m'\u001b[39m\u001b[33mt_mn\u001b[39m\u001b[33m'\u001b[39m]  \u001b[38;5;66;03m# Pull out just the variable we're interested in\u001b[39;00m\n\u001b[32m     51\u001b[39m \u001b[38;5;66;03m# Because nearshore locations are often NaN due to the grid's low resolution\u001b[39;00m\n\u001b[32m     52\u001b[39m \u001b[38;5;66;03m# we need to interpolate the NaNs to the nearest non-NaN before extracting our value.\u001b[39;00m\n\u001b[32m     53\u001b[39m \u001b[38;5;66;03m# We use rioxarray to do the interpolations in two dimensions because plain vanilla xarray\u001b[39;00m\n\u001b[32m     54\u001b[39m \u001b[38;5;66;03m# can only interpolate in one dimension.\u001b[39;00m\n\u001b[32m     55\u001b[39m da = da.rio.write_crs(\u001b[32m4326\u001b[39m)\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/api.py:596\u001b[39m, in \u001b[36mopen_dataset\u001b[39m\u001b[34m(filename_or_obj, engine, chunks, cache, decode_cf, mask_and_scale, decode_times, decode_timedelta, use_cftime, concat_characters, decode_coords, drop_variables, create_default_indexes, inline_array, chunked_array_type, from_array_kwargs, backend_kwargs, **kwargs)\u001b[39m\n\u001b[32m    584\u001b[39m decoders = _resolve_decoders_kwargs(\n\u001b[32m    585\u001b[39m     decode_cf,\n\u001b[32m    586\u001b[39m     open_backend_dataset_parameters=backend.open_dataset_parameters,\n\u001b[32m   (...)\u001b[39m\u001b[32m    592\u001b[39m     decode_coords=decode_coords,\n\u001b[32m    593\u001b[39m )\n\u001b[32m    595\u001b[39m overwrite_encoded_chunks = kwargs.pop(\u001b[33m\"\u001b[39m\u001b[33moverwrite_encoded_chunks\u001b[39m\u001b[33m\"\u001b[39m, \u001b[38;5;28;01mNone\u001b[39;00m)\n\u001b[32m--\u003e \u001b[39m\u001b[32m596\u001b[39m backend_ds = \u001b[43mbackend\u001b[49m\u001b[43m.\u001b[49m\u001b[43mopen_dataset\u001b[49m\u001b[43m(\u001b[49m\n\u001b[32m    597\u001b[39m \u001b[43m    \u001b[49m\u001b[43mfilename_or_obj\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    598\u001b[39m \u001b[43m    \u001b[49m\u001b[43mdrop_variables\u001b[49m\u001b[43m=\u001b[49m\u001b[43mdrop_variables\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    599\u001b[39m \u001b[43m    \u001b[49m\u001b[43m*\u001b[49m\u001b[43m*\u001b[49m\u001b[43mdecoders\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    600\u001b[39m \u001b[43m    \u001b[49m\u001b[43m*\u001b[49m\u001b[43m*\u001b[49m\u001b[43mkwargs\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    601\u001b[39m \u001b[43m\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    602\u001b[39m ds = _dataset_from_backend_dataset(\n\u001b[32m    603\u001b[39m     backend_ds,\n\u001b[32m    604\u001b[39m     filename_or_obj,\n\u001b[32m   (...)\u001b[39m\u001b[32m    615\u001b[39m     **kwargs,\n\u001b[32m    616\u001b[39m )\n\u001b[32m    617\u001b[39m \u001b[38;5;28;01mreturn\u001b[39;00m ds\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/h5netcdf_.py:502\u001b[39m, in \u001b[36mH5netcdfBackendEntrypoint.open_dataset\u001b[39m\u001b[34m(self, filename_or_obj, mask_and_scale, decode_times, concat_characters, decode_coords, drop_variables, use_cftime, decode_timedelta, format, group, lock, invalid_netcdf, phony_dims, decode_vlen_strings, driver, driver_kwds, storage_options)\u001b[39m\n\u001b[32m    499\u001b[39m emit_phony_dims_warning, phony_dims = _check_phony_dims(phony_dims)\n\u001b[32m    501\u001b[39m filename_or_obj = _normalize_filename_or_obj(filename_or_obj)\n\u001b[32m--\u003e \u001b[39m\u001b[32m502\u001b[39m store = \u001b[43mH5NetCDFStore\u001b[49m\u001b[43m.\u001b[49m\u001b[43mopen\u001b[49m\u001b[43m(\u001b[49m\n\u001b[32m    503\u001b[39m \u001b[43m    \u001b[49m\u001b[43mfilename_or_obj\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    504\u001b[39m \u001b[43m    \u001b[49m\u001b[38;5;28;43mformat\u001b[39;49m\u001b[43m=\u001b[49m\u001b[38;5;28;43mformat\u001b[39;49m\u001b[43m,\u001b[49m\n\u001b[32m    505\u001b[39m \u001b[43m    \u001b[49m\u001b[43mgroup\u001b[49m\u001b[43m=\u001b[49m\u001b[43mgroup\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    506\u001b[39m \u001b[43m    \u001b[49m\u001b[43mlock\u001b[49m\u001b[43m=\u001b[49m\u001b[43mlock\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    507\u001b[39m \u001b[43m    \u001b[49m\u001b[43minvalid_netcdf\u001b[49m\u001b[43m=\u001b[49m\u001b[43minvalid_netcdf\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    508\u001b[39m \u001b[43m    \u001b[49m\u001b[43mphony_dims\u001b[49m\u001b[43m=\u001b[49m\u001b[43mphony_dims\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    509\u001b[39m \u001b[43m    \u001b[49m\u001b[43mdecode_vlen_strings\u001b[49m\u001b[43m=\u001b[49m\u001b[43mdecode_vlen_strings\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    510\u001b[39m \u001b[43m    \u001b[49m\u001b[43mdriver\u001b[49m\u001b[43m=\u001b[49m\u001b[43mdriver\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    511\u001b[39m \u001b[43m    \u001b[49m\u001b[43mdriver_kwds\u001b[49m\u001b[43m=\u001b[49m\u001b[43mdriver_kwds\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    512\u001b[39m \u001b[43m    \u001b[49m\u001b[43mstorage_options\u001b[49m\u001b[43m=\u001b[49m\u001b[43mstorage_options\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    513\u001b[39m \u001b[43m\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    515\u001b[39m store_entrypoint = StoreBackendEntrypoint()\n\u001b[32m    517\u001b[39m ds = store_entrypoint.open_dataset(\n\u001b[32m    518\u001b[39m     store,\n\u001b[32m    519\u001b[39m     mask_and_scale=mask_and_scale,\n\u001b[32m   (...)\u001b[39m\u001b[32m    525\u001b[39m     decode_timedelta=decode_timedelta,\n\u001b[32m    526\u001b[39m )\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/h5netcdf_.py:185\u001b[39m, in \u001b[36mH5NetCDFStore.open\u001b[39m\u001b[34m(cls, filename, mode, format, group, lock, autoclose, invalid_netcdf, phony_dims, decode_vlen_strings, driver, driver_kwds, storage_options)\u001b[39m\n\u001b[32m    183\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28misinstance\u001b[39m(filename, \u001b[38;5;28mstr\u001b[39m) \u001b[38;5;129;01mand\u001b[39;00m is_remote_uri(filename) \u001b[38;5;129;01mand\u001b[39;00m driver \u001b[38;5;129;01mis\u001b[39;00m \u001b[38;5;28;01mNone\u001b[39;00m:\n\u001b[32m    184\u001b[39m     mode_ = \u001b[33m\"\u001b[39m\u001b[33mrb\u001b[39m\u001b[33m\"\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m mode == \u001b[33m\"\u001b[39m\u001b[33mr\u001b[39m\u001b[33m\"\u001b[39m \u001b[38;5;28;01melse\u001b[39;00m mode\n\u001b[32m--\u003e \u001b[39m\u001b[32m185\u001b[39m     filename = \u001b[43m_open_remote_file\u001b[49m\u001b[43m(\u001b[49m\n\u001b[32m    186\u001b[39m \u001b[43m        \u001b[49m\u001b[43mfilename\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mmode\u001b[49m\u001b[43m=\u001b[49m\u001b[43mmode_\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mstorage_options\u001b[49m\u001b[43m=\u001b[49m\u001b[43mstorage_options\u001b[49m\n\u001b[32m    187\u001b[39m \u001b[43m    \u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    189\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28misinstance\u001b[39m(filename, BytesIOProxy):\n\u001b[32m    190\u001b[39m     source = filename\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/common.py:223\u001b[39m, in \u001b[36m_open_remote_file\u001b[39m\u001b[34m(file, mode, storage_options)\u001b[39m\n\u001b[32m    218\u001b[39m \u001b[38;5;28;01mimport\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mfsspec\u001b[39;00m\n\u001b[32m    220\u001b[39m fs, _, paths = fsspec.get_fs_token_paths(\n\u001b[32m    221\u001b[39m     file, mode=mode, storage_options=storage_options\n\u001b[32m    222\u001b[39m )\n\u001b[32m--\u003e \u001b[39m\u001b[32m223\u001b[39m \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[43mfs\u001b[49m\u001b[43m.\u001b[49m\u001b[43mopen\u001b[49m\u001b[43m(\u001b[49m\u001b[43mpaths\u001b[49m\u001b[43m[\u001b[49m\u001b[32;43m0\u001b[39;49m\u001b[43m]\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mmode\u001b[49m\u001b[43m=\u001b[49m\u001b[43mmode\u001b[49m\u001b[43m)\u001b[49m\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/spec.py:1338\u001b[39m, in \u001b[36mAbstractFileSystem.open\u001b[39m\u001b[34m(self, path, mode, block_size, cache_options, compression, **kwargs)\u001b[39m\n\u001b[32m   1336\u001b[39m \u001b[38;5;28;01melse\u001b[39;00m:\n\u001b[32m   1337\u001b[39m     ac = kwargs.pop(\u001b[33m\"\u001b[39m\u001b[33mautocommit\u001b[39m\u001b[33m\"\u001b[39m, \u001b[38;5;129;01mnot\u001b[39;00m \u001b[38;5;28mself\u001b[39m._intrans)\n\u001b[32m-\u003e \u001b[39m\u001b[32m1338\u001b[39m     f = \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43m_open\u001b[49m\u001b[43m(\u001b[49m\n\u001b[32m   1339\u001b[39m \u001b[43m        \u001b[49m\u001b[43mpath\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m   1340\u001b[39m \u001b[43m        \u001b[49m\u001b[43mmode\u001b[49m\u001b[43m=\u001b[49m\u001b[43mmode\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m   1341\u001b[39m \u001b[43m        \u001b[49m\u001b[43mblock_size\u001b[49m\u001b[43m=\u001b[49m\u001b[43mblock_size\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m   1342\u001b[39m \u001b[43m        \u001b[49m\u001b[43mautocommit\u001b[49m\u001b[43m=\u001b[49m\u001b[43mac\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m   1343\u001b[39m \u001b[43m        \u001b[49m\u001b[43mcache_options\u001b[49m\u001b[43m=\u001b[49m\u001b[43mcache_options\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m   1344\u001b[39m \u001b[43m        \u001b[49m\u001b[43m*\u001b[49m\u001b[43m*\u001b[49m\u001b[43mkwargs\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m   1345\u001b[39m \u001b[43m    \u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m   1346\u001b[39m     \u001b[38;5;28;01mif\u001b[39;00m compression \u001b[38;5;129;01mis\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m \u001b[38;5;28;01mNone\u001b[39;00m:\n\u001b[32m   1347\u001b[39m         \u001b[38;5;28;01mfrom\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mfsspec\u001b[39;00m\u001b[34;01m.\u001b[39;00m\u001b[34;01mcompression\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;28;01mimport\u001b[39;00m compr\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/implementations/http.py:376\u001b[39m, in \u001b[36mHTTPFileSystem._open\u001b[39m\u001b[34m(self, path, mode, block_size, autocommit, cache_type, cache_options, size, **kwargs)\u001b[39m\n\u001b[32m    374\u001b[39m kw.update(kwargs)\n\u001b[32m    375\u001b[39m info = {}\n\u001b[32m--\u003e \u001b[39m\u001b[32m376\u001b[39m size = size \u001b[38;5;129;01mor\u001b[39;00m info.update(\u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43minfo\u001b[49m\u001b[43m(\u001b[49m\u001b[43mpath\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43m*\u001b[49m\u001b[43m*\u001b[49m\u001b[43mkwargs\u001b[49m\u001b[43m)\u001b[49m) \u001b[38;5;129;01mor\u001b[39;00m info[\u001b[33m\"\u001b[39m\u001b[33msize\u001b[39m\u001b[33m\"\u001b[39m]\n\u001b[32m    377\u001b[39m session = sync(\u001b[38;5;28mself\u001b[39m.loop, \u001b[38;5;28mself\u001b[39m.set_session)\n\u001b[32m    378\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m block_size \u001b[38;5;129;01mand\u001b[39;00m size \u001b[38;5;129;01mand\u001b[39;00m info.get(\u001b[33m\"\u001b[39m\u001b[33mpartial\u001b[39m\u001b[33m\"\u001b[39m, \u001b[38;5;28;01mTrue\u001b[39;00m):\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/asyn.py:118\u001b[39m, in \u001b[36msync_wrapper.\u003clocals\u003e.wrapper\u001b[39m\u001b[34m(*args, **kwargs)\u001b[39m\n\u001b[32m    115\u001b[39m \u001b[38;5;129m@functools\u001b[39m.wraps(func)\n\u001b[32m    116\u001b[39m \u001b[38;5;28;01mdef\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34mwrapper\u001b[39m(*args, **kwargs):\n\u001b[32m    117\u001b[39m     \u001b[38;5;28mself\u001b[39m = obj \u001b[38;5;129;01mor\u001b[39;00m args[\u001b[32m0\u001b[39m]\n\u001b[32m--\u003e \u001b[39m\u001b[32m118\u001b[39m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[43msync\u001b[49m\u001b[43m(\u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mloop\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mfunc\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43m*\u001b[49m\u001b[43margs\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43m*\u001b[49m\u001b[43m*\u001b[49m\u001b[43mkwargs\u001b[49m\u001b[43m)\u001b[49m\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/asyn.py:103\u001b[39m, in \u001b[36msync\u001b[39m\u001b[34m(loop, func, timeout, *args, **kwargs)\u001b[39m\n\u001b[32m    101\u001b[39m     \u001b[38;5;28;01mraise\u001b[39;00m FSTimeoutError \u001b[38;5;28;01mfrom\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mreturn_result\u001b[39;00m\n\u001b[32m    102\u001b[39m \u001b[38;5;28;01melif\u001b[39;00m \u001b[38;5;28misinstance\u001b[39m(return_result, \u001b[38;5;167;01mBaseException\u001b[39;00m):\n\u001b[32m--\u003e \u001b[39m\u001b[32m103\u001b[39m     \u001b[38;5;28;01mraise\u001b[39;00m return_result\n\u001b[32m    104\u001b[39m \u001b[38;5;28;01melse\u001b[39;00m:\n\u001b[32m    105\u001b[39m     \u001b[38;5;28;01mreturn\u001b[39;00m return_result\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/asyn.py:56\u001b[39m, in \u001b[36m_runner\u001b[39m\u001b[34m(event, coro, result, timeout)\u001b[39m\n\u001b[32m     54\u001b[39m     coro = asyncio.wait_for(coro, timeout=timeout)\n\u001b[32m     55\u001b[39m \u001b[38;5;28;01mtry\u001b[39;00m:\n\u001b[32m---\u003e \u001b[39m\u001b[32m56\u001b[39m     result[\u001b[32m0\u001b[39m] = \u001b[38;5;28;01mawait\u001b[39;00m coro\n\u001b[32m     57\u001b[39m \u001b[38;5;28;01mexcept\u001b[39;00m \u001b[38;5;167;01mException\u001b[39;00m \u001b[38;5;28;01mas\u001b[39;00m ex:\n\u001b[32m     58\u001b[39m     result[\u001b[32m0\u001b[39m] = ex\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/implementations/http.py:450\u001b[39m, in \u001b[36mHTTPFileSystem._info\u001b[39m\u001b[34m(self, url, **kwargs)\u001b[39m\n\u001b[32m    447\u001b[39m     \u001b[38;5;28;01mexcept\u001b[39;00m \u001b[38;5;167;01mException\u001b[39;00m \u001b[38;5;28;01mas\u001b[39;00m exc:\n\u001b[32m    448\u001b[39m         \u001b[38;5;28;01mif\u001b[39;00m policy == \u001b[33m\"\u001b[39m\u001b[33mget\u001b[39m\u001b[33m\"\u001b[39m:\n\u001b[32m    449\u001b[39m             \u001b[38;5;66;03m# If get failed, then raise a FileNotFoundError\u001b[39;00m\n\u001b[32m--\u003e \u001b[39m\u001b[32m450\u001b[39m             \u001b[38;5;28;01mraise\u001b[39;00m \u001b[38;5;167;01mFileNotFoundError\u001b[39;00m(url) \u001b[38;5;28;01mfrom\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mexc\u001b[39;00m\n\u001b[32m    451\u001b[39m         logger.debug(\u001b[33m\"\u001b[39m\u001b[33m\"\u001b[39m, exc_info=exc)\n\u001b[32m    453\u001b[39m \u001b[38;5;28;01mreturn\u001b[39;00m {\u001b[33m\"\u001b[39m\u001b[33mname\u001b[39m\u001b[33m\"\u001b[39m: url, \u001b[33m\"\u001b[39m\u001b[33msize\u001b[39m\u001b[33m\"\u001b[39m: \u001b[38;5;28;01mNone\u001b[39;00m, **info, \u001b[33m\"\u001b[39m\u001b[33mtype\u001b[39m\u001b[33m\"\u001b[39m: \u001b[33m\"\u001b[39m\u001b[33mfile\u001b[39m\u001b[33m\"\u001b[39m}\n\n\u001b[31mFileNotFoundError\u001b[39m: https://www.ncei.noaa.gov/thredds-ocean/dodsC/woa23/DATA/temperature/netcdf/decav/1.00/woa23_decav_t07_01.nc","ename":"FileNotFoundError","evalue":"https://www.ncei.noaa.gov/thredds-ocean/dodsC/woa23/DATA/temperature/netcdf/decav/1.00/woa23_decav_t07_01.nc"}],"key":"cnqZGsdZjg"}],"key":"qAkZVp82dN"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"5) Downloading external error map for the specific location.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"L1UGas658r"}],"identifier":"id-5-downloading-external-error-map-for-the-specific-location","label":"5) Downloading external error map for the specific location.","html_id":"id-5-downloading-external-error-map-for-the-specific-location","implicit":true,"key":"zwfZ202zHd"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Currently the error map comes from a fixed file; our plan is to switch to a dynamic AWS download that accepts location parameters.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"FeQ9sr9HuV"}],"key":"JuFQhzRKWz"}],"key":"taJnVHgM1X"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Downloading anomaly detection model error map from NCAR via OSDF\nresponse = requests.get('https://data-osdf.rda.ucar.edu/ncar/rda/pythia_2025/osdf-cookbook/mae_error_map.npy')\nresponse.raise_for_status()\nsonar_clusters = np.load(io.BytesIO(response.content))","key":"cjhNURY0tT"},{"type":"output","id":"H4qP5jM03lHH99vNAB5JK","data":[],"key":"lRXNIpSjaj"}],"key":"BQxgODznzM"},{"type":"block","kind":"notebook-content","children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"O1x7hqSLXN"}],"key":"ZvSW0joYoE"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"6) Helper: mean Sv in dB","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OkTSY9SE4y"}],"identifier":"id-6-helper-mean-sv-in-db","label":"6) Helper: mean Sv in dB","html_id":"id-6-helper-mean-sv-in-db","implicit":true,"key":"Mbq2WHzndu"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Computes the mean of Sv correctly by converting dB → linear, averaging, then linear → dB.\nAccepts array-like input (NumPy/xarray/dask); returns a scalar in dB.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"N8lpXdywXJ"}],"key":"x8ZmSxG109"}],"key":"G1lD5P6fnf"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def calculate_sv_mean(input_sv):\n    # Convert dB to linear, mean in linear space, convert back to dB\n    sv = 10. ** (input_sv / 10.)\n    return 10 * np.log10(np.mean(sv))","key":"YPUc3SP2E1"},{"type":"output","id":"D0t3O50lLECO4tgrd5syu","data":[],"key":"uVlukeenPI"}],"key":"jJTxddaCA1"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"7) Group cruise data into hourly chunks","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DWnOtyST0v"}],"identifier":"id-7-group-cruise-data-into-hourly-chunks","label":"7) Group cruise data into hourly chunks","html_id":"id-7-group-cruise-data-into-hourly-chunks","implicit":true,"key":"b7VlhCt0ld"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Adds an hourly label and groups the cruise data by hour.\nProduces a list of per-hour xarray.Dataset chunks for downstream aggregation.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"HF3D8yIu3D"}],"key":"Z0z3TGvOwg"}],"key":"MLWg8xZszA"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"cruise['time_hour'] = cruise['time'].dt.floor('1h')  # hourly bin label\n\n# Group by each hour\ngrouped = cruise.groupby('time_hour')\n\n# Extract each 1-hour Dataset as a chunk (drop helper label)\nchunks = [group.drop_vars('time_hour') for _, group in grouped]","key":"vTEg5FOrTe"},{"type":"output","id":"jNAExaaThjDeFwDNqQJDm","data":[],"key":"OTKXrJZzDj"}],"key":"j6zv4n39BG"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"8) Compute hourly mean Sv and attach to env_df","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lg5Y7CswlV"}],"identifier":"id-8-compute-hourly-mean-sv-and-attach-to-env-df","label":"8) Compute hourly mean Sv and attach to env_df","html_id":"id-8-compute-hourly-mean-sv-and-attach-to-env-df","implicit":true,"key":"rffj489hPT"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Iterates over hourly chunks, computes mean Sv per hour using calculate_sv_mean.\nConverts dask→NumPy→Python float and appends to a list.\nAssigns the resulting hourly series to env_df[“sv_hourly”].\nAssumes the number/order of hours matches rows retained in env_df.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"ieSn0FQ94N"}],"key":"nyFFMhHvln"}],"key":"qUk5tozkBd"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"sv_hourly = []\ntimestamps = []\n\nfor i in range(0, len(chunks)):\n    sv_data = chunks[i]['Sv']\n    result = calculate_sv_mean(sv_data)\n\n    # Use first time in hour as representative timestamp\n    ts = pd.to_datetime(chunks[i]['time'].values[0])\n    result = result.compute()  # dask -\u003e numpy\n    result = float(result.values)  # numpy -\u003e Python float\n\n    sv_hourly.append(result)\n\nenv_df[\"sv_hourly\"] = sv_hourly","key":"Fs9J9087M0"},{"type":"output","id":"Gbbx7qCGl7Yq2VkV_9iGH","data":[],"key":"KrOQrnW3bC"}],"key":"wd1K51y45h"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"9) Build (depth × time) error-map DataFrame and align timestamps","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iqmGlszZbB"}],"identifier":"id-9-build-depth-time-error-map-dataframe-and-align-timestamps","label":"9) Build (depth × time) error-map DataFrame and align timestamps","html_id":"id-9-build-depth-time-error-map-dataframe-and-align-timestamps","implicit":true,"key":"qEHfR5Pte9"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Extracts one channel from sonar_clusters and pairs it with cruise depths and timestamps to form a DataFrame.\nUses min(...) to guard against size mismatches in depth/time dimensions.\nAligns only the first and last timestamps in env_df to the heatmap’s time range (keeps interior indices unchanged, sets UTC).","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"G1Wbu4zOFF"}],"key":"T1o6AqE2RI"}],"key":"DxI0PliGt3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Prepare axes\ndepths = np.asarray(cruise.depth.values)\ntimes = pd.to_datetime(hm_timestamps)\n\n# Select channel/slice from sonar_clusters\nvals = sonar_clusters[:, :, 1]  # (1088, 28096)\n\n# Guard against mismatched sizes\nn_depth = min(len(depths), vals.shape[0])\nn_time = min(len(times), vals.shape[1])\n\n# DataFrame: rows=depths, cols=timestamps\ndf = pd.DataFrame(\n    data=vals[:n_depth, :n_time],\n    index=depths[:n_depth],\n    columns=times[:n_time]\n)\n\n# Align env_df index endpoints to heatmap timestamps (keeps interior unchanged)\nidx = env_df.index.tolist()\ndf_timestamps = pd.to_datetime(df.columns).tz_localize(None)\nidx[0] = pd.Timestamp(df_timestamps.values[0], tz='UTC').floor(\"s\")\nidx[-1] = pd.Timestamp(df_timestamps.values[-1], tz='UTC').floor(\"s\")\nenv_df.index = idx","key":"ZqWviMPkbt"},{"type":"output","id":"U3B6waPqAuunQ_sAmoqSq","data":[],"key":"XGH5CzuQv1"}],"key":"FjVJQ46V7h"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"10) Data Visualization: Synchronized Lines + Heatmap","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zM5cZSvZMW"}],"identifier":"id-10-data-visualization-synchronized-lines-heatmap","label":"10) Data Visualization: Synchronized Lines + Heatmap","html_id":"id-10-data-visualization-synchronized-lines-heatmap","implicit":true,"key":"PKDg8UhTNB"}],"key":"KfJHIWJga0"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Plots synchronized data: top = time series from line_df; bottom = depth×time heatmap from heatmap_df.\nExpects line_df to have a DatetimeIndex (timezone-naive or converted).\nDepth axis is reversed (surface at top).\nSaves an interactive HTML file to the parent directory (correlations.html) and shows the figure if show=True.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HoDE3TU8N5"}],"key":"s258TXgB1l"}],"key":"QWFltp56jR"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def plot_synchronized_heatmaps_from_df(\n        heatmap_df: pd.DataFrame,\n        line_df: pd.DataFrame,\n        colorscale: str = \"Reds\",\n        show_markers: bool = False,\n        show: bool = False,\n):\n    if not isinstance(line_df.index, pd.DatetimeIndex):\n        raise TypeError(\"line_df must have a DatetimeIndex\")\n    line_df = line_df.copy()\n    if line_df.index.tz is not None:\n        line_df.index = line_df.index.tz_convert(None)\n\n    depths = np.asarray(heatmap_df.index)\n    heatmap_timestamps = pd.to_datetime(heatmap_df.columns)\n    z = heatmap_df.to_numpy()\n\n    n = len(line_df.columns)\n    fig = make_subplots(\n        rows=n + 1,\n        cols=1,\n        shared_xaxes=True,\n        vertical_spacing=0.02,\n        row_heights=[0.1] * n + [0.7],  # n small rows + large heatmap row\n    )\n\n    mode = \"lines+markers\" if show_markers else \"lines\"\n\n    # Define units for each variable\n    units = {\n        'sea_surface_temperature': '°C',\n        'elevation_deg': 'degrees',\n        'sv_hourly': 'dB'\n    }\n\n    for i, col in enumerate(line_df.columns, start=1):\n        fig.add_trace(\n            go.Scatter(x=line_df.index, y=line_df[col], name=str(col), mode=mode, showlegend=True),\n            row=i, col=1\n        )\n\n        # Add units as y-axis titles\n        unit = units.get(col, '')  # Default to empty string if variable not found\n        fig.update_yaxes(\n            title_text=unit,\n            row=i, col=1\n        )\n\n        if i \u003c len(line_df.columns):\n            fig.update_xaxes(showticklabels=False, row=i, col=1)\n\n    fig.add_trace(\n        go.Heatmap(\n            z=z, x=heatmap_timestamps, y=depths, colorscale=colorscale,\n            zmin=np.nanmin(z), zmax=np.nanmax(z),\n            hovertemplate=\"t=%{x}\u003cbr\u003edepth=%{y}\u003cbr\u003evalue=%{z}\u003cextra\u003e\u003c/extra\u003e\",\n        ),\n        row=n + 1, col=1\n    )\n    fig.update_yaxes(autorange=\"reversed\", row=n + 1, col=1, title_text=\"Depth\")\n\n    fig.update_layout(\n        margin=dict(l=40, r=40, t=60, b=40),  # Reduced left margin, increased top for legend\n        hovermode=\"x unified\",\n        template=\"plotly_white\",\n        # height=10 * n + 500,  # scale height with number of signals\n    )\n\n    # Enhanced horizontal legend positioning\n    fig.update_layout(\n        legend=dict(\n            orientation='h',\n            x=0,\n            y=1.02,\n            xanchor='left',\n            yanchor='bottom',\n            bgcolor='rgba(255,255,255,0.8)',\n            bordercolor='rgba(0,0,0,0.1)',\n            borderwidth=1\n        )\n    )\n\n    save_path = os.path.join(os.path.dirname(os.getcwd()), \"correlations.html\")\n    fig.write_html(save_path)\n    print(f\"Plot saved to: {save_path}\")\n    if show:\n        fig.show()\n    return fig\n# Uncomment this line in order to create the plot.\n# fig = plot_synchronized_heatmaps_from_df(heatmap_df=df, line_df=env_df)\n# fig.show()","key":"pdvc4Ksh38"},{"type":"output","id":"re3OTYIeVVNhytAZNVEdh","data":[],"key":"Ye5MD2FKmn"}],"key":"tsDGYDrL8b"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Because rendering the plot is computationally intensive and involves downloading approximately 1 GB of data, we present a static image of the result instead.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bphLrVt29i"}],"key":"gU2gIrxTvT"}],"key":"VTqinU2tgi"},{"type":"block","kind":"notebook-code","data":{"ExecuteTime":{"end_time":"2025-08-15T19:32:51.371053Z","start_time":"2025-08-15T19:32:51.362008Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"from IPython.display import Image, display\ndisplay(Image(filename='../images/sonarai_example.png'))","key":"z89eUEnPdI"},{"type":"output","id":"rpbSFbY649UtwyNx6xuSs","data":[],"key":"WriHRDiDS1"}],"key":"VSAtMVHDaa"}],"key":"XXnn5eAoSa"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Integrating sonar and buoy-based temperature data","url":"/notebooks/sonarai-foundations","group":"NOAA SONAR data examples"},"next":{"title":"PyCoGSS: Spectral Change Analysis of Arctic Water Tracks","url":"/notebooks/pycogss-foundations","group":"PYCOGSS examples"}}},"domain":"http://localhost:3000"},"project":{"open_access":true,"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true},"code":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true}},"title":"OSDF Cookbook","authors":[{"nameParsed":{"literal":"Harsha R. Hampapura","given":"Harsha R.","family":"Hampapura"},"name":"Harsha R. Hampapura","id":"contributors-myst-generated-uid-0"},{"nameParsed":{"literal":"Brian Bockelman","given":"Brian","family":"Bockelman"},"name":"Brian Bockelman","id":"contributors-myst-generated-uid-1"},{"nameParsed":{"literal":"Alexander Hoelzeman","given":"Alexander","family":"Hoelzeman"},"name":"Alexander Hoelzeman","id":"contributors-myst-generated-uid-2"},{"nameParsed":{"literal":"Carrie Wall","given":"Carrie","family":"Wall"},"name":"Carrie Wall","id":"contributors-myst-generated-uid-3"},{"nameParsed":{"literal":"Emma Turetsky","given":"Emma","family":"Turetsky"},"name":"Emma Turetsky","id":"contributors-myst-generated-uid-4"},{"nameParsed":{"literal":"Amandha Wingert Barok","given":"Amandha Wingert","family":"Barok"},"name":"Amandha Wingert Barok","id":"contributors-myst-generated-uid-5"},{"nameParsed":{"literal":"Aashish Panta","given":"Aashish","family":"Panta"},"name":"Aashish Panta","id":"contributors-myst-generated-uid-6"},{"nameParsed":{"literal":"Riley Conroy","given":"Riley","family":"Conroy"},"name":"Riley Conroy","id":"contributors-myst-generated-uid-7"},{"nameParsed":{"literal":"Douglas Schuster","given":"Douglas","family":"Schuster"},"name":"Douglas Schuster","id":"contributors-myst-generated-uid-8"},{"nameParsed":{"literal":"Justin Hiemstra","given":"Justin","family":"Hiemstra"},"name":"Justin Hiemstra","id":"contributors-myst-generated-uid-9"},{"nameParsed":{"literal":"Joanmarie Del Vecchio","given":"Joanmarie Del","family":"Vecchio"},"name":"Joanmarie Del Vecchio","id":"contributors-myst-generated-uid-10"},{"nameParsed":{"literal":"Kibiwott Koech","given":"Kibiwott","family":"Koech"},"name":"Kibiwott Koech","id":"contributors-myst-generated-uid-11"}],"contributors":[{"id":"brian-rose","nameParsed":{"literal":"Brian E. J. Rose","given":"Brian E. J.","family":"Rose"},"name":"Brian E. J. Rose","orcid":"0000-0002-9961-3821","email":"brose@albany.edu","affiliations":["UAlbany"],"url":"https://brian-rose.github.io","github":"brian-rose","bluesky":"@brianejrose.bsky.social","linkedin":"https://www.linkedin.com/in/brian-rose-37bb55106/"},{"id":"clyne","nameParsed":{"literal":"John Clyne","given":"John","family":"Clyne"},"name":"John Clyne","orcid":"0000-0003-2788-9017","affiliations":["CISL"],"github":"clyne"},{"id":"jukent","nameParsed":{"literal":"Julia Kent","given":"Julia","family":"Kent"},"name":"Julia Kent","orcid":"0000-0002-5611-8986","affiliations":["CISL"],"github":"jukent"},{"id":"ktyle","nameParsed":{"literal":"Kevin Tyle","given":"Kevin","family":"Tyle"},"name":"Kevin Tyle","orcid":"0000-0001-5249-9665","affiliations":["UAlbany"],"github":"ktyle"},{"id":"andersy005","nameParsed":{"literal":"Anderson Banihirwe","given":"Anderson","family":"Banihirwe"},"name":"Anderson Banihirwe","orcid":"0000-0001-6583-571X","affiliations":["CarbonPlan"],"github":"andersy005"},{"id":"dcamron","nameParsed":{"literal":"Drew Camron","given":"Drew","family":"Camron"},"name":"Drew Camron","orcid":"0000-0001-7246-6502","affiliations":["Unidata"],"github":"dcamron"},{"id":"dopplershift","nameParsed":{"literal":"Ryan May","given":"Ryan","family":"May"},"name":"Ryan May","orcid":"0000-0003-2907-038X","affiliations":["Unidata"],"github":"dopplershift"},{"id":"mgrover1","nameParsed":{"literal":"Maxwell Grover","given":"Maxwell","family":"Grover"},"name":"Maxwell Grover","orcid":"0000-0002-0370-8974","affiliations":["Argonne"],"github":"mgrover1"},{"id":"r-ford","nameParsed":{"literal":"Robert R. Ford","given":"Robert R.","family":"Ford"},"name":"Robert R. Ford","orcid":"0000-0001-5483-4965","affiliations":["UAlbany"],"github":"r-ford"},{"id":"kmpaul","nameParsed":{"literal":"Kevin Paul","given":"Kevin","family":"Paul"},"name":"Kevin Paul","orcid":"0000-0001-8155-8038","affiliations":["NVIDIA"],"github":"kmpaul"},{"id":"jnmorley","nameParsed":{"literal":"James Morley","given":"James","family":"Morley"},"name":"James Morley","orcid":"0009-0005-5193-7981","github":"jnmorley"},{"id":"erogluorhan","nameParsed":{"literal":"Orhan Eroglu","given":"Orhan","family":"Eroglu"},"name":"Orhan Eroglu","orcid":"0000-0003-3099-8775","affiliations":["CISL"],"github":"erogluorhan"},{"id":"lkailynncar","nameParsed":{"literal":"Lily Kailyn","given":"Lily","family":"Kailyn"},"name":"Lily Kailyn","orcid":"0009-0002-0125-5091","affiliations":["CISL"],"github":"lkailynncar"},{"id":"anissa111","nameParsed":{"literal":"Anissa Zacharias","given":"Anissa","family":"Zacharias"},"name":"Anissa Zacharias","orcid":"0000-0002-2666-8493","affiliations":["CISL"],"github":"anissa111"},{"id":"kafitzgerald","nameParsed":{"literal":"Katelyn FitzGerald","given":"Katelyn","family":"FitzGerald"},"name":"Katelyn FitzGerald","orcid":"0000-0003-4184-1917","affiliations":["CISL"],"github":"kafitzgerald"}],"github":"https://github.com/projectpythia/osdf-cookbook","affiliations":[{"id":"UAlbany","name":"University at Albany (SUNY)","department":"Atmospheric and Environmental Sciences","url":"https://www.albany.edu/daes"},{"id":"CISL","name":"NSF National Center for Atmospheric Research","department":"Computational and Information Systems Lab","url":"https://www.cisl.ucar.edu"},{"id":"Unidata","name":"NSF Unidata","url":"https://www.unidata.ucar.edu"},{"id":"Argonne","name":"Argonne National Laboratory","department":"Environmental Science Division","url":"https://www.anl.gov/evs"},{"id":"CarbonPlan","name":"CarbonPlan","url":"https://carbonplan.org"},{"id":"NVIDIA","name":"NVIDIA Corporation","url":"https://www.nvidia.com/"}],"copyright":"2024","references":{"foundations":{"url":"https://foundations.projectpythia.org"},"xarray":{"url":"https://docs.xarray.dev/en/stable"},"matplotlib":{"url":"https://matplotlib.org/stable"}},"thebe":{"binder":{"url":"https://mybinder.org/","provider":"github","repo":"projectpythia/osdf-cookbook","ref":"HEAD"}},"toc":[{"file":"README.md"},{"children":[{"file":"notebooks/how-to-cite.md"}],"title":"Preamble"},{"children":[{"file":"notebooks/01_osdf_intro.ipynb"},{"file":"notebooks/01_pelicanfs.ipynb"}],"title":"Introduction to OSDF"},{"children":[{"file":"notebooks/02_ncar_intro.ipynb"},{"file":"notebooks/02_cesm2_oceanheat.ipynb"},{"file":"notebooks/02_cmip6_gmst.ipynb"}],"title":"NCAR examples"},{"children":[{"file":"notebooks/03_EnviStor_Foundations.ipynb"},{"file":"notebooks/03_EnviStor_Technical.ipynb"}],"title":"Envistor examples"},{"children":[{"file":"notebooks/04_SonarAI_Foundations.ipynb"},{"file":"notebooks/04_SonarAI_Technical.ipynb"}],"title":"NOAA SONAR data examples"},{"children":[{"file":"notebooks/05_PyCoGSS_Foundations.ipynb"},{"file":"notebooks/05_PyCoGSS_SpectralChange_PFS.ipynb"}],"title":"PYCOGSS examples"},{"children":[{"file":"notebooks/06_introduction_to_NSDF_OpenVISUS.ipynb"},{"file":"notebooks/06_ocean_llc4320_visualization.ipynb"},{"file":"notebooks/06_ocean_llc2160_visualization.ipynb"},{"file":"notebooks/06_atmosphere_llc2160_visualization.ipynb"}],"title":"OpenVISUS examples"}],"thumbnail":"/osdf-cookbook/build/cookbook_logo-35042cacdefd342d103254243b6520b3.png","exports":[],"bibliography":[],"index":"index","pages":[{"level":1,"title":"Preamble"},{"slug":"notebooks.how-to-cite","title":"How to Cite This Cookbook","description":"","date":"","thumbnail":"/osdf-cookbook/build/752d668a01647c1c7b20b3d9a5936e83.svg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Introduction to OSDF"},{"slug":"notebooks.osdf-intro","title":"Streaming Data with the Open Science Data Federation (OSDF)","description":"","date":"","thumbnail":"/osdf-cookbook/build/OSDF_OSPool_Logos-99cf193aeb85d67d226662a090b8949c.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.pelicanfs","title":"Using PelicanFS via FSSpec to Access Data on the OSDF","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"NCAR examples"},{"slug":"notebooks.ncar-intro","title":"Introduction to NSF NCAR’s Geoscience Data Exhcange","description":"","date":"","thumbnail":"/osdf-cookbook/build/GDEX_Logo-14e63756244eaffa89ef375718dec784.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.cesm2-oceanheat","title":"Calculate Surface Ocean Heat using CESM2 LENS data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.cmip6-gmst","title":"Global Mean Surface Temperature Anomalies (GMSTA) from CMIP6 data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Envistor examples"},{"slug":"notebooks.envistor-foundations","title":"Exploring Salinity Patterns in South Florida Coastal Waters","description":"","date":"","thumbnail":"/osdf-cookbook/build/FIU_EnviStor_logo-14a90cd9a6adcbd2340f41e78b465b76.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.envistor-technical","title":"Analyzing Salinity Patterns in South Florida","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"NOAA SONAR data examples"},{"slug":"notebooks.sonarai-foundations","title":"Integrating sonar and buoy-based temperature data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.sonarai-technical","title":"Contextual Integration of NCAR/NOAA Environmental Data with the NOAA Water Column Sonar Archive","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"PYCOGSS examples"},{"slug":"notebooks.pycogss-foundations","title":"PyCoGSS: Spectral Change Analysis of Arctic Water Tracks","description":"","date":"","thumbnail":"/osdf-cookbook/build/pycogss-logo-89634f9a80a51495a2ba88fb9f62fac1.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.pycogss-spectralchange-pfs","title":"PyCoGSS: Spectral Change Analysis of Arctic Water Tracks","description":"","date":"","thumbnail":"/osdf-cookbook/build/pycogss-logo-89634f9a80a51495a2ba88fb9f62fac1.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"OpenVISUS examples"},{"slug":"notebooks.introduction-to-nsdf-openvisus","title":"Introduction to NSDF-OpenVISUS","description":"","date":"","thumbnail":"/osdf-cookbook/build/nsdf-9370e15d8357004fee486039903687a2.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.ocean-llc4320-visualization","title":"ECCO LLC4320 Ocean Dataset Notebook","description":"","date":"","thumbnail":"/osdf-cookbook/build/nsdf-9370e15d8357004fee486039903687a2.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.ocean-llc2160-visualization","title":"DYAMOND LLC2160 Ocean Dataset Notebook","description":"","date":"","thumbnail":"/osdf-cookbook/build/nsdf-9370e15d8357004fee486039903687a2.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.atmosphere-llc2160-visualization","title":"DYAMOND LLC2160 Atmospheric Dataset Notebook","description":"","date":"","thumbnail":"/osdf-cookbook/build/nsdf-9370e15d8357004fee486039903687a2.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}}},"actionData":null,"errors":null},"future":{"unstable_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":true,"v2_headers":true,"v2_meta":true,"v2_normalizeFormMethod":true,"v2_routeConvention":true}};</script><script type="module" async="">import "/osdf-cookbook/build/manifest-ED236704.js";
import * as route0 from "/osdf-cookbook/build/root-ZJOPFBMV.js";
import * as route1 from "/osdf-cookbook/build/routes/$-CQPS5IOR.js";
window.__remixRouteModules = {"root":route0,"routes/$":route1};

import("/osdf-cookbook/build/entry.client-UNPC4GT3.js");</script></body></html>