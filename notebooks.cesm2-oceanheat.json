{"version":3,"kind":"Notebook","sha256":"fee58119baef62fe2c01dd3ca5fdba87abcfe793a4023e92f7f21d7a28db2737","slug":"notebooks.cesm2-oceanheat","location":"/notebooks/02_cesm2_oceanheat.ipynb","dependencies":[],"frontmatter":{"title":"Calculate Surface Ocean Heat using CESM2 LENS data","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"authors":[{"nameParsed":{"literal":"Harsha R. Hampapura","given":"Harsha R.","family":"Hampapura"},"name":"Harsha R. Hampapura","id":"contributors-myst-generated-uid-0"},{"nameParsed":{"literal":"Brian Bockelman","given":"Brian","family":"Bockelman"},"name":"Brian Bockelman","id":"contributors-myst-generated-uid-1"},{"nameParsed":{"literal":"Alexander Hoelzeman","given":"Alexander","family":"Hoelzeman"},"name":"Alexander Hoelzeman","id":"contributors-myst-generated-uid-2"},{"nameParsed":{"literal":"Carrie Wall","given":"Carrie","family":"Wall"},"name":"Carrie Wall","id":"contributors-myst-generated-uid-3"},{"nameParsed":{"literal":"Emma Turetsky","given":"Emma","family":"Turetsky"},"name":"Emma Turetsky","id":"contributors-myst-generated-uid-4"},{"nameParsed":{"literal":"Amandha Wingert Barok","given":"Amandha Wingert","family":"Barok"},"name":"Amandha Wingert Barok","id":"contributors-myst-generated-uid-5"},{"nameParsed":{"literal":"Aashish Panta","given":"Aashish","family":"Panta"},"name":"Aashish Panta","id":"contributors-myst-generated-uid-6"},{"nameParsed":{"literal":"Riley Conroy","given":"Riley","family":"Conroy"},"name":"Riley Conroy","id":"contributors-myst-generated-uid-7"},{"nameParsed":{"literal":"Douglas Schuster","given":"Douglas","family":"Schuster"},"name":"Douglas Schuster","id":"contributors-myst-generated-uid-8"},{"nameParsed":{"literal":"Justin Hiemstra","given":"Justin","family":"Hiemstra"},"name":"Justin Hiemstra","id":"contributors-myst-generated-uid-9"},{"nameParsed":{"literal":"Joanmarie Del Vecchio","given":"Joanmarie Del","family":"Vecchio"},"name":"Joanmarie Del Vecchio","id":"contributors-myst-generated-uid-10"},{"nameParsed":{"literal":"Kibiwott Koech","given":"Kibiwott","family":"Koech"},"name":"Kibiwott Koech","id":"contributors-myst-generated-uid-11"}],"open_access":true,"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true},"code":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true}},"github":"https://github.com/projectpythia/osdf-cookbook","copyright":"2024","affiliations":[{"id":"UAlbany","name":"University at Albany (SUNY)","department":"Atmospheric and Environmental Sciences","url":"https://www.albany.edu/daes"},{"id":"CISL","name":"NSF National Center for Atmospheric Research","department":"Computational and Information Systems Lab","url":"https://www.cisl.ucar.edu"},{"id":"Unidata","name":"NSF Unidata","url":"https://www.unidata.ucar.edu"},{"id":"Argonne","name":"Argonne National Laboratory","department":"Environmental Science Division","url":"https://www.anl.gov/evs"},{"id":"CarbonPlan","name":"CarbonPlan","url":"https://carbonplan.org"},{"id":"NVIDIA","name":"NVIDIA Corporation","url":"https://www.nvidia.com/"}],"numbering":{"title":{"offset":1}},"source_url":"https://github.com/projectpythia/osdf-cookbook/blob/main/notebooks/02_cesm2_oceanheat.ipynb","edit_url":"https://github.com/projectpythia/osdf-cookbook/edit/main/notebooks/02_cesm2_oceanheat.ipynb","exports":[{"format":"ipynb","filename":"02_cesm2_oceanheat.ipynb","url":"/osdf-cookbook/build/02_cesm2_oceanheat-082f596833095076822fe0a674b6fffa.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LVTARClaLH"}],"key":"YLpZLNNUGO"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Overview","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yK47e02EYA"}],"identifier":"overview","label":"Overview","html_id":"overview","implicit":true,"key":"iu6WSkefI4"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"This notebook is an adpation of a ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"fidFRzrAdh"},{"type":"link","url":"https://gallery.pangeo.io/repos/NCAR/notebook-gallery/notebooks/Run-Anywhere/Ocean-Heat-Content/OHC_tutorial.html","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"workflow","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"BsJjMI5QFz"}],"urlSource":"https://gallery.pangeo.io/repos/NCAR/notebook-gallery/notebooks/Run-Anywhere/Ocean-Heat-Content/OHC_tutorial.html","key":"yh6lWBqEnp"},{"type":"text","value":" in the NCAR gallery of the Pangeo collection","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Rxp7YplTTm"}],"key":"jkXS6txMaa"}],"key":"qLen2KhaKY"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"This notebook illustrates how to compute surface ocean heat content using potential temperature data from ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"PA1MpCbGyp"},{"type":"link","url":"https://www.cesm.ucar.edu/community-projects/lens2","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"CESM2 Large Ensemble Dataset","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jZO0Dm6yXO"}],"urlSource":"https://www.cesm.ucar.edu/community-projects/lens2","key":"TWCtH0Sm0M"},{"type":"text","value":" (Community Earth System Model 2) hosted on NCAR’s GDEX.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"eUvXLzMFh9"}],"key":"JXTPhmLBI5"}],"key":"S7jMu2f8lt"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"This data is open access and is accessed via OSDF using the pelicanFS package and demonstrates how you can stream data from NCAR’s GDEX","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"eCSgykJMqE"}],"key":"BEueCldrGJ"}],"key":"Xbyl4OAmCZ"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Please refer to the first chapter of this cookbook to learn more about OSDF, pelican or pelicanFS","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"HlbkuBCJWZ"}],"key":"acxAl4IkiZ"}],"key":"tEQOp7eZ6q"}],"key":"tQAClDyj3j"}],"key":"XM1ulDAnLq"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Prerequisites","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gdpjglf58o"}],"identifier":"prerequisites","label":"Prerequisites","html_id":"prerequisites","implicit":true,"key":"wGAhOzTj4r"},{"type":"table","position":{"start":{"line":2,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"tableRow","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"tableCell","header":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Concepts","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"MJiDQ8VrRG"}],"key":"OXwfuobNPa"},{"type":"tableCell","header":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Importance","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"vez1jCKNQx"}],"key":"ogfZIX1sDG"},{"type":"tableCell","header":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Notes","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"CQsWm2R5ZM"}],"key":"XiyhKWriY0"}],"key":"buSfGQumjX"},{"type":"tableRow","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"link","url":"https://foundations.projectpythia.org/core/cartopy/cartopy","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Intro to Intake-ESM","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"KfkyrcPwjt"}],"urlSource":"https://foundations.projectpythia.org/core/cartopy/cartopy","key":"lZVEOZl38N"}],"key":"f5wWg3L6eZ"},{"type":"tableCell","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Necessary","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"HmNNBUrJ84"}],"key":"qqy2Lp5LyU"},{"type":"tableCell","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Used for searching CMIP6 data","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"MJ7ZSzfzPC"}],"key":"g28DWCUse8"}],"key":"E7fr5Yyvin"},{"type":"tableRow","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"link","url":"https://zarr.dev/","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Understanding of Zarr","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"SVLkiwPd6C"}],"urlSource":"https://zarr.dev/","key":"RlVunL97OC"}],"key":"KY3BsIDiIl"},{"type":"tableCell","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Helpful","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Ej7Nsf9Kr9"}],"key":"f0YFzDoZze"},{"type":"tableCell","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Familiarity with metadata structure","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"K54kgjjviM"}],"key":"FfwD6mhSZ6"}],"key":"qn1L2oaC0d"},{"type":"tableRow","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"link","url":"https://foundations.projectpythia.org/core/matplotlib/","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Matplotlib","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"zDIn330bzN"}],"urlSource":"https://foundations.projectpythia.org/core/matplotlib/","key":"h95LlSbqvo"}],"key":"A0CcmafFQM"},{"type":"tableCell","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Helpful","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"W2PLwQjK6u"}],"key":"SDDLIpSO89"},{"type":"tableCell","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Package used for plotting","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"DN9mFYTy3O"}],"key":"R2oevjEWUf"}],"key":"GNa7Lz1LDq"},{"type":"tableRow","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"link","url":"https://projectpythia.org/osdf-cookbook/notebooks/pelicanfs/","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"PelicanFS","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"Nd43NqAnFo"}],"urlSource":"https://projectpythia.org/osdf-cookbook/notebooks/pelicanfs/","key":"g7vGYBlXtX"}],"key":"M8e7xQDveW"},{"type":"tableCell","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Necessary","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"teRk4LxdCY"}],"key":"eyOTS0lFkA"},{"type":"tableCell","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"The python package used to stream data in this notebook","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"rB2IWbFRaA"}],"key":"W16ViwkLI8"}],"key":"UMjXlDnDxv"},{"type":"tableRow","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"OSDF","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"FTeSURoiS4"}],"key":"gp8dExe0C2"},{"type":"tableCell","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Helpful","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"lXhBaxHN7O"}],"key":"TMhc9ATXY2"},{"type":"tableCell","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"OSDF is used to stream data in this notebook","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"JaknIQrgDQ"}],"key":"UIoUYyan3s"}],"key":"POepZUwdVO"}],"key":"v9EXz0880Q"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Time to learn","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"L1SZ5mJSeQ"}],"key":"Klo4JSUkJJ"},{"type":"text","value":": 20 mins","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"VaySF006Ib"}],"key":"gY43BkEHAA"}],"key":"R65dzM1cpo"}],"key":"C5YUGKapY5"}],"key":"tDngbmzXYd"},{"type":"block","kind":"notebook-content","children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PkJjmi8IyP"}],"key":"PbmBOKuHDp"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Imports","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sMlt1xg9Jd"}],"identifier":"imports","label":"Imports","html_id":"imports","implicit":true,"key":"a8NMyYq7JO"}],"key":"gdANyXgEdH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import intake\nimport numpy as np\nimport pandas as pd\nimport xarray as xr\nimport seaborn as sns\nimport re\nimport matplotlib.pyplot as plt\nimport dask\nfrom dask.distributed import LocalCluster\nimport pelicanfs \nimport cf_units as cf","key":"jz2CQNwAoP"},{"type":"outputs","id":"l85swGCe1iT3Ng625YMSA","children":[],"key":"xbR53M02St"}],"key":"ChovZiWkTB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Load Catalog URL\ncat_url = 'https://stratus.gdex.ucar.edu/d010092/catalogs/d010092-osdf-zarr.json'","key":"WD3gQoH7Vb"},{"type":"outputs","id":"CRVNvYe8py2lUG7qzyvoL","children":[],"key":"n33sMZdBP3"}],"key":"X1bhHd3YO9"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Set up local dask cluster","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SVepphf8HE"}],"identifier":"set-up-local-dask-cluster","label":"Set up local dask cluster","html_id":"set-up-local-dask-cluster","implicit":true,"key":"nfLGmvzbJZ"}],"key":"nDCLdwNRrc"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Before we do any computation let us first set up a local cluster using dask","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ch8V1FBkd0"}],"key":"yQLl5Qi6yj"}],"key":"jJMivu3NSU"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"cluster = LocalCluster()          \nclient = cluster.get_client()","key":"AOrDzeUccy"},{"type":"outputs","id":"KdKhbqFKHU0caGAA3UjLs","children":[],"key":"ipYElrL01I"}],"key":"qWvl7DSr75"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Scale the cluster\nn_workers = 5\ncluster.scale(n_workers)\ncluster","key":"s1dpTjOJyK"},{"type":"outputs","id":"cmi-z5qMUkIYyAmYNSmeW","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"LocalCluster(3b54f117, 'tcp://127.0.0.1:39987', workers=4, threads=4, memory=15.62 GiB)","content_type":"text/plain"},"text/html":{"content":"<div class=\"jp-RenderedHTMLCommon jp-RenderedHTML jp-mod-trusted jp-OutputArea-output\">\n    <div style=\"width: 24px; height: 24px; background-color: #e1e1e1; border: 3px solid #9D9D9D; border-radius: 5px; position: absolute;\">\n    </div>\n    <div style=\"margin-left: 48px;\">\n        <h3 style=\"margin-bottom: 0px; margin-top: 0px;\">LocalCluster</h3>\n        <p style=\"color: #9D9D9D; margin-bottom: 0px;\">3b54f117</p>\n        <table style=\"width: 100%; text-align: left;\">\n            <tr>\n                <td style=\"text-align: left;\">\n                    <strong>Dashboard:</strong> <a href=\"http://127.0.0.1:8787/status\" target=\"_blank\">http://127.0.0.1:8787/status</a>\n                </td>\n                <td style=\"text-align: left;\">\n                    <strong>Workers:</strong> 4\n                </td>\n            </tr>\n            <tr>\n                <td style=\"text-align: left;\">\n                    <strong>Total threads:</strong> 4\n                </td>\n                <td style=\"text-align: left;\">\n                    <strong>Total memory:</strong> 15.62 GiB\n                </td>\n            </tr>\n            \n            <tr>\n    <td style=\"text-align: left;\"><strong>Status:</strong> running</td>\n    <td style=\"text-align: left;\"><strong>Using processes:</strong> True</td>\n</tr>\n\n            \n        </table>\n\n        <details>\n            <summary style=\"margin-bottom: 20px;\">\n                <h3 style=\"display: inline;\">Scheduler Info</h3>\n            </summary>\n\n            <div style=\"\">\n    <div>\n        <div style=\"width: 24px; height: 24px; background-color: #FFF7E5; border: 3px solid #FF6132; border-radius: 5px; position: absolute;\"> </div>\n        <div style=\"margin-left: 48px;\">\n            <h3 style=\"margin-bottom: 0px;\">Scheduler</h3>\n            <p style=\"color: #9D9D9D; margin-bottom: 0px;\">Scheduler-64acd738-11ef-4569-b99a-e7757d49d559</p>\n            <table style=\"width: 100%; text-align: left;\">\n                <tr>\n                    <td style=\"text-align: left;\">\n                        <strong>Comm:</strong> tcp://127.0.0.1:39987\n                    </td>\n                    <td style=\"text-align: left;\">\n                        <strong>Workers:</strong> 0 \n                    </td>\n                </tr>\n                <tr>\n                    <td style=\"text-align: left;\">\n                        <strong>Dashboard:</strong> <a href=\"http://127.0.0.1:8787/status\" target=\"_blank\">http://127.0.0.1:8787/status</a>\n                    </td>\n                    <td style=\"text-align: left;\">\n                        <strong>Total threads:</strong> 0\n                    </td>\n                </tr>\n                <tr>\n                    <td style=\"text-align: left;\">\n                        <strong>Started:</strong> Just now\n                    </td>\n                    <td style=\"text-align: left;\">\n                        <strong>Total memory:</strong> 0 B\n                    </td>\n                </tr>\n            </table>\n        </div>\n    </div>\n\n    <details style=\"margin-left: 48px;\">\n        <summary style=\"margin-bottom: 20px;\">\n            <h3 style=\"display: inline;\">Workers</h3>\n        </summary>\n\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 0</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:33379\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:32815/status\" target=\"_blank\">http://127.0.0.1:32815/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 3.90 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:38493\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-4omafiqk\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 1</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:33835\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:33251/status\" target=\"_blank\">http://127.0.0.1:33251/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 3.90 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:36373\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-pm0ppg3o\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 2</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:45727\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:45785/status\" target=\"_blank\">http://127.0.0.1:45785/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 3.90 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:41913\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-pkzzvb8x\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 3</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:46603\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:35933/status\" target=\"_blank\">http://127.0.0.1:35933/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 3.90 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:33031\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-n615wy2i\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n\n    </details>\n</div>\n\n        </details>\n    </div>\n</div>","content_type":"text/html"}}},"key":"GvmXIDPYnu"}],"key":"JanoIqpXCn"}],"key":"D6u5yKzhY6"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Data Loading","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Oa78o7A4Ry"}],"identifier":"data-loading","label":"Data Loading","html_id":"data-loading","implicit":true,"key":"vPBwrGOF8u"},{"type":"heading","depth":4,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Load CESM2 LENS data from NCAR’s GDEX","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"NHusHXoJtA"}],"identifier":"load-cesm2-lens-data-from-ncars-gdex","label":"Load CESM2 LENS data from NCAR’s GDEX","html_id":"load-cesm2-lens-data-from-ncars-gdex","implicit":true,"key":"a5Hr0tkXcH"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Load CESM2 LENS zarr data from GDEx using an intake-ESM catalog that has OSDF links","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dh1pKT1wqu"}],"key":"stX4TrK9YY"}],"key":"aZ24yM0yPY"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"For more details regarding the dataset. See, ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Yuc0TeF1X6"},{"type":"link","url":"https://gdex.ucar.edu/datasets/d010092/#","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"https://​gdex​.ucar​.edu​/datasets​/d010092​/#","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"U6hbh1yu4U"}],"urlSource":"https://gdex.ucar.edu/datasets/d010092/#","key":"tWG5AQ3cAx"}],"key":"UlWIyRXjo1"}],"key":"Yly7HAjOuz"}],"key":"YU9McsLWkp"}],"key":"IGOdXY4L4Z"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"col = intake.open_esm_datastore(cat_url)\ncol","key":"JwNvnck1nJ"},{"type":"outputs","id":"WDe51KFRhurKM7XT1mcDi","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"},"text/html":{"content":"<p><strong>gdex-cesm2-lens-zarr catalog with 40 dataset(s) from 322 asset(s)</strong>:</p> <div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>unique</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>Unnamed: 0</th>\n      <td>322</td>\n    </tr>\n    <tr>\n      <th>variable</th>\n      <td>53</td>\n    </tr>\n    <tr>\n      <th>long_name</th>\n      <td>51</td>\n    </tr>\n    <tr>\n      <th>component</th>\n      <td>4</td>\n    </tr>\n    <tr>\n      <th>experiment</th>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>forcing_variant</th>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>frequency</th>\n      <td>3</td>\n    </tr>\n    <tr>\n      <th>vertical_levels</th>\n      <td>3</td>\n    </tr>\n    <tr>\n      <th>spatial_domain</th>\n      <td>3</td>\n    </tr>\n    <tr>\n      <th>units</th>\n      <td>20</td>\n    </tr>\n    <tr>\n      <th>start_time</th>\n      <td>4</td>\n    </tr>\n    <tr>\n      <th>end_time</th>\n      <td>7</td>\n    </tr>\n    <tr>\n      <th>path</th>\n      <td>313</td>\n    </tr>\n    <tr>\n      <th>derived_variable</th>\n      <td>0</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"}}},"key":"KyJAs9poEO"}],"key":"clZXHseiJ0"}],"key":"ytVeitAZZF"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Uncomment this line to see all the variables\n# cesm_cat.df['variable'].values","key":"j5e1r2jYRk"},{"type":"outputs","id":"fPmNiSImMueoWloaljYZx","children":[],"key":"y5E3Lg89qb"}],"key":"AFeFzP9J1m"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"cesm_temp = col.search(variable ='TEMP', frequency ='monthly')\ncesm_temp","key":"lXlZ22ynEf"},{"type":"outputs","id":"8UY6R1eT9cTpCsAghDib5","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"},"text/html":{"content":"<p><strong>gdex-cesm2-lens-zarr catalog with 3 dataset(s) from 3 asset(s)</strong>:</p> <div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>unique</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>Unnamed: 0</th>\n      <td>3</td>\n    </tr>\n    <tr>\n      <th>variable</th>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>long_name</th>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>component</th>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>experiment</th>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>forcing_variant</th>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>frequency</th>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>vertical_levels</th>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>spatial_domain</th>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>units</th>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>start_time</th>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>end_time</th>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>path</th>\n      <td>3</td>\n    </tr>\n    <tr>\n      <th>derived_variable</th>\n      <td>0</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"}}},"key":"wadS86Br4D"}],"key":"O6HfKxeCz3"}],"key":"kIs1zQ1Lm2"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"cesm_temp.df['path'].values","key":"E6Tv5VOHzs"},{"type":"outputs","id":"Jf4G2Jn0TjgBGRLX-n4Mi","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":8,"metadata":{},"data":{"text/plain":{"content":"array(['https://osdf-data.gdex.ucar.edu/ncar-gdex/d010092/ocn/monthly/cesm2LE-historical-cmip6-TEMP.zarr',\n       'https://osdf-data.gdex.ucar.edu/ncar-gdex/d010092/ocn/monthly/cesm2LE-ssp370-cmip6-TEMP.zarr',\n       'https://osdf-data.gdex.ucar.edu/ncar-gdex/d010092/ocn/monthly/cesm2LE-ssp370-smbb-TEMP.zarr'],\n      dtype=object)","content_type":"text/plain"}}},"key":"HseC63GThW"}],"key":"iWp4vucg3T"}],"key":"Z1ROUPekz9"},{"type":"block","kind":"notebook-content","children":[{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"eEzOmNWyPQ"}],"key":"Z8Q673lnTS"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Note that all the file paths start with ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"mxvmoUgcJQ"},{"type":"link","url":"https://data-osdf.gdex.ucar.edu","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"https://​data​-osdf​.gdex​.ucar​.edu","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"CmOy7UnuAu"}],"urlSource":"https://data-osdf.gdex.ucar.edu","key":"vm9ZlJI573"},{"type":"text","value":" indicating that the data will be streamed via OSDF","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"xuadNQj5vj"}],"key":"OyiRqwAljg"}],"key":"lABgrpDVc0"}],"key":"hiBcJQEywQ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"dsets_cesm = cesm_temp.to_dataset_dict()","key":"VszzOGfRyP"},{"type":"outputs","id":"Zz4S9VbsHcu1aYDhoYfPc","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stdout","text":"\n--> The keys in the returned dictionary of datasets are constructed as follows:\n\t'component.experiment.frequency.forcing_variant'\n"},"key":"kaatTl47eP"},{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"},"text/html":{"content":"\n<style>\n    /* Turns off some styling */\n    progress {\n        /* gets rid of default border in Firefox and Opera. */\n        border: none;\n        /* Needs to be in here for Safari polyfill so background images work as expected. */\n        background-size: auto;\n    }\n    progress:not([value]), progress:not([value])::-webkit-progress-bar {\n        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);\n    }\n    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {\n        background: #F44336;\n    }\n</style>\n","content_type":"text/html"}}},"key":"tQVfr0J69z"},{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"},"text/html":{"content":"\n    <div>\n      <progress value='0' class='' max='3' style='width:300px; height:20px; vertical-align: middle;'></progress>\n      \n    </div>\n    ","content_type":"text/html"}}},"key":"QsJS2ogceW"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"2026-01-30 01:09:21,573 - distributed.protocol.pickle - ERROR - Failed to serialize 500, message='Internal Server Error', url='https://ucsd-t2-cache.nationalresearchplatform.org:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-ssp370-cmip6-TEMP.zarr/time/0'.\nTraceback (most recent call last):\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/distributed/worker.py\", line 2988, in _run_task_simple\n    result = task(data)\n             ^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/dask/_task_spec.py\", line 767, in __call__\n    return self.func(*new_argspec, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/intake_esm/source.py\", line 82, in _open_dataset\n    ds = xr.open_dataset(url, **xarray_open_kwargs)\n         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/api.py\", line 612, in open_dataset\n    ds = _dataset_from_backend_dataset(\n         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/api.py\", line 302, in _dataset_from_backend_dataset\n    ds = _maybe_create_default_indexes(backend_ds)\n         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/api.py\", line 278, in _maybe_create_default_indexes\n    return ds.assign_coords(Coordinates(to_index))\n                            ^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/core/coordinates.py\", line 315, in __init__\n    index, index_vars = create_default_index_implicit(var, list(coords))\n                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/core/indexes.py\", line 1638, in create_default_index_implicit\n    index = PandasIndex.from_variables(dim_var, options={})\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/core/indexes.py\", line 720, in from_variables\n    data = var._data if isinstance(var._data, PandasIndexingAdapter) else var.data  # type: ignore[redundant-expr]\n                                                                          ^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/core/variable.py\", line 456, in data\n    duck_array = self._data.get_duck_array()\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/core/indexing.py\", line 897, in get_duck_array\n    return self.array.get_duck_array()\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/coding/common.py\", line 80, in get_duck_array\n    return self.func(self.array.get_duck_array())\n                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/coding/common.py\", line 80, in get_duck_array\n    return self.func(self.array.get_duck_array())\n                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/core/indexing.py\", line 737, in get_duck_array\n    array = self.array[self.key]\n            ~~~~~~~~~~^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/zarr.py\", line 262, in __getitem__\n    return indexing.explicit_indexing_adapter(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/core/indexing.py\", line 1129, in explicit_indexing_adapter\n    result = raw_indexing_method(raw_key.tuple)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/zarr.py\", line 225, in _getitem\n    return self._array[key]\n           ~~~~~~~~~~~^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/zarr/core.py\", line 800, in __getitem__\n    result = self.get_basic_selection(pure_selection, fields=fields)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/zarr/core.py\", line 926, in get_basic_selection\n    return self._get_basic_selection_nd(selection=selection, out=out, fields=fields)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/zarr/core.py\", line 968, in _get_basic_selection_nd\n    return self._get_selection(indexer=indexer, out=out, fields=fields)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/zarr/core.py\", line 1343, in _get_selection\n    self._chunk_getitems(\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/zarr/core.py\", line 2179, in _chunk_getitems\n    cdatas = self.chunk_store.getitems(ckeys, contexts=contexts)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/zarr/storage.py\", line 1435, in getitems\n    raise v\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/asyn.py\", line 244, in _run_coro\n    return await asyncio.wait_for(coro, timeout=timeout), i\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/asyncio/tasks.py\", line 520, in wait_for\n    return await fut\n           ^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/implementations/http.py\", line 247, in _cat_file\n    self._raise_not_found_for_status(r, url)\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/implementations/http.py\", line 230, in _raise_not_found_for_status\n    response.raise_for_status()\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/aiohttp/client_reqrep.py\", line 636, in raise_for_status\n    raise ClientResponseError(\naiohttp.client_exceptions.ClientResponseError: 500, message='Internal Server Error', url='https://ucsd-t2-cache.nationalresearchplatform.org:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-ssp370-cmip6-TEMP.zarr/time/0'\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/distributed/protocol/pickle.py\", line 63, in dumps\n    result = pickle.dumps(x, **dump_kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: can't pickle multidict._multidict.CIMultiDictProxy objects\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/distributed/protocol/pickle.py\", line 68, in dumps\n    pickler.dump(x)\nTypeError: can't pickle multidict._multidict.CIMultiDictProxy objects\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/distributed/protocol/pickle.py\", line 80, in dumps\n    result = cloudpickle.dumps(x, **dump_kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/cloudpickle/cloudpickle.py\", line 1544, in dumps\n    cp.dump(obj)\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/cloudpickle/cloudpickle.py\", line 1313, in dump\n    return super().dump(obj)\n           ^^^^^^^^^^^^^^^^^\nTypeError: can't pickle multidict._multidict.CIMultiDictProxy objects\n"},"key":"Ugvoa6xvmu"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"2026-01-30 01:09:22,069 - distributed.worker - ERROR - Compute Failed\nKey:       _open_dataset-78666277-b0a9-48c6-8fc3-696ca067a869\nState:     executing\nTask:  <Task '_open_dataset-78666277-b0a9-48c6-8fc3-696ca067a869' _open_dataset(..., ...)>\nException: 'ClientResponseError(RequestInfo(url=URL(\\'https://ucsd-t2-cache.nationalresearchplatform.org:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-ssp370-cmip6-TEMP.zarr/time/0\\'), method=\\'GET\\', headers=<CIMultiDictProxy(\\'Host\\': \\'ucsd-t2-cache.nationalresearchplatform.org:8443\\', \\'Accept\\': \\'*/*\\', \\'Accept-Encoding\\': \\'gzip, deflate, br, zstd\\', \\'User-Agent\\': \\'Python/3.12 aiohttp/3.13.3\\')>, real_url=URL(\\'https://ucsd-t2-cache.nationalresearchplatform.org:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-ssp370-cmip6-TEMP.zarr/time/0\\')), (<ClientResponse(https://osdf-data.gdex.ucar.edu/ncar-gdex/d010092/ocn/monthly/cesm2LE-ssp370-cmip6-TEMP.zarr/time/0) [301 Moved Permanently]>\\n<CIMultiDictProxy(\\'Server\\': \\'nginx/1.27.0\\', \\'Date\\': \\'Fri, 30 Jan 2026 01:09:12 GMT\\', \\'Content-Type\\': \\'text/html\\', \\'Content-Length\\': \\'169\\', \\'Connection\\': \\'keep-alive\\', \\'Location\\': \\'https://osdf-director.osg-htc.org:443/ncar-gdex/d010092/ocn/monthly/cesm2LE-ssp370-cmip6-TEMP.zarr/time/0\\')>\\n, <ClientResponse(https://osdf-director.osg-htc.org/ncar-gdex/d010092/ocn/monthly/cesm2LE-ssp370-cmip6-TEMP.zarr/time/0) [307 Temporary Redirect]>\\n<CIMultiDictProxy(\\'Access-Control-Allow-Headers\\': \\'Content-Type, Authorization, Depth\\', \\'Access-Control-Allow-Methods\\': \\'GET, PUT, PROPFIND, OPTIONS\\', \\'Access-Control-Allow-Origin\\': \\'*\\', \\'Access-Control-Expose-Headers\\': \\'Content-Type, Authorization, X-Pelican-User, X-Pelican-Timeout, X-Pelican-Token-Generation, X-Pelican-Authorization, X-Pelican-Namespace\\', \\'Content-Length\\': \\'159\\', \\'Content-Type\\': \\'text/html; charset=utf-8\\', \\'Date\\': \\'Fri, 30 Jan 2026 01:09:12 GMT\\', \\'Link\\': \\'<https://ucsd-t2-cache.nationalresearchplatform.org:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-ssp370-cmip6-TEMP.zarr/time/0>; rel=\"duplicate\"; pri=1; depth=6, <https://sdsc-cache.nationalresearchplatform.org:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-ssp370-cmip6-TEMP.zarr/time/0>; rel=\"duplicate\"; pri=2; depth=6, <https://osg-sunnyvale-stashcache.nrp.internet2.edu:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-ssp370-cmip6-TEMP.zarr/time/0>; rel=\"duplicate\"; pri=3; depth=6, <https://fdp-d3d-cache.nationalresearchplatform.org:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-ssp370-cmip6-TEMP.zarr/time/0>; rel=\"duplicate\"; pri=4; depth=6, <https://osdf-cache.ligo-wa.caltech.edu:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-ssp370-cmip6-TEMP.zarr/time/0>; rel=\"duplicate\"; pri=5; depth=6, <https://dtn-pas.kans.nrp.internet2.edu:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-ssp370-cmip6-TEMP.zarr/time/0>; rel=\"duplicate\"; pri=6; depth=6\\', \\'Location\\': \\'https://ucsd-t2-cache.nationalresearchplatform.org:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-ssp370-cmip6-TEMP.zarr/time/0\\', \\'Server\\': \\'pelican/7.22.0\\', \\'X-Pelican-Authorization\\': \\'issuer=https://ncar-s3-origin.nationalresearchplatform.org:8000\\', \\'X-Pelican-Jobid\\': \\'82a0fe3a-04d8-46f0-b6a6-e4e0f29cf685\\', \\'X-Pelican-Namespace\\': \\'namespace=/ncar-gdex, require-token=false, collections-url=https://ncar-s3-origin.nationalresearchplatform.org:8444\\', \\'X-Pelican-Token-Generation\\': \\'issuer=https://ncar-s3-origin.nationalresearchplatform.org:8000, max-scope-depth=3, strategy=OAuth2, base-path=/ncar-gdex\\')>\\n), status=500, message=\\'Internal Server Error\\', headers=<CIMultiDictProxy(\\'Connection\\': \\'Close\\', \\'Server\\': \\'XrootD/v5.9.1\\', \\'Access-Control-Allow-Origin\\': \\'*\\', \\'Access-Control-Allow-Headers\\': \\'Authorization,Want-Digest,Content-Type,User-Agent\\', \\'Content-Length\\': \\'99\\')>)'\nTraceback: '  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/intake_esm/source.py\", line 82, in _open_dataset\\n    ds = xr.open_dataset(url, **xarray_open_kwargs)\\n         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/api.py\", line 612, in open_dataset\\n    ds = _dataset_from_backend_dataset(\\n         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/api.py\", line 302, in _dataset_from_backend_dataset\\n    ds = _maybe_create_default_indexes(backend_ds)\\n         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/api.py\", line 278, in _maybe_create_default_indexes\\n    return ds.assign_coords(Coordinates(to_index))\\n                            ^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/core/coordinates.py\", line 315, in __init__\\n    index, index_vars = create_default_index_implicit(var, list(coords))\\n                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/core/indexes.py\", line 1638, in create_default_index_implicit\\n    index = PandasIndex.from_variables(dim_var, options={})\\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/core/indexes.py\", line 720, in from_variables\\n    data = var._data if isinstance(var._data, PandasIndexingAdapter) else var.data  # type: ignore[redundant-expr]\\n                                                                          ^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/core/variable.py\", line 456, in data\\n    duck_array = self._data.get_duck_array()\\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/core/indexing.py\", line 897, in get_duck_array\\n    return self.array.get_duck_array()\\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/coding/common.py\", line 80, in get_duck_array\\n    return self.func(self.array.get_duck_array())\\n                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/coding/common.py\", line 80, in get_duck_array\\n    return self.func(self.array.get_duck_array())\\n                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/core/indexing.py\", line 737, in get_duck_array\\n    array = self.array[self.key]\\n            ~~~~~~~~~~^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/zarr.py\", line 262, in __getitem__\\n    return indexing.explicit_indexing_adapter(\\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/core/indexing.py\", line 1129, in explicit_indexing_adapter\\n    result = raw_indexing_method(raw_key.tuple)\\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/zarr.py\", line 225, in _getitem\\n    return self._array[key]\\n           ~~~~~~~~~~~^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/zarr/core.py\", line 800, in __getitem__\\n    result = self.get_basic_selection(pure_selection, fields=fields)\\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/zarr/core.py\", line 926, in get_basic_selection\\n    return self._get_basic_selection_nd(selection=selection, out=out, fields=fields)\\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/zarr/core.py\", line 968, in _get_basic_selection_nd\\n    return self._get_selection(indexer=indexer, out=out, fields=fields)\\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/zarr/core.py\", line 1343, in _get_selection\\n    self._chunk_getitems(\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/zarr/core.py\", line 2179, in _chunk_getitems\\n    cdatas = self.chunk_store.getitems(ckeys, contexts=contexts)\\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/zarr/storage.py\", line 1435, in getitems\\n    raise v\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/asyn.py\", line 244, in _run_coro\\n    return await asyncio.wait_for(coro, timeout=timeout), i\\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/asyncio/tasks.py\", line 520, in wait_for\\n    return await fut\\n           ^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/implementations/http.py\", line 247, in _cat_file\\n    self._raise_not_found_for_status(r, url)\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/implementations/http.py\", line 230, in _raise_not_found_for_status\\n    response.raise_for_status()\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/aiohttp/client_reqrep.py\", line 636, in raise_for_status\\n    raise ClientResponseError(\\n'\n\n"},"key":"EhYMhPsKgf"},{"type":"output","children":[],"jupyter_data":{"output_type":"error","traceback":"\u001b[31m--------------------------------------------------------...","ename":"ESMDataSourceError","evalue":"Failed to load dataset with key='ocn.ssp370.monthly.cmip6'\n                 You can use `cat['ocn.ssp370.monthly.cmip6'].df` to inspect the assets/files for this key.\n                 ","hash":"7d18b14cf417e368770aafcbea83b9e3","path":"/osdf-cookbook/build/7d18b14cf417e368770aafcbea83b9e3.txt"},"key":"xqumg89hJC"}],"key":"ESya6hVzlq"}],"key":"NC7bNYw19J"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"dsets_cesm.keys()","key":"c0fUrXL6cw"},{"type":"outputs","id":"IkTlJ6E4BIOV_Q8FtjLM8","children":[],"key":"hvddCvjkPY"}],"key":"fLogoaUo4Y"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"historical       = dsets_cesm['ocn.historical.monthly.cmip6']\nfuture_smbb      = dsets_cesm['ocn.ssp370.monthly.smbb']\nfuture_cmip6     = dsets_cesm['ocn.ssp370.monthly.cmip6']","key":"ub6dDTnI7b"},{"type":"outputs","id":"TaWB0odB3TlMo5syhuogX","children":[],"key":"L28uysPyrW"}],"key":"iMB2pOOlzY"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Change units","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dOcZSqDxiF"}],"identifier":"change-units","label":"Change units","html_id":"change-units","implicit":true,"key":"Xa5fqqsHxP"}],"key":"k0agsYlaTD"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"orig_units = cf.Unit(historical.z_t.attrs['units'])\norig_units","key":"WGcxUJz0EY"},{"type":"outputs","id":"bPagl1cRpc2t-b9VuEcJI","children":[],"key":"xxwZBBJLiq"}],"key":"q13LCZwOBJ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def change_units(ds, variable_str, variable_bounds_str, target_unit_str):\n    orig_units = cf.Unit(ds[variable_str].attrs['units'])\n    target_units = cf.Unit(target_unit_str)\n    variable_in_new_units = xr.apply_ufunc(orig_units.convert, ds[variable_bounds_str], target_units, dask='parallelized', output_dtypes=[ds[variable_bounds_str].dtype])\n    return variable_in_new_units","key":"r8BsMcHdwR"},{"type":"outputs","id":"pefWOyf1kX36gNA2TJP6q","children":[],"key":"FSAlseV3lf"}],"key":"E72baGwMxG"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"depth_levels_in_m = change_units(historical, 'z_t', 'z_t', 'm')\nhist_temp_in_degK = change_units(historical, 'TEMP', 'TEMP', 'degK')\nfut_cmip6_temp_in_degK = change_units(future_cmip6, 'TEMP', 'TEMP', 'degK')\nfut_smbb_temp_in_degK = change_units(future_smbb, 'TEMP', 'TEMP', 'degK')\n#\nhist_temp_in_degK  = hist_temp_in_degK.assign_coords(z_t=(\"z_t\", depth_levels_in_m['z_t'].data))\nhist_temp_in_degK[\"z_t\"].attrs[\"units\"] = \"m\"\nhist_temp_in_degK","key":"ZfBhTNLgT1"},{"type":"outputs","id":"GQUwyMdet7K2rUHXboP8c","children":[],"key":"h90jKY72LN"}],"key":"n0MM1BZF9G"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"depth_levels_in_m.isel(z_t=slice(0, -1))","key":"aV1jmIkeEI"},{"type":"outputs","id":"f0z2R5LOMjd8wlJRrepPr","children":[],"key":"o12p0SnVSA"}],"key":"nzviZCcSGX"},{"type":"block","kind":"notebook-content","children":[{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Compute depth level deltas using the difference of z_t levels","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Yh4EAze9zz"}],"key":"gKgmoP3LEM"}],"key":"mgalaSEB7V"}],"key":"rQdNHxFUkv"}],"key":"iQIsMqpe19"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"depth_level_deltas = depth_levels_in_m.isel(z_t=slice(1, None)).values - depth_levels_in_m.isel(z_t=slice(0, -1)).values\n# Optionally, if you want to keep it as an xarray DataArray, re-wrap the result\ndepth_level_deltas = xr.DataArray(depth_level_deltas, dims=[\"z_t\"], coords={\"z_t\": depth_levels_in_m.z_t.isel(z_t=slice(0, -1))})\ndepth_level_deltas  ","key":"KoU8WygljC"},{"type":"outputs","id":"xXCcYhzp18eZ36kdpnHI6","children":[],"key":"kxasUCEdis"}],"key":"rBDjO1sk13"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Compute Ocean Heat content for ocean surface","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Wx8ehGkuPl"}],"identifier":"compute-ocean-heat-content-for-ocean-surface","label":"Compute Ocean Heat content for ocean surface","html_id":"compute-ocean-heat-content-for-ocean-surface","implicit":true,"key":"le6WSwaZ3I"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Ocean surface is considered to be the top 100m","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"UVbrUR7LO4"}],"key":"vjvQUl4Kqe"}],"key":"zrOPpXuU27"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The formula for this is: ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"wW9saKk2Oz"}],"key":"mFsu9cS8MJ"},{"type":"math","value":"H = \\rho C \\int_0^z T(z) dz","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>H</mi><mo>=</mo><mi>ρ</mi><mi>C</mi><msubsup><mo>∫</mo><mn>0</mn><mi>z</mi></msubsup><mi>T</mi><mo stretchy=\"false\">(</mo><mi>z</mi><mo stretchy=\"false\">)</mo><mi>d</mi><mi>z</mi></mrow><annotation encoding=\"application/x-tex\">H = \\rho C \\int_0^z T(z) dz</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.3262em;vertical-align:-0.9119em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">ρC</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\"><span class=\"mop op-symbol large-op\" style=\"margin-right:0.44445em;position:relative;top:-0.0011em;\">∫</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.4143em;\"><span style=\"top:-1.7881em;margin-left:-0.4445em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span><span style=\"top:-3.8129em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.04398em;\">z</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9119em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span><span class=\"mclose\">)</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span></span></span></span></span>","enumerator":"1","key":"liPUV5sc6a"}],"key":"yVlReI0TtO"}],"key":"CPc70pVEoq"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Where H is ocean heat content, the value we are trying to calculate,","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"hs7jCfvSU8"}],"key":"kuA64swxRL"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"inlineMath","value":"\\rho","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ρ</mi></mrow><annotation encoding=\"application/x-tex\">\\rho</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">ρ</span></span></span></span>","key":"pL5iZTLzwp"},{"type":"text","value":" is the density of sea water, ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"ztv0bm81Xk"},{"type":"inlineMath","value":"1026 kg/m^3","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1026</mn><mi>k</mi><mi>g</mi><mi mathvariant=\"normal\">/</mi><msup><mi>m</mi><mn>3</mn></msup></mrow><annotation encoding=\"application/x-tex\">1026 kg/m^3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord\">1026</span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord\">/</span><span class=\"mord\"><span class=\"mord mathnormal\">m</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span></span></span></span></span></span></span></span>","key":"pxhxr8VVTe"},{"type":"text","value":"  ,","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"WFfvLPkJcN"}],"key":"fOA5rhWT5h"},{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"inlineMath","value":"C","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>C</mi></mrow><annotation encoding=\"application/x-tex\">C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span></span></span></span>","key":"cLIF7gCi7X"},{"type":"text","value":" is the specific heat of sea water, ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"xAzY1LBBFs"},{"type":"inlineMath","value":"3990 J/(kg K)","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3990</mn><mi>J</mi><mi mathvariant=\"normal\">/</mi><mo stretchy=\"false\">(</mo><mi>k</mi><mi>g</mi><mi>K</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">3990 J/(kg K)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">3990</span><span class=\"mord mathnormal\" style=\"margin-right:0.09618em;\">J</span><span class=\"mord\">/</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mclose\">)</span></span></span></span>","key":"WaR5ymUXb6"},{"type":"text","value":"  ,","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"gw3S7Smg5J"}],"key":"zlS0pZlTiu"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"inlineMath","value":"z","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>z</mi></mrow><annotation encoding=\"application/x-tex\">z</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span></span></span></span>","key":"be7ohzM53o"},{"type":"text","value":" is the depth limit of the calculation in meters,","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"KYisyqXVan"}],"key":"jUUvDAgiWa"},{"type":"paragraph","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"and ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"bIB8Fk8V2M"},{"type":"inlineMath","value":"T(z)","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>T</mi><mo stretchy=\"false\">(</mo><mi>z</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">T(z)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span><span class=\"mclose\">)</span></span></span></span>","key":"Kw0cy1SGPI"},{"type":"text","value":" is the temperature at each depth in degrees Kelvin.","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"qIvvxLoHoI"}],"key":"K8zIxn1e9f"}],"key":"W8FJ2NpN0X"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def calc_ocean_heat(delta_level, temperature):\n    rho = 1026 #kg/m^3\n    c_p = 3990 #J/(kg K)\n    weighted_temperature = delta_level * temperature\n    heat = weighted_temperature.sum(dim=\"z_t\")*rho*c_p\n    return heat","key":"chwUW5dp5q"},{"type":"outputs","id":"jOBzpP6Kr_su8DwDTy-r4","children":[],"key":"eNQfryA6eT"}],"key":"JY7zkA25bg"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Remember that the coordinate z_t still has values in cm\nhist_temp_ocean_surface = hist_temp_in_degK.where(hist_temp_in_degK['z_t'] < 1e4,drop=True)\nhist_temp_ocean_surface","key":"ixP7vELFXr"},{"type":"outputs","id":"nOI2u2qj7YMqq3HlzkYdM","children":[],"key":"BF3yw8OWR8"}],"key":"qi7JVNfp31"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"depth_level_deltas_surface = depth_level_deltas.where(depth_level_deltas['z_t'] <1e4, drop= True)\ndepth_level_deltas_surface","key":"Qe8bG9vMEk"},{"type":"outputs","id":"Crf88FFMK1Vkmn7-0wwEr","children":[],"key":"AcYvig3ecq"}],"key":"rRbcy43yfy"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"hist_ocean_heat = calc_ocean_heat(depth_level_deltas_surface,hist_temp_ocean_surface)\nhist_ocean_heat","key":"xD1Cw3fi0I"},{"type":"outputs","id":"fJ9p8yiZ0jqraPUOaI6qY","children":[],"key":"aMbhYRUqXK"}],"key":"BDTc3dja5N"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot Ocean Heat","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LpvNynTFb4"}],"identifier":"plot-ocean-heat","label":"Plot Ocean Heat","html_id":"plot-ocean-heat","implicit":true,"key":"rVlsB6m4zn"}],"key":"ij7WbxqJok"},{"type":"block","kind":"notebook-content","children":[{"type":"admonition","kind":"attention","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Attention","key":"T4xsTOHHsC"}],"key":"IweDHRb2LP"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Has the surface ocean heat content increased with time due to Global Warming ?\nLet us plot the difference between the annual, ensemble mean heat content between the years 2014 and 1850 to check!","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"QOasT4tFeh"}],"key":"H8vZwtHh8u"}],"key":"RlcgFMxTGm"}],"key":"Z9fogUi2a2"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%%time\n# Compute annual and ensemble mean\nhist_oceanheat_ann_mean = hist_ocean_heat.mean('member_id').groupby('time.year').mean()\nhist_oceanheat_ann_mean ","key":"JhaDUbf7hR"},{"type":"outputs","id":"zkL2E79yUPL8coqG0IYcZ","children":[],"key":"EnhVyBoYyz"}],"key":"Tmbma69bvP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"hist_oceanheat_ano = \\\nhist_oceanheat_ann_mean.sel(year=2014) - hist_oceanheat_ann_mean.sel(year=1850)","key":"NVSh97dAa2"},{"type":"outputs","id":"KVzHI53JwawFSVtASxSAf","children":[],"key":"DSMDstPOwF"}],"key":"OH34RlNhVf"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%%time\nhist_oceanheat_ano.plot()","key":"dydiPGscRU"},{"type":"outputs","id":"yM5XLBFIFP0dwYGlgoy_m","children":[],"key":"ZB7rDFMg05"}],"key":"t2QdqD88Mr"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Indeed! The surface ocean is trapping heat as the globe warms!","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bRzI4tfhUC"}],"key":"qBFtdvOQa4"}],"key":"zKs53a4nuv"},{"type":"block","kind":"notebook-content","children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"l4cjUEP3wJ"}],"key":"AYD8CqzMVk"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Summary","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"C8gmszRlcw"}],"identifier":"summary","label":"Summary","html_id":"summary","implicit":true,"key":"BqqMDJU9FQ"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"In this notebook we used sea temperature data from the Community Earth System Model (CESM2) Large Ensemble dataset to compute surface ocean heat and convince ourselves that the surface ocean is trapping extra heat as the globe warms. We used an intake-ESM catalog backed by pelican links to stream data from NCAR’s Geoscience Data Exchange via NCAR’s OSDF origin!","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"McVNfCcaVP"}],"key":"ASEXohIg3q"},{"type":"heading","depth":4,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"What’s next?","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"BNyqC9rdul"}],"identifier":"whats-next","label":"What’s next?","html_id":"whats-next","implicit":true,"key":"zR6QUEmg6g"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"In the next notebook, we will see how to load data from multiple OSDF origins into a workflow. We will stream CMIP6 model data from AWS and observational data from NCAR’s GDEX.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"R7XwOLsPd4"}],"key":"C740rPPHuJ"}],"key":"A31B7xddpj"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Resources and references","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PwR7hKDqDV"}],"identifier":"resources-and-references","label":"Resources and references","html_id":"resources-and-references","implicit":true,"key":"DguDUeBzUI"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Original ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"yi8wEj4kfp"},{"type":"link","url":"https://gallery.pangeo.io/repos/NCAR/notebook-gallery/notebooks/Run-Anywhere/Ocean-Heat-Content/OHC_tutorial.html","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"notebook","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"TDKHslu4wj"}],"urlSource":"https://gallery.pangeo.io/repos/NCAR/notebook-gallery/notebooks/Run-Anywhere/Ocean-Heat-Content/OHC_tutorial.html","key":"x0DiAGhPAd"},{"type":"text","value":" on the pangeo NCAR gallery","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"LuyJZJox5r"}],"key":"n639ivhfDl"}],"key":"QfbWw3DEjt"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"link","url":"https://www.cesm.ucar.edu/community-projects/lens2","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"CESM2 Large Ensemble Dataset","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"BNwiPzfeC0"}],"urlSource":"https://www.cesm.ucar.edu/community-projects/lens2","key":"wzOwYSaQn4"},{"type":"text","value":" (Community Earth System Model 2) hosted on NCAR’s GDEX.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fCyrv7IpZG"}],"key":"RAtb4vxxdF"}],"key":"Fgzz4g6Wdu"}],"key":"hgCecO967E"}],"key":"wdrk8fAG8n"}],"key":"BmiH1dFZ76"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Introduction to NSF NCAR’s Geoscience Data Exhcange","url":"/notebooks/ncar-intro","group":"NCAR examples"},"next":{"title":"Global Mean Surface Temperature Anomalies (GMSTA) from CMIP6 data","url":"/notebooks/cmip6-gmst","group":"NCAR examples"}}},"domain":"http://localhost:3000"}