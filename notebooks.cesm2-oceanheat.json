{"version":2,"kind":"Notebook","sha256":"29067d8abe1ad17246b01a809c5ae8aca88b472c5217a5c01d71900095723903","slug":"notebooks.cesm2-oceanheat","location":"/notebooks/02_cesm2_oceanheat.ipynb","dependencies":[],"frontmatter":{"title":"Calculate Surface Ocean Heat using CESM2 LENS data","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"authors":[{"nameParsed":{"literal":"Harsha R. Hampapura","given":"Harsha R.","family":"Hampapura"},"name":"Harsha R. Hampapura","id":"contributors-myst-generated-uid-0"},{"nameParsed":{"literal":"Brian Bockelman","given":"Brian","family":"Bockelman"},"name":"Brian Bockelman","id":"contributors-myst-generated-uid-1"},{"nameParsed":{"literal":"Alexander Hoelzeman","given":"Alexander","family":"Hoelzeman"},"name":"Alexander Hoelzeman","id":"contributors-myst-generated-uid-2"},{"nameParsed":{"literal":"Carrie Wall","given":"Carrie","family":"Wall"},"name":"Carrie Wall","id":"contributors-myst-generated-uid-3"},{"nameParsed":{"literal":"Emma Turetsky","given":"Emma","family":"Turetsky"},"name":"Emma Turetsky","id":"contributors-myst-generated-uid-4"},{"nameParsed":{"literal":"Amandha Wingert Barok","given":"Amandha Wingert","family":"Barok"},"name":"Amandha Wingert Barok","id":"contributors-myst-generated-uid-5"},{"nameParsed":{"literal":"Aashish Panta","given":"Aashish","family":"Panta"},"name":"Aashish Panta","id":"contributors-myst-generated-uid-6"},{"nameParsed":{"literal":"Riley Conroy","given":"Riley","family":"Conroy"},"name":"Riley Conroy","id":"contributors-myst-generated-uid-7"},{"nameParsed":{"literal":"Douglas Schuster","given":"Douglas","family":"Schuster"},"name":"Douglas Schuster","id":"contributors-myst-generated-uid-8"},{"nameParsed":{"literal":"Justin Hiemstra","given":"Justin","family":"Hiemstra"},"name":"Justin Hiemstra","id":"contributors-myst-generated-uid-9"},{"nameParsed":{"literal":"Joanmarie Del Vecchio","given":"Joanmarie Del","family":"Vecchio"},"name":"Joanmarie Del Vecchio","id":"contributors-myst-generated-uid-10"},{"nameParsed":{"literal":"Kibiwott Koech","given":"Kibiwott","family":"Koech"},"name":"Kibiwott Koech","id":"contributors-myst-generated-uid-11"}],"open_access":true,"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true},"code":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true}},"github":"https://github.com/projectpythia/osdf-cookbook","copyright":"2024","affiliations":[{"id":"UAlbany","name":"University at Albany (SUNY)","department":"Atmospheric and Environmental Sciences","url":"https://www.albany.edu/daes"},{"id":"CISL","name":"NSF National Center for Atmospheric Research","department":"Computational and Information Systems Lab","url":"https://www.cisl.ucar.edu"},{"id":"Unidata","name":"NSF Unidata","url":"https://www.unidata.ucar.edu"},{"id":"Argonne","name":"Argonne National Laboratory","department":"Environmental Science Division","url":"https://www.anl.gov/evs"},{"id":"CarbonPlan","name":"CarbonPlan","url":"https://carbonplan.org"},{"id":"NVIDIA","name":"NVIDIA Corporation","url":"https://www.nvidia.com/"}],"numbering":{"title":{"offset":1}},"source_url":"https://github.com/projectpythia/osdf-cookbook/blob/main/notebooks/02_cesm2_oceanheat.ipynb","edit_url":"https://github.com/projectpythia/osdf-cookbook/edit/main/notebooks/02_cesm2_oceanheat.ipynb","exports":[{"format":"ipynb","filename":"02_cesm2_oceanheat.ipynb","url":"/osdf-cookbook/build/02_cesm2_oceanheat-59b1393753d5cb8bfc431bb27d70d9b0.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ibr8pmE2qn"}],"key":"ooMzjZVSrs"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Overview","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NA3DrZ6821"}],"identifier":"overview","label":"Overview","html_id":"overview","implicit":true,"key":"vanpbHd1Ua"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"This notebook is an adpation of a ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"VbWKa6m6jY"},{"type":"link","url":"https://gallery.pangeo.io/repos/NCAR/notebook-gallery/notebooks/Run-Anywhere/Ocean-Heat-Content/OHC_tutorial.html","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"workflow","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Xg1gVipCvp"}],"urlSource":"https://gallery.pangeo.io/repos/NCAR/notebook-gallery/notebooks/Run-Anywhere/Ocean-Heat-Content/OHC_tutorial.html","key":"TBreXUAdEO"},{"type":"text","value":" in the NCAR gallery of the Pangeo collection","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Ok3bVMdFYz"}],"key":"KgovPqywyq"}],"key":"bVOZk1iYYM"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"This notebook illustrates how to compute surface ocean heat content using potential temperature data from ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"w2DxOuiAF1"},{"type":"link","url":"https://www.cesm.ucar.edu/community-projects/lens2","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"CESM2 Large Ensemble Dataset","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"s00pdBfLOt"}],"urlSource":"https://www.cesm.ucar.edu/community-projects/lens2","key":"rl3G31bD5c"},{"type":"text","value":" (Community Earth System Model 2) hosted on NCAR’s GDEX.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"j4ajao3ywl"}],"key":"BcNTaruo8q"}],"key":"FvQMzdhCNJ"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"This data is open access and is accessed via OSDF using the pelicanFS package and demonstrates how you can stream data from NCAR’s GDEX","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"TE6lvLFyv0"}],"key":"SjGtFsRAoq"}],"key":"TM4IlAW3OC"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Please refer to the first chapter of this cookbook to learn more about OSDF, pelican or pelicanFS","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"TKNDUDegvu"}],"key":"RuVgWNdcqq"}],"key":"UHY3aBUjbq"}],"key":"XQIkmONkCp"}],"key":"jxQCP5aJYb"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Prerequisites","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"aZ5JZqqn5V"}],"identifier":"prerequisites","label":"Prerequisites","html_id":"prerequisites","implicit":true,"key":"lDK99Lq2X7"},{"type":"table","position":{"start":{"line":2,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"tableRow","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"tableCell","header":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Concepts","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"p0D9Cmua3l"}],"key":"AUVWdihel8"},{"type":"tableCell","header":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Importance","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"ITsj1YM4nk"}],"key":"n92DQVfLBR"},{"type":"tableCell","header":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Notes","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"EZsdt99eHk"}],"key":"RL9l6d6Kyc"}],"key":"mBZl5MEsuo"},{"type":"tableRow","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"link","url":"https://foundations.projectpythia.org/core/cartopy/cartopy","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Intro to Intake-ESM","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"ayANmjslUf"}],"urlSource":"https://foundations.projectpythia.org/core/cartopy/cartopy","key":"L7joOSFreP"}],"key":"EDb94JaoEs"},{"type":"tableCell","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Necessary","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"zalwkplJ8y"}],"key":"jRZkgkih3C"},{"type":"tableCell","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Used for searching CMIP6 data","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"MEydJjLS6z"}],"key":"yNVYFwDhu8"}],"key":"aXx2chg6ie"},{"type":"tableRow","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"link","url":"https://zarr.dev/","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Understanding of Zarr","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Pd7rE8Bns9"}],"urlSource":"https://zarr.dev/","key":"RYLotfcb29"}],"key":"vZnn8ZJL3T"},{"type":"tableCell","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Helpful","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"H06Xa2Ya3v"}],"key":"CYZnKuXZQZ"},{"type":"tableCell","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Familiarity with metadata structure","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"hE6zKDf8sh"}],"key":"BS4Aw9eILf"}],"key":"Q4IGQZG0Vv"},{"type":"tableRow","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"link","url":"https://foundations.projectpythia.org/core/matplotlib/","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Matplotlib","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"Co33xQCBgn"}],"urlSource":"https://foundations.projectpythia.org/core/matplotlib/","key":"jXwj2IBDSS"}],"key":"cLrJK8USpN"},{"type":"tableCell","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Helpful","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"CW1QEXLmpe"}],"key":"deLwU51bnP"},{"type":"tableCell","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Package used for plotting","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"jqY9zWys7b"}],"key":"rYtRTXh62G"}],"key":"oj5rEc0FXH"},{"type":"tableRow","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"link","url":"https://projectpythia.org/osdf-cookbook/notebooks/pelicanfs/","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"PelicanFS","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"pfDEaD4ecR"}],"urlSource":"https://projectpythia.org/osdf-cookbook/notebooks/pelicanfs/","key":"XacBpK0Shy"}],"key":"UdqP9EatwI"},{"type":"tableCell","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Necessary","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"pA65Ty1dtI"}],"key":"VUosSAAk0N"},{"type":"tableCell","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"The python package used to stream data in this notebook","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"ZjY7Q5t8PS"}],"key":"bOPIstE94P"}],"key":"mIY5LcGsfM"},{"type":"tableRow","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"OSDF","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"mIbvIx8fsX"}],"key":"hA7Pax4d3Q"},{"type":"tableCell","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Helpful","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"kqes85nCrk"}],"key":"y2NhqbcbKt"},{"type":"tableCell","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"OSDF is used to stream data in this notebook","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"ScOUJY4XFg"}],"key":"ggXan4dOBa"}],"key":"oxPmAgfpbI"}],"key":"AswgKGFJGa"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Time to learn","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"CWnXVUzI2U"}],"key":"OdNOjK8brR"},{"type":"text","value":": 20 mins","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"IySv82YfJF"}],"key":"C57okwMRyX"}],"key":"V3A14DyIL6"}],"key":"ZEVBeiin13"}],"key":"Xm2Bke38Yo"},{"type":"block","kind":"notebook-content","children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Qg9k1FmsOW"}],"key":"MURgxUKrZC"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Imports","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"k3dAeuPFhf"}],"identifier":"imports","label":"Imports","html_id":"imports","implicit":true,"key":"dIt6i2Vc4Y"}],"key":"ogebJKaFbi"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import intake\nimport numpy as np\nimport pandas as pd\nimport xarray as xr\nimport seaborn as sns\nimport re\nimport matplotlib.pyplot as plt\nimport dask\nfrom dask.distributed import LocalCluster\nimport pelicanfs \nimport cf_units as cf","key":"yy5XQb8iGy"},{"type":"output","id":"LnMYE9ch92HdIpGfg5O90","data":[],"key":"VxglgUkxLE"}],"key":"UdYCYQFkDK"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Load Catalog URL\ncat_url = 'https://stratus.gdex.ucar.edu/d010092/catalogs/d010092-osdf-zarr.json'","key":"Q810ybs4Ab"},{"type":"output","id":"55HBhoVLCwFfGWbOd6Fg3","data":[],"key":"BcVIq3IKEn"}],"key":"EBcITy9jtU"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Set up local dask cluster","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"T5LsikhEz7"}],"identifier":"set-up-local-dask-cluster","label":"Set up local dask cluster","html_id":"set-up-local-dask-cluster","implicit":true,"key":"atQT3SHI54"}],"key":"XKjoZ0oMDz"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Before we do any computation let us first set up a local cluster using dask","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DXp3gue989"}],"key":"TMETyEDmaS"}],"key":"rP6DxB9tE3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"cluster = LocalCluster()          \nclient = cluster.get_client()","key":"FrQXNCHPml"},{"type":"output","id":"VRAEcG_LUSA8wMZzFGb2-","data":[],"key":"lh0illCzRa"}],"key":"w2QKyb5vFI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Scale the cluster\nn_workers = 5\ncluster.scale(n_workers)\ncluster","key":"dm5n6EREbq"},{"type":"output","id":"Fe6YLd5cw3N7255HvVFL2","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"LocalCluster(6d5ef200, 'tcp://127.0.0.1:37819', workers=4, threads=4, memory=15.62 GiB)","content_type":"text/plain"},"text/html":{"content":"<div class=\"jp-RenderedHTMLCommon jp-RenderedHTML jp-mod-trusted jp-OutputArea-output\">\n    <div style=\"width: 24px; height: 24px; background-color: #e1e1e1; border: 3px solid #9D9D9D; border-radius: 5px; position: absolute;\">\n    </div>\n    <div style=\"margin-left: 48px;\">\n        <h3 style=\"margin-bottom: 0px; margin-top: 0px;\">LocalCluster</h3>\n        <p style=\"color: #9D9D9D; margin-bottom: 0px;\">6d5ef200</p>\n        <table style=\"width: 100%; text-align: left;\">\n            <tr>\n                <td style=\"text-align: left;\">\n                    <strong>Dashboard:</strong> <a href=\"http://127.0.0.1:8787/status\" target=\"_blank\">http://127.0.0.1:8787/status</a>\n                </td>\n                <td style=\"text-align: left;\">\n                    <strong>Workers:</strong> 4\n                </td>\n            </tr>\n            <tr>\n                <td style=\"text-align: left;\">\n                    <strong>Total threads:</strong> 4\n                </td>\n                <td style=\"text-align: left;\">\n                    <strong>Total memory:</strong> 15.62 GiB\n                </td>\n            </tr>\n            \n            <tr>\n    <td style=\"text-align: left;\"><strong>Status:</strong> running</td>\n    <td style=\"text-align: left;\"><strong>Using processes:</strong> True</td>\n</tr>\n\n            \n        </table>\n\n        <details>\n            <summary style=\"margin-bottom: 20px;\">\n                <h3 style=\"display: inline;\">Scheduler Info</h3>\n            </summary>\n\n            <div style=\"\">\n    <div>\n        <div style=\"width: 24px; height: 24px; background-color: #FFF7E5; border: 3px solid #FF6132; border-radius: 5px; position: absolute;\"> </div>\n        <div style=\"margin-left: 48px;\">\n            <h3 style=\"margin-bottom: 0px;\">Scheduler</h3>\n            <p style=\"color: #9D9D9D; margin-bottom: 0px;\">Scheduler-4a4b3f01-4519-4e0d-83be-b41def86f7cb</p>\n            <table style=\"width: 100%; text-align: left;\">\n                <tr>\n                    <td style=\"text-align: left;\">\n                        <strong>Comm:</strong> tcp://127.0.0.1:37819\n                    </td>\n                    <td style=\"text-align: left;\">\n                        <strong>Workers:</strong> 0 \n                    </td>\n                </tr>\n                <tr>\n                    <td style=\"text-align: left;\">\n                        <strong>Dashboard:</strong> <a href=\"http://127.0.0.1:8787/status\" target=\"_blank\">http://127.0.0.1:8787/status</a>\n                    </td>\n                    <td style=\"text-align: left;\">\n                        <strong>Total threads:</strong> 0\n                    </td>\n                </tr>\n                <tr>\n                    <td style=\"text-align: left;\">\n                        <strong>Started:</strong> Just now\n                    </td>\n                    <td style=\"text-align: left;\">\n                        <strong>Total memory:</strong> 0 B\n                    </td>\n                </tr>\n            </table>\n        </div>\n    </div>\n\n    <details style=\"margin-left: 48px;\">\n        <summary style=\"margin-bottom: 20px;\">\n            <h3 style=\"display: inline;\">Workers</h3>\n        </summary>\n\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 0</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:41849\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:43057/status\" target=\"_blank\">http://127.0.0.1:43057/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 3.91 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:36357\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-oztk5k35\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 1</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:37121\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:34165/status\" target=\"_blank\">http://127.0.0.1:34165/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 3.91 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:35509\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-7zf2quar\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 2</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:35235\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:33157/status\" target=\"_blank\">http://127.0.0.1:33157/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 3.91 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:44793\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-8nhknq09\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n        <div style=\"margin-bottom: 20px;\">\n            <div style=\"width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;\"> </div>\n            <div style=\"margin-left: 48px;\">\n            <details>\n                <summary>\n                    <h4 style=\"margin-bottom: 0px; display: inline;\">Worker: 3</h4>\n                </summary>\n                <table style=\"width: 100%; text-align: left;\">\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Comm: </strong> tcp://127.0.0.1:41719\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Total threads: </strong> 1\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Dashboard: </strong> <a href=\"http://127.0.0.1:37855/status\" target=\"_blank\">http://127.0.0.1:37855/status</a>\n                        </td>\n                        <td style=\"text-align: left;\">\n                            <strong>Memory: </strong> 3.91 GiB\n                        </td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: left;\">\n                            <strong>Nanny: </strong> tcp://127.0.0.1:43877\n                        </td>\n                        <td style=\"text-align: left;\"></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\" style=\"text-align: left;\">\n                            <strong>Local directory: </strong> /tmp/dask-scratch-space/worker-a230ra81\n                        </td>\n                    </tr>\n\n                    \n\n                    \n\n                </table>\n            </details>\n            </div>\n        </div>\n        \n\n    </details>\n</div>\n\n        </details>\n    </div>\n</div>","content_type":"text/html"}}}],"key":"flki5Pwbpp"}],"key":"zcNJUSNAcD"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Data Loading","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PnzOHtcitQ"}],"identifier":"data-loading","label":"Data Loading","html_id":"data-loading","implicit":true,"key":"bwf4KTYM7n"},{"type":"heading","depth":4,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Load CESM2 LENS data from NCAR’s GDEX","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"VWWFUjoZJ1"}],"identifier":"load-cesm2-lens-data-from-ncars-gdex","label":"Load CESM2 LENS data from NCAR’s GDEX","html_id":"load-cesm2-lens-data-from-ncars-gdex","implicit":true,"key":"apve174aiO"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Load CESM2 LENS zarr data from GDEx using an intake-ESM catalog that has OSDF links","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"UgF0zapjSZ"}],"key":"nFKOU03CDH"}],"key":"FhOHqeScur"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"For more details regarding the dataset. See, ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"KUZHDO2hQ9"},{"type":"link","url":"https://gdex.ucar.edu/datasets/d010092/#","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"https://​gdex​.ucar​.edu​/datasets​/d010092​/#","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"NcAGZaBhRO"}],"urlSource":"https://gdex.ucar.edu/datasets/d010092/#","key":"lE6GiPEPG3"}],"key":"XFPheAJ1rZ"}],"key":"kJvdM0HfHr"}],"key":"vMdKa4CzIJ"}],"key":"UHtA9y22J5"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"col = intake.open_esm_datastore(cat_url)\ncol","key":"dGKlm54vlE"},{"type":"output","id":"Tlehkx19JamJZ5Ux-utcQ","data":[{"output_type":"stream","name":"stderr","text":"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/intake_esm/__init__.py:6: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.\n  from pkg_resources import DistributionNotFound, get_distribution\n"},{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"},"text/html":{"content":"<p><strong>gdex-cesm2-lens-zarr catalog with 40 dataset(s) from 322 asset(s)</strong>:</p> <div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>unique</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>Unnamed: 0</th>\n      <td>322</td>\n    </tr>\n    <tr>\n      <th>variable</th>\n      <td>53</td>\n    </tr>\n    <tr>\n      <th>long_name</th>\n      <td>51</td>\n    </tr>\n    <tr>\n      <th>component</th>\n      <td>4</td>\n    </tr>\n    <tr>\n      <th>experiment</th>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>forcing_variant</th>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>frequency</th>\n      <td>3</td>\n    </tr>\n    <tr>\n      <th>vertical_levels</th>\n      <td>3</td>\n    </tr>\n    <tr>\n      <th>spatial_domain</th>\n      <td>3</td>\n    </tr>\n    <tr>\n      <th>units</th>\n      <td>20</td>\n    </tr>\n    <tr>\n      <th>start_time</th>\n      <td>4</td>\n    </tr>\n    <tr>\n      <th>end_time</th>\n      <td>7</td>\n    </tr>\n    <tr>\n      <th>path</th>\n      <td>313</td>\n    </tr>\n    <tr>\n      <th>derived_variable</th>\n      <td>0</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"}}}],"key":"JzXelub4tU"}],"key":"vHjVBp8eQb"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Uncomment this line to see all the variables\n# cesm_cat.df['variable'].values","key":"WZW1hLi5US"},{"type":"output","id":"fi3Ww641W4l3k5pJ2Ty_U","data":[],"key":"LVNAhlzm3S"}],"key":"LZ1ib6eIUu"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"cesm_temp = col.search(variable ='TEMP', frequency ='monthly')\ncesm_temp","key":"xabqcQOGBg"},{"type":"output","id":"k8C-tvh_c4UB_Hj4SnO-6","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"},"text/html":{"content":"<p><strong>gdex-cesm2-lens-zarr catalog with 3 dataset(s) from 3 asset(s)</strong>:</p> <div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>unique</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>Unnamed: 0</th>\n      <td>3</td>\n    </tr>\n    <tr>\n      <th>variable</th>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>long_name</th>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>component</th>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>experiment</th>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>forcing_variant</th>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>frequency</th>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>vertical_levels</th>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>spatial_domain</th>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>units</th>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>start_time</th>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>end_time</th>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>path</th>\n      <td>3</td>\n    </tr>\n    <tr>\n      <th>derived_variable</th>\n      <td>0</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"}}}],"key":"eNenfIIOFd"}],"key":"giutCRBbws"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"cesm_temp.df['path'].values","key":"s6Jsn0ZfI4"},{"type":"output","id":"i28NLbQVn1Nux2fygcNuA","data":[{"output_type":"execute_result","execution_count":8,"metadata":{},"data":{"text/plain":{"content":"array(['https://osdf-data.gdex.ucar.edu/ncar-gdex/d010092/ocn/monthly/cesm2LE-historical-cmip6-TEMP.zarr',\n       'https://osdf-data.gdex.ucar.edu/ncar-gdex/d010092/ocn/monthly/cesm2LE-ssp370-cmip6-TEMP.zarr',\n       'https://osdf-data.gdex.ucar.edu/ncar-gdex/d010092/ocn/monthly/cesm2LE-ssp370-smbb-TEMP.zarr'],\n      dtype=object)","content_type":"text/plain"}}}],"key":"rKEwWRLmvV"}],"key":"tgC2ZcSfw5"},{"type":"block","kind":"notebook-content","children":[{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"dqEsDxum6M"}],"key":"guFZsCLXWL"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Note that all the file paths start with ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"BOqlk6safm"},{"type":"link","url":"https://data-osdf.gdex.ucar.edu","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"https://​data​-osdf​.gdex​.ucar​.edu","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"VhxQSacDb8"}],"urlSource":"https://data-osdf.gdex.ucar.edu","key":"m3MnMS5WdS"},{"type":"text","value":" indicating that the data will be streamed via OSDF","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"MeqnFiaXrr"}],"key":"hqHqzfwiBN"}],"key":"aGBrPjOIn1"}],"key":"PkuhOr6m8G"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"dsets_cesm = cesm_temp.to_dataset_dict()","key":"WD6MUzUZlv"},{"type":"output","id":"rnqNqD5AO5-sLXXji6H06","data":[{"output_type":"stream","name":"stdout","text":"\n--> The keys in the returned dictionary of datasets are constructed as follows:\n\t'component.experiment.frequency.forcing_variant'\n"},{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"},"text/html":{"content":"\n<style>\n    /* Turns off some styling */\n    progress {\n        /* gets rid of default border in Firefox and Opera. */\n        border: none;\n        /* Needs to be in here for Safari polyfill so background images work as expected. */\n        background-size: auto;\n    }\n    progress:not([value]), progress:not([value])::-webkit-progress-bar {\n        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);\n    }\n    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {\n        background: #F44336;\n    }\n</style>\n","content_type":"text/html"}}},{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"},"text/html":{"content":"\n    <div>\n      <progress value='0' class='' max='3' style='width:300px; height:20px; vertical-align: middle;'></progress>\n      \n    </div>\n    ","content_type":"text/html"}}},{"output_type":"stream","name":"stderr","text":"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/intake_esm/__init__.py:6: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.\n  from pkg_resources import DistributionNotFound, get_distribution\n"},{"output_type":"stream","name":"stderr","text":"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/intake_esm/__init__.py:6: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.\n  from pkg_resources import DistributionNotFound, get_distribution\n"},{"output_type":"stream","name":"stderr","text":"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/intake_esm/__init__.py:6: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.\n  from pkg_resources import DistributionNotFound, get_distribution\n"},{"output_type":"stream","name":"stderr","text":"2025-10-03 01:28:38,898 - distributed.protocol.pickle - ERROR - Failed to serialize 504, message='Gateway Timeout', url='https://osdf1.chic.nrp.internet2.edu:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-historical-cmip6-TEMP.zarr/.zmetadata'.\nTraceback (most recent call last):\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/distributed/worker.py\", line 2980, in _run_task_simple\n    result = task(data)\n             ^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/dask/_task_spec.py\", line 758, in __call__\n    return self.func(*new_argspec, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/intake_esm/source.py\", line 77, in _open_dataset\n    ds = xr.open_dataset(url, **xarray_open_kwargs)\n         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/api.py\", line 760, in open_dataset\n    backend_ds = backend.open_dataset(\n                 ^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/zarr.py\", line 1654, in open_dataset\n    store = ZarrStore.open_group(\n            ^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/zarr.py\", line 714, in open_group\n    ) = _get_open_params(\n        ^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/zarr.py\", line 1862, in _get_open_params\n    zarr_root_group = zarr.open_consolidated(store, **open_kwargs)\n                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/zarr/convenience.py\", line 1360, in open_consolidated\n    meta_store = ConsolidatedStoreClass(store, metadata_key=metadata_key)\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/zarr/storage.py\", line 3046, in __init__\n    meta = json_loads(self.store[metadata_key])\n                      ~~~~~~~~~~^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/zarr/storage.py\", line 1446, in __getitem__\n    return self.map[key]\n           ~~~~~~~~^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/mapping.py\", line 155, in __getitem__\n    result = self.fs.cat(k)\n             ^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/asyn.py\", line 118, in wrapper\n    return sync(self.loop, func, *args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/asyn.py\", line 103, in sync\n    raise return_result\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/asyn.py\", line 56, in _runner\n    result[0] = await coro\n                ^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/asyn.py\", line 464, in _cat\n    raise ex\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/asyn.py\", line 244, in _run_coro\n    return await asyncio.wait_for(coro, timeout=timeout), i\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/asyncio/tasks.py\", line 520, in wait_for\n    return await fut\n           ^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/implementations/http.py\", line 246, in _cat_file\n    self._raise_not_found_for_status(r, url)\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/implementations/http.py\", line 229, in _raise_not_found_for_status\n    response.raise_for_status()\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/aiohttp/client_reqrep.py\", line 629, in raise_for_status\n    raise ClientResponseError(\naiohttp.client_exceptions.ClientResponseError: 504, message='Gateway Timeout', url='https://osdf1.chic.nrp.internet2.edu:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-historical-cmip6-TEMP.zarr/.zmetadata'\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/distributed/protocol/pickle.py\", line 63, in dumps\n    result = pickle.dumps(x, **dump_kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: can't pickle multidict._multidict.CIMultiDictProxy objects\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/distributed/protocol/pickle.py\", line 68, in dumps\n    pickler.dump(x)\nTypeError: can't pickle multidict._multidict.CIMultiDictProxy objects\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/distributed/protocol/pickle.py\", line 80, in dumps\n    result = cloudpickle.dumps(x, **dump_kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/cloudpickle/cloudpickle.py\", line 1537, in dumps\n    cp.dump(obj)\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/cloudpickle/cloudpickle.py\", line 1303, in dump\n    return super().dump(obj)\n           ^^^^^^^^^^^^^^^^^\nTypeError: can't pickle multidict._multidict.CIMultiDictProxy objects\n"},{"output_type":"stream","name":"stderr","text":"2025-10-03 01:28:39,344 - distributed.protocol.pickle - ERROR - Failed to serialize 504, message='Gateway Timeout', url='https://osdf1.chic.nrp.internet2.edu:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-ssp370-cmip6-TEMP.zarr/.zmetadata'.\nTraceback (most recent call last):\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/distributed/worker.py\", line 2980, in _run_task_simple\n    result = task(data)\n             ^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/dask/_task_spec.py\", line 758, in __call__\n    return self.func(*new_argspec, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/intake_esm/source.py\", line 77, in _open_dataset\n    ds = xr.open_dataset(url, **xarray_open_kwargs)\n         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/api.py\", line 760, in open_dataset\n    backend_ds = backend.open_dataset(\n                 ^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/zarr.py\", line 1654, in open_dataset\n    store = ZarrStore.open_group(\n            ^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/zarr.py\", line 714, in open_group\n    ) = _get_open_params(\n        ^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/zarr.py\", line 1862, in _get_open_params\n    zarr_root_group = zarr.open_consolidated(store, **open_kwargs)\n                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/zarr/convenience.py\", line 1360, in open_consolidated\n    meta_store = ConsolidatedStoreClass(store, metadata_key=metadata_key)\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/zarr/storage.py\", line 3046, in __init__\n    meta = json_loads(self.store[metadata_key])\n                      ~~~~~~~~~~^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/zarr/storage.py\", line 1446, in __getitem__\n    return self.map[key]\n           ~~~~~~~~^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/mapping.py\", line 155, in __getitem__\n    result = self.fs.cat(k)\n             ^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/asyn.py\", line 118, in wrapper\n    return sync(self.loop, func, *args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/asyn.py\", line 103, in sync\n    raise return_result\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/asyn.py\", line 56, in _runner\n    result[0] = await coro\n                ^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/asyn.py\", line 464, in _cat\n    raise ex\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/asyn.py\", line 244, in _run_coro\n    return await asyncio.wait_for(coro, timeout=timeout), i\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/asyncio/tasks.py\", line 520, in wait_for\n    return await fut\n           ^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/implementations/http.py\", line 246, in _cat_file\n    self._raise_not_found_for_status(r, url)\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/implementations/http.py\", line 229, in _raise_not_found_for_status\n    response.raise_for_status()\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/aiohttp/client_reqrep.py\", line 629, in raise_for_status\n    raise ClientResponseError(\naiohttp.client_exceptions.ClientResponseError: 504, message='Gateway Timeout', url='https://osdf1.chic.nrp.internet2.edu:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-ssp370-cmip6-TEMP.zarr/.zmetadata'\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/distributed/protocol/pickle.py\", line 63, in dumps\n    result = pickle.dumps(x, **dump_kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: can't pickle multidict._multidict.CIMultiDictProxy objects\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/distributed/protocol/pickle.py\", line 68, in dumps\n    pickler.dump(x)\nTypeError: can't pickle multidict._multidict.CIMultiDictProxy objects\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/distributed/protocol/pickle.py\", line 80, in dumps\n    result = cloudpickle.dumps(x, **dump_kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/cloudpickle/cloudpickle.py\", line 1537, in dumps\n    cp.dump(obj)\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/cloudpickle/cloudpickle.py\", line 1303, in dump\n    return super().dump(obj)\n           ^^^^^^^^^^^^^^^^^\nTypeError: can't pickle multidict._multidict.CIMultiDictProxy objects\n"},{"output_type":"stream","name":"stderr","text":"2025-10-03 01:28:39,801 - distributed.worker - ERROR - Compute Failed\nKey:       _open_dataset-d306ffc3-8082-4721-b89f-b559a0d99385\nState:     executing\nTask:  <Task '_open_dataset-d306ffc3-8082-4721-b89f-b559a0d99385' _open_dataset(..., ...)>\nException: 'ClientResponseError(RequestInfo(url=URL(\\'https://osdf1.chic.nrp.internet2.edu:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-historical-cmip6-TEMP.zarr/.zmetadata\\'), method=\\'GET\\', headers=<CIMultiDictProxy(\\'Host\\': \\'osdf1.chic.nrp.internet2.edu:8443\\', \\'Accept\\': \\'*/*\\', \\'Accept-Encoding\\': \\'gzip, deflate, br\\', \\'User-Agent\\': \\'Python/3.12 aiohttp/3.12.15\\')>, real_url=URL(\\'https://osdf1.chic.nrp.internet2.edu:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-historical-cmip6-TEMP.zarr/.zmetadata\\')), (<ClientResponse(https://osdf-data.gdex.ucar.edu/ncar-gdex/d010092/ocn/monthly/cesm2LE-historical-cmip6-TEMP.zarr/.zmetadata) [301 Moved Permanently]>\\n<CIMultiDictProxy(\\'Server\\': \\'nginx/1.27.0\\', \\'Date\\': \\'Fri, 03 Oct 2025 01:28:29 GMT\\', \\'Content-Type\\': \\'text/html\\', \\'Content-Length\\': \\'169\\', \\'Connection\\': \\'keep-alive\\', \\'Location\\': \\'https://osdf-director.osg-htc.org:443/ncar-gdex/d010092/ocn/monthly/cesm2LE-historical-cmip6-TEMP.zarr/.zmetadata\\')>\\n, <ClientResponse(https://osdf-director.osg-htc.org/ncar-gdex/d010092/ocn/monthly/cesm2LE-historical-cmip6-TEMP.zarr/.zmetadata) [307 Temporary Redirect]>\\n<CIMultiDictProxy(\\'Access-Control-Allow-Headers\\': \\'Content-Type, Authorization, Depth\\', \\'Access-Control-Allow-Methods\\': \\'GET, POST, PROPFIND, OPTIONS\\', \\'Access-Control-Allow-Origin\\': \\'*\\', \\'Access-Control-Expose-Headers\\': \\'Content-Type, Authorization, X-Pelican-User, X-Pelican-Timeout, X-Pelican-Token-Generation, X-Pelican-Authorization, X-Pelican-Namespace\\', \\'Content-Length\\': \\'153\\', \\'Content-Type\\': \\'text/html; charset=utf-8\\', \\'Date\\': \\'Fri, 03 Oct 2025 01:28:29 GMT\\', \\'Link\\': \\'<https://osdf1.chic.nrp.internet2.edu:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-historical-cmip6-TEMP.zarr/.zmetadata>; rel=\"duplicate\"; pri=1; depth=5, <https://dtn-pas.kans.nrp.internet2.edu:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-historical-cmip6-TEMP.zarr/.zmetadata>; rel=\"duplicate\"; pri=2; depth=5, <https://osg-hawk-cache.cc.lehigh.edu:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-historical-cmip6-TEMP.zarr/.zmetadata>; rel=\"duplicate\"; pri=3; depth=5, <https://osdf1.newy32aoa.nrp.internet2.edu:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-historical-cmip6-TEMP.zarr/.zmetadata>; rel=\"duplicate\"; pri=4; depth=5, <https://dtn-pas.jack.nrp.internet2.edu:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-historical-cmip6-TEMP.zarr/.zmetadata>; rel=\"duplicate\"; pri=5; depth=5, <https://dtn-pas.cinc.nrp.internet2.edu:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-historical-cmip6-TEMP.zarr/.zmetadata>; rel=\"duplicate\"; pri=6; depth=5\\', \\'Location\\': \\'https://osdf1.chic.nrp.internet2.edu:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-historical-cmip6-TEMP.zarr/.zmetadata\\', \\'Server\\': \\'pelican/7.20.1\\', \\'X-Pelican-Authorization\\': \\'issuer=https://ncar-s3-origin.nationalresearchplatform.org:8000\\', \\'X-Pelican-Jobid\\': \\'d633dc6f-9c22-41e5-843b-5b7f4afda17e\\', \\'X-Pelican-Namespace\\': \\'namespace=/ncar-gdex, require-token=false, collections-url=https://ncar-s3-origin.nationalresearchplatform.org:8444\\', \\'X-Pelican-Token-Generation\\': \\'issuer=https://ncar-s3-origin.nationalresearchplatform.org:8000, max-scope-depth=3, strategy=OAuth2, base-path=/ncar-gdex\\')>\\n), status=504, message=\\'Gateway Timeout\\', headers=<CIMultiDictProxy(\\'Connection\\': \\'Close\\', \\'Server\\': \\'XrootD/v5.8.4\\', \\'Access-Control-Allow-Origin\\': \\'*\\', \\'Access-Control-Allow-Headers\\': \\'Authorization,Want-Digest,Content-Type,User-Agent\\', \\'Content-Disposition\\': \\'attachment\\', \\'Content-Length\\': \\'107\\')>)'\nTraceback: '  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/intake_esm/source.py\", line 77, in _open_dataset\\n    ds = xr.open_dataset(url, **xarray_open_kwargs)\\n         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/api.py\", line 760, in open_dataset\\n    backend_ds = backend.open_dataset(\\n                 ^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/zarr.py\", line 1654, in open_dataset\\n    store = ZarrStore.open_group(\\n            ^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/zarr.py\", line 714, in open_group\\n    ) = _get_open_params(\\n        ^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/zarr.py\", line 1862, in _get_open_params\\n    zarr_root_group = zarr.open_consolidated(store, **open_kwargs)\\n                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/zarr/convenience.py\", line 1360, in open_consolidated\\n    meta_store = ConsolidatedStoreClass(store, metadata_key=metadata_key)\\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/zarr/storage.py\", line 3046, in __init__\\n    meta = json_loads(self.store[metadata_key])\\n                      ~~~~~~~~~~^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/zarr/storage.py\", line 1446, in __getitem__\\n    return self.map[key]\\n           ~~~~~~~~^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/mapping.py\", line 155, in __getitem__\\n    result = self.fs.cat(k)\\n             ^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/asyn.py\", line 118, in wrapper\\n    return sync(self.loop, func, *args, **kwargs)\\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/asyn.py\", line 103, in sync\\n    raise return_result\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/asyn.py\", line 56, in _runner\\n    result[0] = await coro\\n                ^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/asyn.py\", line 464, in _cat\\n    raise ex\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/asyn.py\", line 244, in _run_coro\\n    return await asyncio.wait_for(coro, timeout=timeout), i\\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/asyncio/tasks.py\", line 520, in wait_for\\n    return await fut\\n           ^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/implementations/http.py\", line 246, in _cat_file\\n    self._raise_not_found_for_status(r, url)\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/implementations/http.py\", line 229, in _raise_not_found_for_status\\n    response.raise_for_status()\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/aiohttp/client_reqrep.py\", line 629, in raise_for_status\\n    raise ClientResponseError(\\n'\n\n"},{"output_type":"stream","name":"stderr","text":"2025-10-03 01:28:40,211 - distributed.worker - ERROR - Compute Failed\nKey:       _open_dataset-0434cf98-b498-49dc-a5a1-32a10ceaf588\nState:     executing\nTask:  <Task '_open_dataset-0434cf98-b498-49dc-a5a1-32a10ceaf588' _open_dataset(..., ...)>\nException: 'ClientResponseError(RequestInfo(url=URL(\\'https://osdf1.chic.nrp.internet2.edu:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-ssp370-cmip6-TEMP.zarr/.zmetadata\\'), method=\\'GET\\', headers=<CIMultiDictProxy(\\'Host\\': \\'osdf1.chic.nrp.internet2.edu:8443\\', \\'Accept\\': \\'*/*\\', \\'Accept-Encoding\\': \\'gzip, deflate, br\\', \\'User-Agent\\': \\'Python/3.12 aiohttp/3.12.15\\')>, real_url=URL(\\'https://osdf1.chic.nrp.internet2.edu:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-ssp370-cmip6-TEMP.zarr/.zmetadata\\')), (<ClientResponse(https://osdf-data.gdex.ucar.edu/ncar-gdex/d010092/ocn/monthly/cesm2LE-ssp370-cmip6-TEMP.zarr/.zmetadata) [301 Moved Permanently]>\\n<CIMultiDictProxy(\\'Server\\': \\'nginx/1.27.0\\', \\'Date\\': \\'Fri, 03 Oct 2025 01:28:29 GMT\\', \\'Content-Type\\': \\'text/html\\', \\'Content-Length\\': \\'169\\', \\'Connection\\': \\'keep-alive\\', \\'Location\\': \\'https://osdf-director.osg-htc.org:443/ncar-gdex/d010092/ocn/monthly/cesm2LE-ssp370-cmip6-TEMP.zarr/.zmetadata\\')>\\n, <ClientResponse(https://osdf-director.osg-htc.org/ncar-gdex/d010092/ocn/monthly/cesm2LE-ssp370-cmip6-TEMP.zarr/.zmetadata) [307 Temporary Redirect]>\\n<CIMultiDictProxy(\\'Access-Control-Allow-Headers\\': \\'Content-Type, Authorization, Depth\\', \\'Access-Control-Allow-Methods\\': \\'GET, POST, PROPFIND, OPTIONS\\', \\'Access-Control-Allow-Origin\\': \\'*\\', \\'Access-Control-Expose-Headers\\': \\'Content-Type, Authorization, X-Pelican-User, X-Pelican-Timeout, X-Pelican-Token-Generation, X-Pelican-Authorization, X-Pelican-Namespace\\', \\'Content-Length\\': \\'149\\', \\'Content-Type\\': \\'text/html; charset=utf-8\\', \\'Date\\': \\'Fri, 03 Oct 2025 01:28:30 GMT\\', \\'Link\\': \\'<https://osdf1.chic.nrp.internet2.edu:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-ssp370-cmip6-TEMP.zarr/.zmetadata>; rel=\"duplicate\"; pri=1; depth=5, <https://dtn-pas.kans.nrp.internet2.edu:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-ssp370-cmip6-TEMP.zarr/.zmetadata>; rel=\"duplicate\"; pri=2; depth=5, <https://osg-hawk-cache.cc.lehigh.edu:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-ssp370-cmip6-TEMP.zarr/.zmetadata>; rel=\"duplicate\"; pri=3; depth=5, <https://dtn-pas.jack.nrp.internet2.edu:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-ssp370-cmip6-TEMP.zarr/.zmetadata>; rel=\"duplicate\"; pri=4; depth=5, <https://osdf1.newy32aoa.nrp.internet2.edu:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-ssp370-cmip6-TEMP.zarr/.zmetadata>; rel=\"duplicate\"; pri=5; depth=5, <https://dtn-pas.cinc.nrp.internet2.edu:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-ssp370-cmip6-TEMP.zarr/.zmetadata>; rel=\"duplicate\"; pri=6; depth=5\\', \\'Location\\': \\'https://osdf1.chic.nrp.internet2.edu:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-ssp370-cmip6-TEMP.zarr/.zmetadata\\', \\'Server\\': \\'pelican/7.20.1\\', \\'X-Pelican-Authorization\\': \\'issuer=https://ncar-s3-origin.nationalresearchplatform.org:8000\\', \\'X-Pelican-Jobid\\': \\'90deb368-caaa-45c7-8f24-b70e7012274d\\', \\'X-Pelican-Namespace\\': \\'namespace=/ncar-gdex, require-token=false, collections-url=https://ncar-s3-origin.nationalresearchplatform.org:8444\\', \\'X-Pelican-Token-Generation\\': \\'issuer=https://ncar-s3-origin.nationalresearchplatform.org:8000, max-scope-depth=3, strategy=OAuth2, base-path=/ncar-gdex\\')>\\n), status=504, message=\\'Gateway Timeout\\', headers=<CIMultiDictProxy(\\'Connection\\': \\'Close\\', \\'Server\\': \\'XrootD/v5.8.4\\', \\'Access-Control-Allow-Origin\\': \\'*\\', \\'Access-Control-Allow-Headers\\': \\'Authorization,Want-Digest,Content-Type,User-Agent\\', \\'Content-Disposition\\': \\'attachment\\', \\'Content-Length\\': \\'103\\')>)'\nTraceback: '  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/intake_esm/source.py\", line 77, in _open_dataset\\n    ds = xr.open_dataset(url, **xarray_open_kwargs)\\n         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/api.py\", line 760, in open_dataset\\n    backend_ds = backend.open_dataset(\\n                 ^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/zarr.py\", line 1654, in open_dataset\\n    store = ZarrStore.open_group(\\n            ^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/zarr.py\", line 714, in open_group\\n    ) = _get_open_params(\\n        ^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/zarr.py\", line 1862, in _get_open_params\\n    zarr_root_group = zarr.open_consolidated(store, **open_kwargs)\\n                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/zarr/convenience.py\", line 1360, in open_consolidated\\n    meta_store = ConsolidatedStoreClass(store, metadata_key=metadata_key)\\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/zarr/storage.py\", line 3046, in __init__\\n    meta = json_loads(self.store[metadata_key])\\n                      ~~~~~~~~~~^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/zarr/storage.py\", line 1446, in __getitem__\\n    return self.map[key]\\n           ~~~~~~~~^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/mapping.py\", line 155, in __getitem__\\n    result = self.fs.cat(k)\\n             ^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/asyn.py\", line 118, in wrapper\\n    return sync(self.loop, func, *args, **kwargs)\\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/asyn.py\", line 103, in sync\\n    raise return_result\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/asyn.py\", line 56, in _runner\\n    result[0] = await coro\\n                ^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/asyn.py\", line 464, in _cat\\n    raise ex\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/asyn.py\", line 244, in _run_coro\\n    return await asyncio.wait_for(coro, timeout=timeout), i\\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/asyncio/tasks.py\", line 520, in wait_for\\n    return await fut\\n           ^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/implementations/http.py\", line 246, in _cat_file\\n    self._raise_not_found_for_status(r, url)\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/implementations/http.py\", line 229, in _raise_not_found_for_status\\n    response.raise_for_status()\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/aiohttp/client_reqrep.py\", line 629, in raise_for_status\\n    raise ClientResponseError(\\n'\n\n"},{"output_type":"stream","name":"stderr","text":"2025-10-03 01:28:46,769 - distributed.worker - ERROR - Compute Failed\nKey:       _open_dataset-6a12657a-c01f-4675-be9a-532d93ce1f9c\nState:     executing\nTask:  <Task '_open_dataset-6a12657a-c01f-4675-be9a-532d93ce1f9c' _open_dataset(..., ...)>\nException: 'ClientPayloadError(\"Response payload is not completed: <ContentLengthError: 400, message=\\'Not enough data to satisfy content length header.\\'>\")'\nTraceback: '  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/intake_esm/source.py\", line 77, in _open_dataset\\n    ds = xr.open_dataset(url, **xarray_open_kwargs)\\n         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/api.py\", line 760, in open_dataset\\n    backend_ds = backend.open_dataset(\\n                 ^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/zarr.py\", line 1654, in open_dataset\\n    store = ZarrStore.open_group(\\n            ^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/zarr.py\", line 714, in open_group\\n    ) = _get_open_params(\\n        ^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/zarr.py\", line 1862, in _get_open_params\\n    zarr_root_group = zarr.open_consolidated(store, **open_kwargs)\\n                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/zarr/convenience.py\", line 1360, in open_consolidated\\n    meta_store = ConsolidatedStoreClass(store, metadata_key=metadata_key)\\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/zarr/storage.py\", line 3046, in __init__\\n    meta = json_loads(self.store[metadata_key])\\n                      ~~~~~~~~~~^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/zarr/storage.py\", line 1446, in __getitem__\\n    return self.map[key]\\n           ~~~~~~~~^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/mapping.py\", line 155, in __getitem__\\n    result = self.fs.cat(k)\\n             ^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/asyn.py\", line 118, in wrapper\\n    return sync(self.loop, func, *args, **kwargs)\\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/asyn.py\", line 103, in sync\\n    raise return_result\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/asyn.py\", line 56, in _runner\\n    result[0] = await coro\\n                ^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/asyn.py\", line 464, in _cat\\n    raise ex\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/asyn.py\", line 244, in _run_coro\\n    return await asyncio.wait_for(coro, timeout=timeout), i\\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/asyncio/tasks.py\", line 520, in wait_for\\n    return await fut\\n           ^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/implementations/http.py\", line 245, in _cat_file\\n    out = await r.read()\\n          ^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/aiohttp/client_reqrep.py\", line 686, in read\\n    self._body = await self.content.read()\\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/aiohttp/streams.py\", line 418, in read\\n    block = await self.readany()\\n            ^^^^^^^^^^^^^^^^^^^^\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/aiohttp/streams.py\", line 440, in readany\\n    await self._wait(\"readany\")\\n  File \"/home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/aiohttp/streams.py\", line 347, in _wait\\n    await waiter\\n'\n\n"},{"output_type":"error","traceback":"\u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mException\u001b[39m                                 Traceback (most recent call last)\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/intake_esm/source.py:244\u001b[39m, in \u001b[36mESMDataSource._open_dataset\u001b[39m\u001b[34m(self)\u001b[39m\n\u001b[32m    223\u001b[39m datasets = [\n\u001b[32m    224\u001b[39m     _open_dataset(\n\u001b[32m    225\u001b[39m         record[\u001b[38;5;28mself\u001b[39m.path_column_name],\n\u001b[32m   (...)\u001b[39m\u001b[32m    241\u001b[39m     \u001b[38;5;28;01mfor\u001b[39;00m _, record \u001b[38;5;129;01min\u001b[39;00m \u001b[38;5;28mself\u001b[39m.df.iterrows()\n\u001b[32m    242\u001b[39m ]\n\u001b[32m--> \u001b[39m\u001b[32m244\u001b[39m datasets = \u001b[43mdask\u001b[49m\u001b[43m.\u001b[49m\u001b[43mcompute\u001b[49m\u001b[43m(\u001b[49m\u001b[43m*\u001b[49m\u001b[43mdatasets\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    245\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mlen\u001b[39m(datasets) == \u001b[32m1\u001b[39m:\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/dask/base.py:681\u001b[39m, in \u001b[36mcompute\u001b[39m\u001b[34m(traverse, optimize_graph, scheduler, get, *args, **kwargs)\u001b[39m\n\u001b[32m    679\u001b[39m     keys = \u001b[38;5;28mlist\u001b[39m(flatten(expr.__dask_keys__()))\n\u001b[32m--> \u001b[39m\u001b[32m681\u001b[39m     results = \u001b[43mschedule\u001b[49m\u001b[43m(\u001b[49m\u001b[43mexpr\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mkeys\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43m*\u001b[49m\u001b[43m*\u001b[49m\u001b[43mkwargs\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    683\u001b[39m \u001b[38;5;28;01mreturn\u001b[39;00m repack(results)\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/intake_esm/source.py:77\u001b[39m, in \u001b[36m_open_dataset\u001b[39m\u001b[34m()\u001b[39m\n\u001b[32m     76\u001b[39m \u001b[38;5;28;01melse\u001b[39;00m:\n\u001b[32m---> \u001b[39m\u001b[32m77\u001b[39m     ds = xr.open_dataset(url, **xarray_open_kwargs)\n\u001b[32m     78\u001b[39m     \u001b[38;5;28;01mif\u001b[39;00m preprocess \u001b[38;5;129;01mis\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m \u001b[38;5;28;01mNone\u001b[39;00m:\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/api.py:760\u001b[39m, in \u001b[36mopen_dataset\u001b[39m\u001b[34m()\u001b[39m\n\u001b[32m    759\u001b[39m overwrite_encoded_chunks = kwargs.pop(\u001b[33m\"\u001b[39m\u001b[33moverwrite_encoded_chunks\u001b[39m\u001b[33m\"\u001b[39m, \u001b[38;5;28;01mNone\u001b[39;00m)\n\u001b[32m--> \u001b[39m\u001b[32m760\u001b[39m backend_ds = backend.open_dataset(\n\u001b[32m    761\u001b[39m     filename_or_obj,\n\u001b[32m    762\u001b[39m     drop_variables=drop_variables,\n\u001b[32m    763\u001b[39m     **decoders,\n\u001b[32m    764\u001b[39m     **kwargs,\n\u001b[32m    765\u001b[39m )\n\u001b[32m    766\u001b[39m ds = _dataset_from_backend_dataset(\n\u001b[32m    767\u001b[39m     backend_ds,\n\u001b[32m    768\u001b[39m     filename_or_obj,\n\u001b[32m   (...)\u001b[39m\u001b[32m    779\u001b[39m     **kwargs,\n\u001b[32m    780\u001b[39m )\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/zarr.py:1654\u001b[39m, in \u001b[36mopen_dataset\u001b[39m\u001b[34m()\u001b[39m\n\u001b[32m   1653\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m store:\n\u001b[32m-> \u001b[39m\u001b[32m1654\u001b[39m     store = ZarrStore.open_group(\n\u001b[32m   1655\u001b[39m         filename_or_obj,\n\u001b[32m   1656\u001b[39m         group=group,\n\u001b[32m   1657\u001b[39m         mode=mode,\n\u001b[32m   1658\u001b[39m         synchronizer=synchronizer,\n\u001b[32m   1659\u001b[39m         consolidated=consolidated,\n\u001b[32m   1660\u001b[39m         consolidate_on_close=\u001b[38;5;28;01mFalse\u001b[39;00m,\n\u001b[32m   1661\u001b[39m         chunk_store=chunk_store,\n\u001b[32m   1662\u001b[39m         storage_options=storage_options,\n\u001b[32m   1663\u001b[39m         zarr_version=zarr_version,\n\u001b[32m   1664\u001b[39m         use_zarr_fill_value_as_mask=\u001b[38;5;28;01mNone\u001b[39;00m,\n\u001b[32m   1665\u001b[39m         zarr_format=zarr_format,\n\u001b[32m   1666\u001b[39m         cache_members=cache_members,\n\u001b[32m   1667\u001b[39m     )\n\u001b[32m   1669\u001b[39m store_entrypoint = StoreBackendEntrypoint()\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/zarr.py:714\u001b[39m, in \u001b[36mopen_group\u001b[39m\u001b[34m()\u001b[39m\n\u001b[32m    688\u001b[39m \u001b[38;5;129m@classmethod\u001b[39m\n\u001b[32m    689\u001b[39m \u001b[38;5;28;01mdef\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34mopen_group\u001b[39m(\n\u001b[32m    690\u001b[39m     \u001b[38;5;28mcls\u001b[39m,\n\u001b[32m   (...)\u001b[39m\u001b[32m    707\u001b[39m     cache_members: \u001b[38;5;28mbool\u001b[39m = \u001b[38;5;28;01mTrue\u001b[39;00m,\n\u001b[32m    708\u001b[39m ):\n\u001b[32m    709\u001b[39m     (\n\u001b[32m    710\u001b[39m         zarr_group,\n\u001b[32m    711\u001b[39m         consolidate_on_close,\n\u001b[32m    712\u001b[39m         close_store_on_close,\n\u001b[32m    713\u001b[39m         use_zarr_fill_value_as_mask,\n\u001b[32m--> \u001b[39m\u001b[32m714\u001b[39m     ) = _get_open_params(\n\u001b[32m    715\u001b[39m         store=store,\n\u001b[32m    716\u001b[39m         mode=mode,\n\u001b[32m    717\u001b[39m         synchronizer=synchronizer,\n\u001b[32m    718\u001b[39m         group=group,\n\u001b[32m    719\u001b[39m         consolidated=consolidated,\n\u001b[32m    720\u001b[39m         consolidate_on_close=consolidate_on_close,\n\u001b[32m    721\u001b[39m         chunk_store=chunk_store,\n\u001b[32m    722\u001b[39m         storage_options=storage_options,\n\u001b[32m    723\u001b[39m         zarr_version=zarr_version,\n\u001b[32m    724\u001b[39m         use_zarr_fill_value_as_mask=use_zarr_fill_value_as_mask,\n\u001b[32m    725\u001b[39m         zarr_format=zarr_format,\n\u001b[32m    726\u001b[39m     )\n\u001b[32m    728\u001b[39m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28mcls\u001b[39m(\n\u001b[32m    729\u001b[39m         zarr_group,\n\u001b[32m    730\u001b[39m         mode,\n\u001b[32m   (...)\u001b[39m\u001b[32m    739\u001b[39m         cache_members=cache_members,\n\u001b[32m    740\u001b[39m     )\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/xarray/backends/zarr.py:1862\u001b[39m, in \u001b[36m_get_open_params\u001b[39m\u001b[34m()\u001b[39m\n\u001b[32m   1861\u001b[39m \u001b[38;5;28;01mtry\u001b[39;00m:\n\u001b[32m-> \u001b[39m\u001b[32m1862\u001b[39m     zarr_root_group = zarr.open_consolidated(store, **open_kwargs)\n\u001b[32m   1863\u001b[39m \u001b[38;5;28;01mexcept\u001b[39;00m (\u001b[38;5;167;01mValueError\u001b[39;00m, \u001b[38;5;167;01mKeyError\u001b[39;00m):\n\u001b[32m   1864\u001b[39m     \u001b[38;5;66;03m# ValueError in zarr-python 3.x, KeyError in 2.x.\u001b[39;00m\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/zarr/convenience.py:1360\u001b[39m, in \u001b[36mopen_consolidated\u001b[39m\u001b[34m()\u001b[39m\n\u001b[32m   1359\u001b[39m \u001b[38;5;66;03m# setup metadata store\u001b[39;00m\n\u001b[32m-> \u001b[39m\u001b[32m1360\u001b[39m meta_store = ConsolidatedStoreClass(store, metadata_key=metadata_key)\n\u001b[32m   1362\u001b[39m \u001b[38;5;66;03m# pass through\u001b[39;00m\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/zarr/storage.py:3046\u001b[39m, in \u001b[36m__init__\u001b[39m\u001b[34m()\u001b[39m\n\u001b[32m   3045\u001b[39m \u001b[38;5;66;03m# retrieve consolidated metadata\u001b[39;00m\n\u001b[32m-> \u001b[39m\u001b[32m3046\u001b[39m meta = json_loads(\u001b[38;5;28mself\u001b[39m.store[metadata_key])\n\u001b[32m   3048\u001b[39m \u001b[38;5;66;03m# check format of consolidated metadata\u001b[39;00m\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/zarr/storage.py:1446\u001b[39m, in \u001b[36m__getitem__\u001b[39m\u001b[34m()\u001b[39m\n\u001b[32m   1445\u001b[39m \u001b[38;5;28;01mtry\u001b[39;00m:\n\u001b[32m-> \u001b[39m\u001b[32m1446\u001b[39m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28mself\u001b[39m.map[key]\n\u001b[32m   1447\u001b[39m \u001b[38;5;28;01mexcept\u001b[39;00m \u001b[38;5;28mself\u001b[39m.exceptions \u001b[38;5;28;01mas\u001b[39;00m e:\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/mapping.py:155\u001b[39m, in \u001b[36m__getitem__\u001b[39m\u001b[34m()\u001b[39m\n\u001b[32m    154\u001b[39m \u001b[38;5;28;01mtry\u001b[39;00m:\n\u001b[32m--> \u001b[39m\u001b[32m155\u001b[39m     result = \u001b[38;5;28mself\u001b[39m.fs.cat(k)\n\u001b[32m    156\u001b[39m \u001b[38;5;28;01mexcept\u001b[39;00m \u001b[38;5;28mself\u001b[39m.missing_exceptions \u001b[38;5;28;01mas\u001b[39;00m exc:\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/asyn.py:118\u001b[39m, in \u001b[36mwrapper\u001b[39m\u001b[34m()\u001b[39m\n\u001b[32m    117\u001b[39m \u001b[38;5;28mself\u001b[39m = obj \u001b[38;5;129;01mor\u001b[39;00m args[\u001b[32m0\u001b[39m]\n\u001b[32m--> \u001b[39m\u001b[32m118\u001b[39m \u001b[38;5;28;01mreturn\u001b[39;00m sync(\u001b[38;5;28mself\u001b[39m.loop, func, *args, **kwargs)\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/asyn.py:103\u001b[39m, in \u001b[36msync\u001b[39m\u001b[34m()\u001b[39m\n\u001b[32m    102\u001b[39m \u001b[38;5;28;01melif\u001b[39;00m \u001b[38;5;28misinstance\u001b[39m(return_result, \u001b[38;5;167;01mBaseException\u001b[39;00m):\n\u001b[32m--> \u001b[39m\u001b[32m103\u001b[39m     \u001b[38;5;28;01mraise\u001b[39;00m return_result\n\u001b[32m    104\u001b[39m \u001b[38;5;28;01melse\u001b[39;00m:\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/asyn.py:56\u001b[39m, in \u001b[36m_runner\u001b[39m\u001b[34m()\u001b[39m\n\u001b[32m     55\u001b[39m \u001b[38;5;28;01mtry\u001b[39;00m:\n\u001b[32m---> \u001b[39m\u001b[32m56\u001b[39m     result[\u001b[32m0\u001b[39m] = \u001b[38;5;28;01mawait\u001b[39;00m coro\n\u001b[32m     57\u001b[39m \u001b[38;5;28;01mexcept\u001b[39;00m \u001b[38;5;167;01mException\u001b[39;00m \u001b[38;5;28;01mas\u001b[39;00m ex:\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/asyn.py:464\u001b[39m, in \u001b[36m_cat\u001b[39m\u001b[34m()\u001b[39m\n\u001b[32m    463\u001b[39m     \u001b[38;5;28;01mif\u001b[39;00m ex:\n\u001b[32m--> \u001b[39m\u001b[32m464\u001b[39m         \u001b[38;5;28;01mraise\u001b[39;00m ex\n\u001b[32m    465\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m (\n\u001b[32m    466\u001b[39m     \u001b[38;5;28mlen\u001b[39m(paths) > \u001b[32m1\u001b[39m\n\u001b[32m    467\u001b[39m     \u001b[38;5;129;01mor\u001b[39;00m \u001b[38;5;28misinstance\u001b[39m(path, \u001b[38;5;28mlist\u001b[39m)\n\u001b[32m    468\u001b[39m     \u001b[38;5;129;01mor\u001b[39;00m paths[\u001b[32m0\u001b[39m] != \u001b[38;5;28mself\u001b[39m._strip_protocol(path)\n\u001b[32m    469\u001b[39m ):\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/asyn.py:244\u001b[39m, in \u001b[36m_run_coro\u001b[39m\u001b[34m()\u001b[39m\n\u001b[32m    243\u001b[39m \u001b[38;5;28;01mtry\u001b[39;00m:\n\u001b[32m--> \u001b[39m\u001b[32m244\u001b[39m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28;01mawait\u001b[39;00m asyncio.wait_for(coro, timeout=timeout), i\n\u001b[32m    245\u001b[39m \u001b[38;5;28;01mexcept\u001b[39;00m \u001b[38;5;167;01mException\u001b[39;00m \u001b[38;5;28;01mas\u001b[39;00m e:\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/asyncio/tasks.py:520\u001b[39m, in \u001b[36mwait_for\u001b[39m\u001b[34m()\u001b[39m\n\u001b[32m    519\u001b[39m \u001b[38;5;28;01masync\u001b[39;00m \u001b[38;5;28;01mwith\u001b[39;00m timeouts.timeout(timeout):\n\u001b[32m--> \u001b[39m\u001b[32m520\u001b[39m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28;01mawait\u001b[39;00m fut\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/implementations/http.py:246\u001b[39m, in \u001b[36m_cat_file\u001b[39m\u001b[34m()\u001b[39m\n\u001b[32m    245\u001b[39m     out = \u001b[38;5;28;01mawait\u001b[39;00m r.read()\n\u001b[32m--> \u001b[39m\u001b[32m246\u001b[39m     \u001b[38;5;28mself\u001b[39m._raise_not_found_for_status(r, url)\n\u001b[32m    247\u001b[39m \u001b[38;5;28;01mreturn\u001b[39;00m out\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/fsspec/implementations/http.py:229\u001b[39m, in \u001b[36m_raise_not_found_for_status\u001b[39m\u001b[34m()\u001b[39m\n\u001b[32m    228\u001b[39m     \u001b[38;5;28;01mraise\u001b[39;00m \u001b[38;5;167;01mFileNotFoundError\u001b[39;00m(url)\n\u001b[32m--> \u001b[39m\u001b[32m229\u001b[39m response.raise_for_status()\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/aiohttp/client_reqrep.py:629\u001b[39m, in \u001b[36mraise_for_status\u001b[39m\u001b[34m()\u001b[39m\n\u001b[32m    627\u001b[39m     \u001b[38;5;28mself\u001b[39m.release()\n\u001b[32m--> \u001b[39m\u001b[32m629\u001b[39m \u001b[38;5;28;01mraise\u001b[39;00m ClientResponseError(\n\u001b[32m    630\u001b[39m     \u001b[38;5;28mself\u001b[39m.request_info,\n\u001b[32m    631\u001b[39m     \u001b[38;5;28mself\u001b[39m.history,\n\u001b[32m    632\u001b[39m     status=\u001b[38;5;28mself\u001b[39m.status,\n\u001b[32m    633\u001b[39m     message=\u001b[38;5;28mself\u001b[39m.reason,\n\u001b[32m    634\u001b[39m     headers=\u001b[38;5;28mself\u001b[39m.headers,\n\u001b[32m    635\u001b[39m )\n\n\u001b[31mException\u001b[39m: ClientResponseError(RequestInfo(url=URL('https://osdf1.chic.nrp.internet2.edu:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-historical-cmip6-TEMP.zarr/.zmetadata'), method='GET', headers=<CIMultiDictProxy('Host': 'osdf1.chic.nrp.internet2.edu:8443', 'Accept': '*/*', 'Accept-Encoding': 'gzip, deflate, br', 'User-Agent': 'Python/3.12 aiohttp/3.12.15')>, real_url=URL('https://osdf1.chic.nrp.internet2.edu:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-historical-cmip6-TEMP.zarr/.zmetadata')), (<ClientResponse(https://osdf-data.gdex.ucar.edu/ncar-gdex/d010092/ocn/monthly/cesm2LE-historical-cmip6-TEMP.zarr/.zmetadata) [301 Moved Permanently]>\n<CIMultiDictProxy('Server': 'nginx/1.27.0', 'Date': 'Fri, 03 Oct 2025 01:28:29 GMT', 'Content-Type': 'text/html', 'Content-Length': '169', 'Connection': 'keep-alive', 'Location': 'https://osdf-director.osg-htc.org:443/ncar-gdex/d010092/ocn/monthly/cesm2LE-historical-cmip6-TEMP.zarr/.zmetadata')>\n, <ClientResponse(https://osdf-director.osg-htc.org/ncar-gdex/d010092/ocn/monthly/cesm2LE-historical-cmip6-TEMP.zarr/.zmetadata) [307 Temporary Redirect]>\n<CIMultiDictProxy('Access-Control-Allow-Headers': 'Content-Type, Authorization, Depth', 'Access-Control-Allow-Methods': 'GET, POST, PROPFIND, OPTIONS', 'Access-Control-Allow-Origin': '*', 'Access-Control-Expose-Headers': 'Content-Type, Authorization, X-Pelican-User, X-Pelican-Timeout, X-Pelican-Token-Generation, X-Pelican-Authorization, X-Pelican-Namespace', 'Content-Length': '153', 'Content-Type': 'text/html; charset=utf-8', 'Date': 'Fri, 03 Oct 2025 01:28:29 GMT', 'Link': '<https://osdf1.chic.nrp.internet2.edu:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-historical-cmip6-TEMP.zarr/.zmetadata>; rel=\"duplicate\"; pri=1; depth=5, <https://dtn-pas.kans.nrp.internet2.edu:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-historical-cmip6-TEMP.zarr/.zmetadata>; rel=\"duplicate\"; pri=2; depth=5, <https://osg-hawk-cache.cc.lehigh.edu:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-historical-cmip6-TEMP.zarr/.zmetadata>; rel=\"duplicate\"; pri=3; depth=5, <https://osdf1.newy32aoa.nrp.internet2.edu:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-historical-cmip6-TEMP.zarr/.zmetadata>; rel=\"duplicate\"; pri=4; depth=5, <https://dtn-pas.jack.nrp.internet2.edu:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-historical-cmip6-TEMP.zarr/.zmetadata>; rel=\"duplicate\"; pri=5; depth=5, <https://dtn-pas.cinc.nrp.internet2.edu:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-historical-cmip6-TEMP.zarr/.zmetadata>; rel=\"duplicate\"; pri=6; depth=5', 'Location': 'https://osdf1.chic.nrp.internet2.edu:8443/ncar-gdex/d010092/ocn/monthly/cesm2LE-historical-cmip6-TEMP.zarr/.zmetadata', 'Server': 'pelican/7.20.1', 'X-Pelican-Authorization': 'issuer=https://ncar-s3-origin.nationalresearchplatform.org:8000', 'X-Pelican-Jobid': 'd633dc6f-9c22-41e5-843b-5b7f4afda17e', 'X-Pelican-Namespace': 'namespace=/ncar-gdex, require-token=false, collections-url=https://ncar-s3-origin.nationalresearchplatform.org:8444', 'X-Pelican-Token-Generation': 'issuer=https://ncar-s3-origin.nationalresearchplatform.org:8000, max-scope-depth=3, strategy=OAuth2, base-path=/ncar-gdex')>\n), status=504, message='Gateway Timeout', headers=<CIMultiDictProxy('Connection': 'Close', 'Server': 'XrootD/v5.8.4', 'Access-Control-Allow-Origin': '*', 'Access-Control-Allow-Headers': 'Authorization,Want-Digest,Content-Type,User-Agent', 'Content-Disposition': 'attachment', 'Content-Length': '107')>)\n\nThe above exception was the direct cause of the following exception:\n\n\u001b[31mESMDataSourceError\u001b[39m                        Traceback (most recent call last)\n\u001b[36mCell\u001b[39m\u001b[36m \u001b[39m\u001b[32mIn[9]\u001b[39m\u001b[32m, line 1\u001b[39m\n\u001b[32m----> \u001b[39m\u001b[32m1\u001b[39m dsets_cesm = \u001b[43mcesm_temp\u001b[49m\u001b[43m.\u001b[49m\u001b[43mto_dataset_dict\u001b[49m\u001b[43m(\u001b[49m\u001b[43m)\u001b[49m\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/pydantic/_internal/_validate_call.py:39\u001b[39m, in \u001b[36mupdate_wrapper_attributes.<locals>.wrapper_function\u001b[39m\u001b[34m(*args, **kwargs)\u001b[39m\n\u001b[32m     37\u001b[39m \u001b[38;5;129m@functools\u001b[39m.wraps(wrapped)\n\u001b[32m     38\u001b[39m \u001b[38;5;28;01mdef\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34mwrapper_function\u001b[39m(*args, **kwargs):\n\u001b[32m---> \u001b[39m\u001b[32m39\u001b[39m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[43mwrapper\u001b[49m\u001b[43m(\u001b[49m\u001b[43m*\u001b[49m\u001b[43margs\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43m*\u001b[49m\u001b[43m*\u001b[49m\u001b[43mkwargs\u001b[49m\u001b[43m)\u001b[49m\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/pydantic/_internal/_validate_call.py:136\u001b[39m, in \u001b[36mValidateCallWrapper.__call__\u001b[39m\u001b[34m(self, *args, **kwargs)\u001b[39m\n\u001b[32m    133\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m \u001b[38;5;28mself\u001b[39m.__pydantic_complete__:\n\u001b[32m    134\u001b[39m     \u001b[38;5;28mself\u001b[39m._create_validators()\n\u001b[32m--> \u001b[39m\u001b[32m136\u001b[39m res = \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43m__pydantic_validator__\u001b[49m\u001b[43m.\u001b[49m\u001b[43mvalidate_python\u001b[49m\u001b[43m(\u001b[49m\u001b[43mpydantic_core\u001b[49m\u001b[43m.\u001b[49m\u001b[43mArgsKwargs\u001b[49m\u001b[43m(\u001b[49m\u001b[43margs\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mkwargs\u001b[49m\u001b[43m)\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    137\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mself\u001b[39m.__return_pydantic_validator__:\n\u001b[32m    138\u001b[39m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28mself\u001b[39m.__return_pydantic_validator__(res)\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/intake_esm/core.py:686\u001b[39m, in \u001b[36mesm_datastore.to_dataset_dict\u001b[39m\u001b[34m(self, xarray_open_kwargs, xarray_combine_by_coords_kwargs, preprocess, storage_options, progressbar, aggregate, skip_on_error, **kwargs)\u001b[39m\n\u001b[32m    684\u001b[39m         \u001b[38;5;28;01mexcept\u001b[39;00m \u001b[38;5;167;01mException\u001b[39;00m \u001b[38;5;28;01mas\u001b[39;00m exc:\n\u001b[32m    685\u001b[39m             \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m skip_on_error:\n\u001b[32m--> \u001b[39m\u001b[32m686\u001b[39m                 \u001b[38;5;28;01mraise\u001b[39;00m exc\n\u001b[32m    687\u001b[39m \u001b[38;5;28mself\u001b[39m.datasets = \u001b[38;5;28mself\u001b[39m._create_derived_variables(datasets, skip_on_error)\n\u001b[32m    688\u001b[39m \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28mself\u001b[39m.datasets\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/intake_esm/core.py:682\u001b[39m, in \u001b[36mesm_datastore.to_dataset_dict\u001b[39m\u001b[34m(self, xarray_open_kwargs, xarray_combine_by_coords_kwargs, preprocess, storage_options, progressbar, aggregate, skip_on_error, **kwargs)\u001b[39m\n\u001b[32m    680\u001b[39m \u001b[38;5;28;01mfor\u001b[39;00m task \u001b[38;5;129;01min\u001b[39;00m gen:\n\u001b[32m    681\u001b[39m     \u001b[38;5;28;01mtry\u001b[39;00m:\n\u001b[32m--> \u001b[39m\u001b[32m682\u001b[39m         key, ds = \u001b[43mtask\u001b[49m\u001b[43m.\u001b[49m\u001b[43mresult\u001b[49m\u001b[43m(\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    683\u001b[39m         datasets[key] = ds\n\u001b[32m    684\u001b[39m     \u001b[38;5;28;01mexcept\u001b[39;00m \u001b[38;5;167;01mException\u001b[39;00m \u001b[38;5;28;01mas\u001b[39;00m exc:\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/concurrent/futures/_base.py:449\u001b[39m, in \u001b[36mFuture.result\u001b[39m\u001b[34m(self, timeout)\u001b[39m\n\u001b[32m    447\u001b[39m     \u001b[38;5;28;01mraise\u001b[39;00m CancelledError()\n\u001b[32m    448\u001b[39m \u001b[38;5;28;01melif\u001b[39;00m \u001b[38;5;28mself\u001b[39m._state == FINISHED:\n\u001b[32m--> \u001b[39m\u001b[32m449\u001b[39m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43m__get_result\u001b[49m\u001b[43m(\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    451\u001b[39m \u001b[38;5;28mself\u001b[39m._condition.wait(timeout)\n\u001b[32m    453\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mself\u001b[39m._state \u001b[38;5;129;01min\u001b[39;00m [CANCELLED, CANCELLED_AND_NOTIFIED]:\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/concurrent/futures/_base.py:401\u001b[39m, in \u001b[36mFuture.__get_result\u001b[39m\u001b[34m(self)\u001b[39m\n\u001b[32m    399\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mself\u001b[39m._exception:\n\u001b[32m    400\u001b[39m     \u001b[38;5;28;01mtry\u001b[39;00m:\n\u001b[32m--> \u001b[39m\u001b[32m401\u001b[39m         \u001b[38;5;28;01mraise\u001b[39;00m \u001b[38;5;28mself\u001b[39m._exception\n\u001b[32m    402\u001b[39m     \u001b[38;5;28;01mfinally\u001b[39;00m:\n\u001b[32m    403\u001b[39m         \u001b[38;5;66;03m# Break a reference cycle with the exception in self._exception\u001b[39;00m\n\u001b[32m    404\u001b[39m         \u001b[38;5;28mself\u001b[39m = \u001b[38;5;28;01mNone\u001b[39;00m\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/concurrent/futures/thread.py:59\u001b[39m, in \u001b[36m_WorkItem.run\u001b[39m\u001b[34m(self)\u001b[39m\n\u001b[32m     56\u001b[39m     \u001b[38;5;28;01mreturn\u001b[39;00m\n\u001b[32m     58\u001b[39m \u001b[38;5;28;01mtry\u001b[39;00m:\n\u001b[32m---> \u001b[39m\u001b[32m59\u001b[39m     result = \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mfn\u001b[49m\u001b[43m(\u001b[49m\u001b[43m*\u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43margs\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43m*\u001b[49m\u001b[43m*\u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mkwargs\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m     60\u001b[39m \u001b[38;5;28;01mexcept\u001b[39;00m \u001b[38;5;167;01mBaseException\u001b[39;00m \u001b[38;5;28;01mas\u001b[39;00m exc:\n\u001b[32m     61\u001b[39m     \u001b[38;5;28mself\u001b[39m.future.set_exception(exc)\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/intake_esm/core.py:833\u001b[39m, in \u001b[36m_load_source\u001b[39m\u001b[34m(key, source)\u001b[39m\n\u001b[32m    832\u001b[39m \u001b[38;5;28;01mdef\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34m_load_source\u001b[39m(key, source):\n\u001b[32m--> \u001b[39m\u001b[32m833\u001b[39m     \u001b[38;5;28;01mreturn\u001b[39;00m key, \u001b[43msource\u001b[49m\u001b[43m.\u001b[49m\u001b[43mto_dask\u001b[49m\u001b[43m(\u001b[49m\u001b[43m)\u001b[49m\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/intake_esm/source.py:272\u001b[39m, in \u001b[36mESMDataSource.to_dask\u001b[39m\u001b[34m(self)\u001b[39m\n\u001b[32m    270\u001b[39m \u001b[38;5;28;01mdef\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34mto_dask\u001b[39m(\u001b[38;5;28mself\u001b[39m):\n\u001b[32m    271\u001b[39m \u001b[38;5;250m    \u001b[39m\u001b[33;03m\"\"\"Return xarray object (which will have chunks)\"\"\"\u001b[39;00m\n\u001b[32m--> \u001b[39m\u001b[32m272\u001b[39m     \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43m_load_metadata\u001b[49m\u001b[43m(\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    273\u001b[39m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28mself\u001b[39m._ds\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/intake/source/base.py:283\u001b[39m, in \u001b[36mDataSourceBase._load_metadata\u001b[39m\u001b[34m(self)\u001b[39m\n\u001b[32m    281\u001b[39m \u001b[38;5;250m\u001b[39m\u001b[33;03m\"\"\"load metadata only if needed\"\"\"\u001b[39;00m\n\u001b[32m    282\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mself\u001b[39m._schema \u001b[38;5;129;01mis\u001b[39;00m \u001b[38;5;28;01mNone\u001b[39;00m:\n\u001b[32m--> \u001b[39m\u001b[32m283\u001b[39m     \u001b[38;5;28mself\u001b[39m._schema = \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43m_get_schema\u001b[49m\u001b[43m(\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    284\u001b[39m     \u001b[38;5;28mself\u001b[39m.dtype = \u001b[38;5;28mself\u001b[39m._schema.dtype\n\u001b[32m    285\u001b[39m     \u001b[38;5;28mself\u001b[39m.shape = \u001b[38;5;28mself\u001b[39m._schema.shape\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/intake_esm/source.py:208\u001b[39m, in \u001b[36mESMDataSource._get_schema\u001b[39m\u001b[34m(self)\u001b[39m\n\u001b[32m    206\u001b[39m \u001b[38;5;28;01mdef\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34m_get_schema\u001b[39m(\u001b[38;5;28mself\u001b[39m) -> Schema:\n\u001b[32m    207\u001b[39m     \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mself\u001b[39m._ds \u001b[38;5;129;01mis\u001b[39;00m \u001b[38;5;28;01mNone\u001b[39;00m:\n\u001b[32m--> \u001b[39m\u001b[32m208\u001b[39m         \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43m_open_dataset\u001b[49m\u001b[43m(\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    209\u001b[39m         metadata: \u001b[38;5;28mdict\u001b[39m[\u001b[38;5;28mstr\u001b[39m, typing.Any] = {\u001b[33m'\u001b[39m\u001b[33mdims\u001b[39m\u001b[33m'\u001b[39m: {}, \u001b[33m'\u001b[39m\u001b[33mdata_vars\u001b[39m\u001b[33m'\u001b[39m: {}, \u001b[33m'\u001b[39m\u001b[33mcoords\u001b[39m\u001b[33m'\u001b[39m: ()}\n\u001b[32m    210\u001b[39m         \u001b[38;5;28mself\u001b[39m._schema = Schema(\n\u001b[32m    211\u001b[39m             datashape=\u001b[38;5;28;01mNone\u001b[39;00m,\n\u001b[32m    212\u001b[39m             dtype=\u001b[38;5;28;01mNone\u001b[39;00m,\n\u001b[32m   (...)\u001b[39m\u001b[32m    215\u001b[39m             extra_metadata=metadata,\n\u001b[32m    216\u001b[39m         )\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/intake_esm/source.py:264\u001b[39m, in \u001b[36mESMDataSource._open_dataset\u001b[39m\u001b[34m(self)\u001b[39m\n\u001b[32m    261\u001b[39m     \u001b[38;5;28mself\u001b[39m._ds.attrs[OPTIONS[\u001b[33m'\u001b[39m\u001b[33mdataset_key\u001b[39m\u001b[33m'\u001b[39m]] = \u001b[38;5;28mself\u001b[39m.key\n\u001b[32m    263\u001b[39m \u001b[38;5;28;01mexcept\u001b[39;00m \u001b[38;5;167;01mException\u001b[39;00m \u001b[38;5;28;01mas\u001b[39;00m exc:\n\u001b[32m--> \u001b[39m\u001b[32m264\u001b[39m     \u001b[38;5;28;01mraise\u001b[39;00m ESMDataSourceError(\n\u001b[32m    265\u001b[39m         \u001b[33mf\u001b[39m\u001b[33m\"\"\"\u001b[39m\u001b[33mFailed to load dataset with key=\u001b[39m\u001b[33m'\u001b[39m\u001b[38;5;132;01m{\u001b[39;00m\u001b[38;5;28mself\u001b[39m.key\u001b[38;5;132;01m}\u001b[39;00m\u001b[33m'\u001b[39m\n\u001b[32m    266\u001b[39m \u001b[33m         You can use `cat[\u001b[39m\u001b[33m'\u001b[39m\u001b[38;5;132;01m{\u001b[39;00m\u001b[38;5;28mself\u001b[39m.key\u001b[38;5;132;01m}\u001b[39;00m\u001b[33m'\u001b[39m\u001b[33m].df` to inspect the assets/files for this key.\u001b[39m\n\u001b[32m    267\u001b[39m \u001b[33m         \u001b[39m\u001b[33m\"\"\"\u001b[39m\n\u001b[32m    268\u001b[39m     ) \u001b[38;5;28;01mfrom\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mexc\u001b[39;00m\n\n\u001b[31mESMDataSourceError\u001b[39m: Failed to load dataset with key='ocn.historical.monthly.cmip6'\n                 You can use `cat['ocn.historical.monthly.cmip6'].df` to inspect the assets/files for this key.\n                 ","ename":"ESMDataSourceError","evalue":"Failed to load dataset with key='ocn.historical.monthly.cmip6'\n                 You can use `cat['ocn.historical.monthly.cmip6'].df` to inspect the assets/files for this key.\n                 "}],"key":"h1RAcX1368"}],"key":"gi2Nz9ADvw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"dsets_cesm.keys()","key":"PLFEkZgx3I"},{"type":"output","id":"7_QDLiwcZLlQjEMJiPK5H","data":[],"key":"AoLQ1Pwmbx"}],"key":"wOkg9545Rs"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"historical       = dsets_cesm['ocn.historical.monthly.cmip6']\nfuture_smbb      = dsets_cesm['ocn.ssp370.monthly.smbb']\nfuture_cmip6     = dsets_cesm['ocn.ssp370.monthly.cmip6']","key":"t7H8aG5oBl"},{"type":"output","id":"O0bBP7H8TCzJYt-cNYM5j","data":[],"key":"SQNBauF6TS"}],"key":"n0yfSKqs1w"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Change units","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CqXqmXoWWy"}],"identifier":"change-units","label":"Change units","html_id":"change-units","implicit":true,"key":"MdnelEg9IJ"}],"key":"Ub3oWBbhlf"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"orig_units = cf.Unit(historical.z_t.attrs['units'])\norig_units","key":"OW1Y7smm8g"},{"type":"output","id":"arCqvjdf4yexQkdbaaN_Z","data":[],"key":"EYGHawZQ7b"}],"key":"fqF7vD8Zb5"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def change_units(ds, variable_str, variable_bounds_str, target_unit_str):\n    orig_units = cf.Unit(ds[variable_str].attrs['units'])\n    target_units = cf.Unit(target_unit_str)\n    variable_in_new_units = xr.apply_ufunc(orig_units.convert, ds[variable_bounds_str], target_units, dask='parallelized', output_dtypes=[ds[variable_bounds_str].dtype])\n    return variable_in_new_units","key":"HNK0fGHKTi"},{"type":"output","id":"l1_7ZXm7g2Q3o2JOvbnvi","data":[],"key":"Veq0o1bnVu"}],"key":"wyWWxRoSxX"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"depth_levels_in_m = change_units(historical, 'z_t', 'z_t', 'm')\nhist_temp_in_degK = change_units(historical, 'TEMP', 'TEMP', 'degK')\nfut_cmip6_temp_in_degK = change_units(future_cmip6, 'TEMP', 'TEMP', 'degK')\nfut_smbb_temp_in_degK = change_units(future_smbb, 'TEMP', 'TEMP', 'degK')\n#\nhist_temp_in_degK  = hist_temp_in_degK.assign_coords(z_t=(\"z_t\", depth_levels_in_m['z_t'].data))\nhist_temp_in_degK[\"z_t\"].attrs[\"units\"] = \"m\"\nhist_temp_in_degK","key":"dKJGkXUiT4"},{"type":"output","id":"nHAJzizfYSIDQhYQywhi1","data":[],"key":"Zto3pVlZVV"}],"key":"JXL75mHOuJ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"depth_levels_in_m.isel(z_t=slice(0, -1))","key":"PIx8pJR37Y"},{"type":"output","id":"wptEJOmzCO64ffa-biyHW","data":[],"key":"M4v5KI1EpU"}],"key":"QoQqzAM9aq"},{"type":"block","kind":"notebook-content","children":[{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Compute depth level deltas using the difference of z_t levels","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CdYEYfrIBq"}],"key":"bVM80FLo7e"}],"key":"eF19pIwpXF"}],"key":"Ryg3H1tuUM"}],"key":"JP3pD5dVA0"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"depth_level_deltas = depth_levels_in_m.isel(z_t=slice(1, None)).values - depth_levels_in_m.isel(z_t=slice(0, -1)).values\n# Optionally, if you want to keep it as an xarray DataArray, re-wrap the result\ndepth_level_deltas = xr.DataArray(depth_level_deltas, dims=[\"z_t\"], coords={\"z_t\": depth_levels_in_m.z_t.isel(z_t=slice(0, -1))})\ndepth_level_deltas  ","key":"wnuQlCS5dj"},{"type":"output","id":"WnCz0qMEbRj07hDMC0VFn","data":[],"key":"LTsgYsPgE5"}],"key":"kIrhQ1Hh2C"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Compute Ocean Heat content for ocean surface","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jLlhxHPkU4"}],"identifier":"compute-ocean-heat-content-for-ocean-surface","label":"Compute Ocean Heat content for ocean surface","html_id":"compute-ocean-heat-content-for-ocean-surface","implicit":true,"key":"hytEnFh2im"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Ocean surface is considered to be the top 100m","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"R18B3gIA0V"}],"key":"YnGw03VoH1"}],"key":"qpO92fO7fV"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The formula for this is: ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"G0EGbKQdgx"}],"key":"RpWoQ2XJUH"},{"type":"math","value":"H = \\rho C \\int_0^z T(z) dz","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>H</mi><mo>=</mo><mi>ρ</mi><mi>C</mi><msubsup><mo>∫</mo><mn>0</mn><mi>z</mi></msubsup><mi>T</mi><mo stretchy=\"false\">(</mo><mi>z</mi><mo stretchy=\"false\">)</mo><mi>d</mi><mi>z</mi></mrow><annotation encoding=\"application/x-tex\">H = \\rho C \\int_0^z T(z) dz</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.3262em;vertical-align:-0.9119em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">ρC</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\"><span class=\"mop op-symbol large-op\" style=\"margin-right:0.44445em;position:relative;top:-0.0011em;\">∫</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.4143em;\"><span style=\"top:-1.7881em;margin-left:-0.4445em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span><span style=\"top:-3.8129em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.04398em;\">z</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9119em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span><span class=\"mclose\">)</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span></span></span></span></span>","enumerator":"1","key":"BLpbYVWVqh"}],"key":"pbvgSGX4jy"}],"key":"BPIrZW0fWR"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Where H is ocean heat content, the value we are trying to calculate,","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"p5NowZJolq"}],"key":"rTEvBrE6o0"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"inlineMath","value":"\\rho","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ρ</mi></mrow><annotation encoding=\"application/x-tex\">\\rho</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">ρ</span></span></span></span>","key":"agf6NF8UNT"},{"type":"text","value":" is the density of sea water, ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"IYzVfRByHG"},{"type":"inlineMath","value":"1026 kg/m^3","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1026</mn><mi>k</mi><mi>g</mi><mi mathvariant=\"normal\">/</mi><msup><mi>m</mi><mn>3</mn></msup></mrow><annotation encoding=\"application/x-tex\">1026 kg/m^3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord\">1026</span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord\">/</span><span class=\"mord\"><span class=\"mord mathnormal\">m</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span></span></span></span></span></span></span></span>","key":"sObQmZeP75"},{"type":"text","value":"  ,","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"E4vmUBs0Kj"}],"key":"yzeBVML7V8"},{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"inlineMath","value":"C","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>C</mi></mrow><annotation encoding=\"application/x-tex\">C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span></span></span></span>","key":"jS25zqxM3B"},{"type":"text","value":" is the specific heat of sea water, ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"H2Ll8zsJdk"},{"type":"inlineMath","value":"3990 J/(kg K)","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3990</mn><mi>J</mi><mi mathvariant=\"normal\">/</mi><mo stretchy=\"false\">(</mo><mi>k</mi><mi>g</mi><mi>K</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">3990 J/(kg K)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">3990</span><span class=\"mord mathnormal\" style=\"margin-right:0.09618em;\">J</span><span class=\"mord\">/</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mclose\">)</span></span></span></span>","key":"KyIKDRa8Tl"},{"type":"text","value":"  ,","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"Y6unHFt8V3"}],"key":"GmuTDANvnx"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"inlineMath","value":"z","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>z</mi></mrow><annotation encoding=\"application/x-tex\">z</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span></span></span></span>","key":"mcD5IHKLQp"},{"type":"text","value":" is the depth limit of the calculation in meters,","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"Z2qidrq01q"}],"key":"bVe5Zi0wSQ"},{"type":"paragraph","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"and ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"E0PrrjvPjE"},{"type":"inlineMath","value":"T(z)","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>T</mi><mo stretchy=\"false\">(</mo><mi>z</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">T(z)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span><span class=\"mclose\">)</span></span></span></span>","key":"m721qtiny4"},{"type":"text","value":" is the temperature at each depth in degrees Kelvin.","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"Yv6eCHdorL"}],"key":"xuIKCU34ZQ"}],"key":"YnZK0AUlZL"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def calc_ocean_heat(delta_level, temperature):\n    rho = 1026 #kg/m^3\n    c_p = 3990 #J/(kg K)\n    weighted_temperature = delta_level * temperature\n    heat = weighted_temperature.sum(dim=\"z_t\")*rho*c_p\n    return heat","key":"MNRDoze5rv"},{"type":"output","id":"HlZWCJaLultgh1oJzIskF","data":[],"key":"DHNod2a2qF"}],"key":"qbkL9hdLq7"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Remember that the coordinate z_t still has values in cm\nhist_temp_ocean_surface = hist_temp_in_degK.where(hist_temp_in_degK['z_t'] < 1e4,drop=True)\nhist_temp_ocean_surface","key":"hLKYOpiVPS"},{"type":"output","id":"duGvofmCER-u9jeEQsrbP","data":[],"key":"RaPnSdUm8e"}],"key":"HxT70rSQqe"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"depth_level_deltas_surface = depth_level_deltas.where(depth_level_deltas['z_t'] <1e4, drop= True)\ndepth_level_deltas_surface","key":"aVT9sEJBEe"},{"type":"output","id":"FVg2nwGUkRpV5iOB3-1Mq","data":[],"key":"HhrU3asm5F"}],"key":"LUOC29apYO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"hist_ocean_heat = calc_ocean_heat(depth_level_deltas_surface,hist_temp_ocean_surface)\nhist_ocean_heat","key":"DpnBUsN8FY"},{"type":"output","id":"j6K4ddN0FYQX6y17aHN7U","data":[],"key":"r4ebquGITo"}],"key":"q2nWcKUkMy"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot Ocean Heat","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"t0BXOrfSlL"}],"identifier":"plot-ocean-heat","label":"Plot Ocean Heat","html_id":"plot-ocean-heat","implicit":true,"key":"jlShbI8aF1"}],"key":"TGMjjXIsSC"},{"type":"block","kind":"notebook-content","children":[{"type":"admonition","kind":"attention","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Attention","key":"QeOMeBe9ba"}],"key":"COYpuvbACq"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Has the surface ocean heat content increased with time due to Global Warming ?\nLet us plot the difference between the annual, ensemble mean heat content between the years 2014 and 1850 to check!","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"NXZtf3EgRR"}],"key":"oPP61jW0KN"}],"key":"O9tBD93YM2"}],"key":"wB0cmxwuMt"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%%time\n# Compute annual and ensemble mean\nhist_oceanheat_ann_mean = hist_ocean_heat.mean('member_id').groupby('time.year').mean()\nhist_oceanheat_ann_mean ","key":"QcRt0rZxPV"},{"type":"output","id":"erhY3ZBJnn3TPAVkUxTbr","data":[],"key":"lxdfpYeVhF"}],"key":"ZbbG6lJy3y"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"hist_oceanheat_ano = \\\nhist_oceanheat_ann_mean.sel(year=2014) - hist_oceanheat_ann_mean.sel(year=1850)","key":"WEVT9x1zMg"},{"type":"output","id":"kf_OazswNP42Gdzhltr0m","data":[],"key":"yM8KUrfgcI"}],"key":"nReYdUrwBP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%%time\nhist_oceanheat_ano.plot()","key":"e4iCFitryI"},{"type":"output","id":"vh87gaMe7R-03oqtAt2Jv","data":[],"key":"yOt5uk5b4A"}],"key":"zp1zVaHxhu"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Indeed! The surface ocean is trapping heat as the globe warms!","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WOfjU8ZwnJ"}],"key":"ylvSbGK6o1"}],"key":"NzjiCofHuL"},{"type":"block","kind":"notebook-content","children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iWzKvtzq6l"}],"key":"a2w0V4F4Jd"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Summary","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qLa7pcyynh"}],"identifier":"summary","label":"Summary","html_id":"summary","implicit":true,"key":"Yl8ODHCCgr"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"In this notebook we used sea temperature data from the Community Earth System Model (CESM2) Large Ensemble dataset to compute surface ocean heat and convince ourselves that the surface ocean is trapping extra heat as the globe warms. We used an intake-ESM catalog backed by pelican links to stream data from NCAR’s Geoscience Data Exchange via NCAR’s OSDF origin!","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"eURvYRWlS7"}],"key":"vPUgcZkod7"},{"type":"heading","depth":4,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"What’s next?","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"mhFK38C5HW"}],"identifier":"whats-next","label":"What’s next?","html_id":"whats-next","implicit":true,"key":"vTlIlA9WoJ"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"In the next notebook, we will see how to load data from multiple OSDF origins into a workflow. We will stream CMIP6 model data from AWS and observational data from NCAR’s GDEX.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"j9vMDXHpHR"}],"key":"fUbj6lmXe7"}],"key":"OKJgymkiS0"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Resources and references","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lm7AVNUnKA"}],"identifier":"resources-and-references","label":"Resources and references","html_id":"resources-and-references","implicit":true,"key":"dcYwgdw5Kw"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Original ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"nGK2JEQrMp"},{"type":"link","url":"https://gallery.pangeo.io/repos/NCAR/notebook-gallery/notebooks/Run-Anywhere/Ocean-Heat-Content/OHC_tutorial.html","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"notebook","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"H2Hv4nO8x5"}],"urlSource":"https://gallery.pangeo.io/repos/NCAR/notebook-gallery/notebooks/Run-Anywhere/Ocean-Heat-Content/OHC_tutorial.html","key":"QvOdE0s5VL"},{"type":"text","value":" on the pangeo NCAR gallery","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"I7aheHDMrI"}],"key":"XV9yphJBxD"}],"key":"aZGypS0snA"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"link","url":"https://www.cesm.ucar.edu/community-projects/lens2","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"CESM2 Large Ensemble Dataset","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"A05BEjVgbE"}],"urlSource":"https://www.cesm.ucar.edu/community-projects/lens2","key":"Hl1uKO6trU"},{"type":"text","value":" (Community Earth System Model 2) hosted on NCAR’s GDEX.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Co6YdllAZz"}],"key":"qqSSgoD6hw"}],"key":"Kbi7oSNp4J"}],"key":"rcSWF92Uce"}],"key":"s80I9SlCgE"}],"key":"AJWosioNkW"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Introduction to NSF NCAR’s Geoscience Data Exhcange","url":"/notebooks/ncar-intro","group":"NCAR examples"},"next":{"title":"Global Mean Surface Temperature Anomalies (GMSTA) from CMIP6 data","url":"/notebooks/cmip6-gmst","group":"NCAR examples"}}},"domain":"http://localhost:3000"}