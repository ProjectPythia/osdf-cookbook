{"version":2,"kind":"Notebook","sha256":"0ba524d9363a1973fb82642b3b8fc68a041e678852dec8b3bb51a7d88a3d22ec","slug":"notebooks.sonarai-technical","location":"/notebooks/04_SonarAI_Technical.ipynb","dependencies":[],"frontmatter":{"title":"Contextual Integration of NCAR/NOAA Environmental Data with the NOAA Water Column Sonar Archive","content_includes_title":true,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"authors":[{"nameParsed":{"literal":"Harsha R. Hampapura","given":"Harsha R.","family":"Hampapura"},"name":"Harsha R. Hampapura","id":"contributors-myst-generated-uid-0"},{"nameParsed":{"literal":"Brian Bockelman","given":"Brian","family":"Bockelman"},"name":"Brian Bockelman","id":"contributors-myst-generated-uid-1"},{"nameParsed":{"literal":"Alexander Hoelzeman","given":"Alexander","family":"Hoelzeman"},"name":"Alexander Hoelzeman","id":"contributors-myst-generated-uid-2"},{"nameParsed":{"literal":"Carrie Wall","given":"Carrie","family":"Wall"},"name":"Carrie Wall","id":"contributors-myst-generated-uid-3"},{"nameParsed":{"literal":"Emma Turetsky","given":"Emma","family":"Turetsky"},"name":"Emma Turetsky","id":"contributors-myst-generated-uid-4"},{"nameParsed":{"literal":"Amandha Wingert Barok","given":"Amandha Wingert","family":"Barok"},"name":"Amandha Wingert Barok","id":"contributors-myst-generated-uid-5"},{"nameParsed":{"literal":"Aashish Panta","given":"Aashish","family":"Panta"},"name":"Aashish Panta","id":"contributors-myst-generated-uid-6"},{"nameParsed":{"literal":"Riley Conroy","given":"Riley","family":"Conroy"},"name":"Riley Conroy","id":"contributors-myst-generated-uid-7"},{"nameParsed":{"literal":"Douglas Schuster","given":"Douglas","family":"Schuster"},"name":"Douglas Schuster","id":"contributors-myst-generated-uid-8"},{"nameParsed":{"literal":"Justin Hiemstra","given":"Justin","family":"Hiemstra"},"name":"Justin Hiemstra","id":"contributors-myst-generated-uid-9"},{"nameParsed":{"literal":"Joanmarie Del Vecchio","given":"Joanmarie Del","family":"Vecchio"},"name":"Joanmarie Del Vecchio","id":"contributors-myst-generated-uid-10"},{"nameParsed":{"literal":"Kibiwott Koech","given":"Kibiwott","family":"Koech"},"name":"Kibiwott Koech","id":"contributors-myst-generated-uid-11"}],"open_access":true,"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true},"code":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true}},"github":"https://github.com/projectpythia/osdf-cookbook","copyright":"2024","affiliations":[{"id":"UAlbany","name":"University at Albany (SUNY)","department":"Atmospheric and Environmental Sciences","url":"https://www.albany.edu/daes"},{"id":"CISL","name":"NSF National Center for Atmospheric Research","department":"Computational and Information Systems Lab","url":"https://www.cisl.ucar.edu"},{"id":"Unidata","name":"NSF Unidata","url":"https://www.unidata.ucar.edu"},{"id":"Argonne","name":"Argonne National Laboratory","department":"Environmental Science Division","url":"https://www.anl.gov/evs"},{"id":"CarbonPlan","name":"CarbonPlan","url":"https://carbonplan.org"},{"id":"NVIDIA","name":"NVIDIA Corporation","url":"https://www.nvidia.com/"}],"numbering":{"title":{"offset":1}},"source_url":"https://github.com/projectpythia/osdf-cookbook/blob/main/notebooks/04_SonarAI_Technical.ipynb","edit_url":"https://github.com/projectpythia/osdf-cookbook/edit/main/notebooks/04_SonarAI_Technical.ipynb","exports":[{"format":"ipynb","filename":"04_SonarAI_Technical.ipynb","url":"/osdf-cookbook/build/04_SonarAI_Technical-c1dfe0ce546a4a72dfee5351ab3f90aa.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"code","lang":"","value":"","key":"aisP7uOwsr"}],"key":"IrwxYUiNL0"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Contextual Integration of NCAR/NOAA Environmental Data with the NOAA Water Column Sonar Archive","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mOv4fBjNQU"}],"identifier":"contextual-integration-of-ncar-noaa-environmental-data-with-the-noaa-water-column-sonar-archive","label":"Contextual Integration of NCAR/NOAA Environmental Data with the NOAA Water Column Sonar Archive","html_id":"contextual-integration-of-ncar-noaa-environmental-data-with-the-noaa-water-column-sonar-archive","implicit":true,"key":"HBrRSQd9bx"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This notebook walks through an end-to-end workflow to relate shipboard sonar backscatter (Sv) to local environmental conditions. We (1) open EK60 data from a public NOAA S3 Zarr, (2) gather co-located environmental variables from OISST and IOOS ERDDAP, (3) compute hourly mean Sv, (4) assemble a depth×time error map for reference, and (5) synchronize timestamps to produce an interactive line-plus-heatmap visualization. All selections (time/depth/frequency) and conversions are kept explicit for reproducibility.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"POBgaLSBih"}],"key":"CkgmS5H6kH"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Imports","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"oYhYju1LJp"}],"key":"L2MZKNb7PB"},{"type":"text","value":"\nLoad core libraries for data access (xarray, s3fs), analysis (numpy, pandas), plotting (plotly), and I/O.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"lNvrlFxz5V"}],"key":"tfdFrrE9Ca"}],"key":"tg9ysw7VMm"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"strong","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Initializing the datasets","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"cVA1LUGJSh"}],"key":"Ad4xZdS3SW"},{"type":"text","value":"\nAccess HB1906 EK60 Zarr data from public S3; subset by time/depth, select 38 kHz, and mask bins below bottom.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"Nt2GXrxerG"}],"key":"j7PeO5AYkc"}],"key":"b0uN43jD5o"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"strong","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Access buoy data","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"tZUFkeGl8l"}],"key":"aaTf2g2WHQ"},{"type":"text","value":"\nDefine Georges Bank buoy coordinates, sample daily OISST SST at the nearest grid cell (±1 day), and download the model error map (","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"yhf88srdaO"},{"type":"inlineCode","value":".npy","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"WcfKLUhf4l"},{"type":"text","value":").","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"dI2HeEDTEt"}],"key":"Q2ccm9Htrj"}],"key":"rBN6LYJziR"},{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"strong","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Calculate the temperature anomaly, sun elevation in degree and azimuth","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"RmDX9rub2B"}],"key":"zYjdrPIhQY"}],"key":"JF0x45OhWN"}],"key":"Fykwl28Phv"},{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":16,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"strong","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Downloading external error map for the specific location","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"QdbZwLU6KU"}],"key":"ZgGW5P9R20"},{"type":"text","value":"\nDownloading the error map comes from a fixed file","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"S5yvrgachI"}],"key":"To7iJMPUoP"}],"key":"GPH0LIW4Ay"},{"type":"listItem","spread":true,"position":{"start":{"line":19,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":19,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"strong","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Helper Function: Mean Sv (dB)","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"NAeUflJJqw"}],"key":"hyjyvmXG6L"},{"type":"text","value":"\nConvert Sv from dB→linear, compute mean, convert back to dB.","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"zXYsZ0kwLv"}],"key":"DaubjTxYTN"}],"key":"XcbwX6TwPy"},{"type":"listItem","spread":true,"position":{"start":{"line":22,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":22,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"strong","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"Group Cruise Data into Hourly Chunks","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"tSokIAwsc8"}],"key":"aEf3oli7cq"},{"type":"text","value":"\nAdd an hourly label and split the EK60 dataset into per-hour ","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"dwFPWbP9iG"},{"type":"inlineCode","value":"xarray.Dataset","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"HzBArQEaaU"},{"type":"text","value":" chunks.","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"XWD6xVlnB8"}],"key":"ajdWuFjSJA"}],"key":"niwt3HaXjn"},{"type":"listItem","spread":true,"position":{"start":{"line":25,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":25,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"strong","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"Compute Hourly Mean Sv & Attach to ","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"fMNtyh4ei4"},{"type":"inlineCode","value":"env_df","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"dN10Jdl2WE"}],"key":"tJaNahPavz"},{"type":"text","value":"\nAggregate Sv per hour and append results as a new column in the environmental dataframe.","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"JA6ZKhjL0a"}],"key":"MNjJl5ilPH"}],"key":"AYfGIUb7xS"},{"type":"listItem","spread":true,"position":{"start":{"line":28,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":28,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"strong","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"Build Depth×Time Error-Map DataFrame & Align Timestamps","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"uTSm8S5BMY"}],"key":"ULO26p6bLC"},{"type":"text","value":"\nConstruct a depth-by-time matrix from the error map, guard for size mismatches, and align ","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"WrZYt9y0PL"},{"type":"inlineCode","value":"env_df","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"qQ8oB6cSeG"},{"type":"text","value":" endpoints to the heatmap timestamps.","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"Vy5C5QEUzC"}],"key":"DgpeTisZRS"}],"key":"lSUxqwDsec"},{"type":"listItem","spread":true,"position":{"start":{"line":31,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":31,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"strong","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"Data Visualization: Synchronized Lines + Heatmap","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"ux1qHlGzm7"}],"key":"ydttPPTGeS"},{"type":"text","value":"\nPlot environmental time series above a depth×time heatmap with shared x-axis; save interactive HTML output.","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"gTHhrD6eaW"}],"key":"rQc1V26JK8"}],"key":"P8T1zOz5Od"}],"key":"H7nRLjLY2H"}],"key":"R2bBwcoKRg"},{"type":"block","kind":"notebook-content","children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZiFp9s8HbO"}],"key":"ntKc2g6U1n"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Prerequisites","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Ib2Vpewk3l"}],"identifier":"prerequisites","label":"Prerequisites","html_id":"prerequisites","implicit":true,"key":"CI72JOHUZm"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"This section was inspired by ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"nmVWlRUThW"},{"type":"link","url":"https://github.com/alan-turing-institute/the-turing-way/blob/master/book/templates/chapter-template/chapter-landing-page.md","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"this template","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"cQcOp16ek6"}],"urlSource":"https://github.com/alan-turing-institute/the-turing-way/blob/master/book/templates/chapter-template/chapter-landing-page.md","data":{"kind":"file","org":"alan-turing-institute","repo":"the-turing-way","reference":"master","file":"book/templates/chapter-template/chapter-landing-page.md","raw":"https://raw.githubusercontent.com/alan-turing-institute/the-turing-way/master/book/templates/chapter-template/chapter-landing-page.md"},"internal":false,"protocol":"github","key":"vdnNl9yKbs"},{"type":"text","value":" of the wonderful ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"ECbPplvt8X"},{"type":"link","url":"https://the-turing-way.netlify.app","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"The Turing Way","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"OUrdcHRCdq"}],"urlSource":"https://the-turing-way.netlify.app","key":"mGJBLIB2wH"},{"type":"text","value":" Jupyter Book.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"jtlJXb6oZo"}],"key":"fA4RdW39Un"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"This notebook opens public NOAA EK60 Zarr data from S3, subsets by time/depth, reads daily OISST SST near a buoy, fetches ERDDAP environmental variables, computes hourly mean ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Q4W2Nncan8"},{"type":"strong","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Sv","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"HWqN5Seekq"}],"key":"pCpS5M3CkK"},{"type":"text","value":" (dB), aligns with a depth×time error map, and renders synchronized line/heatmap plots.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"ULrld9G5EL"}],"key":"V9o0e60w59"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Label the importance of each concept explicitly as ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"m1kHYZ5Hhx"},{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"helpful/necessary","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"ED9OjCoW6a"}],"key":"HEZtPTeabT"},{"type":"text","value":".","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"p9y3QvX48n"}],"key":"KxeBADyqBy"},{"type":"table","position":{"start":{"line":8,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"tableRow","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"tableCell","header":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Concepts","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"TIoLU7pGhq"}],"key":"c7JmX7KYKi"},{"type":"tableCell","header":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Importance","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"PPuIBjXTb7"}],"key":"bAT4RMmcAY"},{"type":"tableCell","header":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Notes","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"Vs9UFxq8ZV"}],"key":"AtxsIKuwzO"}],"key":"eNVkcS9F7T"},{"type":"tableRow","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Xarray + Zarr basics","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"fNSPvjJdt1"}],"key":"VL0AD3PuBp"},{"type":"tableCell","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"strong","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Necessary","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"lbWC76raN5"}],"key":"Qm9Lg7VmS9"}],"key":"FE7YQacoeq"},{"type":"tableCell","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Opening Zarr stores, selecting by coords/dims, ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"UH1o9EbTvz"},{"type":"inlineCode","value":".compute()","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"KxHbzskaSK"},{"type":"text","value":" semantics","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"Z2VAnOhMFq"}],"key":"ZwClPpUWZs"}],"key":"QhRhb5zX0a"},{"type":"tableRow","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"s3fs & public S3 access","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"qpHUuVeuoA"}],"key":"aSaK2tdoqV"},{"type":"tableCell","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"strong","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Necessary","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"WlvzcPdNi0"}],"key":"On1AboWGAP"}],"key":"mK0C43ZpeX"},{"type":"tableCell","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Anonymous reads from AWS S3 (","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"srHyg5KDGf"},{"type":"inlineCode","value":"anon=True","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"R6mdmQ53hM"},{"type":"text","value":")","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"qHQ1WJmgif"}],"key":"Dt2Shjx9eU"}],"key":"mvWboZa4Ug"},{"type":"tableRow","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Pandas time series","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"KTxvnNz6eM"}],"key":"YF8vRXVbZ3"},{"type":"tableCell","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"strong","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Necessary","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"OIbaj0ZipB"}],"key":"D6Eo62RFvq"}],"key":"kSL97vMF2T"},{"type":"tableCell","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"inlineCode","value":"DatetimeIndex","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"l8p5RLOZsE"},{"type":"text","value":", sorting, filtering, timezone-naive vs. aware","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"MrmN6iRmEr"}],"key":"ErKKT4CEyc"}],"key":"LOMq3ZDTVo"},{"type":"tableRow","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"NumPy fundamentals","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"hZ68nK5yL0"}],"key":"gfK2yNVK9Y"},{"type":"tableCell","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"strong","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Necessary","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"rGw5E3nzBK"}],"key":"OEpwNiOTbv"}],"key":"MkdDoYhyzN"},{"type":"tableCell","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Array slicing, stats, type conversion","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"humFmaluOh"}],"key":"GIYNj9tEW3"}],"key":"y7cWuDzYPO"},{"type":"tableRow","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Acoustic backscatter (Sv) & dB averaging","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"IXM83yJoR0"}],"key":"vv0nI6U1Tm"},{"type":"tableCell","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"strong","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Necessary","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"LOeS577pyf"}],"key":"ND6LpVVHl6"}],"key":"i92aEnsXkP"},{"type":"tableCell","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Convert dB→linear, mean, then linear→dB, Understanding results","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"gn6iS89Rq4"}],"key":"F0j0wxZ2bt"}],"key":"K4W7Hj7B58"},{"type":"tableRow","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"ERDDAP tabledap & info endpoints","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"DkaaVU3xm0"}],"key":"cWteZfaJgQ"},{"type":"tableCell","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"strong","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Helpful","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"HfIX5giIAc"}],"key":"JvLSmgEtzR"}],"key":"jIdKfkU15N"},{"type":"tableCell","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Reading CSV responses; unit metadata lookup","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"AwNiD5olda"}],"key":"opAFSFH8ah"}],"key":"j3KcQodvR0"},{"type":"tableRow","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Plotly fundamentals","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"HoGYhkAj8M"}],"key":"Mhfd2mxuVy"},{"type":"tableCell","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"strong","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Helpful","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"Vv8DYEMxRq"}],"key":"vAy64nDj9j"}],"key":"oFGLxfhFGm"},{"type":"tableCell","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Subplots, heatmaps, interactive HTML export","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"Ld6bExrdbH"}],"key":"V56jfqb9s6"}],"key":"c59Eve4tcw"},{"type":"tableRow","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Understanding of NetCDF/CF","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"CHfCwQOvdZ"}],"key":"AlPuw0wXBr"},{"type":"tableCell","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"strong","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Helpful","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"sxYqnJFESv"}],"key":"sZQcTAzaQE"}],"key":"WlRSPtVCd6"},{"type":"tableCell","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Variable metadata and geospatial conventions","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"TZFCDdWFP1"}],"key":"d2IQPf0XZv"}],"key":"LOLYdqd0dM"},{"type":"tableRow","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"Dask awareness","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"lieXdhx5Vk"}],"key":"URz6z5eSE2"},{"type":"tableCell","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"strong","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"Helpful","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"ou0RWkmkjF"}],"key":"wHLVOx9Fyn"}],"key":"UqEQdx6snT"},{"type":"tableCell","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"Lazy arrays; when/why to call ","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"j6PFsFhb1Y"},{"type":"inlineCode","value":".compute()","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"bX245zjVio"}],"key":"R1Tz9j9GP9"}],"key":"c9Ea2f7k1j"},{"type":"tableRow","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Geographic coordinates","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"dgAeBdDh1B"}],"key":"MZCjlOMJEB"},{"type":"tableCell","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"strong","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Helpful","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"pLyxSBOmKA"}],"key":"f8418RT6uC"}],"key":"tnjaUy0QH4"},{"type":"tableCell","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"0–360 vs. −180–180 longitude handling","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"H1fQpWy2bW"}],"key":"YdtlwxSBBk"}],"key":"doktRflHK2"},{"type":"tableRow","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"HTTP/IO with ","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"GwTp8bugvz"},{"type":"inlineCode","value":"requests","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"nVsJuHlzeC"}],"key":"TUh1zvQKUU"},{"type":"tableCell","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"strong","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"Helpful","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"NXmhPuZLzJ"}],"key":"xcZUwqgjx0"}],"key":"CCdj1JMyUI"},{"type":"tableCell","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"Downloading ","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"tSfXIQn3U3"},{"type":"inlineCode","value":".npy","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"x7c4kBxN5q"},{"type":"text","value":" assets for local use","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"fpBG3RD6WX"}],"key":"at2YVu7Ej9"}],"key":"zqn3K8DZFG"}],"key":"BWaRSWk7l7"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":22,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":22,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"strong","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"Time to learn","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"XLPqG5qUwd"}],"key":"eEQum4ZsIe"},{"type":"text","value":": ~75 minutes","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"oYVIfvDA62"}],"key":"DdZqfbwfLw"}],"key":"WLvpm8bQNe"},{"type":"listItem","spread":true,"position":{"start":{"line":24,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"strong","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"System requirements","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"iwdWrAWj8Y"}],"key":"t1lRw4NAQ3"},{"type":"text","value":":","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"wYnZkQpQyd"}],"key":"Xnm19M13ml"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":25,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Python 3.9+ with Jupyter Notebook/Lab","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"Cq8uMJOaYS"}],"key":"R5qhfBTHah"}],"key":"pScU7IpYdj"},{"type":"listItem","spread":true,"position":{"start":{"line":26,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Required packages: ","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"afrIZVAvtJ"},{"type":"inlineCode","value":"xarray","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"PSlFP685qu"},{"type":"text","value":", ","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"FBInQ6xOfP"},{"type":"inlineCode","value":"s3fs","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"UeyE6s59nC"},{"type":"text","value":", ","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"cQakAIdp0N"},{"type":"inlineCode","value":"numpy","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"c3wQI1k0sM"},{"type":"text","value":", ","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"Vn9aGuUeq8"},{"type":"inlineCode","value":"pandas","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"Jbbyj0ujP0"},{"type":"text","value":", ","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"DPWDs55Nme"},{"type":"inlineCode","value":"plotly","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"V9a260JUr5"},{"type":"text","value":", ","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"xSUOejRLy5"},{"type":"inlineCode","value":"requests","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"a8nPtR2q4E"},{"type":"text","value":", ","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"luo5LWkU3w"},{"type":"inlineCode","value":"netCDF4","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"cTdb3eQQR5"},{"type":"text","value":" ","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"a81LVQ6x7Q"},{"type":"emphasis","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"(optional but helpful: ","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"CVYQc0PGAQ"},{"type":"inlineCode","value":"dask","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"C6YFzKLEHz"},{"type":"text","value":")","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"cc9pcXYya2"}],"key":"c2DWMX2Vep"}],"key":"xijusHNaEq"}],"key":"VuRfdsPEmg"}],"key":"wvW8KDqJvn"}],"key":"Lrr8bxpFpN"}],"key":"YtqzgrdGmE"},{"type":"paragraph","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"strong","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"Note:","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"lcdhV9P3ON"}],"key":"GNCjJDoCu4"},{"type":"text","value":" Run the cell below ","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"o4ie79Uug2"},{"type":"strong","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"only","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"holhteP2Xi"}],"key":"WG768APupL"},{"type":"text","value":" in a local environment to install the required packages. If you’re using Binder, skip this step.","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"YDAzKHO7NF"}],"key":"io9dESKVxm"}],"key":"nRRgtRBXap"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import os\nimport sys\nimport yaml\nimport shutil\nimport subprocess\n\nENV_PATH = \"../environment.yml\"\n\nwith open(ENV_PATH, \"r\", encoding=\"utf-8\") as f:\n    env = yaml.safe_load(f)\n\nchannels = env.get(\"channels\", [])\ndeps = env.get(\"dependencies\", [])\n\nconda_pkgs = []\npip_pkgs = []\n\nfor dep in deps:\n    if isinstance(dep, str):\n        # Skip python pin and the literal 'pip' meta-package entry\n        name = dep.split(\"=\")[0].strip().lower()\n        if name in {\"python\", \"pip\"}:\n            continue\n        conda_pkgs.append(dep)\n    elif isinstance(dep, dict) and \"pip\" in dep:\n        pip_pkgs.extend(dep[\"pip\"])\n\n# Prefer mamba if present; fallback to conda\nconda_exe = shutil.which(\"mamba\") or shutil.which(\"conda\")\n\n# Install Conda packages\nif conda_pkgs:\n    if not conda_exe:\n        raise RuntimeError(\"Conda/mamba not found in PATH. Run this inside a Conda environment.\")\n    # Install into the current environment prefix\n    env_prefix = os.environ.get(\"CONDA_PREFIX\", sys.prefix)\n    cmd = [conda_exe, \"install\", \"-y\", \"-p\", env_prefix]\n    for ch in channels:\n        cmd += [\"-c\", ch]\n    cmd += conda_pkgs\n    print(\"Running:\", \" \".join(cmd))\n    subprocess.check_call(cmd)\nelse:\n    print(\"No Conda packages to install.\")\n\n# Install pip packages into the current kernel's Python\nif pip_pkgs:\n    cmd = [sys.executable, \"-m\", \"pip\", \"install\", *pip_pkgs]\n    print(\"Running:\", \" \".join(cmd))\n    subprocess.check_call(cmd)\nelse:\n    print(\"No pip packages to install.\")\n","key":"J8hCK494Xi"},{"type":"output","id":"VRRqgnShvvmOBCYBGLt7f","data":[{"output_type":"stream","name":"stdout","text":"Running: /usr/bin/conda install -y -p /home/runner/micromamba/envs/osdf-cookbook -c conda-forge jupyterlab mystmd jupyterlab-myst aiohttp bash_kernel intake intake-esm=2025.2.3 pelicanplatform panel bokeh xmltodict cartopy colorcet cf-units boto3 basemap pelicanfs=1.2.1 matplotlib metpy pandas xarray geopandas pystac-client rasterio dask dask-jobqueue openpyxl hvplot plotly zarr=2.18.1 s3fs seaborn tqdm h5netcdf igwn-auth-utils=1.4.0\n"},{"output_type":"stream","name":"stdout","text":"\u001b[1;33mCI detected\u001b[0m\u001b[1;33m...\u001b[0m\n\u001b[1;33mBy accessing \u001b[0m\u001b[4;94mhttps://repo.anaconda.com/pkgs/main\u001b[0m\u001b[1;33m via CI for this repository you \u001b[0m\n\u001b[1;33macknowledge and agree to the Terms of Service:\u001b[0m\n\u001b[1;33mANACONDA TERMS OF SERVICE\u001b[0m\n\u001b[1;33mEffective Date: July \u001b[0m\u001b[1;36m15\u001b[0m\u001b[1;33m, \u001b[0m\u001b[1;36m2025\u001b[0m\n\n\u001b[1;33mSee \u001b[0m\u001b[4;94mhttps://anaconda.com/legal/terms/terms-of-service\u001b[0m\n\u001b[1;33mBy accessing \u001b[0m\u001b[4;94mhttps://repo.anaconda.com/pkgs/r\u001b[0m\u001b[1;33m via CI for this repository you \u001b[0m\n\u001b[1;33macknowledge and agree to the Terms of Service:\u001b[0m\n\u001b[1;33mANACONDA TERMS OF SERVICE\u001b[0m\n\u001b[1;33mEffective Date: July \u001b[0m\u001b[1;36m15\u001b[0m\u001b[1;33m, \u001b[0m\u001b[1;36m2025\u001b[0m\n\n\u001b[1;33mSee \u001b[0m\u001b[4;94mhttps://anaconda.com/legal/terms/terms-of-service\u001b[0m\n\u001b[1;32m2\u001b[0m\u001b[1;32m channel Terms of Service accepted\u001b[0m\nRetrieving notices: - \b\b\\ "},{"output_type":"stream","name":"stdout","text":"\b\bdone\n"},{"output_type":"stream","name":"stdout","text":"Channels:\n - conda-forge\n - defaults\nPlatform: linux-64\nCollecting package metadata (repodata.json): / \b\b- "},{"output_type":"stream","name":"stdout","text":"\b\b\\ \b\b| \b\b/ "},{"output_type":"stream","name":"stdout","text":"\b\b- \b\b\\ "},{"output_type":"stream","name":"stdout","text":"\b\b| \b\b/ "},{"output_type":"stream","name":"stdout","text":"\b\b- \b\b\\ \b\b| "},{"output_type":"stream","name":"stdout","text":"\b\b/ \b\b- "},{"output_type":"stream","name":"stdout","text":"\b\b\\ \b\b| "},{"output_type":"stream","name":"stdout","text":"\b\b/ \b\b- \b\b\\ "},{"output_type":"stream","name":"stdout","text":"\b\b| \b\b/ "},{"output_type":"stream","name":"stdout","text":"\b\b- \b\b\\ "},{"output_type":"stream","name":"stdout","text":"\b\b| \b\b/ "},{"output_type":"stream","name":"stdout","text":"\b\b- \b\b\\ "},{"output_type":"stream","name":"stdout","text":"\b\b| \b\b/ \b\b- "},{"output_type":"stream","name":"stdout","text":"\b\b\\ \b\b| "},{"output_type":"stream","name":"stdout","text":"\b\b/ \b\b- "},{"output_type":"stream","name":"stdout","text":"\b\b\\ "},{"output_type":"stream","name":"stdout","text":"\b\b| "},{"output_type":"stream","name":"stdout","text":"\b\b/ "},{"output_type":"stream","name":"stdout","text":"\b\b- "},{"output_type":"stream","name":"stdout","text":"\b\b\\ "},{"output_type":"stream","name":"stdout","text":"\b\bdone\nSolving environment: / \b\b- "},{"output_type":"stream","name":"stdout","text":"\b\b\\ \b\b| "},{"output_type":"stream","name":"stdout","text":"\b\b/ \b\b- "},{"output_type":"stream","name":"stdout","text":"\b\b\\ \b\b| "},{"output_type":"stream","name":"stdout","text":"\b\b/ \b\b- "},{"output_type":"stream","name":"stdout","text":"\b\b\\ \b\b| "},{"output_type":"stream","name":"stdout","text":"\b\bdone\n"},{"output_type":"stream","name":"stderr","text":"\n\n==> WARNING: A newer version of conda exists. <==\n    current version: 25.7.0\n    latest version: 25.9.1\n\nPlease update conda by running\n\n    $ conda update -n base -c defaults conda\n\n\n"},{"output_type":"stream","name":"stdout","text":"\n# All requested packages already installed.\n\n"},{"output_type":"stream","name":"stdout","text":"Running: /home/runner/micromamba/envs/osdf-cookbook/bin/python -m pip install import-ipynb OpenVisus openvisuspy pvlib rioxarray stackstac\n"},{"output_type":"stream","name":"stdout","text":"Requirement already satisfied: import-ipynb in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (0.2)\nRequirement already satisfied: OpenVisus in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (2.2.149)\nRequirement already satisfied: openvisuspy in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (1.0.71)\nRequirement already satisfied: pvlib in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (0.13.1)\nRequirement already satisfied: rioxarray in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (0.19.0)\nRequirement already satisfied: stackstac in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (0.5.1)\nRequirement already satisfied: IPython in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from import-ipynb) (9.6.0)\nRequirement already satisfied: nbformat in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from import-ipynb) (5.10.4)\nRequirement already satisfied: numpy>=1.21.2 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from pvlib) (2.3.3)\nRequirement already satisfied: pandas>=1.3.3 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from pvlib) (2.2.3)\nRequirement already satisfied: pytz in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from pvlib) (2024.1)\nRequirement already satisfied: requests in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from pvlib) (2.32.5)\nRequirement already satisfied: scipy>=1.7.2 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from pvlib) (1.16.2)\nRequirement already satisfied: h5py in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from pvlib) (3.15.1)\nRequirement already satisfied: packaging in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from rioxarray) (25.0)\nRequirement already satisfied: rasterio>=1.4.3 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from rioxarray) (1.4.3)\nRequirement already satisfied: xarray>=2024.7.0 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from rioxarray) (2025.10.1)\nRequirement already satisfied: pyproj>=3.3 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from rioxarray) (3.7.2)\nRequirement already satisfied: dask>=2022.1.1 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from dask[array]>=2022.1.1->stackstac) (2025.10.0)\nRequirement already satisfied: python-dateutil>=2.8.2 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from pandas>=1.3.3->pvlib) (2.9.0.post0)\nRequirement already satisfied: tzdata>=2022.7 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from pandas>=1.3.3->pvlib) (2025.2)\nRequirement already satisfied: certifi in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from pyproj>=3.3->rioxarray) (2025.10.5)\nRequirement already satisfied: affine in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from rasterio>=1.4.3->rioxarray) (2.4.0)\nRequirement already satisfied: attrs in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from rasterio>=1.4.3->rioxarray) (25.4.0)\nRequirement already satisfied: click>=4.0 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from rasterio>=1.4.3->rioxarray) (8.3.0)\nRequirement already satisfied: cligj>=0.5 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from rasterio>=1.4.3->rioxarray) (0.7.2)\nRequirement already satisfied: click-plugins in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from rasterio>=1.4.3->rioxarray) (1.1.1.2)\nRequirement already satisfied: pyparsing in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from rasterio>=1.4.3->rioxarray) (3.2.5)\nRequirement already satisfied: cloudpickle>=3.0.0 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from dask>=2022.1.1->dask[array]>=2022.1.1->stackstac) (3.1.1)\nRequirement already satisfied: fsspec>=2021.09.0 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from dask>=2022.1.1->dask[array]>=2022.1.1->stackstac) (2025.9.0)\nRequirement already satisfied: partd>=1.4.0 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from dask>=2022.1.1->dask[array]>=2022.1.1->stackstac) (1.4.2)\nRequirement already satisfied: pyyaml>=5.3.1 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from dask>=2022.1.1->dask[array]>=2022.1.1->stackstac) (6.0.3)\nRequirement already satisfied: toolz>=0.10.0 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from dask>=2022.1.1->dask[array]>=2022.1.1->stackstac) (1.0.0)\nRequirement already satisfied: locket in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from partd>=1.4.0->dask>=2022.1.1->dask[array]>=2022.1.1->stackstac) (1.0.0)\nRequirement already satisfied: six>=1.5 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from python-dateutil>=2.8.2->pandas>=1.3.3->pvlib) (1.17.0)\nRequirement already satisfied: decorator in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from IPython->import-ipynb) (5.2.1)\nRequirement already satisfied: ipython-pygments-lexers in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from IPython->import-ipynb) (1.1.1)\nRequirement already satisfied: jedi>=0.16 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from IPython->import-ipynb) (0.19.2)\nRequirement already satisfied: matplotlib-inline in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from IPython->import-ipynb) (0.1.7)\nRequirement already satisfied: pexpect>4.3 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from IPython->import-ipynb) (4.9.0)\nRequirement already satisfied: prompt_toolkit<3.1.0,>=3.0.41 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from IPython->import-ipynb) (3.0.52)\nRequirement already satisfied: pygments>=2.4.0 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from IPython->import-ipynb) (2.19.2)\nRequirement already satisfied: stack_data in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from IPython->import-ipynb) (0.6.3)\nRequirement already satisfied: traitlets>=5.13.0 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from IPython->import-ipynb) (5.14.3)\nRequirement already satisfied: wcwidth in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from prompt_toolkit<3.1.0,>=3.0.41->IPython->import-ipynb) (0.2.14)\nRequirement already satisfied: parso<0.9.0,>=0.8.4 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from jedi>=0.16->IPython->import-ipynb) (0.8.5)\nRequirement already satisfied: ptyprocess>=0.5 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from pexpect>4.3->IPython->import-ipynb) (0.7.0)\nRequirement already satisfied: fastjsonschema>=2.15 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from nbformat->import-ipynb) (2.21.2)\nRequirement already satisfied: jsonschema>=2.6 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from nbformat->import-ipynb) (4.25.1)\nRequirement already satisfied: jupyter-core!=5.0.*,>=4.12 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from nbformat->import-ipynb) (5.9.1)\nRequirement already satisfied: jsonschema-specifications>=2023.03.6 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from jsonschema>=2.6->nbformat->import-ipynb) (2025.9.1)\nRequirement already satisfied: referencing>=0.28.4 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from jsonschema>=2.6->nbformat->import-ipynb) (0.37.0)\nRequirement already satisfied: rpds-py>=0.7.1 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from jsonschema>=2.6->nbformat->import-ipynb) (0.27.1)\nRequirement already satisfied: platformdirs>=2.5 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from jupyter-core!=5.0.*,>=4.12->nbformat->import-ipynb) (4.5.0)\nRequirement already satisfied: typing-extensions>=4.4.0 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from referencing>=0.28.4->jsonschema>=2.6->nbformat->import-ipynb) (4.15.0)\nRequirement already satisfied: charset_normalizer<4,>=2 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from requests->pvlib) (3.4.4)\nRequirement already satisfied: idna<4,>=2.5 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from requests->pvlib) (3.11)\nRequirement already satisfied: urllib3<3,>=1.21.1 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from requests->pvlib) (2.5.0)\nRequirement already satisfied: executing>=1.2.0 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from stack_data->IPython->import-ipynb) (2.2.1)\nRequirement already satisfied: asttokens>=2.1.0 in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from stack_data->IPython->import-ipynb) (3.0.0)\nRequirement already satisfied: pure_eval in /home/runner/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages (from stack_data->IPython->import-ipynb) (0.2.3)\n"}],"key":"iS8T6SFKr1"}],"key":"xqKZapvvbg"},{"type":"block","kind":"notebook-content","children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UmSFZNF3Sb"}],"key":"yKLByNrm9p"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"1) Imports","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cwjXFZznav"}],"identifier":"id-1-imports","label":"1) Imports","html_id":"id-1-imports","implicit":true,"key":"X5yOmwPoDX"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Core libraries used throughout the notebook.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"MlFW1c8IC4"}],"key":"TwsBcJD0Y7"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Key roles:","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"TZ7prQ5R5T"}],"key":"JN3F7pTgsY"},{"type":"code","lang":"","value":"xarray/s3fs for reading NOAA Zarr data from S3\nnumpy/pandas for arrays & tables\nplotly for interactive plotting\nrequests/io/os for file I/O and downloads\ndatetime for time calculations","position":{"start":{"line":6,"column":1},"end":{"line":10,"column":1}},"key":"vkiKv0TvNH"}],"key":"ma90StHhdt"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import xarray as xr\nimport s3fs\nimport numpy as np\nimport plotly.graph_objects as go\nfrom plotly.subplots import make_subplots\nimport pandas as pd\nimport requests\nimport io\nimport os\nimport rioxarray\nfrom datetime import datetime, timedelta\nimport pvlib","key":"uXHS74gg1X"},{"type":"output","id":"i9qOyU8a1nqZgWo0ywBsJ","data":[],"key":"aSAd7bPAQm"}],"key":"u9vupQcHmJ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2) Initializing the datasets","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"j63Bu02efA"}],"identifier":"id-2-initializing-the-datasets","label":"2) Initializing the datasets","html_id":"id-2-initializing-the-datasets","implicit":true,"key":"aYOJxbIa1M"}],"key":"h0284Ybiyz"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Builds the S3 path to the HB1906 EK60 Zarr dataset and opens it anonymously.\nSubsets by time window and depth range, selects the 38 kHz channel, and masks samples below the estimated bottom.\n.compute() materializes the selection; hm_timestamps will be reused for time alignment later. All datasets are accessed\nusing the OSDF infrastructure","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Acl5uRY9WI"}],"key":"ooELNpwJWk"}],"key":"vIxyxjr3Mz"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"bucket_name = 'noaa-wcsd-zarr-pds'\nship_name = \"Henry_B._Bigelow\"\ncruise_name = \"HB1906\"\nsensor_name = \"EK60\"\n\n# Accessing the NOAA HB1906 dataset using OSDF (anonymous S3)\ns3_file_system = s3fs.S3FileSystem(anon=True)\nzarr_store = f'{cruise_name}.zarr'\ns3_zarr_store_path = f\"{bucket_name}/level_2/{ship_name}/{cruise_name}/{sensor_name}/{zarr_store}\"\n\n# Map S3 path to a zarr store and open (consolidated=None to let xarray infer metadata)\nstore = s3fs.S3Map(root=s3_zarr_store_path, s3=s3_file_system, check=False)\ncruise = xr.open_zarr(store=store, consolidated=None)\n\n# Time/depth subset and single-frequency selection\nstart_time = \"2019-10-16T15:00:00\"\nend_time = \"2019-10-16T23:11:09\"\ntimeslice = slice(start_time, end_time)\ndepths = slice(10, 250)\ncruise = cruise.sel(time=timeslice, depth=depths, drop=False)\ncruise = cruise.sel(frequency=38000, method='nearest').compute()  # materialize after selection\ncruise = cruise.where(cruise.depth < cruise.bottom + 2, drop=True)  # remove bins below bottom\n\n# Timestamps for later alignment\nhm_timestamps = cruise.time.values.tolist()","key":"LrEN6pDSeN"},{"type":"output","id":"KWSii_HChG-YSvKGbZ1qS","data":[],"key":"n8LTx4qxXk"}],"key":"XYhMOjS6mY"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3) Accessing buoy data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MCCyvElRBw"}],"identifier":"id-3-accessing-buoy-data","label":"3) Accessing buoy data","html_id":"id-3-accessing-buoy-data","implicit":true,"key":"aMUF1gsnUP"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Defines a buoy location on Georges Bank (longitude converted to 0–360).","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"wi1ATwZ4Go"}],"key":"zjSXcGEExJ"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Optional: Loads three daily OISST files and samples SST at the nearest grid point (day before, day of, day after).","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"x7PCVx5EZS"}],"key":"iZ0Enuibjw"}],"key":"YfiLNKcOAF"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"ERDDAP buoy environmental data.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"BHaYLYwCae"}],"key":"QvPw7vIOM6"}],"key":"nDDBm5e20E"}],"key":"fz2ZrAVLer"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Sets ERDDAP dataset parameters and enforces a max_days cap by adjusting end_date_time if needed.\nReads station metadata to extract lon/lat and wind-speed units; prepares a conversion to knots.\nPulls a table of time, wind_speed, SST, significant wave height, converts wind speed to knots, indexes by time.\nFilters to the requested window and keeps the first nine rows (intentional truncation for later alignment).","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"ocRoGBoDB9"}],"key":"arkuWhBhAZ"}],"key":"GBuRNZo72G"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Location of one specific buoy located on Georges Bank\ntarget_lon = 360 - 66.546  # convert from -180..180 to 0..360\ntarget_lat = 41.088\n\n# ______________OPTIONAL BUOY DATA FROM NCAR/UCAR______________\n# print(f\"Target coordinates: Longitude: {target_lon}, Latitude: {target_lat}\")\n#\n# # Accessing stationary buoy data (daily OISST files); select nearest grid cell\n# buoy_data_day_before = xr.open_dataset(\n#     'https://data.rda.ucar.edu/d277007/avhrr_v2.1/2019/oisst-avhrr-v02r01.20191015.nc#mode=bytes', engine='netcdf4')\n# buoy_data_actual_day = xr.open_dataset(\n#     'https://data.rda.ucar.edu/d277007/avhrr_v2.1/2019/oisst-avhrr-v02r01.20191016.nc#mode=bytes',\n#     engine='netcdf4')\n# buoy_data_day_after = xr.open_dataset(\n#     'https://data.rda.ucar.edu/d277007/avhrr_v2.1/2019/oisst-avhrr-v02r01.20191017.nc#mode=bytes',\n#     engine='netcdf4')\n#\n# sst_day_before = buoy_data_day_before['sst'].sel(lon=target_lon, lat=target_lat, method='nearest').values[0][0]\n# sst_actual_day = buoy_data_actual_day['sst'].sel(lon=target_lon, lat=target_lat, method='nearest').values[0][0]\n# sst_day_after = buoy_data_day_after['sst'].sel(lon=target_lon, lat=target_lat, method='nearest').values[0][0]\n# ______________________________________________________________\n\n# The following code has been copied from https://github.com/ioos/soundcoop/blob/main/3_HMD_environmental_data/plot_sound_environmental_and_climatology_data.ipynb in order to access buoy environmental data.\n\nerddap_dataset = 'gov-ndbc-44005'\nsound_dataset = 'Monh'\nmax_days = 25\nstart_date_time = '2019-10-16T14:00:00.000'\nend_date_time = '2021-10-16T23:30:00.000'\nmin_frequency = 21\nmax_frequency = 24000\n\nerddap_base_url = 'https://erddap.sensors.ioos.us/erddap'\n\n# Cap the end date if requested range exceeds max_days\ntime_delta = datetime.fromisoformat(end_date_time) - datetime.fromisoformat(start_date_time)\nif time_delta.days > max_days:\n    end_date_time = str(datetime.fromisoformat(start_date_time) + timedelta(days=max_days))\n    print(f'end_date_time updated to {end_date_time}')\n\n# Get station lon/lat and units from ERDDAP metadata (CSV)\nerddap_metadata_url = f'{erddap_base_url}/info/{erddap_dataset}/index.csv'\nenv_metadata_df = pd.read_csv(erddap_metadata_url)\n\nenv_station_x = env_metadata_df.loc[env_metadata_df['Attribute Name'] == 'geospatial_lon_min']['Value'].item()\nenv_station_y = env_metadata_df.loc[env_metadata_df['Attribute Name'] == 'geospatial_lat_min']['Value'].item()\nswt_var = 'sea_surface_temperature'\n\n# __________OPTIONAL: Add Wind__________\n# Determine wind_speed units to convert to knots\n# wind_speed_units_row = env_metadata_df[\n#     (env_metadata_df['Row Type'] == 'attribute') &\n#     (env_metadata_df['Attribute Name'] == 'units') &\n#     # (env_metadata_df['Variable Name'] == 'wind_speed')\n#     ]\n# wind_speed_units = wind_speed_units_row.iloc[0]['Value']\n# print(wind_speed_units)\n\n# wind_speed_to_kts_factors = {\n#     \"m.s-1\": 1.94384,\n#     \"mph\": 0.86897423357831,\n#     \"kmh\": 0.53995555554212126825,\n#     \"ft.s-1\": 0.59248243198521155506\n# }\n\n# if wind_speed_units in wind_speed_to_kts_factors:\n#     print(\"Success! Units can be converted from\", wind_speed_units, 'to', 'kts')\n# else:\n#     print(\"Error! Wind speed cannot be converted from\", wind_speed_units, 'to', 'kts')\n\n# wind_var = 'wind_speed'\n# wave_var = 'sea_surface_wave_significant_height'\n# anomaly_var = 'swt_anomaly'\n# wind_var_kts = 'wind_speed_kts'\n# ________________________________________\n\n# Build ERDDAP tabledap query URL\nerddap_dataset_url = (\n    f'{erddap_base_url}/tabledap/{erddap_dataset}.csv'\n    f'?time,{swt_var}'\n)\n\n# Read dataset (skip the second row of units)\nenv_df = pd.read_csv(\n    erddap_dataset_url,\n    skiprows=[1]  # The second row (index 1) are the column units, which we don't need\n)\n\n# Format time, convert wind speed to knots, index by time\nenv_df['time'] = pd.to_datetime(env_df['time'])\n# env_df['wind_speed_kts'] = env_df['wind_speed'].apply(lambda x: x * wind_speed_to_kts_factors[wind_speed_units])\n# del env_df['wind_speed']\nenv_df = env_df.set_index('time').sort_index()\n\n# Filter by requested time window and keep first 9 rows (drops the rest)\nenv_df = env_df[(env_df.index > start_date_time) & (env_df.index < end_date_time)]\nenv_df.drop(env_df.tail(-9).index, inplace=True)\n# env_df","key":"fIRPhKtNLB"},{"type":"output","id":"v98fvt-y99ZxNr1U0FjxJ","data":[{"output_type":"stream","name":"stdout","text":"end_date_time updated to 2019-11-10 14:00:00\n"}],"key":"AtHAfYHTpk"}],"key":"ZmtoJebvs4"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"4) Calculate the temperature anomaly, sun elevation in degree and azimuth","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KDcCQIHm7W"}],"identifier":"id-4-calculate-the-temperature-anomaly-sun-elevation-in-degree-and-azimuth","label":"4) Calculate the temperature anomaly, sun elevation in degree and azimuth","html_id":"id-4-calculate-the-temperature-anomaly-sun-elevation-in-degree-and-azimuth","implicit":true,"key":"Ug7VvGwl9l"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Extracts World Ocean Atlas 2023 temperature data for a specific location and month and calculates temperature anomaly (optional), sun elevation in degree and azimuth (optional).","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"PRfdbCajsg"}],"key":"ovUyD8VeDi"}],"key":"ArOnvqa85K"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def get_woa23_temp_at_xy(x, y, month, var='t_mn', depth=0):\n    \"\"\"\n    Get 1-degree WOA 2023 temperature values for a given point and month.\n\n    Args:\n        x: A longitude value given in decimal degrees\n        y: A latitude value given in decimal degrees\n        month: The month asn integer from which to extract the value\n        var (optional): The temperature variable to use. Defaults to the statistical mean.\n        depth (optional): The depth at which to extract the value. Defaults to the surface.\n    \"\"\"\n    url = (\n        'https://www.ncei.noaa.gov/thredds-ocean/dodsC/woa23/DATA/'\n        f'temperature/netcdf/decav/1.00/woa23_decav_t{month:02}_01.nc'\n    )\n    ds = xr.open_dataset(\n        url,\n        decode_times=False  # xarray can't handle times defined as \"months since ...\"\n    )\n\n    da = ds.isel(depth=depth)[var]  # Pull out just the variable we're interested in\n\n    # Because nearshore locations are often NaN due to the grid's low resolution\n    # we need to interpolate the NaNs to the nearest non-NaN before extracting our value.\n    # We use rioxarray to do the interpolations in two dimensions because plain vanilla xarray\n    # can only interpolate in one dimension.\n    da = da.rio.write_crs(4326)\n    da = da.rio.interpolate_na(method='nearest')\n\n    # Then we extract the value, also using the nearest neighbor method because the given\n    # x and y values are unlikely to fall exactly on one of the grid's lat/lon coordinate pairs\n    val = da.sel(lon=x, lat=y, method='nearest').item()\n\n    return val\n\n\n# Define the location of our selected ERDDAP dataset\n# Override here if needed\nx = env_station_x\ny = env_station_y\n\nurl = (\n    'https://www.ncei.noaa.gov/thredds-ocean/dodsC/woa23/DATA/'\n    f'temperature/netcdf/decav/1.00/woa23_decav_t07_01.nc'\n)\nda = xr.open_dataset(\n    url,\n    decode_times=False  # xarray can't handle times defined as \"months since ...\"\n).isel(depth=0)['t_mn']  # Pull out just the variable we're interested in\n\n# Because nearshore locations are often NaN due to the grid's low resolution\n# we need to interpolate the NaNs to the nearest non-NaN before extracting our value.\n# We use rioxarray to do the interpolations in two dimensions because plain vanilla xarray\n# can only interpolate in one dimension.\nda = da.rio.write_crs(4326)\nda = da.rio.interpolate_na(method='nearest')\n\n# Then we extract the value, also using the nearest neighbor method because the given\n# x and y values are unlikely to fall exactly on one of the grid's lat/lon coordinate pairs\nval = da.sel(lon=x, lat=y, method='nearest').item()\n\n# Assemble a mapping between months and WOA 2023 temperature values\nmonths = list(range(1, 13))\ntemps = [get_woa23_temp_at_xy(x, y, m) for m in months]\nclim_dict = {m: t for m, t in zip(months, temps)}\n\n# Calculate the sea water temperature anomaly by subtracting the monthly WOA 2023 temperature value\n# from each measured sea water temperature value and store it as a new variable\nanomaly_var = env_df[swt_var] - [clim_dict[10]]\n# We are not adding the temperature_anomaly variable to our dataset, because we were able to see that it follows the sea surface temperature.\n# env_df[\"temperature_anomaly\"] = anomaly_var\n\n# ---- Time range in UTC ----\ntimes_utc = pd.date_range(\n    start=start_date_time,\n    end=end_date_time,\n    freq=\"1h\",\n    tz=\"UTC\"  # <-- key: set timezone to UTC\n)\n\n# ---- Calculate solar position ----\nsolpos = pvlib.solarposition.get_solarposition(times_utc, target_lat, target_lon)\n\n# ---- Extract elevation ----\ndf = pd.DataFrame({\n    \"time_utc\": times_utc,\n    \"elevation_deg\": solpos[\"elevation\"],\n    \"azimuth_deg\": solpos[\"azimuth\"]\n})\n\nenv_df[\"elevation_deg\"] = solpos[\"elevation\"].tolist()[1:10]\n# env_df[\"azimuth_deg\"] = solpos[\"azimuth\"].tolist()[:9]\nenv_df","key":"oTEGgquOZt"},{"type":"output","id":"YA-s_zGWnQdt-uPH8dV1U","data":[{"output_type":"execute_result","execution_count":5,"metadata":{},"data":{"text/plain":{"content":"                           sea_surface_temperature  elevation_deg\ntime                                                             \n2019-10-16 14:50:00+00:00                     12.3      37.332351\n2019-10-16 15:50:00+00:00                     12.4      39.900225\n2019-10-16 16:50:00+00:00                     12.3      38.739163\n2019-10-16 17:50:00+00:00                     12.3      34.088215\n2019-10-16 18:50:00+00:00                     12.3      26.742124\n2019-10-16 19:50:00+00:00                     12.5      17.567071\n2019-10-16 20:50:00+00:00                     12.4       7.244244\n2019-10-16 21:50:00+00:00                     12.3      -3.739642\n2019-10-16 22:50:00+00:00                     12.3     -15.017410","content_type":"text/plain"},"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>sea_surface_temperature</th>\n      <th>elevation_deg</th>\n    </tr>\n    <tr>\n      <th>time</th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>2019-10-16 14:50:00+00:00</th>\n      <td>12.3</td>\n      <td>37.332351</td>\n    </tr>\n    <tr>\n      <th>2019-10-16 15:50:00+00:00</th>\n      <td>12.4</td>\n      <td>39.900225</td>\n    </tr>\n    <tr>\n      <th>2019-10-16 16:50:00+00:00</th>\n      <td>12.3</td>\n      <td>38.739163</td>\n    </tr>\n    <tr>\n      <th>2019-10-16 17:50:00+00:00</th>\n      <td>12.3</td>\n      <td>34.088215</td>\n    </tr>\n    <tr>\n      <th>2019-10-16 18:50:00+00:00</th>\n      <td>12.3</td>\n      <td>26.742124</td>\n    </tr>\n    <tr>\n      <th>2019-10-16 19:50:00+00:00</th>\n      <td>12.5</td>\n      <td>17.567071</td>\n    </tr>\n    <tr>\n      <th>2019-10-16 20:50:00+00:00</th>\n      <td>12.4</td>\n      <td>7.244244</td>\n    </tr>\n    <tr>\n      <th>2019-10-16 21:50:00+00:00</th>\n      <td>12.3</td>\n      <td>-3.739642</td>\n    </tr>\n    <tr>\n      <th>2019-10-16 22:50:00+00:00</th>\n      <td>12.3</td>\n      <td>-15.017410</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"}}}],"key":"r5ucBeGwC6"}],"key":"PjLPH2Gc1u"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"5) Downloading external error map for the specific location.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"y1EyDSrXMM"}],"identifier":"id-5-downloading-external-error-map-for-the-specific-location","label":"5) Downloading external error map for the specific location.","html_id":"id-5-downloading-external-error-map-for-the-specific-location","implicit":true,"key":"S1lUQQ66ZT"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Currently the error map comes from a fixed file; our plan is to switch to a dynamic AWS download that accepts location parameters.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"WbsArbKJL8"}],"key":"M4OmovKtF4"}],"key":"dmltfEhray"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Downloading anomaly detection model error map from NCAR via OSDF\nresponse = requests.get('https://data-osdf.rda.ucar.edu/ncar/rda/pythia_2025/osdf-cookbook/mae_error_map.npy')\nresponse.raise_for_status()\nsonar_clusters = np.load(io.BytesIO(response.content))","key":"OSVXBsE8AL"},{"type":"output","id":"g_jAbwbgndq4ouHJNRsxA","data":[{"output_type":"error","traceback":"\u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mSSLCertVerificationError\u001b[39m                  Traceback (most recent call last)\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/urllib3/connectionpool.py:464\u001b[39m, in \u001b[36mHTTPConnectionPool._make_request\u001b[39m\u001b[34m(self, conn, method, url, body, headers, retries, timeout, chunked, response_conn, preload_content, decode_content, enforce_content_length)\u001b[39m\n\u001b[32m    463\u001b[39m \u001b[38;5;28;01mtry\u001b[39;00m:\n\u001b[32m--> \u001b[39m\u001b[32m464\u001b[39m     \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43m_validate_conn\u001b[49m\u001b[43m(\u001b[49m\u001b[43mconn\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    465\u001b[39m \u001b[38;5;28;01mexcept\u001b[39;00m (SocketTimeout, BaseSSLError) \u001b[38;5;28;01mas\u001b[39;00m e:\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/urllib3/connectionpool.py:1093\u001b[39m, in \u001b[36mHTTPSConnectionPool._validate_conn\u001b[39m\u001b[34m(self, conn)\u001b[39m\n\u001b[32m   1092\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m conn.is_closed:\n\u001b[32m-> \u001b[39m\u001b[32m1093\u001b[39m     \u001b[43mconn\u001b[49m\u001b[43m.\u001b[49m\u001b[43mconnect\u001b[49m\u001b[43m(\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m   1095\u001b[39m \u001b[38;5;66;03m# TODO revise this, see https://github.com/urllib3/urllib3/issues/2791\u001b[39;00m\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/urllib3/connection.py:790\u001b[39m, in \u001b[36mHTTPSConnection.connect\u001b[39m\u001b[34m(self)\u001b[39m\n\u001b[32m    788\u001b[39m server_hostname_rm_dot = server_hostname.rstrip(\u001b[33m\"\u001b[39m\u001b[33m.\u001b[39m\u001b[33m\"\u001b[39m)\n\u001b[32m--> \u001b[39m\u001b[32m790\u001b[39m sock_and_verified = \u001b[43m_ssl_wrap_socket_and_match_hostname\u001b[49m\u001b[43m(\u001b[49m\n\u001b[32m    791\u001b[39m \u001b[43m    \u001b[49m\u001b[43msock\u001b[49m\u001b[43m=\u001b[49m\u001b[43msock\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    792\u001b[39m \u001b[43m    \u001b[49m\u001b[43mcert_reqs\u001b[49m\u001b[43m=\u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mcert_reqs\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    793\u001b[39m \u001b[43m    \u001b[49m\u001b[43mssl_version\u001b[49m\u001b[43m=\u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mssl_version\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    794\u001b[39m \u001b[43m    \u001b[49m\u001b[43mssl_minimum_version\u001b[49m\u001b[43m=\u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mssl_minimum_version\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    795\u001b[39m \u001b[43m    \u001b[49m\u001b[43mssl_maximum_version\u001b[49m\u001b[43m=\u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mssl_maximum_version\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    796\u001b[39m \u001b[43m    \u001b[49m\u001b[43mca_certs\u001b[49m\u001b[43m=\u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mca_certs\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    797\u001b[39m \u001b[43m    \u001b[49m\u001b[43mca_cert_dir\u001b[49m\u001b[43m=\u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mca_cert_dir\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    798\u001b[39m \u001b[43m    \u001b[49m\u001b[43mca_cert_data\u001b[49m\u001b[43m=\u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mca_cert_data\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    799\u001b[39m \u001b[43m    \u001b[49m\u001b[43mcert_file\u001b[49m\u001b[43m=\u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mcert_file\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    800\u001b[39m \u001b[43m    \u001b[49m\u001b[43mkey_file\u001b[49m\u001b[43m=\u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mkey_file\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    801\u001b[39m \u001b[43m    \u001b[49m\u001b[43mkey_password\u001b[49m\u001b[43m=\u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mkey_password\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    802\u001b[39m \u001b[43m    \u001b[49m\u001b[43mserver_hostname\u001b[49m\u001b[43m=\u001b[49m\u001b[43mserver_hostname_rm_dot\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    803\u001b[39m \u001b[43m    \u001b[49m\u001b[43mssl_context\u001b[49m\u001b[43m=\u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mssl_context\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    804\u001b[39m \u001b[43m    \u001b[49m\u001b[43mtls_in_tls\u001b[49m\u001b[43m=\u001b[49m\u001b[43mtls_in_tls\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    805\u001b[39m \u001b[43m    \u001b[49m\u001b[43massert_hostname\u001b[49m\u001b[43m=\u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43massert_hostname\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    806\u001b[39m \u001b[43m    \u001b[49m\u001b[43massert_fingerprint\u001b[49m\u001b[43m=\u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43massert_fingerprint\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    807\u001b[39m \u001b[43m\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    808\u001b[39m \u001b[38;5;28mself\u001b[39m.sock = sock_and_verified.socket\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/urllib3/connection.py:969\u001b[39m, in \u001b[36m_ssl_wrap_socket_and_match_hostname\u001b[39m\u001b[34m(sock, cert_reqs, ssl_version, ssl_minimum_version, ssl_maximum_version, cert_file, key_file, key_password, ca_certs, ca_cert_dir, ca_cert_data, assert_hostname, assert_fingerprint, server_hostname, ssl_context, tls_in_tls)\u001b[39m\n\u001b[32m    967\u001b[39m         server_hostname = normalized\n\u001b[32m--> \u001b[39m\u001b[32m969\u001b[39m ssl_sock = \u001b[43mssl_wrap_socket\u001b[49m\u001b[43m(\u001b[49m\n\u001b[32m    970\u001b[39m \u001b[43m    \u001b[49m\u001b[43msock\u001b[49m\u001b[43m=\u001b[49m\u001b[43msock\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    971\u001b[39m \u001b[43m    \u001b[49m\u001b[43mkeyfile\u001b[49m\u001b[43m=\u001b[49m\u001b[43mkey_file\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    972\u001b[39m \u001b[43m    \u001b[49m\u001b[43mcertfile\u001b[49m\u001b[43m=\u001b[49m\u001b[43mcert_file\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    973\u001b[39m \u001b[43m    \u001b[49m\u001b[43mkey_password\u001b[49m\u001b[43m=\u001b[49m\u001b[43mkey_password\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    974\u001b[39m \u001b[43m    \u001b[49m\u001b[43mca_certs\u001b[49m\u001b[43m=\u001b[49m\u001b[43mca_certs\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    975\u001b[39m \u001b[43m    \u001b[49m\u001b[43mca_cert_dir\u001b[49m\u001b[43m=\u001b[49m\u001b[43mca_cert_dir\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    976\u001b[39m \u001b[43m    \u001b[49m\u001b[43mca_cert_data\u001b[49m\u001b[43m=\u001b[49m\u001b[43mca_cert_data\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    977\u001b[39m \u001b[43m    \u001b[49m\u001b[43mserver_hostname\u001b[49m\u001b[43m=\u001b[49m\u001b[43mserver_hostname\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    978\u001b[39m \u001b[43m    \u001b[49m\u001b[43mssl_context\u001b[49m\u001b[43m=\u001b[49m\u001b[43mcontext\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    979\u001b[39m \u001b[43m    \u001b[49m\u001b[43mtls_in_tls\u001b[49m\u001b[43m=\u001b[49m\u001b[43mtls_in_tls\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    980\u001b[39m \u001b[43m\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    982\u001b[39m \u001b[38;5;28;01mtry\u001b[39;00m:\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/urllib3/util/ssl_.py:480\u001b[39m, in \u001b[36mssl_wrap_socket\u001b[39m\u001b[34m(sock, keyfile, certfile, cert_reqs, ca_certs, server_hostname, ssl_version, ciphers, ssl_context, ca_cert_dir, key_password, ca_cert_data, tls_in_tls)\u001b[39m\n\u001b[32m    478\u001b[39m context.set_alpn_protocols(ALPN_PROTOCOLS)\n\u001b[32m--> \u001b[39m\u001b[32m480\u001b[39m ssl_sock = \u001b[43m_ssl_wrap_socket_impl\u001b[49m\u001b[43m(\u001b[49m\u001b[43msock\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mcontext\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mtls_in_tls\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mserver_hostname\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    481\u001b[39m \u001b[38;5;28;01mreturn\u001b[39;00m ssl_sock\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/urllib3/util/ssl_.py:524\u001b[39m, in \u001b[36m_ssl_wrap_socket_impl\u001b[39m\u001b[34m(sock, ssl_context, tls_in_tls, server_hostname)\u001b[39m\n\u001b[32m    522\u001b[39m     \u001b[38;5;28;01mreturn\u001b[39;00m SSLTransport(sock, ssl_context, server_hostname)\n\u001b[32m--> \u001b[39m\u001b[32m524\u001b[39m \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[43mssl_context\u001b[49m\u001b[43m.\u001b[49m\u001b[43mwrap_socket\u001b[49m\u001b[43m(\u001b[49m\u001b[43msock\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mserver_hostname\u001b[49m\u001b[43m=\u001b[49m\u001b[43mserver_hostname\u001b[49m\u001b[43m)\u001b[49m\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/ssl.py:455\u001b[39m, in \u001b[36mSSLContext.wrap_socket\u001b[39m\u001b[34m(self, sock, server_side, do_handshake_on_connect, suppress_ragged_eofs, server_hostname, session)\u001b[39m\n\u001b[32m    449\u001b[39m \u001b[38;5;28;01mdef\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34mwrap_socket\u001b[39m(\u001b[38;5;28mself\u001b[39m, sock, server_side=\u001b[38;5;28;01mFalse\u001b[39;00m,\n\u001b[32m    450\u001b[39m                 do_handshake_on_connect=\u001b[38;5;28;01mTrue\u001b[39;00m,\n\u001b[32m    451\u001b[39m                 suppress_ragged_eofs=\u001b[38;5;28;01mTrue\u001b[39;00m,\n\u001b[32m    452\u001b[39m                 server_hostname=\u001b[38;5;28;01mNone\u001b[39;00m, session=\u001b[38;5;28;01mNone\u001b[39;00m):\n\u001b[32m    453\u001b[39m     \u001b[38;5;66;03m# SSLSocket class handles server_hostname encoding before it calls\u001b[39;00m\n\u001b[32m    454\u001b[39m     \u001b[38;5;66;03m# ctx._wrap_socket()\u001b[39;00m\n\u001b[32m--> \u001b[39m\u001b[32m455\u001b[39m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43msslsocket_class\u001b[49m\u001b[43m.\u001b[49m\u001b[43m_create\u001b[49m\u001b[43m(\u001b[49m\n\u001b[32m    456\u001b[39m \u001b[43m        \u001b[49m\u001b[43msock\u001b[49m\u001b[43m=\u001b[49m\u001b[43msock\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    457\u001b[39m \u001b[43m        \u001b[49m\u001b[43mserver_side\u001b[49m\u001b[43m=\u001b[49m\u001b[43mserver_side\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    458\u001b[39m \u001b[43m        \u001b[49m\u001b[43mdo_handshake_on_connect\u001b[49m\u001b[43m=\u001b[49m\u001b[43mdo_handshake_on_connect\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    459\u001b[39m \u001b[43m        \u001b[49m\u001b[43msuppress_ragged_eofs\u001b[49m\u001b[43m=\u001b[49m\u001b[43msuppress_ragged_eofs\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    460\u001b[39m \u001b[43m        \u001b[49m\u001b[43mserver_hostname\u001b[49m\u001b[43m=\u001b[49m\u001b[43mserver_hostname\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    461\u001b[39m \u001b[43m        \u001b[49m\u001b[43mcontext\u001b[49m\u001b[43m=\u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[43m,\u001b[49m\n\u001b[32m    462\u001b[39m \u001b[43m        \u001b[49m\u001b[43msession\u001b[49m\u001b[43m=\u001b[49m\u001b[43msession\u001b[49m\n\u001b[32m    463\u001b[39m \u001b[43m    \u001b[49m\u001b[43m)\u001b[49m\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/ssl.py:1041\u001b[39m, in \u001b[36mSSLSocket._create\u001b[39m\u001b[34m(cls, sock, server_side, do_handshake_on_connect, suppress_ragged_eofs, server_hostname, context, session)\u001b[39m\n\u001b[32m   1040\u001b[39m                 \u001b[38;5;28;01mraise\u001b[39;00m \u001b[38;5;167;01mValueError\u001b[39;00m(\u001b[33m\"\u001b[39m\u001b[33mdo_handshake_on_connect should not be specified for non-blocking sockets\u001b[39m\u001b[33m\"\u001b[39m)\n\u001b[32m-> \u001b[39m\u001b[32m1041\u001b[39m             \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mdo_handshake\u001b[49m\u001b[43m(\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m   1042\u001b[39m \u001b[38;5;28;01mexcept\u001b[39;00m:\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/ssl.py:1319\u001b[39m, in \u001b[36mSSLSocket.do_handshake\u001b[39m\u001b[34m(self, block)\u001b[39m\n\u001b[32m   1318\u001b[39m         \u001b[38;5;28mself\u001b[39m.settimeout(\u001b[38;5;28;01mNone\u001b[39;00m)\n\u001b[32m-> \u001b[39m\u001b[32m1319\u001b[39m     \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43m_sslobj\u001b[49m\u001b[43m.\u001b[49m\u001b[43mdo_handshake\u001b[49m\u001b[43m(\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m   1320\u001b[39m \u001b[38;5;28;01mfinally\u001b[39;00m:\n\n\u001b[31mSSLCertVerificationError\u001b[39m: [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: certificate has expired (_ssl.c:1010)\n\nDuring handling of the above exception, another exception occurred:\n\n\u001b[31mSSLError\u001b[39m                                  Traceback (most recent call last)\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/urllib3/connectionpool.py:787\u001b[39m, in \u001b[36mHTTPConnectionPool.urlopen\u001b[39m\u001b[34m(self, method, url, body, headers, retries, redirect, assert_same_host, timeout, pool_timeout, release_conn, chunked, body_pos, preload_content, decode_content, **response_kw)\u001b[39m\n\u001b[32m    786\u001b[39m \u001b[38;5;66;03m# Make the request on the HTTPConnection object\u001b[39;00m\n\u001b[32m--> \u001b[39m\u001b[32m787\u001b[39m response = \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43m_make_request\u001b[49m\u001b[43m(\u001b[49m\n\u001b[32m    788\u001b[39m \u001b[43m    \u001b[49m\u001b[43mconn\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    789\u001b[39m \u001b[43m    \u001b[49m\u001b[43mmethod\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    790\u001b[39m \u001b[43m    \u001b[49m\u001b[43murl\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    791\u001b[39m \u001b[43m    \u001b[49m\u001b[43mtimeout\u001b[49m\u001b[43m=\u001b[49m\u001b[43mtimeout_obj\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    792\u001b[39m \u001b[43m    \u001b[49m\u001b[43mbody\u001b[49m\u001b[43m=\u001b[49m\u001b[43mbody\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    793\u001b[39m \u001b[43m    \u001b[49m\u001b[43mheaders\u001b[49m\u001b[43m=\u001b[49m\u001b[43mheaders\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    794\u001b[39m \u001b[43m    \u001b[49m\u001b[43mchunked\u001b[49m\u001b[43m=\u001b[49m\u001b[43mchunked\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    795\u001b[39m \u001b[43m    \u001b[49m\u001b[43mretries\u001b[49m\u001b[43m=\u001b[49m\u001b[43mretries\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    796\u001b[39m \u001b[43m    \u001b[49m\u001b[43mresponse_conn\u001b[49m\u001b[43m=\u001b[49m\u001b[43mresponse_conn\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    797\u001b[39m \u001b[43m    \u001b[49m\u001b[43mpreload_content\u001b[49m\u001b[43m=\u001b[49m\u001b[43mpreload_content\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    798\u001b[39m \u001b[43m    \u001b[49m\u001b[43mdecode_content\u001b[49m\u001b[43m=\u001b[49m\u001b[43mdecode_content\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    799\u001b[39m \u001b[43m    \u001b[49m\u001b[43m*\u001b[49m\u001b[43m*\u001b[49m\u001b[43mresponse_kw\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    800\u001b[39m \u001b[43m\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    802\u001b[39m \u001b[38;5;66;03m# Everything went great!\u001b[39;00m\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/urllib3/connectionpool.py:488\u001b[39m, in \u001b[36mHTTPConnectionPool._make_request\u001b[39m\u001b[34m(self, conn, method, url, body, headers, retries, timeout, chunked, response_conn, preload_content, decode_content, enforce_content_length)\u001b[39m\n\u001b[32m    487\u001b[39m         new_e = _wrap_proxy_error(new_e, conn.proxy.scheme)\n\u001b[32m--> \u001b[39m\u001b[32m488\u001b[39m     \u001b[38;5;28;01mraise\u001b[39;00m new_e\n\u001b[32m    490\u001b[39m \u001b[38;5;66;03m# conn.request() calls http.client.*.request, not the method in\u001b[39;00m\n\u001b[32m    491\u001b[39m \u001b[38;5;66;03m# urllib3.request. It also calls makefile (recv) on the socket.\u001b[39;00m\n\n\u001b[31mSSLError\u001b[39m: [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: certificate has expired (_ssl.c:1010)\n\nThe above exception was the direct cause of the following exception:\n\n\u001b[31mMaxRetryError\u001b[39m                             Traceback (most recent call last)\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/requests/adapters.py:644\u001b[39m, in \u001b[36mHTTPAdapter.send\u001b[39m\u001b[34m(self, request, stream, timeout, verify, cert, proxies)\u001b[39m\n\u001b[32m    643\u001b[39m \u001b[38;5;28;01mtry\u001b[39;00m:\n\u001b[32m--> \u001b[39m\u001b[32m644\u001b[39m     resp = \u001b[43mconn\u001b[49m\u001b[43m.\u001b[49m\u001b[43murlopen\u001b[49m\u001b[43m(\u001b[49m\n\u001b[32m    645\u001b[39m \u001b[43m        \u001b[49m\u001b[43mmethod\u001b[49m\u001b[43m=\u001b[49m\u001b[43mrequest\u001b[49m\u001b[43m.\u001b[49m\u001b[43mmethod\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    646\u001b[39m \u001b[43m        \u001b[49m\u001b[43murl\u001b[49m\u001b[43m=\u001b[49m\u001b[43murl\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    647\u001b[39m \u001b[43m        \u001b[49m\u001b[43mbody\u001b[49m\u001b[43m=\u001b[49m\u001b[43mrequest\u001b[49m\u001b[43m.\u001b[49m\u001b[43mbody\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    648\u001b[39m \u001b[43m        \u001b[49m\u001b[43mheaders\u001b[49m\u001b[43m=\u001b[49m\u001b[43mrequest\u001b[49m\u001b[43m.\u001b[49m\u001b[43mheaders\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    649\u001b[39m \u001b[43m        \u001b[49m\u001b[43mredirect\u001b[49m\u001b[43m=\u001b[49m\u001b[38;5;28;43;01mFalse\u001b[39;49;00m\u001b[43m,\u001b[49m\n\u001b[32m    650\u001b[39m \u001b[43m        \u001b[49m\u001b[43massert_same_host\u001b[49m\u001b[43m=\u001b[49m\u001b[38;5;28;43;01mFalse\u001b[39;49;00m\u001b[43m,\u001b[49m\n\u001b[32m    651\u001b[39m \u001b[43m        \u001b[49m\u001b[43mpreload_content\u001b[49m\u001b[43m=\u001b[49m\u001b[38;5;28;43;01mFalse\u001b[39;49;00m\u001b[43m,\u001b[49m\n\u001b[32m    652\u001b[39m \u001b[43m        \u001b[49m\u001b[43mdecode_content\u001b[49m\u001b[43m=\u001b[49m\u001b[38;5;28;43;01mFalse\u001b[39;49;00m\u001b[43m,\u001b[49m\n\u001b[32m    653\u001b[39m \u001b[43m        \u001b[49m\u001b[43mretries\u001b[49m\u001b[43m=\u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mmax_retries\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    654\u001b[39m \u001b[43m        \u001b[49m\u001b[43mtimeout\u001b[49m\u001b[43m=\u001b[49m\u001b[43mtimeout\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    655\u001b[39m \u001b[43m        \u001b[49m\u001b[43mchunked\u001b[49m\u001b[43m=\u001b[49m\u001b[43mchunked\u001b[49m\u001b[43m,\u001b[49m\n\u001b[32m    656\u001b[39m \u001b[43m    \u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    658\u001b[39m \u001b[38;5;28;01mexcept\u001b[39;00m (ProtocolError, \u001b[38;5;167;01mOSError\u001b[39;00m) \u001b[38;5;28;01mas\u001b[39;00m err:\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/urllib3/connectionpool.py:841\u001b[39m, in \u001b[36mHTTPConnectionPool.urlopen\u001b[39m\u001b[34m(self, method, url, body, headers, retries, redirect, assert_same_host, timeout, pool_timeout, release_conn, chunked, body_pos, preload_content, decode_content, **response_kw)\u001b[39m\n\u001b[32m    839\u001b[39m     new_e = ProtocolError(\u001b[33m\"\u001b[39m\u001b[33mConnection aborted.\u001b[39m\u001b[33m\"\u001b[39m, new_e)\n\u001b[32m--> \u001b[39m\u001b[32m841\u001b[39m retries = \u001b[43mretries\u001b[49m\u001b[43m.\u001b[49m\u001b[43mincrement\u001b[49m\u001b[43m(\u001b[49m\n\u001b[32m    842\u001b[39m \u001b[43m    \u001b[49m\u001b[43mmethod\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43murl\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43merror\u001b[49m\u001b[43m=\u001b[49m\u001b[43mnew_e\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43m_pool\u001b[49m\u001b[43m=\u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43m_stacktrace\u001b[49m\u001b[43m=\u001b[49m\u001b[43msys\u001b[49m\u001b[43m.\u001b[49m\u001b[43mexc_info\u001b[49m\u001b[43m(\u001b[49m\u001b[43m)\u001b[49m\u001b[43m[\u001b[49m\u001b[32;43m2\u001b[39;49m\u001b[43m]\u001b[49m\n\u001b[32m    843\u001b[39m \u001b[43m\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    844\u001b[39m retries.sleep()\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/urllib3/util/retry.py:519\u001b[39m, in \u001b[36mRetry.increment\u001b[39m\u001b[34m(self, method, url, response, error, _pool, _stacktrace)\u001b[39m\n\u001b[32m    518\u001b[39m     reason = error \u001b[38;5;129;01mor\u001b[39;00m ResponseError(cause)\n\u001b[32m--> \u001b[39m\u001b[32m519\u001b[39m     \u001b[38;5;28;01mraise\u001b[39;00m MaxRetryError(_pool, url, reason) \u001b[38;5;28;01mfrom\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01mreason\u001b[39;00m  \u001b[38;5;66;03m# type: ignore[arg-type]\u001b[39;00m\n\u001b[32m    521\u001b[39m log.debug(\u001b[33m\"\u001b[39m\u001b[33mIncremented Retry for (url=\u001b[39m\u001b[33m'\u001b[39m\u001b[38;5;132;01m%s\u001b[39;00m\u001b[33m'\u001b[39m\u001b[33m): \u001b[39m\u001b[38;5;132;01m%r\u001b[39;00m\u001b[33m\"\u001b[39m, url, new_retry)\n\n\u001b[31mMaxRetryError\u001b[39m: HTTPSConnectionPool(host='data-osdf.rda.ucar.edu', port=443): Max retries exceeded with url: /ncar/rda/pythia_2025/osdf-cookbook/mae_error_map.npy (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: certificate has expired (_ssl.c:1010)')))\n\nDuring handling of the above exception, another exception occurred:\n\n\u001b[31mSSLError\u001b[39m                                  Traceback (most recent call last)\n\u001b[36mCell\u001b[39m\u001b[36m \u001b[39m\u001b[32mIn[6]\u001b[39m\u001b[32m, line 2\u001b[39m\n\u001b[32m      1\u001b[39m \u001b[38;5;66;03m# Downloading anomaly detection model error map from NCAR via OSDF\u001b[39;00m\n\u001b[32m----> \u001b[39m\u001b[32m2\u001b[39m response = \u001b[43mrequests\u001b[49m\u001b[43m.\u001b[49m\u001b[43mget\u001b[49m\u001b[43m(\u001b[49m\u001b[33;43m'\u001b[39;49m\u001b[33;43mhttps://data-osdf.rda.ucar.edu/ncar/rda/pythia_2025/osdf-cookbook/mae_error_map.npy\u001b[39;49m\u001b[33;43m'\u001b[39;49m\u001b[43m)\u001b[49m\n\u001b[32m      3\u001b[39m response.raise_for_status()\n\u001b[32m      4\u001b[39m sonar_clusters = np.load(io.BytesIO(response.content))\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/requests/api.py:73\u001b[39m, in \u001b[36mget\u001b[39m\u001b[34m(url, params, **kwargs)\u001b[39m\n\u001b[32m     62\u001b[39m \u001b[38;5;28;01mdef\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34mget\u001b[39m(url, params=\u001b[38;5;28;01mNone\u001b[39;00m, **kwargs):\n\u001b[32m     63\u001b[39m \u001b[38;5;250m    \u001b[39m\u001b[33mr\u001b[39m\u001b[33;03m\"\"\"Sends a GET request.\u001b[39;00m\n\u001b[32m     64\u001b[39m \n\u001b[32m     65\u001b[39m \u001b[33;03m    :param url: URL for the new :class:`Request` object.\u001b[39;00m\n\u001b[32m   (...)\u001b[39m\u001b[32m     70\u001b[39m \u001b[33;03m    :rtype: requests.Response\u001b[39;00m\n\u001b[32m     71\u001b[39m \u001b[33;03m    \"\"\"\u001b[39;00m\n\u001b[32m---> \u001b[39m\u001b[32m73\u001b[39m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[43mrequest\u001b[49m\u001b[43m(\u001b[49m\u001b[33;43m\"\u001b[39;49m\u001b[33;43mget\u001b[39;49m\u001b[33;43m\"\u001b[39;49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43murl\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mparams\u001b[49m\u001b[43m=\u001b[49m\u001b[43mparams\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43m*\u001b[49m\u001b[43m*\u001b[49m\u001b[43mkwargs\u001b[49m\u001b[43m)\u001b[49m\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/requests/api.py:59\u001b[39m, in \u001b[36mrequest\u001b[39m\u001b[34m(method, url, **kwargs)\u001b[39m\n\u001b[32m     55\u001b[39m \u001b[38;5;66;03m# By using the 'with' statement we are sure the session is closed, thus we\u001b[39;00m\n\u001b[32m     56\u001b[39m \u001b[38;5;66;03m# avoid leaving sockets open which can trigger a ResourceWarning in some\u001b[39;00m\n\u001b[32m     57\u001b[39m \u001b[38;5;66;03m# cases, and look like a memory leak in others.\u001b[39;00m\n\u001b[32m     58\u001b[39m \u001b[38;5;28;01mwith\u001b[39;00m sessions.Session() \u001b[38;5;28;01mas\u001b[39;00m session:\n\u001b[32m---> \u001b[39m\u001b[32m59\u001b[39m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[43msession\u001b[49m\u001b[43m.\u001b[49m\u001b[43mrequest\u001b[49m\u001b[43m(\u001b[49m\u001b[43mmethod\u001b[49m\u001b[43m=\u001b[49m\u001b[43mmethod\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43murl\u001b[49m\u001b[43m=\u001b[49m\u001b[43murl\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43m*\u001b[49m\u001b[43m*\u001b[49m\u001b[43mkwargs\u001b[49m\u001b[43m)\u001b[49m\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/requests/sessions.py:589\u001b[39m, in \u001b[36mSession.request\u001b[39m\u001b[34m(self, method, url, params, data, headers, cookies, files, auth, timeout, allow_redirects, proxies, hooks, stream, verify, cert, json)\u001b[39m\n\u001b[32m    584\u001b[39m send_kwargs = {\n\u001b[32m    585\u001b[39m     \u001b[33m\"\u001b[39m\u001b[33mtimeout\u001b[39m\u001b[33m\"\u001b[39m: timeout,\n\u001b[32m    586\u001b[39m     \u001b[33m\"\u001b[39m\u001b[33mallow_redirects\u001b[39m\u001b[33m\"\u001b[39m: allow_redirects,\n\u001b[32m    587\u001b[39m }\n\u001b[32m    588\u001b[39m send_kwargs.update(settings)\n\u001b[32m--> \u001b[39m\u001b[32m589\u001b[39m resp = \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43msend\u001b[49m\u001b[43m(\u001b[49m\u001b[43mprep\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43m*\u001b[49m\u001b[43m*\u001b[49m\u001b[43msend_kwargs\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    591\u001b[39m \u001b[38;5;28;01mreturn\u001b[39;00m resp\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/requests/sessions.py:703\u001b[39m, in \u001b[36mSession.send\u001b[39m\u001b[34m(self, request, **kwargs)\u001b[39m\n\u001b[32m    700\u001b[39m start = preferred_clock()\n\u001b[32m    702\u001b[39m \u001b[38;5;66;03m# Send the request\u001b[39;00m\n\u001b[32m--> \u001b[39m\u001b[32m703\u001b[39m r = \u001b[43madapter\u001b[49m\u001b[43m.\u001b[49m\u001b[43msend\u001b[49m\u001b[43m(\u001b[49m\u001b[43mrequest\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43m*\u001b[49m\u001b[43m*\u001b[49m\u001b[43mkwargs\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    705\u001b[39m \u001b[38;5;66;03m# Total elapsed time of the request (approximately)\u001b[39;00m\n\u001b[32m    706\u001b[39m elapsed = preferred_clock() - start\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/osdf-cookbook/lib/python3.12/site-packages/requests/adapters.py:675\u001b[39m, in \u001b[36mHTTPAdapter.send\u001b[39m\u001b[34m(self, request, stream, timeout, verify, cert, proxies)\u001b[39m\n\u001b[32m    671\u001b[39m         \u001b[38;5;28;01mraise\u001b[39;00m ProxyError(e, request=request)\n\u001b[32m    673\u001b[39m     \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28misinstance\u001b[39m(e.reason, _SSLError):\n\u001b[32m    674\u001b[39m         \u001b[38;5;66;03m# This branch is for urllib3 v1.22 and later.\u001b[39;00m\n\u001b[32m--> \u001b[39m\u001b[32m675\u001b[39m         \u001b[38;5;28;01mraise\u001b[39;00m SSLError(e, request=request)\n\u001b[32m    677\u001b[39m     \u001b[38;5;28;01mraise\u001b[39;00m \u001b[38;5;167;01mConnectionError\u001b[39;00m(e, request=request)\n\u001b[32m    679\u001b[39m \u001b[38;5;28;01mexcept\u001b[39;00m ClosedPoolError \u001b[38;5;28;01mas\u001b[39;00m e:\n\n\u001b[31mSSLError\u001b[39m: HTTPSConnectionPool(host='data-osdf.rda.ucar.edu', port=443): Max retries exceeded with url: /ncar/rda/pythia_2025/osdf-cookbook/mae_error_map.npy (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: certificate has expired (_ssl.c:1010)')))","ename":"SSLError","evalue":"HTTPSConnectionPool(host='data-osdf.rda.ucar.edu', port=443): Max retries exceeded with url: /ncar/rda/pythia_2025/osdf-cookbook/mae_error_map.npy (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: certificate has expired (_ssl.c:1010)')))"}],"key":"AYEpaU3GqL"}],"key":"saccGS7vd1"},{"type":"block","kind":"notebook-content","children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"l6rl2bF2z2"}],"key":"gWlxHlt9vy"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"6) Helper: mean Sv in dB","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bsvG7raksO"}],"identifier":"id-6-helper-mean-sv-in-db","label":"6) Helper: mean Sv in dB","html_id":"id-6-helper-mean-sv-in-db","implicit":true,"key":"FCXpDfzOrU"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Computes the mean of Sv correctly by converting dB → linear, averaging, then linear → dB.\nAccepts array-like input (NumPy/xarray/dask); returns a scalar in dB.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"iVxJOJiz6s"}],"key":"fZsn0Z5j6S"}],"key":"DqSkeh3PhE"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def calculate_sv_mean(input_sv):\n    # Convert dB to linear, mean in linear space, convert back to dB\n    sv = 10. ** (input_sv / 10.)\n    return 10 * np.log10(np.mean(sv))","key":"TPkd74hUaW"},{"type":"output","id":"dEH69D79rHzWMYaZh2Z_a","data":[],"key":"RUkuw3WuRf"}],"key":"Sp9ukPpyE3"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"7) Group cruise data into hourly chunks","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yvrTKOFX1j"}],"identifier":"id-7-group-cruise-data-into-hourly-chunks","label":"7) Group cruise data into hourly chunks","html_id":"id-7-group-cruise-data-into-hourly-chunks","implicit":true,"key":"fpuVWwKSTO"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Adds an hourly label and groups the cruise data by hour.\nProduces a list of per-hour xarray.Dataset chunks for downstream aggregation.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"oZ42KyHT77"}],"key":"nDv1ScCNTw"}],"key":"PyaIxrLNyk"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"cruise['time_hour'] = cruise['time'].dt.floor('1h')  # hourly bin label\n\n# Group by each hour\ngrouped = cruise.groupby('time_hour')\n\n# Extract each 1-hour Dataset as a chunk (drop helper label)\nchunks = [group.drop_vars('time_hour') for _, group in grouped]","key":"b9HQYUpiZE"},{"type":"output","id":"_iGcxIUEjlVyrr-wi_FaR","data":[],"key":"WZp4wm53EN"}],"key":"mpfVyAmAjE"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"8) Compute hourly mean Sv and attach to env_df","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BO5N73Y9Ng"}],"identifier":"id-8-compute-hourly-mean-sv-and-attach-to-env-df","label":"8) Compute hourly mean Sv and attach to env_df","html_id":"id-8-compute-hourly-mean-sv-and-attach-to-env-df","implicit":true,"key":"OpBrJD3zgK"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Iterates over hourly chunks, computes mean Sv per hour using calculate_sv_mean.\nConverts dask→NumPy→Python float and appends to a list.\nAssigns the resulting hourly series to env_df[“sv_hourly”].\nAssumes the number/order of hours matches rows retained in env_df.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"hLGtci3CnI"}],"key":"saKsuxbaOW"}],"key":"b95TQMj6PY"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"sv_hourly = []\ntimestamps = []\n\nfor i in range(0, len(chunks)):\n    sv_data = chunks[i]['Sv']\n    result = calculate_sv_mean(sv_data)\n\n    # Use first time in hour as representative timestamp\n    ts = pd.to_datetime(chunks[i]['time'].values[0])\n    result = result.compute()  # dask -> numpy\n    result = float(result.values)  # numpy -> Python float\n\n    sv_hourly.append(result)\n\nenv_df[\"sv_hourly\"] = sv_hourly","key":"Y1SUbgQjYH"},{"type":"output","id":"GA8nACSuTr06ilVarjesx","data":[],"key":"NbIn4tEoUQ"}],"key":"eJcuX6m54m"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"9) Build (depth × time) error-map DataFrame and align timestamps","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"IGZ72PGwsb"}],"identifier":"id-9-build-depth-time-error-map-dataframe-and-align-timestamps","label":"9) Build (depth × time) error-map DataFrame and align timestamps","html_id":"id-9-build-depth-time-error-map-dataframe-and-align-timestamps","implicit":true,"key":"OTGl3O7zye"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Extracts one channel from sonar_clusters and pairs it with cruise depths and timestamps to form a DataFrame.\nUses min(...) to guard against size mismatches in depth/time dimensions.\nAligns only the first and last timestamps in env_df to the heatmap’s time range (keeps interior indices unchanged, sets UTC).","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"mwtTh2avWe"}],"key":"hhBFVZ91Xz"}],"key":"sxMJ5OoNBR"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Prepare axes\ndepths = np.asarray(cruise.depth.values)\ntimes = pd.to_datetime(hm_timestamps)\n\n# Select channel/slice from sonar_clusters\nvals = sonar_clusters[:, :, 1]  # (1088, 28096)\n\n# Guard against mismatched sizes\nn_depth = min(len(depths), vals.shape[0])\nn_time = min(len(times), vals.shape[1])\n\n# DataFrame: rows=depths, cols=timestamps\ndf = pd.DataFrame(\n    data=vals[:n_depth, :n_time],\n    index=depths[:n_depth],\n    columns=times[:n_time]\n)\n\n# Align env_df index endpoints to heatmap timestamps (keeps interior unchanged)\nidx = env_df.index.tolist()\ndf_timestamps = pd.to_datetime(df.columns).tz_localize(None)\nidx[0] = pd.Timestamp(df_timestamps.values[0], tz='UTC').floor(\"s\")\nidx[-1] = pd.Timestamp(df_timestamps.values[-1], tz='UTC').floor(\"s\")\nenv_df.index = idx","key":"MGb51zFeJ5"},{"type":"output","id":"yjTLLuzhO2h-Tq4tf0Edq","data":[],"key":"GVfEC3YPP4"}],"key":"Z4dwLNbSZy"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"10) Data Visualization: Synchronized Lines + Heatmap","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NxY0hxovve"}],"identifier":"id-10-data-visualization-synchronized-lines-heatmap","label":"10) Data Visualization: Synchronized Lines + Heatmap","html_id":"id-10-data-visualization-synchronized-lines-heatmap","implicit":true,"key":"DpvGPoMEIe"}],"key":"CkL15Acbs3"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Plots synchronized data: top = time series from line_df; bottom = depth×time heatmap from heatmap_df.\nExpects line_df to have a DatetimeIndex (timezone-naive or converted).\nDepth axis is reversed (surface at top).\nSaves an interactive HTML file to the parent directory (correlations.html) and shows the figure if show=True.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wEkQOjv47F"}],"key":"phvjfr3XDu"}],"key":"cLg4u6MZwD"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def plot_synchronized_heatmaps_from_df(\n        heatmap_df: pd.DataFrame,\n        line_df: pd.DataFrame,\n        colorscale: str = \"Reds\",\n        show_markers: bool = False,\n        show: bool = False,\n):\n    if not isinstance(line_df.index, pd.DatetimeIndex):\n        raise TypeError(\"line_df must have a DatetimeIndex\")\n    line_df = line_df.copy()\n    if line_df.index.tz is not None:\n        line_df.index = line_df.index.tz_convert(None)\n\n    depths = np.asarray(heatmap_df.index)\n    heatmap_timestamps = pd.to_datetime(heatmap_df.columns)\n    z = heatmap_df.to_numpy()\n\n    n = len(line_df.columns)\n    fig = make_subplots(\n        rows=n + 1,\n        cols=1,\n        shared_xaxes=True,\n        vertical_spacing=0.02,\n        row_heights=[0.1] * n + [0.7],  # n small rows + large heatmap row\n    )\n\n    mode = \"lines+markers\" if show_markers else \"lines\"\n\n    # Define units for each variable\n    units = {\n        'sea_surface_temperature': '°C',\n        'elevation_deg': 'degrees',\n        'sv_hourly': 'dB'\n    }\n\n    for i, col in enumerate(line_df.columns, start=1):\n        fig.add_trace(\n            go.Scatter(x=line_df.index, y=line_df[col], name=str(col), mode=mode, showlegend=True),\n            row=i, col=1\n        )\n\n        # Add units as y-axis titles\n        unit = units.get(col, '')  # Default to empty string if variable not found\n        fig.update_yaxes(\n            title_text=unit,\n            row=i, col=1\n        )\n\n        if i < len(line_df.columns):\n            fig.update_xaxes(showticklabels=False, row=i, col=1)\n\n    fig.add_trace(\n        go.Heatmap(\n            z=z, x=heatmap_timestamps, y=depths, colorscale=colorscale,\n            zmin=np.nanmin(z), zmax=np.nanmax(z),\n            hovertemplate=\"t=%{x}<br>depth=%{y}<br>value=%{z}<extra></extra>\",\n        ),\n        row=n + 1, col=1\n    )\n    fig.update_yaxes(autorange=\"reversed\", row=n + 1, col=1, title_text=\"Depth\")\n\n    fig.update_layout(\n        margin=dict(l=40, r=40, t=60, b=40),  # Reduced left margin, increased top for legend\n        hovermode=\"x unified\",\n        template=\"plotly_white\",\n        # height=10 * n + 500,  # scale height with number of signals\n    )\n\n    # Enhanced horizontal legend positioning\n    fig.update_layout(\n        legend=dict(\n            orientation='h',\n            x=0,\n            y=1.02,\n            xanchor='left',\n            yanchor='bottom',\n            bgcolor='rgba(255,255,255,0.8)',\n            bordercolor='rgba(0,0,0,0.1)',\n            borderwidth=1\n        )\n    )\n\n    save_path = os.path.join(os.path.dirname(os.getcwd()), \"correlations.html\")\n    fig.write_html(save_path)\n    print(f\"Plot saved to: {save_path}\")\n    if show:\n        fig.show()\n    return fig\n# Uncomment this line in order to create the plot.\n# fig = plot_synchronized_heatmaps_from_df(heatmap_df=df, line_df=env_df)\n# fig.show()","key":"Pt3I4cTWfv"},{"type":"output","id":"vS2sIKG5SnpItiaCRi92K","data":[],"key":"EJZIOBdCaU"}],"key":"xtSuJt5wBu"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Because rendering the plot is computationally intensive and involves downloading approximately 1 GB of data, we present a static image of the result instead.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SpsmXAlXEO"}],"key":"GJl3W7TYrc"}],"key":"NmLYAEIy1N"},{"type":"block","kind":"notebook-code","data":{"ExecuteTime":{"end_time":"2025-08-15T19:32:51.371053Z","start_time":"2025-08-15T19:32:51.362008Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"from IPython.display import Image, display\ndisplay(Image(filename='../images/sonarai_example.png'))","key":"oyaVgoaVaq"},{"type":"output","id":"r9XNqfBLy9DVTt_SjSCkd","data":[],"key":"O7RbieEi4B"}],"key":"BhwlV0nBmB"}],"key":"ZryNN3TcHD"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Integrating sonar and buoy-based temperature data","url":"/notebooks/sonarai-foundations","group":"NOAA SONAR data examples"},"next":{"title":"PyCoGSS: Spectral Change Analysis of Arctic Water Tracks","url":"/notebooks/pycogss-foundations","group":"PYCOGSS examples"}}},"domain":"http://localhost:3000"}