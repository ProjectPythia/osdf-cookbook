{"version":2,"kind":"Notebook","sha256":"0aca457a99a1977ccdc7a13cb4230e7da5b01a079fce5ce6585619d9b030727b","slug":"notebooks.sonarai-technical","location":"/notebooks/04_SonarAI_Technical.ipynb","dependencies":[],"frontmatter":{"title":"SonarAI Technical Notebook","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"authors":[{"nameParsed":{"literal":"Harsha R. Hampapura","given":"Harsha R.","family":"Hampapura"},"name":"Harsha R. Hampapura","id":"contributors-myst-generated-uid-0"},{"nameParsed":{"literal":"Brian Bockelman","given":"Brian","family":"Bockelman"},"name":"Brian Bockelman","id":"contributors-myst-generated-uid-1"},{"nameParsed":{"literal":"Alexander Hoelzeman","given":"Alexander","family":"Hoelzeman"},"name":"Alexander Hoelzeman","id":"contributors-myst-generated-uid-2"},{"nameParsed":{"literal":"Carrie Wall","given":"Carrie","family":"Wall"},"name":"Carrie Wall","id":"contributors-myst-generated-uid-3"},{"nameParsed":{"literal":"Emma Turetsky","given":"Emma","family":"Turetsky"},"name":"Emma Turetsky","id":"contributors-myst-generated-uid-4"},{"nameParsed":{"literal":"Amandha Wingert Barok","given":"Amandha Wingert","family":"Barok"},"name":"Amandha Wingert Barok","id":"contributors-myst-generated-uid-5"},{"nameParsed":{"literal":"Aashish Panta","given":"Aashish","family":"Panta"},"name":"Aashish Panta","id":"contributors-myst-generated-uid-6"},{"nameParsed":{"literal":"Riley Conroy","given":"Riley","family":"Conroy"},"name":"Riley Conroy","id":"contributors-myst-generated-uid-7"},{"nameParsed":{"literal":"Douglas Schuster","given":"Douglas","family":"Schuster"},"name":"Douglas Schuster","id":"contributors-myst-generated-uid-8"},{"nameParsed":{"literal":"Justin Hiemstra","given":"Justin","family":"Hiemstra"},"name":"Justin Hiemstra","id":"contributors-myst-generated-uid-9"},{"nameParsed":{"literal":"Joanmarie Del Vecchio","given":"Joanmarie Del","family":"Vecchio"},"name":"Joanmarie Del Vecchio","id":"contributors-myst-generated-uid-10"},{"nameParsed":{"literal":"Kibiwott Koech","given":"Kibiwott","family":"Koech"},"name":"Kibiwott Koech","id":"contributors-myst-generated-uid-11"}],"open_access":true,"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true},"code":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true}},"github":"https://github.com/projectpythia/osdf-cookbook","copyright":"2024","affiliations":[{"id":"UAlbany","name":"University at Albany (SUNY)","department":"Atmospheric and Environmental Sciences","url":"https://www.albany.edu/daes"},{"id":"CISL","name":"NSF National Center for Atmospheric Research","department":"Computational and Information Systems Lab","url":"https://www.cisl.ucar.edu"},{"id":"Unidata","name":"NSF Unidata","url":"https://www.unidata.ucar.edu"},{"id":"Argonne","name":"Argonne National Laboratory","department":"Environmental Science Division","url":"https://www.anl.gov/evs"},{"id":"CarbonPlan","name":"CarbonPlan","url":"https://carbonplan.org"},{"id":"NVIDIA","name":"NVIDIA Corporation","url":"https://www.nvidia.com/"}],"numbering":{"title":{"offset":1}},"edit_url":"https://github.com/projectpythia/osdf-cookbook/blob/main/notebooks/04_SonarAI_Technical.ipynb","exports":[{"format":"ipynb","filename":"04_SonarAI_Technical.ipynb","url":"/osdf-cookbook/build/04_SonarAI_Technical-1f7077a0cf53711df63e96887b07fd85.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Notebook Structure","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DfCxCW1ZOn"}],"identifier":"notebook-structure","label":"Notebook Structure","html_id":"notebook-structure","implicit":true,"key":"mKvsvFxgMY"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This notebook walks through an end-to-end workflow to relate shipboard sonar backscatter (Sv) to local environmental conditions. We (1) open EK60 data from a public NOAA S3 Zarr, (2) gather co-located environmental variables from OISST and IOOS ERDDAP, (3) compute hourly mean Sv, (4) assemble a depth×time error map for reference, and (5) synchronize timestamps to produce an interactive line-plus-heatmap visualization. All selections (time/depth/frequency) and conversions are kept explicit for reproducibility.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fPxdjuSeZH"}],"key":"grSiWoA8YN"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Imports","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"KNeksgOeG0"}],"key":"xrKIil0mzu"},{"type":"text","value":"\nLoad core libraries for data access (xarray, s3fs), analysis (numpy, pandas), plotting (plotly), and I/O.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"nZOmYEZLkI"}],"key":"Qj9luyBtFC"}],"key":"T6GLEq7lz7"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"strong","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Initializing the datasets","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"THL9Su4Ebg"}],"key":"YcPGUFbjuI"},{"type":"text","value":"\nAccess HB1906 EK60 Zarr data from public S3; subset by time/depth, select 38 kHz, and mask bins below bottom.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"br3Ca92JTP"}],"key":"vdYr91EBBC"}],"key":"veRXVWyeOF"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"strong","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Access buoy data","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"csNIx22Seg"}],"key":"POwWcM5vox"},{"type":"text","value":"\nDefine Georges Bank buoy coordinates, sample daily OISST SST at the nearest grid cell (±1 day), and download the model error map (","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"ky1ehwy39F"},{"type":"inlineCode","value":".npy","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"CXAKVJXZHc"},{"type":"text","value":").","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"mYzJqlBBlW"}],"key":"vMbJmcxzYp"}],"key":"I83xtGD6VL"},{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":14,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"strong","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Downloading external error map for the specific location","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"ZXw9FS6Lvz"}],"key":"crVqwSVcJN"},{"type":"text","value":"\nDownloading the error map comes from a fixed file","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"kShXIHAaIc"}],"key":"YNZmb8kyfU"}],"key":"BUUjzO4x8O"},{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"strong","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Helper Function: Mean Sv (dB)","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"NzhmKO6MaX"}],"key":"nBDYpONnTO"},{"type":"text","value":"\nConvert Sv from dB→linear, compute mean, convert back to dB.","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"SIIl8Km4rG"}],"key":"ahAq5kVLB8"}],"key":"goxyAA3SoA"},{"type":"listItem","spread":true,"position":{"start":{"line":20,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":20,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"strong","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"Group Cruise Data into Hourly Chunks","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"MpWD5dY9CZ"}],"key":"DVxbE4CwFG"},{"type":"text","value":"\nAdd an hourly label and split the EK60 dataset into per-hour ","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"Jyv8j9GjL6"},{"type":"inlineCode","value":"xarray.Dataset","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"isu9xbvsZr"},{"type":"text","value":" chunks.","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"p066MXT3DN"}],"key":"hSWk7kd43V"}],"key":"dXmmbio1nC"},{"type":"listItem","spread":true,"position":{"start":{"line":23,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":23,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"strong","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"Compute Hourly Mean Sv & Attach to ","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"XD2NAZZKUF"},{"type":"inlineCode","value":"env_df","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"CjfjzJBbD8"}],"key":"CUnFDjPMhr"},{"type":"text","value":"\nAggregate Sv per hour and append results as a new column in the environmental dataframe.","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"KIiMNbdGce"}],"key":"hlqmAaoaBb"}],"key":"HGw2UgUwTz"},{"type":"listItem","spread":true,"position":{"start":{"line":26,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":26,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"strong","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"Build Depth×Time Error-Map DataFrame & Align Timestamps","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"rabIIZDtX4"}],"key":"kuF5T21jry"},{"type":"text","value":"\nConstruct a depth-by-time matrix from the error map, guard for size mismatches, and align ","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"d3OLXsV6WJ"},{"type":"inlineCode","value":"env_df","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"n8DnZLVMZb"},{"type":"text","value":" endpoints to the heatmap timestamps.","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"uyxORyF78R"}],"key":"PxCX8XUeeG"}],"key":"d42CSUHQDg"},{"type":"listItem","spread":true,"position":{"start":{"line":29,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":29,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"strong","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"text","value":"Data Visualization: Synchronized Lines + Heatmap","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"Z4z08acwe0"}],"key":"ljUNeOXZGZ"},{"type":"text","value":"\nPlot environmental time series above a depth×time heatmap with shared x-axis; save interactive HTML output.","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"RAgWzQgOOx"}],"key":"BCmcmQTRnT"}],"key":"fCa0p9qogi"}],"key":"K68ot0HKUP"}],"key":"NVaJay3IZv"},{"type":"block","kind":"notebook-content","children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rFZsgjfB0D"}],"key":"k8nKDlMPCz"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Prerequisites","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kPZaqBK3Ef"}],"identifier":"prerequisites","label":"Prerequisites","html_id":"prerequisites","implicit":true,"key":"fld58CGjsE"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"This section was inspired by ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"eLawtS5dbu"},{"type":"link","url":"https://github.com/alan-turing-institute/the-turing-way/blob/master/book/templates/chapter-template/chapter-landing-page.md","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"this template","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Lf9y5E1Ryx"}],"urlSource":"https://github.com/alan-turing-institute/the-turing-way/blob/master/book/templates/chapter-template/chapter-landing-page.md","data":{"kind":"file","org":"alan-turing-institute","repo":"the-turing-way","reference":"master","file":"book/templates/chapter-template/chapter-landing-page.md","raw":"https://raw.githubusercontent.com/alan-turing-institute/the-turing-way/master/book/templates/chapter-template/chapter-landing-page.md"},"internal":false,"protocol":"github","key":"iBIxXZ8VAN"},{"type":"text","value":" of the wonderful ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"WzGLrpDu7G"},{"type":"link","url":"https://the-turing-way.netlify.app","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"The Turing Way","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"brahyZ4q3f"}],"urlSource":"https://the-turing-way.netlify.app","key":"xQqD708cJH"},{"type":"text","value":" Jupyter Book.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"rEEe8HR3Bj"}],"key":"n0oOmAZMwW"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"This notebook opens public NOAA EK60 Zarr data from S3, subsets by time/depth, reads daily OISST SST near a buoy, fetches ERDDAP environmental variables, computes hourly mean ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"sg6MCWZ6Cr"},{"type":"strong","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Sv","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"LQNQEAnHC8"}],"key":"UveMkGpyEv"},{"type":"text","value":" (dB), aligns with a depth×time error map, and renders synchronized line/heatmap plots.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"FQdEryHeTJ"}],"key":"gSR5Ecorhi"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Label the importance of each concept explicitly as ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"yvxqmupYUk"},{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"helpful/necessary","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"vhoqW4Wkbv"}],"key":"BmXLAj8Gqw"},{"type":"text","value":".","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"iZKEoSZYEw"}],"key":"ATBkNLCUf4"},{"type":"table","position":{"start":{"line":8,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"tableRow","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"tableCell","header":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Concepts","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"jvJnDk0sgI"}],"key":"gqynbWDiaf"},{"type":"tableCell","header":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Importance","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"CSDngEBP9p"}],"key":"GpVU1jMP48"},{"type":"tableCell","header":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Notes","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"pIUmR7IsLS"}],"key":"bx6PvAG8zI"}],"key":"TEuUhofFfV"},{"type":"tableRow","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Xarray + Zarr basics","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"e276JXtyEP"}],"key":"B7rDAC716K"},{"type":"tableCell","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"strong","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Necessary","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"dbDeWaEfrJ"}],"key":"pJnAs5KdVl"}],"key":"yqc565o8tN"},{"type":"tableCell","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Opening Zarr stores, selecting by coords/dims, ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"XesbSdSsXf"},{"type":"inlineCode","value":".compute()","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"wdN0cV1nb5"},{"type":"text","value":" semantics","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"DTOlNqiho5"}],"key":"qZZFFKPal7"}],"key":"yuJkYOYZ8T"},{"type":"tableRow","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"s3fs & public S3 access","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"vcxWyTPgrW"}],"key":"R83hTs7cuL"},{"type":"tableCell","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"strong","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Necessary","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"DjO7suPUxN"}],"key":"sFeMoXD88I"}],"key":"hX4YLQiH8G"},{"type":"tableCell","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Anonymous reads from AWS S3 (","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"GUGlSJHtB6"},{"type":"inlineCode","value":"anon=True","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"ooGNs3Zmic"},{"type":"text","value":")","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"HtzIDsocSi"}],"key":"zNtHWVEpZf"}],"key":"K0rAK82pH9"},{"type":"tableRow","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Pandas time series","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"F4LepZC6SJ"}],"key":"SrMvYeOQTl"},{"type":"tableCell","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"strong","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Necessary","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"yXU0vdrEJT"}],"key":"vAdqNzaSab"}],"key":"U9w915lfzS"},{"type":"tableCell","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"inlineCode","value":"DatetimeIndex","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"uD5hdGknDt"},{"type":"text","value":", sorting, filtering, timezone-naive vs. aware","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"jkjcGlyi75"}],"key":"tvXpmppVV7"}],"key":"y21aQj7nlD"},{"type":"tableRow","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"NumPy fundamentals","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"TMbk921zwz"}],"key":"Qm6dyGXqua"},{"type":"tableCell","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"strong","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Necessary","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"vgYn6I99lu"}],"key":"qgMcyXXhAM"}],"key":"M0bTFwRH41"},{"type":"tableCell","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Array slicing, stats, type conversion","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"fLUT8TGKAj"}],"key":"CJwn2UPFdR"}],"key":"C9MoRAHzBj"},{"type":"tableRow","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Acoustic backscatter (Sv) & dB averaging","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"a5Eeb2wmS7"}],"key":"zDyJg2VpyY"},{"type":"tableCell","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"strong","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Necessary","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"yOk2mnFAQm"}],"key":"tBhYHb9pQv"}],"key":"QidClKy2AY"},{"type":"tableCell","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Convert dB→linear, mean, then linear→dB, Understanding results","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"Yv5DB6IkrQ"}],"key":"Qbx63h4jpM"}],"key":"piWsonZLeL"},{"type":"tableRow","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"ERDDAP tabledap & info endpoints","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"v5TsMksQxs"}],"key":"YdDESu5m7J"},{"type":"tableCell","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"strong","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Helpful","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"u2U3ScrzeY"}],"key":"A7LB1eVibC"}],"key":"FZ43U4nLWv"},{"type":"tableCell","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Reading CSV responses; unit metadata lookup","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"VigFulM32B"}],"key":"dCefU2Uv5m"}],"key":"O55zeYTipE"},{"type":"tableRow","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Plotly fundamentals","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"xcHrQaRsIz"}],"key":"akfajyWCcw"},{"type":"tableCell","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"strong","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Helpful","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"ABwM8fzAYX"}],"key":"MjPzBbI7u8"}],"key":"c33isRsKIE"},{"type":"tableCell","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Subplots, heatmaps, interactive HTML export","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"eozF5gp1OT"}],"key":"b5T2Xh6hR7"}],"key":"OaiYSYhnsn"},{"type":"tableRow","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Understanding of NetCDF/CF","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"pGGb2ZcEZ1"}],"key":"dVQgVrNS2Y"},{"type":"tableCell","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"strong","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Helpful","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"isfsBtf49E"}],"key":"vGYaJBIvQ6"}],"key":"B8CLp84w5M"},{"type":"tableCell","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Variable metadata and geospatial conventions","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"CCYeV8fqvB"}],"key":"Inl1cmj0fA"}],"key":"q3n6ilaA8f"},{"type":"tableRow","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"Dask awareness","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"uW4IlQlhKh"}],"key":"XkL9WyaIng"},{"type":"tableCell","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"strong","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"Helpful","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"DjrUn1r589"}],"key":"udNfLFu4CT"}],"key":"kkjj3Dcza2"},{"type":"tableCell","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"Lazy arrays; when/why to call ","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"sLjMyPldcK"},{"type":"inlineCode","value":".compute()","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"tVq9WQ4JCx"}],"key":"TpfDRZRrpX"}],"key":"vir0GlXFq0"},{"type":"tableRow","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Geographic coordinates","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"RJseMeWHYm"}],"key":"pFrYDrsjFO"},{"type":"tableCell","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"strong","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Helpful","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"Nvx3NPTEtf"}],"key":"w2N7YkjfBx"}],"key":"W9X6v618fN"},{"type":"tableCell","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"0–360 vs. −180–180 longitude handling","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"vpUTaC8j9D"}],"key":"uomffaHMPx"}],"key":"pxrM2DYXIm"},{"type":"tableRow","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"HTTP/IO with ","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"VfdjZYxogy"},{"type":"inlineCode","value":"requests","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"IZwUFm2BMG"}],"key":"qqB4bsQNed"},{"type":"tableCell","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"strong","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"Helpful","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"XqmokduCoX"}],"key":"aiLgIxuCT8"}],"key":"FsHs5RorDQ"},{"type":"tableCell","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"Downloading ","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"vXZjURhSV7"},{"type":"inlineCode","value":".npy","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"Ij349nXdFL"},{"type":"text","value":" assets for local use","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"JxMpJjdUgo"}],"key":"IAgrkdms3J"}],"key":"qDQCSvPnvm"}],"key":"XTGMUwniPs"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":22,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":22,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"strong","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"Time to learn","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"hmhPUdM9pe"}],"key":"nFVda7kRkJ"},{"type":"text","value":": ~75 minutes","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"iMBS7RCEoi"}],"key":"kvbbxqSLGu"}],"key":"nK8jm6Dpg3"},{"type":"listItem","spread":true,"position":{"start":{"line":24,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"strong","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"System requirements","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"VDuHqwc0Wn"}],"key":"kxN9fpQVOa"},{"type":"text","value":":","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"RNJ8Eu2WnR"}],"key":"egSJUowk6G"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":25,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"Python 3.9+ with Jupyter Notebook/Lab","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"JarPOus4LP"}],"key":"a31vFDnuLo"},{"type":"listItem","spread":true,"position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"Required packages: ","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"ZRkzow7L95"},{"type":"inlineCode","value":"xarray","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"JB2qIBDC49"},{"type":"text","value":", ","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"xrzcsehQSM"},{"type":"inlineCode","value":"s3fs","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"niWjDAEtS5"},{"type":"text","value":", ","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"NEQ9eypCVn"},{"type":"inlineCode","value":"numpy","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"QVYrvjDmii"},{"type":"text","value":", ","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"uRYkpLpwkI"},{"type":"inlineCode","value":"pandas","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"IIiYxL8NOn"},{"type":"text","value":", ","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"riUx4qHuxF"},{"type":"inlineCode","value":"plotly","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"dFIAHSKNJT"},{"type":"text","value":", ","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"mGcJxM6aaS"},{"type":"inlineCode","value":"requests","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"iZPsCHz4Zy"},{"type":"text","value":", ","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"FyKXq3GVq3"},{"type":"inlineCode","value":"netCDF4","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"X0tReDlqGJ"},{"type":"text","value":" ","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"qhxnguRKjK"},{"type":"emphasis","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"(optional but helpful: ","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"l6SdPuZbh6"},{"type":"inlineCode","value":"dask","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"yq05jgLlOm"},{"type":"text","value":")","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"tofAt27fkd"}],"key":"tNAqH7riSE"}],"key":"kbCZxrYMbL"}],"key":"rU6TImjNRv"}],"key":"x9Yc8saiBX"}],"key":"TH84cJmReI"}],"key":"GeEzkplccX"},{"type":"block","kind":"notebook-content","children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Qr805E2ZF4"}],"key":"dMIQkN3Otv"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"1) Imports","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ySmwh7BQKQ"}],"identifier":"id-1-imports","label":"1) Imports","html_id":"id-1-imports","implicit":true,"key":"U0iJSHLsZZ"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Core libraries used throughout the notebook.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"DRmhakSxyZ"}],"key":"pBWliWloTs"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Key roles:","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"rR8NUcGGXK"}],"key":"yQeZZwalNi"},{"type":"code","lang":"","value":"xarray/s3fs for reading NOAA Zarr data from S3\nnumpy/pandas for arrays & tables\nplotly for interactive plotting\nrequests/io/os for file I/O and downloads\ndatetime for time calculations","position":{"start":{"line":6,"column":1},"end":{"line":10,"column":1}},"key":"h0KbjBGln2"}],"key":"CY5kwmYK7x"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import xarray as xr\nimport s3fs\nimport numpy as np\nimport plotly.graph_objects as go\nfrom plotly.subplots import make_subplots\nimport pandas as pd\nimport requests\nimport io\nimport os\nfrom datetime import datetime, timedelta","key":"K9pNWErAW8"},{"type":"output","id":"MkVySExF2CXLO4ZWp_RGG","data":[],"key":"n12sDvsRxS"}],"key":"K7wwZrFTTc"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2) Initializing the datasets","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"IIGrOdJmnE"}],"identifier":"id-2-initializing-the-datasets","label":"2) Initializing the datasets","html_id":"id-2-initializing-the-datasets","implicit":true,"key":"YJIq4rJ64M"}],"key":"NvFJQFkEyv"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Builds the S3 path to the HB1906 EK60 Zarr dataset and opens it anonymously.\nSubsets by time window and depth range, selects the 38 kHz channel, and masks samples below the estimated bottom.\n.compute() materializes the selection; hm_timestamps will be reused for time alignment later. All datasets are accessed\nusing the OSDF infrastructure","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lVrn8iWgny"}],"key":"G2pDgHdTxU"}],"key":"pfNeUf3Do3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"bucket_name = 'noaa-wcsd-zarr-pds'\nship_name = \"Henry_B._Bigelow\"\ncruise_name = \"HB1906\"\nsensor_name = \"EK60\"\n\n# Accessing the NOAA HB1906 dataset using OSDF (anonymous S3)\ns3_file_system = s3fs.S3FileSystem(anon=True)\nzarr_store = f'{cruise_name}.zarr'\ns3_zarr_store_path = f\"{bucket_name}/level_2/{ship_name}/{cruise_name}/{sensor_name}/{zarr_store}\"\n\n# Map S3 path to a zarr store and open (consolidated=None to let xarray infer metadata)\nstore = s3fs.S3Map(root=s3_zarr_store_path, s3=s3_file_system, check=False)\ncruise = xr.open_zarr(store=store, consolidated=None)\n\n# Time/depth subset and single-frequency selection\nstart_time = \"2019-10-16T15:00:00\"\nend_time = \"2019-10-16T23:30:00\"\ntimeslice = slice(start_time, end_time)\ndepths=slice(10, 250)\ncruise = cruise.sel(time=timeslice, depth=depths, drop=False)\ncruise = cruise.sel(frequency=38000, method='nearest').compute()  # materialize after selection\ncruise = cruise.where(cruise.depth < cruise.bottom, drop=True)    # remove bins below bottom\n\n# Timestamps for later alignment\nhm_timestamps = cruise.time.values.tolist()","key":"pNMYfTrgDR"},{"type":"output","id":"D7gxAgHn09I0yBk89I2d2","data":[],"key":"R5awOjkszr"}],"key":"sVQSwyY8KH"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3) Accessing buoy data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mxK1DlKosq"}],"identifier":"id-3-accessing-buoy-data","label":"3) Accessing buoy data","html_id":"id-3-accessing-buoy-data","implicit":true,"key":"OIhkocrxxj"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Defines a buoy location on Georges Bank (longitude converted to 0–360).","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"gfYFsLkO24"}],"key":"mTkaKW5NEv"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Optional: Loads three daily OISST files and samples SST at the nearest grid point (day before, day of, day after).","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"QcnTV2HRnj"}],"key":"eSXM87yn0r"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"ERDDAP buoy environmental data.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"neYOywq3wj"}],"key":"joti2sJogC"}],"key":"E4aLQCj0DM"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Sets ERDDAP dataset parameters and enforces a max_days cap by adjusting end_date_time if needed.\nReads station metadata to extract lon/lat and wind-speed units; prepares a conversion to knots.\nPulls a table of time, wind_speed, SST, significant wave height, converts wind speed to knots, indexes by time.\nFilters to the requested window and keeps the first nine rows (intentional truncation for later alignment).","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"nsxJXK7roi"}],"key":"Q1yPjYjfFL"}],"key":"XH9sqwr95G"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Location of one specific buoy located on Georges Bank\ntarget_lon = 360 - 66.546  # convert from -180..180 to 0..360\ntarget_lat = 41.088\n\n# ______________OPTIONAL BUOY DATA FROM NCAR/UCAR______________\n# print(f\"Target coordinates: Longitude: {target_lon}, Latitude: {target_lat}\")\n#\n# # Accessing stationary buoy data (daily OISST files); select nearest grid cell\n# buoy_data_day_before = xr.open_dataset(\n#     'https://data.rda.ucar.edu/d277007/avhrr_v2.1/2019/oisst-avhrr-v02r01.20191015.nc#mode=bytes', engine='netcdf4')\n# buoy_data_actual_day = xr.open_dataset(\n#     'https://data.rda.ucar.edu/d277007/avhrr_v2.1/2019/oisst-avhrr-v02r01.20191016.nc#mode=bytes',\n#     engine='netcdf4')\n# buoy_data_day_after = xr.open_dataset(\n#     'https://data.rda.ucar.edu/d277007/avhrr_v2.1/2019/oisst-avhrr-v02r01.20191017.nc#mode=bytes',\n#     engine='netcdf4')\n#\n# sst_day_before = buoy_data_day_before['sst'].sel(lon=target_lon, lat=target_lat, method='nearest').values[0][0]\n# sst_actual_day = buoy_data_actual_day['sst'].sel(lon=target_lon, lat=target_lat, method='nearest').values[0][0]\n# sst_day_after = buoy_data_day_after['sst'].sel(lon=target_lon, lat=target_lat, method='nearest').values[0][0]\n# ______________________________________________________________\n\n# The following code has been copied from https://github.com/ioos/soundcoop/blob/main/3_HMD_environmental_data/plot_sound_environmental_and_climatology_data.ipynb in order to access buoy environmental data.\n\nerddap_dataset = 'gov-ndbc-44005'\nsound_dataset = 'Monh'\nmax_days = 25\nstart_date_time = '2019-10-16T14:00:00.000'\nend_date_time = '2021-10-16T23:30:00.000'\nmin_frequency = 21\nmax_frequency = 24000\n\nerddap_base_url = 'https://erddap.sensors.ioos.us/erddap'\n\n# Cap the end date if requested range exceeds max_days\ntime_delta = datetime.fromisoformat(end_date_time) - datetime.fromisoformat(start_date_time)\nif time_delta.days > max_days:\n    end_date_time = str(datetime.fromisoformat(start_date_time) + timedelta(days=max_days))\n    print(f'end_date_time updated to {end_date_time}')\n\n# Get station lon/lat and units from ERDDAP metadata (CSV)\nerddap_metadata_url = f'{erddap_base_url}/info/{erddap_dataset}/index.csv'\nenv_metadata_df = pd.read_csv(erddap_metadata_url)\n\nenv_station_x = env_metadata_df.loc[env_metadata_df['Attribute Name'] == 'geospatial_lon_min']['Value'].item()\nenv_station_y = env_metadata_df.loc[env_metadata_df['Attribute Name'] == 'geospatial_lat_min']['Value'].item()\n\n# Determine wind_speed units to convert to knots\nwind_speed_units_row = env_metadata_df[\n    (env_metadata_df['Row Type'] == 'attribute') &\n    (env_metadata_df['Attribute Name'] == 'units') &\n    (env_metadata_df['Variable Name'] == 'wind_speed')\n    ]\nwind_speed_units = wind_speed_units_row.iloc[0]['Value']\nprint(wind_speed_units)\n\nwind_speed_to_kts_factors = {\n    \"m.s-1\": 1.94384,\n    \"mph\": 0.86897423357831,\n    \"kmh\": 0.53995555554212126825,\n    \"ft.s-1\": 0.59248243198521155506\n}\n\nif wind_speed_units in wind_speed_to_kts_factors:\n    print(\"Success! Units can be converted from\", wind_speed_units, 'to', 'kts')\nelse:\n    print(\"Error! Wind speed cannot be converted from\", wind_speed_units, 'to', 'kts')\n\nwind_var = 'wind_speed'\nswt_var = 'sea_surface_temperature'\nwave_var = 'sea_surface_wave_significant_height'\nanomaly_var = 'swt_anomaly'\nwind_var_kts = 'wind_speed_kts'\n\n# Build ERDDAP tabledap query URL\nerddap_dataset_url = (\n    f'{erddap_base_url}/tabledap/{erddap_dataset}.csv'\n    f'?time,{wind_var},{swt_var},{wave_var}'\n)\n\n# Read dataset (skip the second row of units)\nenv_df = pd.read_csv(\n    erddap_dataset_url,\n    skiprows=[1]  # The second row (index 1) are the column units, which we don't need\n)\n\n# Format time, convert wind speed to knots, index by time\nenv_df['time'] = pd.to_datetime(env_df['time'])\nenv_df['wind_speed_kts'] = env_df['wind_speed'].apply(lambda x: x * wind_speed_to_kts_factors[wind_speed_units])\ndel env_df['wind_speed']\nenv_df = env_df.set_index('time').sort_index()\n\n# Filter by requested time window and keep first 9 rows (drops the rest)\nenv_df = env_df[(env_df.index > start_date_time) & (env_df.index < end_date_time)]\nenv_df.drop(env_df.tail(-9).index,inplace=True)\n# env_df","key":"r46FyeTj2t"},{"type":"output","id":"cpshahHJH9EMYgZhAfwjc","data":[{"output_type":"stream","name":"stdout","text":"end_date_time updated to 2019-11-10 14:00:00\n"},{"output_type":"stream","name":"stdout","text":"m.s-1\nSuccess! Units can be converted from m.s-1 to kts\n"}],"key":"hxiN0NkZeO"}],"key":"v6vSC8v4df"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"4) Downloading external error map for the specific location.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lucvgxsjLl"}],"identifier":"id-4-downloading-external-error-map-for-the-specific-location","label":"4) Downloading external error map for the specific location.","html_id":"id-4-downloading-external-error-map-for-the-specific-location","implicit":true,"key":"MLQeLHlyXV"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Currently the error map comes from a fixed file; our plan is to switch to a dynamic AWS download that accepts location parameters.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"AQyVnVwKb2"}],"key":"hA37SWF3sT"}],"key":"QW1RavR0cV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Downloading anomaly detection model error map from NCAR via OSDF\nresponse = requests.get('https://data-osdf.rda.ucar.edu/ncar/rda/pythia_2025/osdf-cookbook/mae_error_map.npy')\nresponse.raise_for_status()\nerror_map = np.load(io.BytesIO(response.content))","key":"iEoRtXJSby"},{"type":"output","id":"ZSTW8JBNaVLGCfCSB3kxR","data":[],"key":"sbTRKLb2VV"}],"key":"dOHYGSTtBb"},{"type":"block","kind":"notebook-content","children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"g0WmV92K3I"}],"key":"fCCxM2luVb"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"5) Helper: mean Sv in dB","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RllIYr5WdD"}],"identifier":"id-5-helper-mean-sv-in-db","label":"5) Helper: mean Sv in dB","html_id":"id-5-helper-mean-sv-in-db","implicit":true,"key":"WYHqy4pqEx"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Computes the mean of Sv correctly by converting dB → linear, averaging, then linear → dB.\nAccepts array-like input (NumPy/xarray/dask); returns a scalar in dB.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"QsDdWSIYMe"}],"key":"tcFBxk9qK3"}],"key":"dQgT1OUAu9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def calculate_sv_mean(input_sv):\n    # Convert dB to linear, mean in linear space, convert back to dB\n    sv = 10. ** (input_sv / 10.)\n    return 10 * np.log10(np.mean(sv))","key":"XaM1mdM5bX"},{"type":"output","id":"8-QriDa0xndUwyK8o0dNo","data":[],"key":"mxE3udfWjD"}],"key":"qa3Jjagy56"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"6) Group cruise data into hourly chunks","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bwLbodt54n"}],"identifier":"id-6-group-cruise-data-into-hourly-chunks","label":"6) Group cruise data into hourly chunks","html_id":"id-6-group-cruise-data-into-hourly-chunks","implicit":true,"key":"FN6MKvgG2p"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Adds an hourly label and groups the cruise data by hour.\nProduces a list of per-hour xarray.Dataset chunks for downstream aggregation.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"oePqQg2xiA"}],"key":"OqoHEsY9Cx"}],"key":"McEBkoi0C4"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"cruise['time_hour'] = cruise['time'].dt.floor('1h')  # hourly bin label\n\n# Group by each hour\ngrouped = cruise.groupby('time_hour')\n\n# Extract each 1-hour Dataset as a chunk (drop helper label)\nchunks = [group.drop_vars('time_hour') for _, group in grouped]","key":"woALDOMwPT"},{"type":"output","id":"piF2kUVrcRiQlnVwW8cwg","data":[],"key":"n1FPSeBh3P"}],"key":"YUdyZ3vbaq"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"7) Compute hourly mean Sv and attach to env_df","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ug94Too9v8"}],"identifier":"id-7-compute-hourly-mean-sv-and-attach-to-env-df","label":"7) Compute hourly mean Sv and attach to env_df","html_id":"id-7-compute-hourly-mean-sv-and-attach-to-env-df","implicit":true,"key":"TzJNEbTCE2"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Iterates over hourly chunks, computes mean Sv per hour using calculate_sv_mean.\nConverts dask→NumPy→Python float and appends to a list.\nAssigns the resulting hourly series to env_df[“sv_hourly”].\nAssumes the number/order of hours matches rows retained in env_df.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"XOBY43qlFv"}],"key":"G4ick379H2"}],"key":"U5Iddd4BRX"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"sv_hourly = []\ntimestamps = []\n\nfor i in range(0,len(chunks)):\n    sv_data = chunks[i]['Sv']\n    result = calculate_sv_mean(sv_data)\n\n    # Use first time in hour as representative timestamp\n    ts = pd.to_datetime(chunks[i]['time'].values[0])\n    result = result.compute()           # dask -> numpy\n    result = float(result.values)       # numpy -> Python float\n\n    sv_hourly.append(result)\n\nenv_df[\"sv_hourly\"] = sv_hourly","key":"MCgio1bLLm"},{"type":"output","id":"RGpycU1wIejHuX7kVJDOq","data":[],"key":"wRc0YZCTJz"}],"key":"hdw6Kehqhh"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"8) Build (depth × time) error-map DataFrame and align timestamps","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"O0y2HOeB5N"}],"identifier":"id-8-build-depth-time-error-map-dataframe-and-align-timestamps","label":"8) Build (depth × time) error-map DataFrame and align timestamps","html_id":"id-8-build-depth-time-error-map-dataframe-and-align-timestamps","implicit":true,"key":"rYiBNU9pD6"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Extracts one channel from error_map and pairs it with cruise depths and timestamps to form a DataFrame.\nUses min(...) to guard against size mismatches in depth/time dimensions.\nAligns only the first and last timestamps in env_df to the heatmap’s time range (keeps interior indices unchanged, sets UTC).","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"weml7G4VRj"}],"key":"rGgAVnNwLp"}],"key":"fHwCVnEkjd"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Prepare axes\ndepths = np.asarray(cruise.depth.values)\ntimes  = pd.to_datetime(hm_timestamps)\n\n# Select channel/slice from error_map\nvals = error_map[:, :, 1]  # (1088, 28096)\n\n# Guard against mismatched sizes\nn_depth = min(len(depths), vals.shape[0])\nn_time  = min(len(times),  vals.shape[1])\n\n# DataFrame: rows=depths, cols=timestamps\ndf = pd.DataFrame(\n    data=vals[:n_depth, :n_time],\n    index=depths[:n_depth],\n    columns=times[:n_time]\n)\n\n# Align env_df index endpoints to heatmap timestamps (keeps interior unchanged)\nidx = env_df.index.tolist()\ndf_timestamps = pd.to_datetime(df.columns).tz_localize(None)\nidx[0] = pd.Timestamp(df_timestamps.values[0], tz='UTC').floor(\"s\")\nidx[-1] = pd.Timestamp(df_timestamps.values[-1], tz='UTC').floor(\"s\")\nenv_df.index = idx","key":"GqGJtlg4Xe"},{"type":"output","id":"YSdtzQ3kiKUbgXE_Ip-8A","data":[],"key":"YoChnRq9Lq"}],"key":"lKa67Us1tJ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"9) Data Visualization: Synchronized Lines + Heatmap","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pAAW6hRa5H"}],"identifier":"id-9-data-visualization-synchronized-lines-heatmap","label":"9) Data Visualization: Synchronized Lines + Heatmap","html_id":"id-9-data-visualization-synchronized-lines-heatmap","implicit":true,"key":"KlRFIHK4Wh"}],"key":"OzhPKCWt0F"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Plots synchronized data: top = time series from line_df; bottom = depth×time heatmap from heatmap_df.\nExpects line_df to have a DatetimeIndex (timezone-naive or converted).\nDepth axis is reversed (surface at top).\nSaves an interactive HTML file to the parent directory (out.html) and shows the figure if show=True.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EmjoGTdjsv"}],"key":"bDWt9VBnlf"}],"key":"hRSbyHXN7j"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def plot_synchronized_heatmaps_from_df(\n    heatmap_df: pd.DataFrame,  # rows = depths, columns = timestamps\n    line_df: pd.DataFrame,\n    colorscale: str = \"Reds\",\n    show_markers: bool = False,\n    show: bool = False,\n):\n    # --- Validate line_df ---\n    if not isinstance(line_df.index, pd.DatetimeIndex):\n        raise TypeError(\"line_df must have a DatetimeIndex\")\n    line_df = line_df.copy()\n    if line_df.index.tz is not None:\n        line_df.index = line_df.index.tz_convert(None)\n\n    # --- Extract axis values from heatmap_df ---\n    depths = np.asarray(heatmap_df.index)\n    heatmap_timestamps = pd.to_datetime(heatmap_df.columns)\n    z = heatmap_df.to_numpy()\n\n    # --- Build figure ---\n    fig = make_subplots(\n        rows=2,\n        cols=1,\n        shared_xaxes=True,\n        vertical_spacing=0.03,\n        row_heights=[0.3, 0.7]  # smaller line plot, bigger heatmap\n    )\n\n    # Top panel: line plots\n    mode = \"lines+markers\" if show_markers else \"lines\"\n    for col in line_df.columns:\n        fig.add_trace(\n            go.Scatter(\n                x=line_df.index,\n                y=line_df[col],\n                name=str(col),\n                mode=mode\n            ),\n            row=1, col=1\n        )\n\n    # Bottom panel: heatmap\n    fig.add_trace(\n        go.Heatmap(\n            z=z,\n            x=heatmap_timestamps,\n            y=depths,\n            colorscale=colorscale,\n            zmin=np.nanmin(z),\n            zmax=np.nanmax(z),\n            colorbar_len=0.28,\n            colorbar_y=0.14,\n            hovertemplate=\"t=%{x}<br>depth=%{y}<br>value=%{z}<extra></extra>\",\n        ),\n        row=2, col=1\n    )\n\n    fig.update_yaxes(autorange=\"reversed\", row=2, col=1, title_text=\"Depth\")\n    fig.update_layout(\n        legend_title_text=\"Signals\",\n        margin=dict(l=60, r=40, t=40, b=40),\n        hovermode=\"x unified\",\n        template=\"plotly_white\",\n        height=700\n    )\n\n    # Save/show\n    save_path = os.path.join(os.path.dirname(os.getcwd()), \"out.html\")  # saves HTML in parent dir\n    fig.write_html(save_path)\n    print(f\"Plot saved to: {save_path}\")\n    if show:\n        fig.show()\n\n    return fig\n\n# Create synchronized line+heatmap figure\nfig = plot_synchronized_heatmaps_from_df(heatmap_df=df, line_df=env_df, show=True)\n\n# fig.show()","key":"rRTsdkTOs0"},{"type":"output","id":"MOCjjsqm-ClUqae4co7pF","data":[{"output_type":"stream","name":"stdout","text":"Plot saved to: /home/runner/work/osdf-cookbook/osdf-cookbook/out.html\n"},{"output_type":"display_data","metadata":{},"data":{"application/vnd.plotly.v1+json":{"content_type":"application/vnd.plotly.v1+json","hash":"bd769bde022e393b87d20e82baceff58","path":"/osdf-cookbook/build/bd769bde022e393b87d20e82baceff58.json"}}}],"key":"Ne2BbIa6Ut"}],"key":"tYkJwhFJmq"}],"key":"hWocki9uXJ"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Integrating sonar and buoy-based temperature data","url":"/notebooks/sonarai-foundations","group":"NOAA SONAR data examples"},"next":{"title":"Use the GeoJSON file to get the Area of Interest and query the STAC catalog for items","url":"/notebooks/pycogss-spectral-change","group":"PYCOGSS examples"}}},"domain":"http://localhost:3000"}